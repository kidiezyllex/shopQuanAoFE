import{j as e}from"./ui-vendor-CFM_MCUz.js";import{r as s}from"./react-vendor-B55MjJUH.js";import{C as a,c as t}from"./card-ClEzRAeX.js";import{t as n,v as i,w as r,B as l,I as c,A as h,b as d,c as x,D as o,a as m,d as j,g as u,f as g,y as p}from"./index-BHeY-5EX.js";import{t as N,a5 as v,ad as f,ae as b,aC as y,P as k,aF as O,aG as T,W as C,aH as H,a7 as w,ah as A}from"./icons-vendor-BrsZP2ku.js";import{B as z}from"./badge-BeHegjHt.js";import{D,a as _,b as I,c as G,d as K,e as S,g as P}from"./dialog-Va24CY58.js";import{S as F,a as M,b as V,c as B,d as X}from"./select-C6W71KWg.js";import{T as E,a as Q,b as q,c as U,d as $,e as L}from"./table-DL-K3PV4.js";import{d as R}from"./query-vendor-CBwfxcof.js";import{B as W,a as J,b as Y,c as Z,d as ee,e as se}from"./breadcrumb-CP4jYkI2.js";import{A as ae,m as te}from"./heavy-vendor-BfN2pHnQ.js";import{f as ne}from"./utils-vendor-C6znz4jh.js";import{l as ie}from"./index-DwIVA3Vd.js";function re(){const[re,le]=s.useState(""),[ce,he]=s.useState({page:1,limit:10}),[de,xe]=s.useState(!1),[oe,me]=s.useState(!1),[je,ue]=s.useState(null),[ge,pe]=s.useState(!1),[Ne,ve]=s.useState(null),[fe,be]=s.useState("HOAT_DONG"),{data:ye,isLoading:ke,error:Oe}=n(ce),Te=i(),Ce=r((null==Ne?void 0:Ne.id)||""),He=R();s.useEffect((()=>{const e=setTimeout((()=>{if(re.trim())he((e=>({...e,search:re,page:1})));else{const{search:e,...s}=ce;he({...s,page:1})}}),500);return()=>clearTimeout(e)}),[re]);const we=(e,s)=>{if(""===s){const s={...ce};delete s[e],he({...s,page:1})}else he({...ce,[e]:s,page:1})},Ae=e=>{he({...ce,page:e})},ze=s=>{switch(s){case"ADMIN":return e.jsx(z,{className:"bg-purple-600 text-white hover:bg-purple-700",children:"Quản trị viên"});case"STAFF":return e.jsx(z,{className:"bg-blue-600 text-white hover:bg-blue-700",children:"Nhân viên"});case"CUSTOMER":return e.jsx(z,{className:"bg-slate-600 text-white hover:bg-slate-700",children:"Khách hàng"});default:return e.jsx(z,{className:"bg-gray-500 text-white hover:bg-gray-600",children:s})}},De=s=>{switch(s){case"HOAT_DONG":return e.jsx(z,{className:"bg-green-600 text-white hover:bg-green-700",children:"Hoạt động"});case"KHONG_HOAT_DONG":return e.jsx(z,{className:"bg-red-600 text-white hover:bg-red-700",children:"Không hoạt động"});default:return e.jsx(z,{className:"bg-gray-500 text-white hover:bg-gray-600",children:s})}},_e=(e,s)=>{ve(e),be(s),pe(!0)};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(W,{children:e.jsxs(J,{children:[e.jsx(Y,{children:e.jsx(Z,{href:"/admin/statistics",children:"Dashboard"})}),e.jsx(ee,{}),e.jsx(Y,{children:e.jsx(Z,{href:"#",children:"Quản lý người dùng"})}),e.jsx(ee,{}),e.jsx(Y,{children:e.jsx(se,{children:"Danh sách tài khoản"})})]})}),e.jsx("a",{href:"/admin/accounts/create",className:"flex items-center gap-2",children:e.jsxs(l,{className:"flex items-center gap-2",children:[e.jsx(N.Icon,{path:v,size:.7}),"Thêm tài khoản mới"]})})]}),e.jsx(a,{className:"mb-4",children:e.jsxs(t,{className:"py-4",children:[e.jsxs("div",{className:"flex flex-col space-y-4 md:space-y-0 md:flex-row md:justify-between md:items-center gap-2",children:[e.jsxs("div",{className:"relative flex-1 max-w-4xl",children:[e.jsx(N.Icon,{path:f,size:.7,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-maintext"}),e.jsx(c,{type:"text",placeholder:"Tìm kiếm theo tên, email, số điện thoại...",className:"pl-10 pr-4 py-2 w-full border rounded-[6px]",value:re,onChange:e=>le(e.target.value)})]}),e.jsxs(l,{variant:"outline",className:"flex items-center",onClick:()=>xe(!de),children:[e.jsx(N.Icon,{path:b,size:.7,className:"mr-2"}),de?"Ẩn bộ lọc":"Hiện bộ lọc"]})]}),e.jsx(ae,{children:de&&e.jsx(te.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3},className:"mt-4 pt-4 border-t",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-maintext mb-2 font-semibold",children:"Vai trò"}),e.jsxs(F,{value:ce.role||"",onValueChange:e=>we("role","all"===e?void 0:e),children:[e.jsx(M,{children:e.jsx(V,{placeholder:"Tất cả vai trò"})}),e.jsxs(B,{children:[e.jsx(X,{value:"all",children:"Tất cả vai trò"}),e.jsx(X,{value:"ADMIN",children:"Quản trị viên"}),e.jsx(X,{value:"CUSTOMER",children:"Khách hàng"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-maintext mb-2 font-semibold",children:"Trạng thái"}),e.jsxs(F,{value:ce.status||"",onValueChange:e=>we("status","all"===e?void 0:e),children:[e.jsx(M,{children:e.jsx(V,{placeholder:"Tất cả trạng thái"})}),e.jsxs(B,{children:[e.jsx(X,{value:"all",children:"Tất cả trạng thái"}),e.jsx(X,{value:"HOAT_DONG",children:"Hoạt động"}),e.jsx(X,{value:"KHONG_HOAT_DONG",children:"Không hoạt động"})]})]})]})]})})})]})}),e.jsx(a,{children:e.jsx(t,{className:"p-0",children:ke?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(N.Icon,{path:y,size:2,className:"animate-spin text-primary"})}):Oe?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64",children:[e.jsx("h2",{className:"text-xl font-bold text-red-500",children:"Đã xảy ra lỗi"}),e.jsx("p",{className:"text-maintext",children:Oe.message||"Không thể tải dữ liệu tài khoản"})]}):e.jsxs(e.Fragment,{children:[e.jsxs(E,{children:[e.jsx(Q,{children:e.jsxs(q,{children:[e.jsx(U,{children:"Tài khoản"}),e.jsx(U,{children:"Liên hệ"}),e.jsx(U,{children:"Vai trò"}),e.jsx(U,{children:"Trạng thái"}),e.jsx(U,{children:"Ngày tạo"}),e.jsx(U,{className:"text-right",children:"Thao tác"})]})}),e.jsx($,{children:0===(null==ye?void 0:ye.data.accounts.length)?e.jsx(q,{children:e.jsx(L,{colSpan:6,className:"text-center py-8 text-maintext",children:"Không có tài khoản nào được tìm thấy"})}):null==ye?void 0:ye.data.accounts.map((s=>{return e.jsxs(q,{className:"hover:bg-gray-50",children:[e.jsx(L,{className:"py-3 px-4",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"p-0.5 rounded-full bg-gradient-to-tr from-yellow-400 via-red-500 to-purple-600",children:e.jsxs(h,{className:"h-10 w-10 border-2 border-white rounded-full",children:[e.jsx(d,{src:`/images/dfavatar${Math.floor(4*Math.random())+1}.png`,alt:`${s.fullName} avatar`}),e.jsx(x,{className:"bg-gray-200 text-maintext",children:(t=s.fullName,t.split(" ").map((e=>e[0])).join("").toUpperCase().substring(0,2))})]})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-maintext",children:s.fullName}),e.jsx("div",{className:"text-sm text-maintext",children:s.email})]})]})}),e.jsx(L,{className:"py-3 px-4 text-sm text-maintext",children:s.phoneNumber&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(N.Icon,{path:k,size:.7,className:"mr-2 text-maintext"}),s.phoneNumber]})}),e.jsx(L,{className:"py-3 px-4",children:ze(s.role)}),e.jsx(L,{className:"py-3 px-4",children:De(s.status)}),e.jsx(L,{className:"py-3 px-4 text-sm text-maintext",children:(a=s.createdAt,a?ne(new Date(a),"dd/MM/yyyy HH:mm",{locale:ie}):"Chưa xác định")}),e.jsx(L,{className:"py-3 px-4 text-right",children:e.jsxs(o,{children:[e.jsx(m,{asChild:!0,children:e.jsx(l,{size:"icon",variant:"outline",children:e.jsx(N.Icon,{path:O,size:.7})})}),e.jsxs(j,{align:"end",children:[e.jsx("a",{href:`/admin/accounts/edit/${s.id}`,passHref:!0,children:e.jsxs(u,{className:"cursor-pointer text-maintext",children:[e.jsx(N.Icon,{path:T,size:.7,className:"mr-2"}),e.jsx("span",{className:"text-maintext",children:"Chỉnh sửa"})]})}),e.jsx(g,{}),"HOAT_DONG"===s.status?e.jsxs(u,{className:"cursor-pointer text-maintext",onClick:()=>_e(s,"KHONG_HOAT_DONG"),children:[e.jsx(N.Icon,{path:C,size:.7,className:"mr-2"}),e.jsx("span",{className:"text-maintext",children:"Vô hiệu hóa"})]}):e.jsxs(u,{className:"cursor-pointer text-maintext",onClick:()=>_e(s,"HOAT_DONG"),children:[e.jsx(N.Icon,{path:H,size:.7,className:"mr-2"}),e.jsx("span",{className:"text-maintext",children:"Kích hoạt"})]}),e.jsx(g,{}),e.jsxs(u,{className:"cursor-pointer text-red-600",onClick:()=>(e=>{ue(e),me(!0)})(s),children:[e.jsx(N.Icon,{path:w,size:.7,className:"mr-2"}),e.jsx("span",{className:"text-red-600",children:"Xóa tài khoản"})]})]})]})})]},s.id);var a,t}))})]}),(null==ye?void 0:ye.data.pagination)&&ye.data.pagination.totalPages>1&&e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-t",children:[e.jsxs("div",{className:"text-sm text-maintext",children:["Hiển thị ",(ye.data.pagination.currentPage-1)*(ce.limit||10)+1," đến"," ",Math.min(ye.data.pagination.currentPage*(ce.limit||10),ye.data.pagination.count)," ","trong tổng số ",ye.data.pagination.count," tài khoản"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(l,{variant:"outline",size:"sm",onClick:()=>Ae(ye.data.pagination.currentPage-1),disabled:1===ye.data.pagination.currentPage,children:"Trước"}),Array.from({length:ye.data.pagination.totalPages},((e,s)=>s+1)).map((s=>e.jsx(l,{variant:s===ye.data.pagination.currentPage?"default":"outline",size:"sm",onClick:()=>Ae(s),children:s},s))),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>Ae(ye.data.pagination.currentPage+1),disabled:ye.data.pagination.currentPage===ye.data.pagination.totalPages,children:"Sau"})]})]})]})})}),e.jsx(D,{open:oe,onOpenChange:me,children:e.jsxs(_,{children:[e.jsxs(I,{children:[e.jsx(G,{children:"Xác nhận xóa tài khoản"}),e.jsxs(K,{children:["Bạn có chắc chắn muốn xóa tài khoản ",e.jsx("span",{className:"font-semibold",children:null==je?void 0:je.fullName}),"?",e.jsx("br",{}),"Hành động này không thể hoàn tác."]})]}),e.jsxs(S,{className:"gap-2 sm:justify-end",children:[e.jsx(P,{asChild:!0,children:e.jsx(l,{type:"button",variant:"outline",children:"Hủy"})}),e.jsx(l,{type:"button",variant:"destructive",onClick:async()=>{if(je)try{await Te.mutateAsync(je.id,{onSuccess:()=>{p.success("Xóa tài khoản thành công"),me(!1),He.invalidateQueries({queryKey:["accounts"]})},onError:e=>{p.error("Xóa tài khoản thất bại: "+(e.message||"Không xác định"))}})}catch(e){p.error("Xóa tài khoản thất bại")}},disabled:Te.isPending,className:"flex items-center gap-2",children:Te.isPending?e.jsxs(e.Fragment,{children:[e.jsx(N.Icon,{path:y,size:.7,className:"animate-spin"}),"Đang xử lý..."]}):e.jsxs(e.Fragment,{children:[e.jsx(N.Icon,{path:w,size:.7}),"Xác nhận xóa"]})})]})]})}),e.jsx(D,{open:ge,onOpenChange:pe,children:e.jsxs(_,{children:[e.jsxs(I,{children:[e.jsx(G,{children:"HOAT_DONG"===fe?"Kích hoạt tài khoản":"Vô hiệu hóa tài khoản"}),e.jsx(K,{children:"HOAT_DONG"===fe?e.jsxs(e.Fragment,{children:["Bạn có chắc chắn muốn kích hoạt tài khoản ",e.jsx("span",{className:"font-semibold",children:null==Ne?void 0:Ne.fullName}),"?",e.jsx("br",{}),"Tài khoản này sẽ có thể đăng nhập và sử dụng hệ thống."]}):e.jsxs(e.Fragment,{children:["Bạn có chắc chắn muốn vô hiệu hóa tài khoản ",e.jsx("span",{className:"font-semibold",children:null==Ne?void 0:Ne.fullName}),"?",e.jsx("br",{}),"Tài khoản này sẽ không thể đăng nhập và sử dụng hệ thống cho đến khi được kích hoạt lại."]})})]}),e.jsxs(S,{className:"gap-2 sm:justify-end",children:[e.jsx(P,{asChild:!0,children:e.jsx(l,{type:"button",variant:"outline",children:"Hủy"})}),e.jsx(l,{type:"button",variant:"HOAT_DONG"===fe?"default":"destructive",onClick:async()=>{if(!Ne)return;const e={status:fe};try{await Ce.mutateAsync(e,{onSuccess:()=>{p.success("Cập nhật trạng thái tài khoản thành công"),pe(!1),He.invalidateQueries({queryKey:["accounts"]})},onError:e=>{p.error("Cập nhật trạng thái tài khoản thất bại: "+(e.message||"Không xác định"))}})}catch(s){p.error("Cập nhật trạng thái tài khoản thất bại")}},disabled:Ce.isPending,className:"flex items-center gap-2",children:Ce.isPending?e.jsxs(e.Fragment,{children:[e.jsx(N.Icon,{path:y,size:.7,className:"animate-spin"}),"Đang xử lý..."]}):"HOAT_DONG"===fe?e.jsxs(e.Fragment,{children:[e.jsx(N.Icon,{path:A,size:.7}),"Kích hoạt"]}):e.jsxs(e.Fragment,{children:[e.jsx(N.Icon,{path:C,size:.7}),"Vô hiệu hóa"]})})]})]})})]})}const le=()=>e.jsx(re,{});export{le as default};
