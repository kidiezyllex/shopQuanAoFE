import{a as c,aZ as me,b1 as ue,b2 as ge,aJ as je,j as e,B as r,k as n,aa as pe,ao as Ne,q as be,ap as fe,A as ve,m as ye,aQ as A,J as ke,K as De,L as Ce,z as Ae,G as Oe,H as Te,b3 as we,M as Se,P as b,b4 as He,O as P,X as z,b5 as Ie,ac as F,at as Pe,a6 as d}from"./index-Dpx_4rWJ.js";import{C as B,c as K}from"./card-fT6uSY2F.js";import{B as h}from"./badge-CA2Kv9aL.js";import{D as G,a as M,b as _,c as Q,d as V,e as L,i as E}from"./dialog-BuHyDe_9.js";import{S as R,a as X,b as q,c as U,d as x}from"./select-CS4vNzI5.js";import{T as ze,a as Fe,b as O,c as m,d as Be,e as o}from"./table-BeX0puEz.js";import{B as Ke,a as Ge,b as T,c as $,d as J,e as Me}from"./breadcrumb-CJedQ5QG.js";import{f as _e,l as Qe}from"./index-VIuxkY8Z.js";import"./createLucideIcon-BdgKQErZ.js";import"./index-BdQq_4o_.js";import"./index-qvEK80KO.js";import"./check-CyKb8IHM.js";import"./typeof-QjJsDpFa.js";function Ve(){const[p,Z]=c.useState(""),[l,u]=c.useState({page:1,limit:10}),[f,W]=c.useState(!1),[Y,v]=c.useState(!1),[g,ee]=c.useState(null),[se,y]=c.useState(!1),[i,te]=c.useState(null),[j,ae]=c.useState("HOAT_DONG"),{data:t,isLoading:ne,error:w}=me(l),k=ue(),D=ge((i==null?void 0:i.id)||""),S=je();c.useEffect(()=>{const s=setTimeout(()=>{if(p.trim())u(a=>({...a,search:p,page:1}));else{const{search:a,...N}=l;u({...N,page:1})}},500);return()=>clearTimeout(s)},[p]);const H=(s,a)=>{if(a===""){const N={...l};delete N[s],u({...N,page:1})}else u({...l,[s]:a,page:1})},C=s=>{u({...l,page:s})},ie=s=>s?_e(new Date(s),"dd/MM/yyyy HH:mm",{locale:Qe}):"Chưa xác định",re=s=>{switch(s){case"ADMIN":return e.jsx(h,{className:"bg-purple-600 text-white hover:bg-purple-700",children:"Quản trị viên"});case"STAFF":return e.jsx(h,{className:"bg-blue-600 text-white hover:bg-blue-700",children:"Nhân viên"});case"CUSTOMER":return e.jsx(h,{className:"bg-slate-600 text-white hover:bg-slate-700",children:"Khách hàng"});default:return e.jsx(h,{className:"bg-gray-500 text-white hover:bg-gray-600",children:s})}},le=s=>{switch(s){case"HOAT_DONG":return e.jsx(h,{className:"bg-green-600 text-white hover:bg-green-700",children:"Hoạt động"});case"KHONG_HOAT_DONG":return e.jsx(h,{className:"bg-red-600 text-white hover:bg-red-700",children:"Không hoạt động"});default:return e.jsx(h,{className:"bg-gray-500 text-white hover:bg-gray-600",children:s})}},ce=s=>s.split(" ").map(a=>a[0]).join("").toUpperCase().substring(0,2),he=()=>`/images/dfavatar${Math.floor(Math.random()*4)+1}.png`,oe=s=>{ee(s),v(!0)},de=async()=>{if(g)try{await k.mutateAsync(g.id,{onSuccess:()=>{d.success("Xóa tài khoản thành công"),v(!1),S.invalidateQueries({queryKey:["accounts"]})},onError:s=>{d.error("Xóa tài khoản thất bại: "+(s.message||"Không xác định"))}})}catch{d.error("Xóa tài khoản thất bại")}},I=(s,a)=>{te(s),ae(a),y(!0)},xe=async()=>{if(!i)return;const s={status:j};try{await D.mutateAsync(s,{onSuccess:()=>{d.success("Cập nhật trạng thái tài khoản thành công"),y(!1),S.invalidateQueries({queryKey:["accounts"]})},onError:a=>{d.error("Cập nhật trạng thái tài khoản thất bại: "+(a.message||"Không xác định"))}})}catch{d.error("Cập nhật trạng thái tài khoản thất bại")}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(Ke,{children:e.jsxs(Ge,{children:[e.jsx(T,{children:e.jsx($,{href:"/admin/statistics",children:"Dashboard"})}),e.jsx(J,{}),e.jsx(T,{children:e.jsx($,{href:"#",children:"Quản lý người dùng"})}),e.jsx(J,{}),e.jsx(T,{children:e.jsx(Me,{children:"Danh sách tài khoản"})})]})}),e.jsx("a",{href:"/admin/accounts/create",className:"flex items-center gap-2",children:e.jsxs(r,{className:"flex items-center gap-2",children:[e.jsx(n.Icon,{path:pe,size:.7}),"Thêm tài khoản mới"]})})]}),e.jsx(B,{className:"mb-4",children:e.jsxs(K,{className:"py-4",children:[e.jsxs("div",{className:"flex flex-col space-y-4 md:space-y-0 md:flex-row md:justify-between md:items-center gap-2",children:[e.jsxs("div",{className:"relative flex-1 max-w-4xl",children:[e.jsx(n.Icon,{path:Ne,size:.7,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-maintext"}),e.jsx(be,{type:"text",placeholder:"Tìm kiếm theo tên, email, số điện thoại...",className:"pl-10 pr-4 py-2 w-full border rounded-[6px]",value:p,onChange:s=>Z(s.target.value)})]}),e.jsxs(r,{variant:"outline",className:"flex items-center",onClick:()=>W(!f),children:[e.jsx(n.Icon,{path:fe,size:.7,className:"mr-2"}),f?"Ẩn bộ lọc":"Hiện bộ lọc"]})]}),e.jsx(ve,{children:f&&e.jsx(ye.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3},className:"mt-4 pt-4 border-t",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-maintext mb-2 font-semibold",children:"Vai trò"}),e.jsxs(R,{value:l.role||"",onValueChange:s=>H("role",s==="all"?void 0:s),children:[e.jsx(X,{children:e.jsx(q,{placeholder:"Tất cả vai trò"})}),e.jsxs(U,{children:[e.jsx(x,{value:"all",children:"Tất cả vai trò"}),e.jsx(x,{value:"ADMIN",children:"Quản trị viên"}),e.jsx(x,{value:"CUSTOMER",children:"Khách hàng"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-maintext mb-2 font-semibold",children:"Trạng thái"}),e.jsxs(R,{value:l.status||"",onValueChange:s=>H("status",s==="all"?void 0:s),children:[e.jsx(X,{children:e.jsx(q,{placeholder:"Tất cả trạng thái"})}),e.jsxs(U,{children:[e.jsx(x,{value:"all",children:"Tất cả trạng thái"}),e.jsx(x,{value:"HOAT_DONG",children:"Hoạt động"}),e.jsx(x,{value:"KHONG_HOAT_DONG",children:"Không hoạt động"})]})]})]})]})})})]})}),e.jsx(B,{children:e.jsx(K,{className:"p-0",children:ne?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(n.Icon,{path:A,size:2,className:"animate-spin text-primary"})}):w?e.jsxs("div",{className:"flex flex-col items-center justify-center h-64",children:[e.jsx("h2",{className:"text-xl font-bold text-red-500",children:"Đã xảy ra lỗi"}),e.jsx("p",{className:"text-maintext",children:w.message||"Không thể tải dữ liệu tài khoản"})]}):e.jsxs(e.Fragment,{children:[e.jsxs(ze,{children:[e.jsx(Fe,{children:e.jsxs(O,{children:[e.jsx(m,{children:"Tài khoản"}),e.jsx(m,{children:"Liên hệ"}),e.jsx(m,{children:"Vai trò"}),e.jsx(m,{children:"Trạng thái"}),e.jsx(m,{children:"Ngày tạo"}),e.jsx(m,{className:"text-right",children:"Thao tác"})]})}),e.jsx(Be,{children:(t==null?void 0:t.data.accounts.length)===0?e.jsx(O,{children:e.jsx(o,{colSpan:6,className:"text-center py-8 text-maintext",children:"Không có tài khoản nào được tìm thấy"})}):t==null?void 0:t.data.accounts.map(s=>e.jsxs(O,{className:"hover:bg-gray-50",children:[e.jsx(o,{className:"py-3 px-4",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"p-0.5 rounded-full bg-gradient-to-tr from-yellow-400 via-red-500 to-purple-600",children:e.jsxs(ke,{className:"h-10 w-10 border-2 border-white rounded-full",children:[e.jsx(De,{src:he(),alt:`${s.fullName} avatar`}),e.jsx(Ce,{className:"bg-gray-200 text-maintext",children:ce(s.fullName)})]})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-maintext",children:s.fullName}),e.jsx("div",{className:"text-sm text-maintext",children:s.email})]})]})}),e.jsx(o,{className:"py-3 px-4 text-sm text-maintext",children:s.phoneNumber&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(n.Icon,{path:Ae,size:.7,className:"mr-2 text-maintext"}),s.phoneNumber]})}),e.jsx(o,{className:"py-3 px-4",children:re(s.role)}),e.jsx(o,{className:"py-3 px-4",children:le(s.status)}),e.jsx(o,{className:"py-3 px-4 text-sm text-maintext",children:ie(s.createdAt)}),e.jsx(o,{className:"py-3 px-4 text-right",children:e.jsxs(Oe,{children:[e.jsx(Te,{asChild:!0,children:e.jsx(r,{size:"icon",variant:"outline",children:e.jsx(n.Icon,{path:we,size:.7})})}),e.jsxs(Se,{align:"end",children:[e.jsx("a",{href:`/admin/accounts/edit/${s.id}`,children:e.jsxs(b,{className:"cursor-pointer text-maintext",children:[e.jsx(n.Icon,{path:He,size:.7,className:"mr-2"}),e.jsx("span",{className:"text-maintext",children:"Chỉnh sửa"})]})}),e.jsx(P,{}),s.status==="HOAT_DONG"?e.jsxs(b,{className:"cursor-pointer text-maintext",onClick:()=>I(s,"KHONG_HOAT_DONG"),children:[e.jsx(n.Icon,{path:z,size:.7,className:"mr-2"}),e.jsx("span",{className:"text-maintext",children:"Vô hiệu hóa"})]}):e.jsxs(b,{className:"cursor-pointer text-maintext",onClick:()=>I(s,"HOAT_DONG"),children:[e.jsx(n.Icon,{path:Ie,size:.7,className:"mr-2"}),e.jsx("span",{className:"text-maintext",children:"Kích hoạt"})]}),e.jsx(P,{}),e.jsxs(b,{className:"cursor-pointer text-red-600",onClick:()=>oe(s),children:[e.jsx(n.Icon,{path:F,size:.7,className:"mr-2"}),e.jsx("span",{className:"text-red-600",children:"Xóa tài khoản"})]})]})]})})]},s.id))})]}),(t==null?void 0:t.data.pagination)&&t.data.pagination.totalPages>1&&e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-t",children:[e.jsxs("div",{className:"text-sm text-maintext",children:["Hiển thị ",(t.data.pagination.currentPage-1)*(l.limit||10)+1," đến"," ",Math.min(t.data.pagination.currentPage*(l.limit||10),t.data.pagination.count)," ","trong tổng số ",t.data.pagination.count," tài khoản"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(r,{variant:"outline",size:"sm",onClick:()=>C(t.data.pagination.currentPage-1),disabled:t.data.pagination.currentPage===1,children:"Trước"}),Array.from({length:t.data.pagination.totalPages},(s,a)=>a+1).map(s=>e.jsx(r,{variant:s===t.data.pagination.currentPage?"default":"outline",size:"sm",onClick:()=>C(s),children:s},s)),e.jsx(r,{variant:"outline",size:"sm",onClick:()=>C(t.data.pagination.currentPage+1),disabled:t.data.pagination.currentPage===t.data.pagination.totalPages,children:"Sau"})]})]})]})})}),e.jsx(G,{open:Y,onOpenChange:v,children:e.jsxs(M,{children:[e.jsxs(_,{children:[e.jsx(Q,{children:"Xác nhận xóa tài khoản"}),e.jsxs(V,{children:["Bạn có chắc chắn muốn xóa tài khoản ",e.jsx("span",{className:"font-semibold",children:g==null?void 0:g.fullName}),"?",e.jsx("br",{}),"Hành động này không thể hoàn tác."]})]}),e.jsxs(L,{className:"gap-2 sm:justify-end",children:[e.jsx(E,{asChild:!0,children:e.jsx(r,{type:"button",variant:"outline",children:"Hủy"})}),e.jsx(r,{type:"button",variant:"destructive",onClick:de,disabled:k.isPending,className:"flex items-center gap-2",children:k.isPending?e.jsxs(e.Fragment,{children:[e.jsx(n.Icon,{path:A,size:.7,className:"animate-spin"}),"Đang xử lý..."]}):e.jsxs(e.Fragment,{children:[e.jsx(n.Icon,{path:F,size:.7}),"Xác nhận xóa"]})})]})]})}),e.jsx(G,{open:se,onOpenChange:y,children:e.jsxs(M,{children:[e.jsxs(_,{children:[e.jsx(Q,{children:j==="HOAT_DONG"?"Kích hoạt tài khoản":"Vô hiệu hóa tài khoản"}),e.jsx(V,{children:j==="HOAT_DONG"?e.jsxs(e.Fragment,{children:["Bạn có chắc chắn muốn kích hoạt tài khoản ",e.jsx("span",{className:"font-semibold",children:i==null?void 0:i.fullName}),"?",e.jsx("br",{}),"Tài khoản này sẽ có thể đăng nhập và sử dụng hệ thống."]}):e.jsxs(e.Fragment,{children:["Bạn có chắc chắn muốn vô hiệu hóa tài khoản ",e.jsx("span",{className:"font-semibold",children:i==null?void 0:i.fullName}),"?",e.jsx("br",{}),"Tài khoản này sẽ không thể đăng nhập và sử dụng hệ thống cho đến khi được kích hoạt lại."]})})]}),e.jsxs(L,{className:"gap-2 sm:justify-end",children:[e.jsx(E,{asChild:!0,children:e.jsx(r,{type:"button",variant:"outline",children:"Hủy"})}),e.jsx(r,{type:"button",variant:j==="HOAT_DONG"?"default":"destructive",onClick:xe,disabled:D.isPending,className:"flex items-center gap-2",children:D.isPending?e.jsxs(e.Fragment,{children:[e.jsx(n.Icon,{path:A,size:.7,className:"animate-spin"}),"Đang xử lý..."]}):j==="HOAT_DONG"?e.jsxs(e.Fragment,{children:[e.jsx(n.Icon,{path:Pe,size:.7}),"Kích hoạt"]}):e.jsxs(e.Fragment,{children:[e.jsx(n.Icon,{path:z,size:.7}),"Vô hiệu hóa"]})})]})]})})]})}const ts=()=>e.jsx(Ve,{});export{ts as default};
