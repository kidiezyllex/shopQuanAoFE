import{U as Ce,a,j as e,B as d,k as H,w as Se,aa as Te,q as h,bq as Pe,a6 as u}from"./index-Dpx_4rWJ.js";import{C as v,a as N,b as y,c as f}from"./card-fT6uSY2F.js";import{L as i}from"./label-B0XdI4bT.js";import{S as b,a as C,b as S,c as T,d as r}from"./select-CS4vNzI5.js";import{S as we}from"./separator-vZGg2kit.js";import{b as Ie}from"./order-Cuy2edjT.js";import{B as ke,a as De,b as O,c as Y,d as Z,e as Fe}from"./breadcrumb-CJedQ5QG.js";import{u as qe}from"./product-SA3ZOUlJ.js";import{T as $,a as ee,b as P,c as o,d as se,e as m}from"./table-BeX0puEz.js";import{D as Ae,a as Ve,b as Be,c as He,e as Oe}from"./dialog-BuHyDe_9.js";import"./index-BdQq_4o_.js";import"./index-qvEK80KO.js";import"./createLucideIcon-BdgKQErZ.js";import"./check-CyKb8IHM.js";function Ee(){const E=Ce(),ne=Ie(),[z,L]=a.useState(!1),[M,ae]=a.useState(""),[te,j]=a.useState(!1),[c,w]=a.useState([]),[Q,ie]=a.useState(""),[R,re]=a.useState(""),[ce,le]=a.useState(""),[I,he]=a.useState(""),[k,de]=a.useState(""),[D,oe]=a.useState(""),[p,me]=a.useState(""),[g,xe]=a.useState(""),[F,ue]=a.useState(""),[G,je]=a.useState("CASH"),[X,pe]=a.useState(""),[q,ge]=a.useState(0),[x,ve]=a.useState(0),[A,Ne]=a.useState(0),{data:V}=qe({name:M,limit:10,status:"HOAT_DONG"});a.useEffect(()=>{const s=c.reduce((n,t)=>n+t.price*t.quantity,0);ge(s),ve(0),Ne(s-x)},[c,x]);const ye=s=>{var t,K,_,U,W,J;const n={product:s.id,variant:{colorId:((_=(K=(t=s.variants)==null?void 0:t[0])==null?void 0:K.color)==null?void 0:_.id)||"",sizeId:((J=(W=(U=s.variants)==null?void 0:U[0])==null?void 0:W.size)==null?void 0:J.id)||""},quantity:1,price:s.salePrice||s.regularPrice};w([...c,n]),j(!1)},fe=s=>{const n=[...c];n.splice(s,1),w(n)},B=(s,n)=>{if(n<1)return;const t=[...c];t[s].quantity=n,w(t)},be=async s=>{if(s.preventDefault(),c.length===0){u.error("Vui lòng thêm ít nhất một sản phẩm vào đơn hàng");return}if(!Q||!R){u.error("Vui lòng nhập thông tin khách hàng");return}if(!I||!k||!D||!p||!g||!F){u.error("Vui lòng nhập đầy đủ thông tin giao hàng");return}L(!0);try{const t={customer:"64f720fb93a46d138d413045",items:c,voucher:X||"",subTotal:q,discount:x,total:A,shippingAddress:{name:I,phoneNumber:k,provinceId:p,districtId:g,wardId:F,specificAddress:D},paymentMethod:G};await ne.mutateAsync(t,{onSuccess:()=>{u.success("Tạo đơn hàng thành công"),E("/admin/orders")}})}catch{u.error("Tạo đơn hàng thất bại")}finally{L(!1)}},l=s=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND",maximumFractionDigits:0}).format(s);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(ke,{children:e.jsxs(De,{children:[e.jsx(O,{children:e.jsx(Y,{href:"/admin/statistics",children:"Dashboard"})}),e.jsx(Z,{}),e.jsx(O,{children:e.jsx(Y,{href:"/admin/orders",children:"Quản lý đơn hàng"})}),e.jsx(Z,{}),e.jsx(O,{children:e.jsx(Fe,{children:"Tạo đơn hàng mới"})})]})}),e.jsxs(d,{variant:"outline",onClick:()=>E(-1),children:[e.jsx(H.Icon,{path:Se,size:.7,className:"mr-2"}),"Quay lại"]})]}),e.jsx("form",{onSubmit:be,children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[e.jsxs(v,{children:[e.jsxs(N,{className:"flex flex-row items-center justify-between",children:[e.jsx(y,{children:"Sản phẩm"}),e.jsxs(d,{type:"button",onClick:()=>j(!0),children:[e.jsx(H.Icon,{path:Te,size:.7,className:"mr-2"}),"Thêm sản phẩm"]})]}),e.jsxs(f,{children:[c.length===0?e.jsx("div",{className:"text-center py-4 border rounded-[6px]",children:e.jsx("p",{className:"text-maintext",children:"Chưa có sản phẩm nào. Vui lòng thêm sản phẩm vào đơn hàng."})}):e.jsx("div",{className:"border rounded-[6px]",children:e.jsxs($,{children:[e.jsx(ee,{children:e.jsxs(P,{children:[e.jsx(o,{children:"Sản phẩm"}),e.jsx(o,{className:"text-right",children:"Đơn giá"}),e.jsx(o,{className:"text-center",children:"Số lượng"}),e.jsx(o,{className:"text-right",children:"Thành tiền"}),e.jsx(o,{})]})}),e.jsx(se,{children:c.map((s,n)=>e.jsxs(P,{children:[e.jsxs(m,{children:["Product ",n+1," (",s.product,")"]}),e.jsx(m,{className:"text-right",children:l(s.price)}),e.jsx(m,{className:"text-center",children:e.jsxs("div",{className:"flex justify-center items-center",children:[e.jsx(d,{type:"button",variant:"outline",size:"icon",className:"h-8 w-8",onClick:()=>B(n,s.quantity-1),children:"-"}),e.jsx(h,{type:"number",value:s.quantity,onChange:t=>B(n,parseInt(t.target.value)),className:"w-16 mx-2 text-center",min:1}),e.jsx(d,{type:"button",variant:"outline",size:"icon",className:"h-8 w-8",onClick:()=>B(n,s.quantity+1),children:"+"})]})}),e.jsx(m,{className:"text-right",children:l(s.price*s.quantity)}),e.jsx(m,{children:e.jsx(d,{type:"button",variant:"ghost",size:"icon",onClick:()=>fe(n),children:e.jsx(H.Icon,{path:Pe,size:.7})})})]},n))})]})}),e.jsxs("div",{className:"mt-4 space-y-2 border-t pt-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"Tổng tiền sản phẩm:"}),e.jsx("span",{className:"font-medium",children:l(q)})]}),x>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"Giảm giá:"}),e.jsxs("span",{className:"font-medium text-red-500",children:["-",l(x)]})]}),e.jsxs("div",{className:"flex justify-between border-t pt-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Tổng thanh toán:"}),e.jsx("span",{className:"text-lg font-bold",children:l(A)})]})]})]})]}),e.jsxs(v,{children:[e.jsx(N,{children:e.jsx(y,{children:"Thông tin khách hàng"})}),e.jsxs(f,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"customerName",children:"Tên khách hàng"}),e.jsx(h,{id:"customerName",value:Q,onChange:s=>ie(s.target.value),placeholder:"Nhập tên khách hàng",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"customerPhone",children:"Số điện thoại"}),e.jsx(h,{id:"customerPhone",value:R,onChange:s=>re(s.target.value),placeholder:"Nhập số điện thoại khách hàng",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"customerEmail",children:"Email (không bắt buộc)"}),e.jsx(h,{id:"customerEmail",type:"email",value:ce,onChange:s=>le(s.target.value),placeholder:"Nhập email khách hàng"})]})]})]}),e.jsxs(v,{children:[e.jsx(N,{children:e.jsx(y,{children:"Thông tin giao hàng"})}),e.jsxs(f,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"shippingName",children:"Tên người nhận"}),e.jsx(h,{id:"shippingName",value:I,onChange:s=>he(s.target.value),placeholder:"Tên người nhận hàng",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"shippingPhone",children:"Số điện thoại"}),e.jsx(h,{id:"shippingPhone",value:k,onChange:s=>de(s.target.value),placeholder:"Số điện thoại người nhận",required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"province",children:"Tỉnh/Thành phố"}),e.jsxs(b,{value:p,onValueChange:me,children:[e.jsx(C,{id:"province",children:e.jsx(S,{placeholder:"Chọn Tỉnh/Thành phố"})}),e.jsxs(T,{children:[e.jsx(r,{value:"01",children:"Hà Nội"}),e.jsx(r,{value:"02",children:"Hồ Chí Minh"}),e.jsx(r,{value:"03",children:"Đà Nẵng"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"district",children:"Quận/Huyện"}),e.jsxs(b,{value:g,onValueChange:xe,disabled:!p,children:[e.jsx(C,{id:"district",children:e.jsx(S,{placeholder:"Chọn Quận/Huyện"})}),e.jsxs(T,{children:[e.jsx(r,{value:"001",children:"Quận 1"}),e.jsx(r,{value:"002",children:"Quận 2"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"ward",children:"Phường/Xã"}),e.jsxs(b,{value:F,onValueChange:ue,disabled:!g,children:[e.jsx(C,{id:"ward",children:e.jsx(S,{placeholder:"Chọn Phường/Xã"})}),e.jsxs(T,{children:[e.jsx(r,{value:"00001",children:"Phường 1"}),e.jsx(r,{value:"00002",children:"Phường 2"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"address",children:"Địa chỉ cụ thể"}),e.jsx(h,{id:"address",value:D,onChange:s=>oe(s.target.value),placeholder:"Số nhà, tên đường, khu vực...",required:!0})]})]})]})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs(v,{children:[e.jsx(N,{children:e.jsx(y,{children:"Thanh toán"})}),e.jsxs(f,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"paymentMethod",children:"Phương thức thanh toán"}),e.jsxs(b,{value:G,onValueChange:je,children:[e.jsx(C,{id:"paymentMethod",children:e.jsx(S,{placeholder:"Chọn phương thức thanh toán"})}),e.jsxs(T,{children:[e.jsx(r,{value:"CASH",children:"Tiền mặt"}),e.jsx(r,{value:"BANK_TRANSFER",children:"Chuyển khoản ngân hàng"}),e.jsx(r,{value:"COD",children:"Thanh toán khi nhận hàng"}),e.jsx(r,{value:"MIXED",children:"Thanh toán nhiều phương thức"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"voucherCode",children:"Mã giảm giá (nếu có)"}),e.jsx(h,{id:"voucherCode",value:X,onChange:s=>pe(s.target.value),placeholder:"Nhập mã giảm giá"})]}),e.jsx(we,{className:"my-4"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-maintext",children:"Tổng tiền sản phẩm:"}),e.jsx("span",{children:l(q)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-maintext",children:"Giảm giá:"}),e.jsx("span",{children:l(x)})]}),e.jsxs("div",{className:"flex justify-between font-medium pt-3 border-t",children:[e.jsx("span",{children:"Tổng thanh toán:"}),e.jsx("span",{className:"text-lg",children:l(A)})]})]}),e.jsx(d,{type:"submit",className:"w-full mt-6",disabled:z,children:z?e.jsx("span",{children:"Đang tạo đơn hàng..."}):e.jsx("span",{children:"Tạo đơn hàng"})})]})]})})]})}),e.jsx(Ae,{open:te,onOpenChange:j,children:e.jsxs(Ve,{className:"max-w-4xl",children:[e.jsx(Be,{children:e.jsx(He,{children:"Chọn sản phẩm"})}),e.jsxs("div",{className:"py-4",children:[e.jsx(h,{placeholder:"Tìm kiếm sản phẩm...",value:M,onChange:s=>ae(s.target.value),className:"mb-4"}),!V||V.data.products.length===0?e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-maintext",children:"Không tìm thấy sản phẩm phù hợp."})}):e.jsx("div",{className:"max-h-[400px] overflow-y-auto",children:e.jsxs($,{children:[e.jsx(ee,{children:e.jsxs(P,{children:[e.jsx(o,{children:"Sản phẩm"}),e.jsx(o,{className:"text-right",children:"Giá"}),e.jsx(o,{})]})}),e.jsx(se,{children:V.data.products.map(s=>{var n;return e.jsxs(P,{children:[e.jsx(m,{children:e.jsxs("div",{className:"flex items-center space-x-4",children:[((n=s.images)==null?void 0:n[0])&&e.jsx("img",{src:s.images[0],alt:s.name,className:"h-10 w-10 rounded-[6px] object-cover"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsx("div",{className:"text-sm text-maintext",children:s.code})]})]})}),e.jsx(m,{className:"text-right",children:l(s.salePrice||s.regularPrice)}),e.jsx(m,{className:"text-right",children:e.jsx(d,{size:"sm",onClick:()=>ye(s),children:"Chọn"})})]},s.id)})})]})})]}),e.jsx(Oe,{children:e.jsx(d,{variant:"outline",onClick:()=>j(!1),children:"Đóng"})})]})})]})}const $e=()=>e.jsx(Ee,{});export{$e as default};
