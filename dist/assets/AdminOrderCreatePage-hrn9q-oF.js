import{j as e}from"./ui-vendor-CFM_MCUz.js";import{u as s,r as n}from"./react-vendor-B55MjJUH.js";import{C as a,a as i,b as l,c as r}from"./card-ClEzRAeX.js";import{B as c,I as t,y as h}from"./index-BHeY-5EX.js";import{L as d}from"./label-Bm9nFuXD.js";import{S as x,a as o,b as m,c as j,d as u}from"./select-C6W71KWg.js";import{S as p}from"./separator-CIUDwsOv.js";import{t as g,M as v,a5 as N,aX as y}from"./icons-vendor-BrsZP2ku.js";import{b as f}from"./order-BDDy-DF1.js";import{B as b,a as C,b as S,c as T,d as w,e as k}from"./breadcrumb-CP4jYkI2.js";import{u as F}from"./product-BXJPBtky.js";import{T as P,a as q,b as D,c as I,d as V,e as z}from"./table-DL-K3PV4.js";import"./query-vendor-CBwfxcof.js";import"./heavy-vendor-BfN2pHnQ.js";function A(){const A=s(),H=f(),[M,E]=n.useState(!1),[Q,_]=n.useState(""),[G,O]=n.useState(!1),[X,B]=n.useState([]),[K,R]=n.useState(""),[L,Y]=n.useState(""),[J,U]=n.useState(""),[W,Z]=n.useState(""),[$,ee]=n.useState(""),[se,ne]=n.useState(""),[ae,ie]=n.useState(""),[le,re]=n.useState(""),[ce,te]=n.useState(""),[he,de]=n.useState("CASH"),[xe,oe]=n.useState(""),[me,je]=n.useState(0),[ue,pe]=n.useState(0),[ge,ve]=n.useState(0),{data:Ne}=F({name:Q,limit:10,status:"HOAT_DONG"});n.useEffect((()=>{const e=X.reduce(((e,s)=>e+s.price*s.quantity),0);je(e),pe(0),ve(e-ue)}),[X,ue]);const ye=(e,s)=>{if(s<1)return;const n=[...X];n[e].quantity=s,B(n)},fe=e=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND",maximumFractionDigits:0}).format(e);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(b,{children:e.jsxs(C,{children:[e.jsx(S,{children:e.jsx(T,{href:"/admin/statistics",children:"Dashboard"})}),e.jsx(w,{}),e.jsx(S,{children:e.jsx(T,{href:"/admin/orders",children:"Quản lý đơn hàng"})}),e.jsx(w,{}),e.jsx(S,{children:e.jsx(k,{children:"Tạo đơn hàng mới"})})]})}),e.jsxs(c,{variant:"outline",onClick:()=>A(-1),children:[e.jsx(g.Icon,{path:v,size:.7,className:"mr-2"}),"Quay lại"]})]}),e.jsx("form",{onSubmit:async e=>{if(e.preventDefault(),0!==X.length)if(K&&L)if(W&&$&&se&&ae&&le&&ce){E(!0);try{const e={customer:"64f720fb93a46d138d413045",items:X,voucher:xe||"",subTotal:me,discount:ue,total:ge,shippingAddress:{name:W,phoneNumber:$,provinceId:ae,districtId:le,wardId:ce,specificAddress:se},paymentMethod:he};await H.mutateAsync(e,{onSuccess:()=>{h.success("Tạo đơn hàng thành công"),A("/admin/orders")}})}catch(s){h.error("Tạo đơn hàng thất bại")}finally{E(!1)}}else h.error("Vui lòng nhập đầy đủ thông tin giao hàng");else h.error("Vui lòng nhập thông tin khách hàng");else h.error("Vui lòng thêm ít nhất một sản phẩm vào đơn hàng")},children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[e.jsxs(a,{children:[e.jsxs(i,{className:"flex flex-row items-center justify-between",children:[e.jsx(l,{children:"Sản phẩm"}),e.jsxs(c,{type:"button",onClick:()=>O(!0),children:[e.jsx(g.Icon,{path:N,size:.7,className:"mr-2"}),"Thêm sản phẩm"]})]}),e.jsxs(r,{children:[0===X.length?e.jsx("div",{className:"text-center py-4 border rounded-[6px]",children:e.jsx("p",{className:"text-maintext",children:"Chưa có sản phẩm nào. Vui lòng thêm sản phẩm vào đơn hàng."})}):e.jsx("div",{className:"border rounded-[6px]",children:e.jsxs(P,{children:[e.jsx(q,{children:e.jsxs(D,{children:[e.jsx(I,{children:"Sản phẩm"}),e.jsx(I,{className:"text-right",children:"Đơn giá"}),e.jsx(I,{className:"text-center",children:"Số lượng"}),e.jsx(I,{className:"text-right",children:"Thành tiền"}),e.jsx(I,{})]})}),e.jsx(V,{children:X.map(((s,n)=>e.jsxs(D,{children:[e.jsxs(z,{children:["Product ",n+1," (",s.product,")"]}),e.jsx(z,{className:"text-right",children:fe(s.price)}),e.jsx(z,{className:"text-center",children:e.jsxs("div",{className:"flex justify-center items-center",children:[e.jsx(c,{type:"button",variant:"outline",size:"icon",className:"h-8 w-8",onClick:()=>ye(n,s.quantity-1),children:"-"}),e.jsx(t,{type:"number",value:s.quantity,onChange:e=>ye(n,parseInt(e.target.value)),className:"w-16 mx-2 text-center",min:1}),e.jsx(c,{type:"button",variant:"outline",size:"icon",className:"h-8 w-8",onClick:()=>ye(n,s.quantity+1),children:"+"})]})}),e.jsx(z,{className:"text-right",children:fe(s.price*s.quantity)}),e.jsx(z,{children:e.jsx(c,{type:"button",variant:"ghost",size:"icon",onClick:()=>(e=>{const s=[...X];s.splice(e,1),B(s)})(n),children:e.jsx(g.Icon,{path:y,size:.7})})})]},n)))})]})}),e.jsxs("div",{className:"mt-4 space-y-2 border-t pt-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"Tổng tiền sản phẩm:"}),e.jsx("span",{className:"font-medium",children:fe(me)})]}),ue>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"Giảm giá:"}),e.jsxs("span",{className:"font-medium text-red-500",children:["-",fe(ue)]})]}),e.jsxs("div",{className:"flex justify-between border-t pt-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Tổng thanh toán:"}),e.jsx("span",{className:"text-lg font-bold",children:fe(ge)})]})]})]})]}),e.jsxs(a,{children:[e.jsx(i,{children:e.jsx(l,{children:"Thông tin khách hàng"})}),e.jsxs(r,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"customerName",children:"Tên khách hàng"}),e.jsx(t,{id:"customerName",value:K,onChange:e=>R(e.target.value),placeholder:"Nhập tên khách hàng",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"customerPhone",children:"Số điện thoại"}),e.jsx(t,{id:"customerPhone",value:L,onChange:e=>Y(e.target.value),placeholder:"Nhập số điện thoại khách hàng",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"customerEmail",children:"Email (không bắt buộc)"}),e.jsx(t,{id:"customerEmail",type:"email",value:J,onChange:e=>U(e.target.value),placeholder:"Nhập email khách hàng"})]})]})]}),e.jsxs(a,{children:[e.jsx(i,{children:e.jsx(l,{children:"Thông tin giao hàng"})}),e.jsxs(r,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"shippingName",children:"Tên người nhận"}),e.jsx(t,{id:"shippingName",value:W,onChange:e=>Z(e.target.value),placeholder:"Tên người nhận hàng",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"shippingPhone",children:"Số điện thoại"}),e.jsx(t,{id:"shippingPhone",value:$,onChange:e=>ee(e.target.value),placeholder:"Số điện thoại người nhận",required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"province",children:"Tỉnh/Thành phố"}),e.jsxs(x,{value:ae,onValueChange:ie,children:[e.jsx(o,{id:"province",children:e.jsx(m,{placeholder:"Chọn Tỉnh/Thành phố"})}),e.jsxs(j,{children:[e.jsx(u,{value:"01",children:"Hà Nội"}),e.jsx(u,{value:"02",children:"Hồ Chí Minh"}),e.jsx(u,{value:"03",children:"Đà Nẵng"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"district",children:"Quận/Huyện"}),e.jsxs(x,{value:le,onValueChange:re,disabled:!ae,children:[e.jsx(o,{id:"district",children:e.jsx(m,{placeholder:"Chọn Quận/Huyện"})}),e.jsxs(j,{children:[e.jsx(u,{value:"001",children:"Quận 1"}),e.jsx(u,{value:"002",children:"Quận 2"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"ward",children:"Phường/Xã"}),e.jsxs(x,{value:ce,onValueChange:te,disabled:!le,children:[e.jsx(o,{id:"ward",children:e.jsx(m,{placeholder:"Chọn Phường/Xã"})}),e.jsxs(j,{children:[e.jsx(u,{value:"00001",children:"Phường 1"}),e.jsx(u,{value:"00002",children:"Phường 2"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"address",children:"Địa chỉ cụ thể"}),e.jsx(t,{id:"address",value:se,onChange:e=>ne(e.target.value),placeholder:"Số nhà, tên đường, khu vực...",required:!0})]})]})]})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs(a,{children:[e.jsx(i,{children:e.jsx(l,{children:"Thanh toán"})}),e.jsxs(r,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"paymentMethod",children:"Phương thức thanh toán"}),e.jsxs(x,{value:he,onValueChange:de,children:[e.jsx(o,{id:"paymentMethod",children:e.jsx(m,{placeholder:"Chọn phương thức thanh toán"})}),e.jsxs(j,{children:[e.jsx(u,{value:"CASH",children:"Tiền mặt"}),e.jsx(u,{value:"BANK_TRANSFER",children:"Chuyển khoản ngân hàng"}),e.jsx(u,{value:"COD",children:"Thanh toán khi nhận hàng"}),e.jsx(u,{value:"MIXED",children:"Thanh toán nhiều phương thức"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"voucherCode",children:"Mã giảm giá (nếu có)"}),e.jsx(t,{id:"voucherCode",value:xe,onChange:e=>oe(e.target.value),placeholder:"Nhập mã giảm giá"})]}),e.jsx(p,{className:"my-4"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-maintext",children:"Tổng tiền sản phẩm:"}),e.jsx("span",{children:fe(me)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-maintext",children:"Giảm giá:"}),e.jsx("span",{children:fe(ue)})]}),e.jsxs("div",{className:"flex justify-between font-medium pt-3 border-t",children:[e.jsx("span",{children:"Tổng thanh toán:"}),e.jsx("span",{className:"text-lg",children:fe(ge)})]})]}),e.jsx(c,{type:"submit",className:"w-full mt-6",disabled:M,children:M?e.jsx("span",{children:"Đang tạo đơn hàng..."}):e.jsx("span",{children:"Tạo đơn hàng"})})]})]})})]})}),e.jsx(Dialog,{open:G,onOpenChange:O,children:e.jsxs(DialogContent,{className:"max-w-4xl",children:[e.jsx(DialogHeader,{children:e.jsx(DialogTitle,{children:"Chọn sản phẩm"})}),e.jsxs("div",{className:"py-4",children:[e.jsx(t,{placeholder:"Tìm kiếm sản phẩm...",value:Q,onChange:e=>_(e.target.value),className:"mb-4"}),Ne&&0!==Ne.data.products.length?e.jsx("div",{className:"max-h-[400px] overflow-y-auto",children:e.jsxs(P,{children:[e.jsx(q,{children:e.jsxs(D,{children:[e.jsx(I,{children:"Sản phẩm"}),e.jsx(I,{className:"text-right",children:"Giá"}),e.jsx(I,{})]})}),e.jsx(V,{children:Ne.data.products.map((s=>{var n;return e.jsxs(D,{children:[e.jsx(z,{children:e.jsxs("div",{className:"flex items-center space-x-4",children:[(null==(n=s.images)?void 0:n[0])&&e.jsx("img",{src:s.images[0],alt:s.name,className:"h-10 w-10 rounded-[6px] object-cover"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsx("div",{className:"text-sm text-maintext",children:s.code})]})]})}),e.jsx(z,{className:"text-right",children:fe(s.salePrice||s.regularPrice)}),e.jsx(z,{className:"text-right",children:e.jsx(c,{size:"sm",onClick:()=>(e=>{var s,n,a,i,l,r;const c={product:e._id,variant:{colorId:(null==(a=null==(n=null==(s=e.variants)?void 0:s[0])?void 0:n.color)?void 0:a._id)||"",sizeId:(null==(r=null==(l=null==(i=e.variants)?void 0:i[0])?void 0:l.size)?void 0:r._id)||""},quantity:1,price:e.salePrice||e.regularPrice};B([...X,c]),O(!1)})(s),children:"Chọn"})})]},s._id)}))})]})}):e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-maintext",children:"Không tìm thấy sản phẩm phù hợp."})})]}),e.jsx(DialogFooter,{children:e.jsx(c,{variant:"outline",onClick:()=>O(!1),children:"Đóng"})})]})})]})}const H=()=>e.jsx(A,{});export{H as default};
