import{U as se,a as m,j as e,B as K,k as U,w as ae,q as d,br as ne,a6 as $,b9 as re}from"./index-Dpx_4rWJ.js";import{C as v,a as y,b as f,c as b}from"./card-fT6uSY2F.js";import{L as n}from"./label-B0XdI4bT.js";import{S as z}from"./separator-vZGg2kit.js";import{S as x,a as o,b as p,c as u,d as r}from"./select-CS4vNzI5.js";import{a as te,f as ie,d as de}from"./order-Cuy2edjT.js";import{B as ce,a as he,b as A,c as Q,d as R,e as le}from"./breadcrumb-CJedQ5QG.js";import"./index-BdQq_4o_.js";import"./index-qvEK80KO.js";import"./createLucideIcon-BdgKQErZ.js";import"./check-CyKb8IHM.js";function me(){var F,D,H,O,k,P,_,V,B,E,L,M;const h=se(),{id:j}=useParams(),{data:t,isLoading:X,isError:q}=te(j),Y=ie(),J=de(),[i,S]=m.useState({}),[g,C]=m.useState(""),[W,w]=m.useState(""),[I,T]=m.useState(!1);m.useEffect(()=>{if(t!=null&&t.data){const s=t.data;C(s.orderStatus),w(s.paymentStatus),s.shippingAddress&&S({shippingAddress:{name:s.shippingAddress.name,phoneNumber:s.shippingAddress.phoneNumber,provinceId:s.shippingAddress.provinceId,districtId:s.shippingAddress.districtId,wardId:s.shippingAddress.wardId,specificAddress:s.shippingAddress.specificAddress}})}},[t]);const Z=async s=>{if(s.preventDefault(),!!j){T(!0);try{Object.keys(i).length>0&&await Y.mutateAsync({orderId:j,payload:i}),g&&g!==(t==null?void 0:t.data.orderStatus)&&await J.mutateAsync({orderId:j,payload:{status:g}}),$.success("Cập nhật đơn hàng thành công"),h("/admin/orders")}catch{$.error("Cập nhật đơn hàng thất bại")}finally{T(!1)}}},c=(s,N)=>{S(G=>({...G,shippingAddress:{...G.shippingAddress,[s]:N}}))},l=s=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND",maximumFractionDigits:0}).format(s),ee=s=>new Intl.DateTimeFormat("vi-VN",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(new Date(s));if(X)return e.jsx("div",{className:"container py-10",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("p",{className:"text-white",children:"Đang tải thông tin đơn hàng..."})})});if(q||!t)return e.jsx("div",{className:"container py-10",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("p",{className:"text-red-500",children:"Không thể tải thông tin đơn hàng. Vui lòng thử lại sau."})})});const a=t.data;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(ce,{children:e.jsxs(he,{children:[e.jsx(A,{children:e.jsx(Q,{href:"/admin/statistics",children:"Dashboard"})}),e.jsx(R,{}),e.jsx(A,{children:e.jsx(Q,{href:"/admin/orders",children:"Quản lý đơn hàng"})}),e.jsx(R,{}),e.jsx(A,{children:e.jsxs(le,{children:["Chỉnh sửa đơn hàng #",a.orderNumber]})})]})}),e.jsxs(K,{variant:"outline",onClick:()=>h(-1),children:[e.jsx(U.Icon,{path:ae,size:.7,className:"mr-2"}),"Quay lại"]})]}),e.jsx("form",{onSubmit:Z,children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[e.jsxs(v,{children:[e.jsx(y,{children:e.jsx(f,{children:"Thông tin giao hàng"})}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"name",children:"Tên người nhận"}),e.jsx(d,{id:"name",value:((F=i.shippingAddress)==null?void 0:F.name)||"",onChange:s=>c("name",s.target.value),placeholder:"Tên người nhận hàng"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"phoneNumber",children:"Số điện thoại"}),e.jsx(d,{id:"phoneNumber",value:((D=i.shippingAddress)==null?void 0:D.phoneNumber)||"",onChange:s=>c("phoneNumber",s.target.value),placeholder:"Số điện thoại người nhận"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"province",children:"Tỉnh/Thành phố"}),e.jsxs(x,{value:((H=i.shippingAddress)==null?void 0:H.provinceId)||"",onValueChange:s=>c("provinceId",s),children:[e.jsx(o,{id:"province",children:e.jsx(p,{placeholder:"Chọn Tỉnh/Thành phố"})}),e.jsx(u,{children:e.jsx(r,{value:((O=a.shippingAddress)==null?void 0:O.provinceId)||"",children:((k=a.shippingAddress)==null?void 0:k.provinceName)||"Không có dữ liệu"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"district",children:"Quận/Huyện"}),e.jsxs(x,{value:((P=i.shippingAddress)==null?void 0:P.districtId)||"",onValueChange:s=>c("districtId",s),children:[e.jsx(o,{id:"district",children:e.jsx(p,{placeholder:"Chọn Quận/Huyện"})}),e.jsx(u,{children:e.jsx(r,{value:((_=a.shippingAddress)==null?void 0:_.districtId)||"",children:((V=a.shippingAddress)==null?void 0:V.districtName)||"Không có dữ liệu"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"ward",children:"Phường/Xã"}),e.jsxs(x,{value:((B=i.shippingAddress)==null?void 0:B.wardId)||"",onValueChange:s=>c("wardId",s),children:[e.jsx(o,{id:"ward",children:e.jsx(p,{placeholder:"Chọn Phường/Xã"})}),e.jsx(u,{children:e.jsx(r,{value:((E=a.shippingAddress)==null?void 0:E.wardId)||"",children:((L=a.shippingAddress)==null?void 0:L.wardName)||"Không có dữ liệu"})})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"specificAddress",children:"Địa chỉ cụ thể"}),e.jsx(d,{id:"specificAddress",value:((M=i.shippingAddress)==null?void 0:M.specificAddress)||"",onChange:s=>c("specificAddress",s.target.value),placeholder:"Số nhà, tên đường, khu vực..."})]})]})]}),e.jsxs(v,{children:[e.jsx(y,{children:e.jsx(f,{children:"Các sản phẩm trong đơn hàng"})}),e.jsxs(b,{children:[e.jsx("div",{className:"border rounded-[6px]",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-maintext uppercase tracking-wider",children:"Sản phẩm"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-maintext uppercase tracking-wider",children:"Đơn giá"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-maintext uppercase tracking-wider",children:"Số lượng"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-maintext uppercase tracking-wider",children:"Thành tiền"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:a.items.map((s,N)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[s.product.imageUrl&&e.jsx("div",{className:"flex-shrink-0 h-10 w-10",children:e.jsx("img",{className:"h-10 w-10 rounded-[6px] object-cover",src:s.product.imageUrl,alt:s.product.name})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"text-sm font-medium text-maintext",children:s.product.name}),s.variant&&e.jsx("div",{className:"text-sm text-maintext",children:s.variant.colorName&&s.variant.sizeName&&`${s.variant.colorName} / ${s.variant.sizeName}`})]})]})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-right text-sm text-maintext",children:l(s.price)}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-right text-sm text-maintext",children:s.quantity}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-right text-sm font-medium",children:l(s.price*s.quantity)})]},N))})]})}),e.jsxs("div",{className:"mt-4 space-y-2 border-t pt-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"Tổng tiền sản phẩm:"}),e.jsx("span",{className:"font-medium",children:l(a.subTotal)})]}),a.voucher&&e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-sm",children:["Giảm giá (",a.voucher.code,"):"]}),e.jsxs("span",{className:"font-medium text-red-500",children:["-",l(a.discount)]})]}),e.jsxs("div",{className:"flex justify-between border-t pt-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Tổng thanh toán:"}),e.jsx("span",{className:"text-lg font-bold",children:l(a.total)})]})]})]})]})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs(v,{children:[e.jsx(y,{children:e.jsx(f,{children:"Thông tin đơn hàng"})}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"orderNumber",children:"Mã đơn hàng"}),e.jsx(d,{id:"orderNumber",value:a.orderNumber,disabled:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"createdAt",children:"Ngày tạo"}),e.jsx(d,{id:"createdAt",value:ee(a.createdAt),disabled:!0})]}),e.jsx(z,{className:"my-4"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"orderStatus",children:"Trạng thái đơn hàng"}),e.jsxs(x,{value:g,onValueChange:C,children:[e.jsx(o,{id:"orderStatus",children:e.jsx(p,{placeholder:"Chọn trạng thái"})}),e.jsxs(u,{children:[e.jsx(r,{value:"CHO_XAC_NHAN",children:"Chờ xác nhận"}),e.jsx(r,{value:"CHO_GIAO_HANG",children:"Chờ giao hàng"}),e.jsx(r,{value:"DANG_VAN_CHUYEN",children:"Đang vận chuyển"}),e.jsx(r,{value:"DA_GIAO_HANG",children:"Đã giao hàng"}),e.jsx(r,{value:"HOAN_THANH",children:"Hoàn thành"}),e.jsx(r,{value:"DA_HUY",children:"Đã hủy"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"paymentStatus",children:"Trạng thái thanh toán"}),e.jsxs(x,{value:W,onValueChange:w,children:[e.jsx(o,{id:"paymentStatus",children:e.jsx(p,{placeholder:"Chọn trạng thái"})}),e.jsxs(u,{children:[e.jsx(r,{value:"PENDING",children:"Chưa thanh toán"}),e.jsx(r,{value:"PARTIAL_PAID",children:"Thanh toán một phần"}),e.jsx(r,{value:"PAID",children:"Đã thanh toán"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"paymentMethod",children:"Phương thức thanh toán"}),e.jsx(d,{id:"paymentMethod",value:a.paymentMethod==="CASH"?"Tiền mặt":a.paymentMethod==="BANK_TRANSFER"?"Chuyển khoản ngân hàng":a.paymentMethod==="COD"?"Thanh toán khi nhận hàng":a.paymentMethod==="MIXED"?"Thanh toán nhiều phương thức":"Không xác định",disabled:!0})]}),e.jsx(z,{className:"my-4"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"customer",children:"Khách hàng"}),e.jsx(d,{id:"customer",value:`${a.customer.fullName} (${a.customer.phoneNumber})`,disabled:!0})]}),e.jsx(K,{type:"submit",className:"w-full mt-6",disabled:I,children:I?e.jsx("span",{children:"Đang cập nhật..."}):e.jsxs(e.Fragment,{children:[e.jsx(U.Icon,{path:ne,size:.7,className:"mr-2"}),"Lưu thay đổi"]})})]})]})})]})})]})}const Ae=()=>{const{id:h}=re();return h?e.jsx(me,{params:{id:h}}):e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Sửa đơn hàng"}),e.jsx("p",{className:"text-gray-600",children:"ID đơn hàng không hợp lệ"})]})};export{Ae as default};
