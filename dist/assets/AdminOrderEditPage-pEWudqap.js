import{j as e}from"./ui-vendor-CFM_MCUz.js";import{u as s,r as n,i}from"./react-vendor-B55MjJUH.js";import{C as a,a as d,b as r,c as t}from"./card-ClEzRAeX.js";import{B as l,I as c,y as h}from"./index-BHeY-5EX.js";import{L as m}from"./label-Bm9nFuXD.js";import{S as x}from"./separator-CIUDwsOv.js";import{S as o,a as p,b as j,c as u,d as g}from"./select-C6W71KWg.js";import{t as v,M as N,aY as y}from"./icons-vendor-BrsZP2ku.js";import{a as f,f as A,d as b}from"./order-BDDy-DF1.js";import{B as w,a as I,b as C,c as S,d as T,e as F}from"./breadcrumb-CP4jYkI2.js";import"./query-vendor-CBwfxcof.js";import"./heavy-vendor-BfN2pHnQ.js";function D(){var i,D,H,_,k,V,M,P,G,K,O,E;const z=s(),{id:L}=useParams(),{data:Q,isLoading:U,isError:X}=f(L),Y=A(),$=b(),[q,B]=n.useState({}),[R,J]=n.useState(""),[W,Z]=n.useState(""),[ee,se]=n.useState(!1);n.useEffect((()=>{if(null==Q?void 0:Q.data){const e=Q.data;J(e.orderStatus),Z(e.paymentStatus),e.shippingAddress&&B({shippingAddress:{name:e.shippingAddress.name,phoneNumber:e.shippingAddress.phoneNumber,provinceId:e.shippingAddress.provinceId,districtId:e.shippingAddress.districtId,wardId:e.shippingAddress.wardId,specificAddress:e.shippingAddress.specificAddress}})}}),[Q]);const ne=(e,s)=>{B((n=>({...n,shippingAddress:{...n.shippingAddress,[e]:s}})))},ie=e=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND",maximumFractionDigits:0}).format(e);if(U)return e.jsx("div",{className:"container py-10",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("p",{className:"text-white",children:"Đang tải thông tin đơn hàng..."})})});if(X||!Q)return e.jsx("div",{className:"container py-10",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("p",{className:"text-red-500",children:"Không thể tải thông tin đơn hàng. Vui lòng thử lại sau."})})});const ae=Q.data;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(w,{children:e.jsxs(I,{children:[e.jsx(C,{children:e.jsx(S,{href:"/admin/statistics",children:"Dashboard"})}),e.jsx(T,{}),e.jsx(C,{children:e.jsx(S,{href:"/admin/orders",children:"Quản lý đơn hàng"})}),e.jsx(T,{}),e.jsx(C,{children:e.jsxs(F,{children:["Chỉnh sửa đơn hàng #",ae.orderNumber]})})]})}),e.jsxs(l,{variant:"outline",onClick:()=>z(-1),children:[e.jsx(v.Icon,{path:N,size:.7,className:"mr-2"}),"Quay lại"]})]}),e.jsx("form",{onSubmit:async e=>{if(e.preventDefault(),L){se(!0);try{Object.keys(q).length>0&&await Y.mutateAsync({orderId:L,payload:q}),R&&R!==(null==Q?void 0:Q.data.orderStatus)&&await $.mutateAsync({orderId:L,payload:{status:R}}),h.success("Cập nhật đơn hàng thành công"),z("/admin/orders")}catch(s){h.error("Cập nhật đơn hàng thất bại")}finally{se(!1)}}},children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[e.jsxs(a,{children:[e.jsx(d,{children:e.jsx(r,{children:"Thông tin giao hàng"})}),e.jsxs(t,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"name",children:"Tên người nhận"}),e.jsx(c,{id:"name",value:(null==(i=q.shippingAddress)?void 0:i.name)||"",onChange:e=>ne("name",e.target.value),placeholder:"Tên người nhận hàng"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"phoneNumber",children:"Số điện thoại"}),e.jsx(c,{id:"phoneNumber",value:(null==(D=q.shippingAddress)?void 0:D.phoneNumber)||"",onChange:e=>ne("phoneNumber",e.target.value),placeholder:"Số điện thoại người nhận"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"province",children:"Tỉnh/Thành phố"}),e.jsxs(o,{value:(null==(H=q.shippingAddress)?void 0:H.provinceId)||"",onValueChange:e=>ne("provinceId",e),children:[e.jsx(p,{id:"province",children:e.jsx(j,{placeholder:"Chọn Tỉnh/Thành phố"})}),e.jsx(u,{children:e.jsx(g,{value:(null==(_=ae.shippingAddress)?void 0:_.provinceId)||"",children:(null==(k=ae.shippingAddress)?void 0:k.provinceName)||"Không có dữ liệu"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"district",children:"Quận/Huyện"}),e.jsxs(o,{value:(null==(V=q.shippingAddress)?void 0:V.districtId)||"",onValueChange:e=>ne("districtId",e),children:[e.jsx(p,{id:"district",children:e.jsx(j,{placeholder:"Chọn Quận/Huyện"})}),e.jsx(u,{children:e.jsx(g,{value:(null==(M=ae.shippingAddress)?void 0:M.districtId)||"",children:(null==(P=ae.shippingAddress)?void 0:P.districtName)||"Không có dữ liệu"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"ward",children:"Phường/Xã"}),e.jsxs(o,{value:(null==(G=q.shippingAddress)?void 0:G.wardId)||"",onValueChange:e=>ne("wardId",e),children:[e.jsx(p,{id:"ward",children:e.jsx(j,{placeholder:"Chọn Phường/Xã"})}),e.jsx(u,{children:e.jsx(g,{value:(null==(K=ae.shippingAddress)?void 0:K.wardId)||"",children:(null==(O=ae.shippingAddress)?void 0:O.wardName)||"Không có dữ liệu"})})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"specificAddress",children:"Địa chỉ cụ thể"}),e.jsx(c,{id:"specificAddress",value:(null==(E=q.shippingAddress)?void 0:E.specificAddress)||"",onChange:e=>ne("specificAddress",e.target.value),placeholder:"Số nhà, tên đường, khu vực..."})]})]})]}),e.jsxs(a,{children:[e.jsx(d,{children:e.jsx(r,{children:"Các sản phẩm trong đơn hàng"})}),e.jsxs(t,{children:[e.jsx("div",{className:"border rounded-[6px]",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-maintext uppercase tracking-wider",children:"Sản phẩm"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-maintext uppercase tracking-wider",children:"Đơn giá"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-maintext uppercase tracking-wider",children:"Số lượng"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-maintext uppercase tracking-wider",children:"Thành tiền"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:ae.items.map(((s,n)=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[s.product.imageUrl&&e.jsx("div",{className:"flex-shrink-0 h-10 w-10",children:e.jsx("img",{className:"h-10 w-10 rounded-[6px] object-cover",src:s.product.imageUrl,alt:s.product.name})}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"text-sm font-medium text-maintext",children:s.product.name}),s.variant&&e.jsx("div",{className:"text-sm text-maintext",children:s.variant.colorName&&s.variant.sizeName&&`${s.variant.colorName} / ${s.variant.sizeName}`})]})]})}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-right text-sm text-maintext",children:ie(s.price)}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-right text-sm text-maintext",children:s.quantity}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-right text-sm font-medium",children:ie(s.price*s.quantity)})]},n)))})]})}),e.jsxs("div",{className:"mt-4 space-y-2 border-t pt-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:"Tổng tiền sản phẩm:"}),e.jsx("span",{className:"font-medium",children:ie(ae.subTotal)})]}),ae.voucher&&e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-sm",children:["Giảm giá (",ae.voucher.code,"):"]}),e.jsxs("span",{className:"font-medium text-red-500",children:["-",ie(ae.discount)]})]}),e.jsxs("div",{className:"flex justify-between border-t pt-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Tổng thanh toán:"}),e.jsx("span",{className:"text-lg font-bold",children:ie(ae.total)})]})]})]})]})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs(a,{children:[e.jsx(d,{children:e.jsx(r,{children:"Thông tin đơn hàng"})}),e.jsxs(t,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"orderNumber",children:"Mã đơn hàng"}),e.jsx(c,{id:"orderNumber",value:ae.orderNumber,disabled:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"createdAt",children:"Ngày tạo"}),e.jsx(c,{id:"createdAt",value:(de=ae.createdAt,new Intl.DateTimeFormat("vi-VN",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(new Date(de))),disabled:!0})]}),e.jsx(x,{className:"my-4"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"orderStatus",children:"Trạng thái đơn hàng"}),e.jsxs(o,{value:R,onValueChange:J,children:[e.jsx(p,{id:"orderStatus",children:e.jsx(j,{placeholder:"Chọn trạng thái"})}),e.jsxs(u,{children:[e.jsx(g,{value:"CHO_XAC_NHAN",children:"Chờ xác nhận"}),e.jsx(g,{value:"CHO_GIAO_HANG",children:"Chờ giao hàng"}),e.jsx(g,{value:"DANG_VAN_CHUYEN",children:"Đang vận chuyển"}),e.jsx(g,{value:"DA_GIAO_HANG",children:"Đã giao hàng"}),e.jsx(g,{value:"HOAN_THANH",children:"Hoàn thành"}),e.jsx(g,{value:"DA_HUY",children:"Đã hủy"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"paymentStatus",children:"Trạng thái thanh toán"}),e.jsxs(o,{value:W,onValueChange:Z,children:[e.jsx(p,{id:"paymentStatus",children:e.jsx(j,{placeholder:"Chọn trạng thái"})}),e.jsxs(u,{children:[e.jsx(g,{value:"PENDING",children:"Chưa thanh toán"}),e.jsx(g,{value:"PARTIAL_PAID",children:"Thanh toán một phần"}),e.jsx(g,{value:"PAID",children:"Đã thanh toán"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"paymentMethod",children:"Phương thức thanh toán"}),e.jsx(c,{id:"paymentMethod",value:"CASH"===ae.paymentMethod?"Tiền mặt":"BANK_TRANSFER"===ae.paymentMethod?"Chuyển khoản ngân hàng":"COD"===ae.paymentMethod?"Thanh toán khi nhận hàng":"MIXED"===ae.paymentMethod?"Thanh toán nhiều phương thức":"Không xác định",disabled:!0})]}),e.jsx(x,{className:"my-4"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"customer",children:"Khách hàng"}),e.jsx(c,{id:"customer",value:`${ae.customer.fullName} (${ae.customer.phoneNumber})`,disabled:!0})]}),e.jsx(l,{type:"submit",className:"w-full mt-6",disabled:ee,children:ee?e.jsx("span",{children:"Đang cập nhật..."}):e.jsxs(e.Fragment,{children:[e.jsx(v.Icon,{path:y,size:.7,className:"mr-2"}),"Lưu thay đổi"]})})]})]})})]})})]});var de}const H=()=>{const{id:s}=i();return s?e.jsx(D,{params:{id:s}}):e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Sửa đơn hàng"}),e.jsx("p",{className:"text-gray-600",children:"ID đơn hàng không hợp lệ"})]})};export{H as default};
