import{a as x,j as e,ag as Un,bG as $s,bw as Kn,af as Qn,bH as Xn,ak as Vs,bI as Wn,aj as Yn,ai as ue,bd as qs,bx as Jn,bD as Zn,bK as ea,bO as ta,bL as sa,an as M,aI as Pt,k as N,bP as Qe,a2 as W,B as D,m as X,a5 as na,h as _s,a6 as v,bj as aa,aZ as ra,aU as ia,T as pt,bQ as la,aB as Be,G as ps,H as fs,bR as js,M as ys,P as bs,ao as ca,q as xe,ar as Ue,av as oa,as as da,at as ha,au as ma,ae as ua,aa as ft,bS as xa,ab as ga,ac as vs,bT as ws,F as jt,a8 as pa}from"./index-Dpx_4rWJ.js";import{B as fa,a as ja,b as Ns,c as ya,d as ba,e as va}from"./breadcrumb-CJedQ5QG.js";import{T as wa,b as Na,c as Cs,a as Ss}from"./tabs-BXj1bKUw.js";import{R as Ca,S as Ts,a as Is,b as ks,c as Ps,d as ge}from"./select-CS4vNzI5.js";import{D as Pe,a as Ee,b as De,c as Re,e as Ae,d as Sa}from"./dialog-BuHyDe_9.js";import{B as H}from"./badge-CA2Kv9aL.js";import{S as Oe}from"./separator-vZGg2kit.js";import{P as Ta,a as Ia,b as se,c as ka,d as Ke,f as Es,e as Pa}from"./pagination-v-vcRYeI.js";import{b as Ea,h as Da,i as Ra}from"./voucher-C7mr4xZE.js";import{u as Aa,a as Oa}from"./product-SA3ZOUlJ.js";import{u as Ma}from"./promotion-BheM1RSV.js";import{a as La}from"./promotions-BLXdZVKB.js";import{p as Et,c as za}from"./middleware-C0Ya4A5M.js";import{g as Fa}from"./order-Cuy2edjT.js";import{g as yt}from"./sizeMapping-RjPPY2bw.js";import{C as Ha,a as $a,b as Va,c as qa}from"./card-fT6uSY2F.js";import{S as Ct,R as _a,V as Ga,C as Ba}from"./scroll-area-jH8Oe1ZO.js";import{T as Gs,a as Bs,b as St,c as $,d as Us,e as V}from"./table-BeX0puEz.js";import{E as Ua}from"./jspdf.es.min-rGtSAule.js";import"./createLucideIcon-BdgKQErZ.js";import"./index-BdQq_4o_.js";import"./index-qvEK80KO.js";import"./check-CyKb8IHM.js";import"./typeof-QjJsDpFa.js";var[Je,Qi]=Un("Tooltip",[$s]),Ze=$s(),Ks="TooltipProvider",Ka=700,Tt="tooltip.open",[Qa,Dt]=Je(Ks),Qs=t=>{const{__scopeTooltip:n,delayDuration:s=Ka,skipDelayDuration:r=300,disableHoverableContent:i=!1,children:l}=t,c=x.useRef(!0),d=x.useRef(!1),u=x.useRef(0);return x.useEffect(()=>{const y=u.current;return()=>window.clearTimeout(y)},[]),e.jsx(Qa,{scope:n,isOpenDelayedRef:c,delayDuration:s,onOpen:x.useCallback(()=>{window.clearTimeout(u.current),c.current=!1},[]),onClose:x.useCallback(()=>{window.clearTimeout(u.current),u.current=window.setTimeout(()=>c.current=!0,r)},[r]),isPointerInTransitRef:d,onPointerInTransitChange:x.useCallback(y=>{d.current=y},[]),disableHoverableContent:i,children:l})};Qs.displayName=Ks;var Me="Tooltip",[Xa,Le]=Je(Me),Xs=t=>{const{__scopeTooltip:n,children:s,open:r,defaultOpen:i,onOpenChange:l,disableHoverableContent:c,delayDuration:d}=t,u=Dt(Me,t.__scopeTooltip),y=Ze(n),[b,S]=x.useState(null),k=Kn(),p=x.useRef(0),E=c??u.disableHoverableContent,I=d??u.delayDuration,O=x.useRef(!1),[w,T]=Qn({prop:r,defaultProp:i??!1,onChange:tt=>{tt?(u.onOpen(),document.dispatchEvent(new CustomEvent(Tt))):u.onClose(),l==null||l(tt)},caller:Me}),F=x.useMemo(()=>w?O.current?"delayed-open":"instant-open":"closed",[w]),C=x.useCallback(()=>{window.clearTimeout(p.current),p.current=0,O.current=!1,T(!0)},[T]),_=x.useCallback(()=>{window.clearTimeout(p.current),p.current=0,T(!1)},[T]),oe=x.useCallback(()=>{window.clearTimeout(p.current),p.current=window.setTimeout(()=>{O.current=!0,T(!0),p.current=0},I)},[I,T]);return x.useEffect(()=>()=>{p.current&&(window.clearTimeout(p.current),p.current=0)},[]),e.jsx(Xn,{...y,children:e.jsx(Xa,{scope:n,contentId:k,open:w,stateAttribute:F,trigger:b,onTriggerChange:S,onTriggerEnter:x.useCallback(()=>{u.isOpenDelayedRef.current?oe():C()},[u.isOpenDelayedRef,oe,C]),onTriggerLeave:x.useCallback(()=>{E?_():(window.clearTimeout(p.current),p.current=0)},[_,E]),onOpen:C,onClose:_,disableHoverableContent:E,children:s})})};Xs.displayName=Me;var It="TooltipTrigger",Ws=x.forwardRef((t,n)=>{const{__scopeTooltip:s,...r}=t,i=Le(It,s),l=Dt(It,s),c=Ze(s),d=x.useRef(null),u=Vs(n,d,i.onTriggerChange),y=x.useRef(!1),b=x.useRef(!1),S=x.useCallback(()=>y.current=!1,[]);return x.useEffect(()=>()=>document.removeEventListener("pointerup",S),[S]),e.jsx(Wn,{asChild:!0,...c,children:e.jsx(Yn.button,{"aria-describedby":i.open?i.contentId:void 0,"data-state":i.stateAttribute,...r,ref:u,onPointerMove:ue(t.onPointerMove,k=>{k.pointerType!=="touch"&&!b.current&&!l.isPointerInTransitRef.current&&(i.onTriggerEnter(),b.current=!0)}),onPointerLeave:ue(t.onPointerLeave,()=>{i.onTriggerLeave(),b.current=!1}),onPointerDown:ue(t.onPointerDown,()=>{i.open&&i.onClose(),y.current=!0,document.addEventListener("pointerup",S,{once:!0})}),onFocus:ue(t.onFocus,()=>{y.current||i.onOpen()}),onBlur:ue(t.onBlur,i.onClose),onClick:ue(t.onClick,i.onClose)})})});Ws.displayName=It;var Rt="TooltipPortal",[Wa,Ya]=Je(Rt,{forceMount:void 0}),Ys=t=>{const{__scopeTooltip:n,forceMount:s,children:r,container:i}=t,l=Le(Rt,n);return e.jsx(Wa,{scope:n,forceMount:s,children:e.jsx(qs,{present:s||l.open,children:e.jsx(Jn,{asChild:!0,container:i,children:r})})})};Ys.displayName=Rt;var je="TooltipContent",Js=x.forwardRef((t,n)=>{const s=Ya(je,t.__scopeTooltip),{forceMount:r=s.forceMount,side:i="top",...l}=t,c=Le(je,t.__scopeTooltip);return e.jsx(qs,{present:r||c.open,children:c.disableHoverableContent?e.jsx(Zs,{side:i,...l,ref:n}):e.jsx(Ja,{side:i,...l,ref:n})})}),Ja=x.forwardRef((t,n)=>{const s=Le(je,t.__scopeTooltip),r=Dt(je,t.__scopeTooltip),i=x.useRef(null),l=Vs(n,i),[c,d]=x.useState(null),{trigger:u,onClose:y}=s,b=i.current,{onPointerInTransitChange:S}=r,k=x.useCallback(()=>{d(null),S(!1)},[S]),p=x.useCallback((E,I)=>{const O=E.currentTarget,w={x:E.clientX,y:E.clientY},T=nr(w,O.getBoundingClientRect()),F=ar(w,T),C=rr(I.getBoundingClientRect()),_=lr([...F,...C]);d(_),S(!0)},[S]);return x.useEffect(()=>()=>k(),[k]),x.useEffect(()=>{if(u&&b){const E=O=>p(O,b),I=O=>p(O,u);return u.addEventListener("pointerleave",E),b.addEventListener("pointerleave",I),()=>{u.removeEventListener("pointerleave",E),b.removeEventListener("pointerleave",I)}}},[u,b,p,k]),x.useEffect(()=>{if(c){const E=I=>{const O=I.target,w={x:I.clientX,y:I.clientY},T=(u==null?void 0:u.contains(O))||(b==null?void 0:b.contains(O)),F=!ir(w,c);T?k():F&&(k(),y())};return document.addEventListener("pointermove",E),()=>document.removeEventListener("pointermove",E)}},[u,b,c,y,k]),e.jsx(Zs,{...t,ref:l})}),[Za,er]=Je(Me,{isInside:!1}),tr=ta("TooltipContent"),Zs=x.forwardRef((t,n)=>{const{__scopeTooltip:s,children:r,"aria-label":i,onEscapeKeyDown:l,onPointerDownOutside:c,...d}=t,u=Le(je,s),y=Ze(s),{onClose:b}=u;return x.useEffect(()=>(document.addEventListener(Tt,b),()=>document.removeEventListener(Tt,b)),[b]),x.useEffect(()=>{if(u.trigger){const S=k=>{const p=k.target;p!=null&&p.contains(u.trigger)&&b()};return window.addEventListener("scroll",S,{capture:!0}),()=>window.removeEventListener("scroll",S,{capture:!0})}},[u.trigger,b]),e.jsx(Zn,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:l,onPointerDownOutside:c,onFocusOutside:S=>S.preventDefault(),onDismiss:b,children:e.jsxs(ea,{"data-state":u.stateAttribute,...y,...d,ref:n,style:{...d.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[e.jsx(tr,{children:r}),e.jsx(Za,{scope:s,isInside:!0,children:e.jsx(Ca,{id:u.contentId,role:"tooltip",children:i||r})})]})})});Js.displayName=je;var en="TooltipArrow",sr=x.forwardRef((t,n)=>{const{__scopeTooltip:s,...r}=t,i=Ze(s);return er(en,s).isInside?null:e.jsx(sa,{...i,...r,ref:n})});sr.displayName=en;function nr(t,n){const s=Math.abs(n.top-t.y),r=Math.abs(n.bottom-t.y),i=Math.abs(n.right-t.x),l=Math.abs(n.left-t.x);switch(Math.min(s,r,i,l)){case l:return"left";case i:return"right";case s:return"top";case r:return"bottom";default:throw new Error("unreachable")}}function ar(t,n,s=5){const r=[];switch(n){case"top":r.push({x:t.x-s,y:t.y+s},{x:t.x+s,y:t.y+s});break;case"bottom":r.push({x:t.x-s,y:t.y-s},{x:t.x+s,y:t.y-s});break;case"left":r.push({x:t.x+s,y:t.y-s},{x:t.x+s,y:t.y+s});break;case"right":r.push({x:t.x-s,y:t.y-s},{x:t.x-s,y:t.y+s});break}return r}function rr(t){const{top:n,right:s,bottom:r,left:i}=t;return[{x:i,y:n},{x:s,y:n},{x:s,y:r},{x:i,y:r}]}function ir(t,n){const{x:s,y:r}=t;let i=!1;for(let l=0,c=n.length-1;l<n.length;c=l++){const d=n[l],u=n[c],y=d.x,b=d.y,S=u.x,k=u.y;b>r!=k>r&&s<(S-y)*(r-b)/(k-b)+y&&(i=!i)}return i}function lr(t){const n=t.slice();return n.sort((s,r)=>s.x<r.x?-1:s.x>r.x?1:s.y<r.y?-1:s.y>r.y?1:0),cr(n)}function cr(t){if(t.length<=1)return t.slice();const n=[];for(let r=0;r<t.length;r++){const i=t[r];for(;n.length>=2;){const l=n[n.length-1],c=n[n.length-2];if((l.x-c.x)*(i.y-c.y)>=(l.y-c.y)*(i.x-c.x))n.pop();else break}n.push(i)}n.pop();const s=[];for(let r=t.length-1;r>=0;r--){const i=t[r];for(;s.length>=2;){const l=s[s.length-1],c=s[s.length-2];if((l.x-c.x)*(i.y-c.y)>=(l.y-c.y)*(i.x-c.x))s.pop();else break}s.push(i)}return s.pop(),n.length===1&&s.length===1&&n[0].x===s[0].x&&n[0].y===s[0].y?n:n.concat(s)}var or=Qs,dr=Xs,hr=Ws,mr=Ys,tn=Js;const bt=or,vt=dr,wt=hr,Xe=x.forwardRef(({className:t,sideOffset:n=4,...s},r)=>e.jsx(mr,{children:e.jsx(tn,{ref:r,sideOffset:n,className:M("z-50 overflow-hidden rounded-[6px] bg-primary px-3 py-1.5 text-xs text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]",t),...s})}));Xe.displayName=tn.displayName;const ur={dailySales:125e5,totalOrders:24,averageOrder:52e4,pendingOrders:3},Ds=Pt()(Et((t,n)=>({stats:ur,setStats:s=>t({stats:s}),updateStatsOnCheckout:s=>{const r=n().stats,i=r.dailySales+s,l=r.totalOrders+1,c=Math.round(i/l);t({stats:{...r,dailySales:i,totalOrders:l,averageOrder:c}})}}),{name:"pos-storage",storage:za(()=>localStorage)})),xr=Pt(Et((t,n)=>({items:[],appliedDiscount:0,appliedVoucher:null,couponCode:"",addToCart:s=>{const r=[...n().items],i=r.findIndex(l=>l.id===s.id);if(i>=0)if(r[i].quantity<s.stock)r[i].quantity+=1;else return;else{const l={...s,hasDiscount:!!(s.hasDiscount||s.originalPrice&&s.originalPrice>s.price),discountPercent:s.discountPercent||0};r.push(l)}t({items:r})},removeFromCart:s=>{const r=n().items.filter(i=>i.id!==s);t({items:r})},updateQuantity:(s,r)=>{const i=n().items.map(l=>{if(l.id===s){const c=l.quantity+r;return c<=0?null:c>l.stock?{...l,quantity:l.stock}:{...l,quantity:c}}return l}).filter(l=>l!==null&&l.quantity>0);t({items:i})},clearCart:()=>{t({items:[],appliedDiscount:0,appliedVoucher:null,couponCode:""})},setDiscount:s=>{t({appliedDiscount:s})},setVoucher:s=>{t({appliedVoucher:s})},setCouponCode:s=>{t({couponCode:s})},calculateSubtotal:()=>n().items.reduce((s,r)=>s+r.price*r.quantity,0),calculateTotal:()=>n().calculateSubtotal()-n().appliedDiscount}),{name:"pos-cart-storage"})),gr=Pt()(Et((t,n)=>({carts:[],activeCartId:null,maxCarts:5,createNewCart:()=>{const{carts:s,maxCarts:r}=n();if(s.length>=r)return null;const i=`cart-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,l={id:i,name:`Giỏ hàng ${s.length+1}`,items:[],appliedDiscount:0,appliedVoucher:null,couponCode:"",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return t(c=>({carts:[...c.carts,l],activeCartId:i})),i},deleteCart:s=>{t(r=>{const i=r.carts.filter(d=>d.id!==s);let l=r.activeCartId;return r.activeCartId===s&&(l=i.length>0?i[0].id:null),{carts:i.map((d,u)=>({...d,name:`Giỏ hàng ${u+1}`,updatedAt:new Date().toISOString()})),activeCartId:l}})},setActiveCart:s=>{const{carts:r}=n();r.some(l=>l.id===s)&&t({activeCartId:s})},updateCart:(s,r)=>{t(i=>({carts:i.carts.map(l=>l.id===s?{...l,...r,updatedAt:new Date().toISOString()}:l)}))},getActiveCart:()=>{const{carts:s,activeCartId:r}=n();return s.find(i=>i.id===r)||null},clearAllCarts:()=>{t({carts:[],activeCartId:null})},addItemToCart:(s,r)=>{t(i=>({carts:i.carts.map(l=>{if(l.id!==s)return l;const c=l.items.findIndex(u=>u.id===r.id);let d;return c>=0?d=l.items.map((u,y)=>y===c?{...u,quantity:u.quantity+r.quantity}:u):d=[...l.items,r],{...l,items:d,updatedAt:new Date().toISOString()}})}))},removeItemFromCart:(s,r)=>{t(i=>({carts:i.carts.map(l=>l.id===s?{...l,items:l.items.filter(c=>c.id!==r),updatedAt:new Date().toISOString()}:l)}))},updateItemQuantityInCart:(s,r,i)=>{t(l=>({carts:l.carts.map(c=>{if(c.id!==s)return c;const d=c.items.map(u=>{if(u.id!==r)return u;const y=u.quantity+i;return y<=0?null:{...u,quantity:y}}).filter(Boolean);return{...c,items:d,updatedAt:new Date().toISOString()}})}))},clearCartItems:s=>{t(r=>({carts:r.carts.map(i=>i.id===s?{...i,items:[],appliedDiscount:0,appliedVoucher:null,couponCode:"",updatedAt:new Date().toISOString()}:i)}))},setCartDiscount:(s,r,i,l)=>{t(c=>({carts:c.carts.map(d=>d.id===s?{...d,appliedDiscount:r,appliedVoucher:i||null,couponCode:l||"",updatedAt:new Date().toISOString()}:d)}))}}),{name:"pending-carts-storage",version:1})),pr=({open:t,onOpenChange:n,onVoucherSelect:s,formatCurrency:r})=>{var k;const{data:i,isLoading:l,isError:c}=Ea({page:1,limit:100,status:"HOAT_DONG"}),d=p=>{navigator.clipboard.writeText(p).then(()=>{v.success(`Đã sao chép mã: ${p}`),s(p),n(!1)}).catch(E=>{v.error("Không thể sao chép mã.")})},u=p=>new Intl.DateTimeFormat("vi-VN",{day:"2-digit",month:"2-digit",year:"numeric"}).format(new Date(p)),y=p=>new Date(p)<new Date,b=p=>p.quantity-p.usedCount<=0,S=p=>y(p.endDate)||b(p);return e.jsx(Pe,{open:t,onOpenChange:n,children:e.jsxs(Ee,{className:"sm:max-w-6xl max-h-[90vh] flex flex-col ",children:[e.jsx(De,{className:"pb-6 border-b border-border",children:e.jsxs(Re,{className:"flex items-center gap-2",children:[e.jsx(N.Icon,{path:Qe,size:1,className:"text-primary"}),e.jsx("span",{children:"Danh sách mã giảm giá"})]})}),e.jsx("div",{className:"flex-1 overflow-hidden",children:l?e.jsxs("div",{className:"space-y-4 py-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(W,{className:"h-8 w-48"}),e.jsx(W,{className:"h-8 w-32"})]}),e.jsxs("div",{className:"border border-border rounded-xl overflow-hidden",children:[e.jsx("div",{className:"bg-gray-50 p-4 border-b",children:e.jsx("div",{className:"grid grid-cols-7 gap-4",children:[...Array(7)].map((p,E)=>e.jsx(W,{className:"h-4 w-full"},E))})}),[...Array(5)].map((p,E)=>e.jsx("div",{className:"p-4 border-b border-border last:border-b-0",children:e.jsx("div",{className:"grid grid-cols-7 gap-4 items-center",children:[...Array(7)].map((I,O)=>e.jsx(W,{className:"h-6 w-full"},O))})},E))]})]}):c?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16",children:[e.jsx("div",{className:"h-20 w-20 rounded-full bg-red-50 flex items-center justify-center mb-6",children:e.jsx(N.Icon,{path:Qe,size:2,className:"text-red-500"})}),e.jsx("h3",{className:"text-xl font-semibold text-red-600 mb-2",children:"Lỗi khi tải dữ liệu"}),e.jsx("p",{className:"text-maintext text-center max-w-md",children:"Không thể tải danh sách mã giảm giá. Vui lòng kiểm tra kết nối mạng và thử lại."}),e.jsx(D,{variant:"outline",className:"mt-4",onClick:()=>window.location.reload(),children:"Thử lại"})]}):!((k=i==null?void 0:i.data)!=null&&k.vouchers)||i.data.vouchers.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16",children:[e.jsx("div",{className:"h-20 w-20 rounded-full bg-gray-50 flex items-center justify-center mb-6",children:e.jsx(N.Icon,{path:Qe,size:2,className:"text-maintext"})}),e.jsx("h3",{className:"text-xl font-semibold text-maintext mb-2",children:"Chưa có mã giảm giá"}),e.jsx("p",{className:"text-maintext text-center max-w-md",children:"Hiện tại không có mã giảm giá nào đang hoạt động trong hệ thống."})]}):e.jsxs("div",{className:"py-0",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"text-sm text-maintext",children:[e.jsx("span",{className:"font-semibold text-primary text-lg",children:i.data.vouchers.length})," mã giảm giá"]}),e.jsxs("div",{className:"text-sm text-maintext",children:[e.jsx("span",{className:"font-semibold text-green-600 text-lg",children:i.data.vouchers.filter(p=>!S(p)).length})," khả dụng"]}),e.jsxs("div",{className:"text-sm text-maintext",children:[e.jsx("span",{className:"font-semibold text-red-600 text-lg",children:i.data.vouchers.filter(p=>S(p)).length})," không khả dụng"]})]})}),e.jsx("div",{className:"border border-border rounded-xl overflow-hidden shadow-sm bg-white",children:e.jsx(Ct,{className:"max-h-[50vh]",children:e.jsxs(Gs,{children:[e.jsx(Bs,{children:e.jsxs(St,{children:[e.jsx($,{className:"w-[180px]",children:"Mã giảm giá"}),e.jsx($,{className:"w-[200px]",children:"Tên chương trình"}),e.jsx($,{className:"text-center w-[80px]",children:"Loại"}),e.jsx($,{className:"text-right w-[120px]",children:"Giá trị"}),e.jsx($,{className:"text-right w-[150px]",children:"Đơn tối thiểu"}),e.jsx($,{className:"text-center w-[80px]",children:"Còn lại"}),e.jsx($,{className:"text-center w-[100px]",children:"Hết hạn"}),e.jsx($,{className:"text-center w-[150px]",children:"Thao tác"})]})}),e.jsx(Us,{children:i.data.vouchers.map((p,E)=>{const I=y(p.endDate),O=b(p),w=S(p),T=p.quantity-p.usedCount;return e.jsxs(X.tr,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.2,delay:E*.05},className:M("transition-all duration-200 hover:bg-gray-50/50",w&&"bg-gray-50/30 opacity-75"),children:[e.jsx(V,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:M("h-2 w-2 rounded-full",w?"bg-red-400":"bg-green-400")}),e.jsxs("div",{children:[e.jsx("div",{className:M("font-mono font-bold text-sm tracking-wider",w?"text-maintext":"text-primary"),children:p.code}),e.jsxs("div",{className:"text-xs text-maintext",children:["ID: ",p.id.slice(-6)]})]})]})}),e.jsxs(V,{children:[e.jsx("div",{className:M("font-medium text-sm leading-tight","text-maintext"),children:p.name}),e.jsxs("div",{className:"text-xs text-maintext mt-1",children:["Đã dùng: ",p.usedCount,"/",p.quantity]})]}),e.jsx(V,{className:"text-center",children:e.jsx(H,{variant:p.discountType==="PERCENTAGE"?"default":"secondary",className:M("text-xs",p.discountType==="PERCENTAGE"?"bg-blue-100 text-blue-700 border-blue-200":"bg-purple-100 text-purple-700 border-purple-200"),children:p.discountType==="PERCENTAGE"?"%":"VNĐ"})}),e.jsxs(V,{className:"text-right",children:[e.jsx("div",{className:M("font-bold text-sm",w?"text-maintext":"text-primary"),children:p.discountType==="PERCENTAGE"?`${p.discountValue}%`:r(p.discountValue)}),p.discountType==="PERCENTAGE"&&p.maxValue&&e.jsxs("div",{className:"text-xs text-maintext",children:["Max: ",r(p.maxValue)]})]}),e.jsx(V,{className:"text-right",children:e.jsx("div",{className:"font-semibold text-sm text-maintext",children:r(p.minOrderValue)})}),e.jsx(V,{className:"text-center",children:e.jsx(H,{variant:T<=5?"destructive":T<=20?"outline":"secondary",className:M("text-xs font-semibold",T<=5?"bg-red-100 text-red-700 border-red-200":T<=20?"bg-yellow-100 text-yellow-700 border-yellow-200":"bg-green-100 text-green-700 border-green-200"),children:T})}),e.jsxs(V,{className:"text-center",children:[e.jsx("div",{className:M("text-xs font-medium",I?"text-red-600":"text-maintext"),children:u(p.endDate)}),I&&e.jsx(H,{variant:"destructive",className:"text-xs mt-1",children:"Hết hạn"})]}),e.jsxs(V,{className:"text-center",children:[e.jsx(X.div,{whileHover:w?{}:{scale:1.05},whileTap:w?{}:{scale:.95},children:e.jsxs(D,{size:"sm",className:M("px-4 py-2 text-xs font-semibold transition-all duration-200",w?"bg-gray-200 text-maintext cursor-not-allowed hover:bg-gray-200":"bg-gradient-to-r from-primary to-secondary hover:from-secondary hover:to-primary text-white shadow-md hover:shadow-lg"),onClick:()=>!w&&d(p.code),disabled:w,children:[e.jsx(N.Icon,{path:na,size:.6,className:"mr-1.5"}),I?"Hết hạn":O?"Hết lượt":"Chọn mã"]})}),w&&e.jsx("div",{className:"text-xs text-red-500 mt-1 font-medium",children:I?"Đã hết hạn":"Hết lượt sử dụng"})]})]},p.id)})})]})})}),e.jsx("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg border border-border",children:e.jsxs("div",{className:"flex items-center justify-between text-sm text-maintext",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-2 w-2 rounded-full bg-green-400"}),e.jsx("span",{children:"Khả dụng"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-2 w-2 rounded-full bg-red-400"}),e.jsx("span",{children:"Không khả dụng"})]})]}),e.jsxs("div",{className:"text-xs text-maintext",children:["Cập nhật lần cuối: ",new Date().toLocaleTimeString("vi-VN")]})]})})]})}),e.jsx(Ae,{className:"pt-6 border-t border-border",children:e.jsxs(D,{variant:"outline",onClick:()=>n(!1),className:"px-8 py-2 font-medium",children:[e.jsx(N.Icon,{path:_s,size:.7,className:"mr-2"}),"Đóng"]})})]})})};function fr(t,n){if(t.match(/^[a-z]+:\/\//i))return t;if(t.match(/^\/\//))return window.location.protocol+t;if(t.match(/^[a-z]+:/i))return t;const s=document.implementation.createHTMLDocument(),r=s.createElement("base"),i=s.createElement("a");return s.head.appendChild(r),s.body.appendChild(i),n&&(r.href=n),i.href=t,i.href}const jr=(()=>{let t=0;const n=()=>`0000${(Math.random()*36**4<<0).toString(36)}`.slice(-4);return()=>(t+=1,`u${n()}${t}`)})();function ne(t){const n=[];for(let s=0,r=t.length;s<r;s++)n.push(t[s]);return n}let pe=null;function sn(t={}){return pe||(t.includeStyleProperties?(pe=t.includeStyleProperties,pe):(pe=ne(window.getComputedStyle(document.documentElement)),pe))}function We(t,n){const r=(t.ownerDocument.defaultView||window).getComputedStyle(t).getPropertyValue(n);return r?parseFloat(r.replace("px","")):0}function yr(t){const n=We(t,"border-left-width"),s=We(t,"border-right-width");return t.clientWidth+n+s}function br(t){const n=We(t,"border-top-width"),s=We(t,"border-bottom-width");return t.clientHeight+n+s}function nn(t,n={}){const s=n.width||yr(t),r=n.height||br(t);return{width:s,height:r}}function vr(){let t,n;try{n=process}catch{}const s=n&&n.env?n.env.devicePixelRatio:null;return s&&(t=parseInt(s,10),Number.isNaN(t)&&(t=1)),t||window.devicePixelRatio||1}const Q=16384;function wr(t){(t.width>Q||t.height>Q)&&(t.width>Q&&t.height>Q?t.width>t.height?(t.height*=Q/t.width,t.width=Q):(t.width*=Q/t.height,t.height=Q):t.width>Q?(t.height*=Q/t.width,t.width=Q):(t.width*=Q/t.height,t.height=Q))}function Ye(t){return new Promise((n,s)=>{const r=new Image;r.onload=()=>{r.decode().then(()=>{requestAnimationFrame(()=>n(r))})},r.onerror=s,r.crossOrigin="anonymous",r.decoding="async",r.src=t})}async function Nr(t){return Promise.resolve().then(()=>new XMLSerializer().serializeToString(t)).then(encodeURIComponent).then(n=>`data:image/svg+xml;charset=utf-8,${n}`)}async function Cr(t,n,s){const r="http://www.w3.org/2000/svg",i=document.createElementNS(r,"svg"),l=document.createElementNS(r,"foreignObject");return i.setAttribute("width",`${n}`),i.setAttribute("height",`${s}`),i.setAttribute("viewBox",`0 0 ${n} ${s}`),l.setAttribute("width","100%"),l.setAttribute("height","100%"),l.setAttribute("x","0"),l.setAttribute("y","0"),l.setAttribute("externalResourcesRequired","true"),i.appendChild(l),l.appendChild(t),Nr(i)}const q=(t,n)=>{if(t instanceof n)return!0;const s=Object.getPrototypeOf(t);return s===null?!1:s.constructor.name===n.name||q(s,n)};function Sr(t){const n=t.getPropertyValue("content");return`${t.cssText} content: '${n.replace(/'|"/g,"")}';`}function Tr(t,n){return sn(n).map(s=>{const r=t.getPropertyValue(s),i=t.getPropertyPriority(s);return`${s}: ${r}${i?" !important":""};`}).join(" ")}function Ir(t,n,s,r){const i=`.${t}:${n}`,l=s.cssText?Sr(s):Tr(s,r);return document.createTextNode(`${i}{${l}}`)}function Rs(t,n,s,r){const i=window.getComputedStyle(t,s),l=i.getPropertyValue("content");if(l===""||l==="none")return;const c=jr();try{n.className=`${n.className} ${c}`}catch{return}const d=document.createElement("style");d.appendChild(Ir(c,s,i,r)),n.appendChild(d)}function kr(t,n,s){Rs(t,n,":before",s),Rs(t,n,":after",s)}const As="application/font-woff",Os="image/jpeg",Pr={woff:As,woff2:As,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:Os,jpeg:Os,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml",webp:"image/webp"};function Er(t){const n=/\.([^./]*?)$/g.exec(t);return n?n[1]:""}function At(t){const n=Er(t).toLowerCase();return Pr[n]||""}function Dr(t){return t.split(/,/)[1]}function kt(t){return t.search(/^(data:)/)!==-1}function Rr(t,n){return`data:${n};base64,${t}`}async function an(t,n,s){const r=await fetch(t,n);if(r.status===404)throw new Error(`Resource "${r.url}" not found`);const i=await r.blob();return new Promise((l,c)=>{const d=new FileReader;d.onerror=c,d.onloadend=()=>{try{l(s({res:r,result:d.result}))}catch(u){c(u)}},d.readAsDataURL(i)})}const Nt={};function Ar(t,n,s){let r=t.replace(/\?.*/,"");return s&&(r=t),/ttf|otf|eot|woff2?/i.test(r)&&(r=r.replace(/.*\//,"")),n?`[${n}]${r}`:r}async function Ot(t,n,s){const r=Ar(t,n,s.includeQueryParams);if(Nt[r]!=null)return Nt[r];s.cacheBust&&(t+=(/\?/.test(t)?"&":"?")+new Date().getTime());let i;try{const l=await an(t,s.fetchRequestInit,({res:c,result:d})=>(n||(n=c.headers.get("Content-Type")||""),Dr(d)));i=Rr(l,n)}catch(l){i=s.imagePlaceholder||"";let c=`Failed to fetch resource: ${t}`;l&&(c=typeof l=="string"?l:l.message),c&&console.warn(c)}return Nt[r]=i,i}async function Or(t){const n=t.toDataURL();return n==="data:,"?t.cloneNode(!1):Ye(n)}async function Mr(t,n){if(t.currentSrc){const l=document.createElement("canvas"),c=l.getContext("2d");l.width=t.clientWidth,l.height=t.clientHeight,c==null||c.drawImage(t,0,0,l.width,l.height);const d=l.toDataURL();return Ye(d)}const s=t.poster,r=At(s),i=await Ot(s,r,n);return Ye(i)}async function Lr(t,n){var s;try{if(!((s=t==null?void 0:t.contentDocument)===null||s===void 0)&&s.body)return await et(t.contentDocument.body,n,!0)}catch{}return t.cloneNode(!1)}async function zr(t,n){return q(t,HTMLCanvasElement)?Or(t):q(t,HTMLVideoElement)?Mr(t,n):q(t,HTMLIFrameElement)?Lr(t,n):t.cloneNode(rn(t))}const Fr=t=>t.tagName!=null&&t.tagName.toUpperCase()==="SLOT",rn=t=>t.tagName!=null&&t.tagName.toUpperCase()==="SVG";async function Hr(t,n,s){var r,i;if(rn(n))return n;let l=[];return Fr(t)&&t.assignedNodes?l=ne(t.assignedNodes()):q(t,HTMLIFrameElement)&&(!((r=t.contentDocument)===null||r===void 0)&&r.body)?l=ne(t.contentDocument.body.childNodes):l=ne(((i=t.shadowRoot)!==null&&i!==void 0?i:t).childNodes),l.length===0||q(t,HTMLVideoElement)||await l.reduce((c,d)=>c.then(()=>et(d,s)).then(u=>{u&&n.appendChild(u)}),Promise.resolve()),n}function $r(t,n,s){const r=n.style;if(!r)return;const i=window.getComputedStyle(t);i.cssText?(r.cssText=i.cssText,r.transformOrigin=i.transformOrigin):sn(s).forEach(l=>{let c=i.getPropertyValue(l);l==="font-size"&&c.endsWith("px")&&(c=`${Math.floor(parseFloat(c.substring(0,c.length-2)))-.1}px`),q(t,HTMLIFrameElement)&&l==="display"&&c==="inline"&&(c="block"),l==="d"&&n.getAttribute("d")&&(c=`path(${n.getAttribute("d")})`),r.setProperty(l,c,i.getPropertyPriority(l))})}function Vr(t,n){q(t,HTMLTextAreaElement)&&(n.innerHTML=t.value),q(t,HTMLInputElement)&&n.setAttribute("value",t.value)}function qr(t,n){if(q(t,HTMLSelectElement)){const s=n,r=Array.from(s.children).find(i=>t.value===i.getAttribute("value"));r&&r.setAttribute("selected","")}}function _r(t,n,s){return q(n,Element)&&($r(t,n,s),kr(t,n,s),Vr(t,n),qr(t,n)),n}async function Gr(t,n){const s=t.querySelectorAll?t.querySelectorAll("use"):[];if(s.length===0)return t;const r={};for(let l=0;l<s.length;l++){const d=s[l].getAttribute("xlink:href");if(d){const u=t.querySelector(d),y=document.querySelector(d);!u&&y&&!r[d]&&(r[d]=await et(y,n,!0))}}const i=Object.values(r);if(i.length){const l="http://www.w3.org/1999/xhtml",c=document.createElementNS(l,"svg");c.setAttribute("xmlns",l),c.style.position="absolute",c.style.width="0",c.style.height="0",c.style.overflow="hidden",c.style.display="none";const d=document.createElementNS(l,"defs");c.appendChild(d);for(let u=0;u<i.length;u++)d.appendChild(i[u]);t.appendChild(c)}return t}async function et(t,n,s){return!s&&n.filter&&!n.filter(t)?null:Promise.resolve(t).then(r=>zr(r,n)).then(r=>Hr(t,r,n)).then(r=>_r(t,r,n)).then(r=>Gr(r,n))}const ln=/url\((['"]?)([^'"]+?)\1\)/g,Br=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,Ur=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function Kr(t){const n=t.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return new RegExp(`(url\\(['"]?)(${n})(['"]?\\))`,"g")}function Qr(t){const n=[];return t.replace(ln,(s,r,i)=>(n.push(i),s)),n.filter(s=>!kt(s))}async function Xr(t,n,s,r,i){try{const l=s?fr(n,s):n,c=At(n);let d;return i||(d=await Ot(l,c,r)),t.replace(Kr(n),`$1${d}$3`)}catch{}return t}function Wr(t,{preferredFontFormat:n}){return n?t.replace(Ur,s=>{for(;;){const[r,,i]=Br.exec(s)||[];if(!i)return"";if(i===n)return`src: ${r};`}}):t}function cn(t){return t.search(ln)!==-1}async function on(t,n,s){if(!cn(t))return t;const r=Wr(t,s);return Qr(r).reduce((l,c)=>l.then(d=>Xr(d,c,n,s)),Promise.resolve(r))}async function fe(t,n,s){var r;const i=(r=n.style)===null||r===void 0?void 0:r.getPropertyValue(t);if(i){const l=await on(i,null,s);return n.style.setProperty(t,l,n.style.getPropertyPriority(t)),!0}return!1}async function Yr(t,n){await fe("background",t,n)||await fe("background-image",t,n),await fe("mask",t,n)||await fe("-webkit-mask",t,n)||await fe("mask-image",t,n)||await fe("-webkit-mask-image",t,n)}async function Jr(t,n){const s=q(t,HTMLImageElement);if(!(s&&!kt(t.src))&&!(q(t,SVGImageElement)&&!kt(t.href.baseVal)))return;const r=s?t.src:t.href.baseVal,i=await Ot(r,At(r),n);await new Promise((l,c)=>{t.onload=l,t.onerror=n.onImageErrorHandler?(...u)=>{try{l(n.onImageErrorHandler(...u))}catch(y){c(y)}}:c;const d=t;d.decode&&(d.decode=l),d.loading==="lazy"&&(d.loading="eager"),s?(t.srcset="",t.src=i):t.href.baseVal=i})}async function Zr(t,n){const r=ne(t.childNodes).map(i=>dn(i,n));await Promise.all(r).then(()=>t)}async function dn(t,n){q(t,Element)&&(await Yr(t,n),await Jr(t,n),await Zr(t,n))}function ei(t,n){const{style:s}=t;n.backgroundColor&&(s.backgroundColor=n.backgroundColor),n.width&&(s.width=`${n.width}px`),n.height&&(s.height=`${n.height}px`);const r=n.style;return r!=null&&Object.keys(r).forEach(i=>{s[i]=r[i]}),t}const Ms={};async function Ls(t){let n=Ms[t];if(n!=null)return n;const r=await(await fetch(t)).text();return n={url:t,cssText:r},Ms[t]=n,n}async function zs(t,n){let s=t.cssText;const r=/url\(["']?([^"')]+)["']?\)/g,l=(s.match(/url\([^)]+\)/g)||[]).map(async c=>{let d=c.replace(r,"$1");return d.startsWith("https://")||(d=new URL(d,t.url).href),an(d,n.fetchRequestInit,({result:u})=>(s=s.replace(c,`url(${u})`),[c,u]))});return Promise.all(l).then(()=>s)}function Fs(t){if(t==null)return[];const n=[],s=/(\/\*[\s\S]*?\*\/)/gi;let r=t.replace(s,"");const i=new RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");for(;;){const u=i.exec(r);if(u===null)break;n.push(u[0])}r=r.replace(i,"");const l=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,c="((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})",d=new RegExp(c,"gi");for(;;){let u=l.exec(r);if(u===null){if(u=d.exec(r),u===null)break;l.lastIndex=d.lastIndex}else d.lastIndex=l.lastIndex;n.push(u[0])}return n}async function ti(t,n){const s=[],r=[];return t.forEach(i=>{if("cssRules"in i)try{ne(i.cssRules||[]).forEach((l,c)=>{if(l.type===CSSRule.IMPORT_RULE){let d=c+1;const u=l.href,y=Ls(u).then(b=>zs(b,n)).then(b=>Fs(b).forEach(S=>{try{i.insertRule(S,S.startsWith("@import")?d+=1:i.cssRules.length)}catch(k){console.error("Error inserting rule from remote css",{rule:S,error:k})}})).catch(b=>{console.error("Error loading remote css",b.toString())});r.push(y)}})}catch(l){const c=t.find(d=>d.href==null)||document.styleSheets[0];i.href!=null&&r.push(Ls(i.href).then(d=>zs(d,n)).then(d=>Fs(d).forEach(u=>{c.insertRule(u,c.cssRules.length)})).catch(d=>{console.error("Error loading remote stylesheet",d)})),console.error("Error inlining remote css file",l)}}),Promise.all(r).then(()=>(t.forEach(i=>{if("cssRules"in i)try{ne(i.cssRules||[]).forEach(l=>{s.push(l)})}catch(l){console.error(`Error while reading CSS rules from ${i.href}`,l)}}),s))}function si(t){return t.filter(n=>n.type===CSSRule.FONT_FACE_RULE).filter(n=>cn(n.style.getPropertyValue("src")))}async function ni(t,n){if(t.ownerDocument==null)throw new Error("Provided element is not within a Document");const s=ne(t.ownerDocument.styleSheets),r=await ti(s,n);return si(r)}function hn(t){return t.trim().replace(/["']/g,"")}function ai(t){const n=new Set;function s(r){(r.style.fontFamily||getComputedStyle(r).fontFamily).split(",").forEach(l=>{n.add(hn(l))}),Array.from(r.children).forEach(l=>{l instanceof HTMLElement&&s(l)})}return s(t),n}async function ri(t,n){const s=await ni(t,n),r=ai(t);return(await Promise.all(s.filter(l=>r.has(hn(l.style.fontFamily))).map(l=>{const c=l.parentStyleSheet?l.parentStyleSheet.href:null;return on(l.cssText,c,n)}))).join(`
`)}async function ii(t,n){const s=n.fontEmbedCSS!=null?n.fontEmbedCSS:n.skipFonts?null:await ri(t,n);if(s){const r=document.createElement("style"),i=document.createTextNode(s);r.appendChild(i),t.firstChild?t.insertBefore(r,t.firstChild):t.appendChild(r)}}async function li(t,n={}){const{width:s,height:r}=nn(t,n),i=await et(t,n,!0);return await ii(i,n),await dn(i,n),ei(i,n),await Cr(i,s,r)}async function ci(t,n={}){const{width:s,height:r}=nn(t,n),i=await li(t,n),l=await Ye(i),c=document.createElement("canvas"),d=c.getContext("2d"),u=n.pixelRatio||vr(),y=n.canvasWidth||s,b=n.canvasHeight||r;return c.width=y*u,c.height=b*u,n.skipAutoScale||wr(c),c.style.width=`${y}`,c.style.height=`${b}`,n.backgroundColor&&(d.fillStyle=n.backgroundColor,d.fillRect(0,0,c.width,c.height)),d.drawImage(l,0,0,c.width,c.height),c}async function oi(t,n={}){return(await ci(t,n)).toDataURL()}const mn=x.forwardRef(({className:t,children:n,...s},r)=>e.jsxs(_a,{ref:r,className:M("relative overflow-hidden",t),...s,children:[e.jsx(Ga,{className:"h-full w-full rounded-[inherit]",children:n}),e.jsx(Ba,{})]}));mn.displayName="CustomScrollArea";const di=({open:t,onOpenChange:n,invoiceData:s,formatCurrency:r,formatDateTimeForInvoice:i})=>{const[l,c]=x.useState(!1),d=x.useRef(null);if(!s)return null;const u=async()=>{try{c(!0);const y=d.current;if(!y)throw new Error("Invoice element not found");const b=await oi(y,{quality:.95,pixelRatio:2,skipAutoScale:!0,cacheBust:!0}),S=new Ua({orientation:"portrait",unit:"mm",format:"a4",putOnlyUsedFonts:!0}),k=S.internal.pageSize.getWidth(),p=S.getImageProperties(b),E=p.height*k/p.width;S.addImage(b,"PNG",0,0,k,E),S.save(`HoaDon_${s.orderId.replace(/[^a-zA-Z0-9]/g,"_")}.pdf`),v.success("Đã lưu hoá đơn PDF thành công!")}catch{v.error("Lỗi khi in hoá đơn PDF.")}finally{c(!1)}};return e.jsx(Pe,{open:t,onOpenChange:n,children:e.jsxs(Ee,{className:"sm:max-w-2xl md:max-w-3xl lg:max-w-4xl max-h-[90vh] flex flex-col min-h-0",children:[e.jsx(De,{children:e.jsx(Re,{className:"text-maintext text-center text-2xl font-semibold",children:"Hoá đơn bán hàng"})}),e.jsx(mn,{className:"flex-1 min-h-0 p-4 overflow-y-auto",children:e.jsxs("div",{ref:d,className:"p-4 bg-white",id:"invoice-content",children:[e.jsx("div",{className:"w-full justify-center mb-4",children:e.jsx("img",{draggable:"false",src:"/images/logo.svg",alt:"logo",width:100,height:100,className:"w-auto mx-auto h-20"})}),e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:s.shopInfo.name}),e.jsx("p",{className:"text-sm",children:s.shopInfo.address}),e.jsxs("p",{className:"text-sm",children:["ĐT: ",s.shopInfo.phone," - Email: ",s.shopInfo.email]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4 text-sm",children:[e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Mã HĐ:"})," ",s.orderId]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Ngày:"})," ",i(s.createdAt)]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Nhân viên:"})," ",s.employee]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Khách hàng:"})," ",s.customerInfo.name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Điện thoại:"})," ",s.customerInfo.phone]})]})]}),e.jsxs(Gs,{className:"mb-4 text-sm",children:[e.jsx(Bs,{children:e.jsxs(St,{children:[e.jsx($,{className:"w-[40px] text-center",children:"STT"}),e.jsx($,{children:"Tên sản phẩm"}),e.jsx($,{className:"text-xs",children:"Màu/Size"}),e.jsx($,{className:"text-right w-[50px]",children:"SL"}),e.jsx($,{className:"text-right w-[100px]",children:"Đơn giá"}),e.jsx($,{className:"text-right w-[100px]",children:"Thành tiền"})]})}),e.jsx(Us,{children:s.items.map((y,b)=>e.jsxs(St,{children:[e.jsx(V,{className:"text-center",children:b+1}),e.jsx(V,{className:"font-medium",children:y.name}),e.jsxs(V,{className:"text-xs",children:[y.color," / ",y.size]}),e.jsx(V,{className:"text-right",children:y.quantity}),e.jsx(V,{className:"text-right",children:r(y.price)}),e.jsx(V,{className:"text-right font-semibold",children:r(y.total)})]},b))})]}),e.jsx("div",{className:"flex justify-end mb-4",children:e.jsxs("div",{className:"w-full max-w-sm space-y-1.5 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Tổng tiền hàng:"}),e.jsx("span",{children:r(s.subTotal)})]}),s.discount>0&&e.jsxs("div",{className:"flex justify-between text-red-600",children:[e.jsxs("span",{children:["Giảm giá (",s.voucherCode||"KM","):"]}),e.jsxs("span",{children:["-",r(s.discount)]})]}),e.jsx(Oe,{}),e.jsxs("div",{className:"flex justify-between font-bold text-base",children:[e.jsx("span",{children:"TỔNG THANH TOÁN:"}),e.jsx("span",{className:"text-primary",children:r(s.total)})]}),e.jsx(Oe,{}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Phương thức:"}),e.jsx("span",{children:s.paymentMethod})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Tiền khách đưa:"}),e.jsx("span",{children:r(s.cashReceived)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Tiền thừa:"}),e.jsx("span",{children:r(s.changeGiven)})]})]})}),e.jsx("p",{className:"text-center text-sm mt-8",children:"Cảm ơn Quý khách và hẹn gặp lại!"}),e.jsxs("p",{className:"text-center text-xs mt-1",children:["Website: ",s.shopInfo.name.toLowerCase().replace(/ /g,""),".vn"]})]})}),e.jsxs(Ae,{className:"mt-4",children:[e.jsx(D,{variant:"outline",onClick:()=>n(!1),children:"Đóng"}),e.jsxs(D,{onClick:u,disabled:l,children:[e.jsx(N.Icon,{path:aa,size:.7,className:"mr-2"}),l?"Đang xử lý...":"Lưu PDF & In"]})]})]})})},hi=({value:t,size:n=200})=>{const s=`https://api.qrserver.com/v1/create-qr-code/?size=${n}x${n}&data=${encodeURIComponent(t)}`;return e.jsx("img",{src:s,alt:"QR Code",width:n,height:n,className:"border border-gray-200 rounded"})},mi=()=>e.jsxs("div",{className:"bg-white rounded-[6px] border border-border shadow-sm overflow-hidden",children:[e.jsx(W,{className:"h-48 w-full"}),e.jsxs("div",{className:"p-4",children:[e.jsx(W,{className:"h-4 w-3/4 mb-2"}),e.jsx(W,{className:"h-3 w-1/2 mb-2"}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(W,{className:"h-4 w-1/3"}),e.jsxs("div",{className:"flex -space-x-1",children:[e.jsx(W,{className:"h-5 w-5 rounded-full"}),e.jsx(W,{className:"h-5 w-5 rounded-full"})]})]}),e.jsx(W,{className:"h-8 w-full mt-3"})]})]}),ke=t=>{if(!(t!=null&&t.images))return"/images/white-image.png";const n=t.images[0];return typeof n=="string"?n:typeof n=="object"&&(n!=null&&n.url)?n.url:typeof n=="object"&&(n!=null&&n.imageUrl)?n.imageUrl:"/images/white-image.png"},un=t=>{var n;return{id:t.id,colorId:t.colorId?{id:t.colorId.id,name:t.colorId.name,code:t.colorId.code,images:t.colorId.images||[]}:void 0,sizeId:t.sizeId?{id:t.sizeId.id,name:t.sizeId.name,value:t.sizeId.value}:void 0,price:t.price,stock:t.stock,images:((n=t.images)==null?void 0:n.map(s=>typeof s=="string"?s:s.url||s.imageUrl))||[],sku:t.sku,actualSizeId:t.actualSizeId}},Hs=t=>{var n;return{id:t.id,name:t.name,brand:t.brand,category:t.category,description:t.description,variants:((n=t.variants)==null?void 0:n.map(un))||[],status:t.status,createdAt:t.createdAt}};function ui(){var Zt,es,ts,ss,ns,as,rs,is,ls,cs,os,ds,hs,ms,us,xs,gs;const[t,n]=x.useState(""),[s,r]=x.useState(null),[i,l]=x.useState(null),{carts:c,activeCartId:d,createNewCart:u,deleteCart:y,setActiveCart:b,addItemToCart:S,removeItemFromCart:k,updateItemQuantityInCart:p,clearCartItems:E,setCartDiscount:I,getActiveCart:O}=gr(),w=O(),T=(w==null?void 0:w.items)||[],F=(w==null?void 0:w.appliedDiscount)||0,C=(w==null?void 0:w.appliedVoucher)||null,_=(w==null?void 0:w.couponCode)||"",{items:oe,appliedDiscount:tt,appliedVoucher:xi,couponCode:gi,addToCart:Mt,removeFromCart:Lt,updateQuantity:zt,clearCart:st,setDiscount:Z,setVoucher:ee,setCouponCode:ze,calculateSubtotal:pi,calculateTotal:fi}=xr(),[G,Ft]=x.useState("cash"),[xn,Fe]=x.useState(!1),[ye,be]=x.useState(""),[nt,ve]=x.useState(""),[we,Ne]=x.useState("guest"),[Ht,$t]=x.useState(!1),[gn,at]=x.useState(!1),[He,$e]=x.useState(!1),[B,ae]=x.useState({page:1,limit:6}),[de,pn]=x.useState({status:"HOAT_DONG"}),[Ve,ji]=x.useState("newest"),[rt,fn]=x.useState(!1),[Ce,jn]=x.useState("Tất cả sản phẩm"),[Vt,qt]=x.useState(!1),[Y,Se]=x.useState(""),[_t,Gt]=x.useState(!1),[Bt,yn]=x.useState(null),[bn,qe]=x.useState(!1),[Te,it]=x.useState(null),[yi,bi]=x.useState(!1),[vi,wi]=x.useState(null);Ds(a=>a.stats);const vn=Ds(a=>a.updateStatsOnCheckout),wn=Fa(),[Nn,Cn]=x.useState([{id:"TX-1234",customer:"Nguyễn Văn A",amount:125e4,time:"10:25",status:"completed"},{id:"TX-1233",customer:"Trần Thị B",amount:85e4,time:"09:40",status:"completed"},{id:"TX-1232",customer:"Lê Văn C",amount:21e5,time:"09:15",status:"pending"}]),{mutate:Sn}=Da(),Tn=x.useMemo(()=>({role:"CUSTOMER",status:"HOAT_DONG",limit:100}),[]),{data:z,isLoading:In}=ra(Tn);x.useEffect(()=>{const a=setTimeout(()=>{fn(t.trim().length>0)},300);return()=>clearTimeout(a)},[t]),x.useEffect(()=>{pn(a=>{var o;if(Ce==="Tất cả sản phẩm"){const{categories:m,...g}=a;return m?g:a}else{const m=[Ce];return((o=a.categories)==null?void 0:o[0])===Ce?a:{...a,categories:m}}}),ae(a=>({...a,page:1}))},[Ce]);const kn=x.useMemo(()=>({...B,...de}),[B.page,B.limit,de.status,de.categories]),Pn=Aa(kn),En=x.useMemo(()=>rt?{keyword:t,status:"HOAT_DONG",page:B.page,limit:B.limit,...de.categories&&{categories:de.categories}}:{keyword:""},[rt,t,B.page,B.limit,de.categories]),Dn=Oa(En),{data:U,isLoading:Ut,isError:Rn}=rt?Dn:Pn,An=x.useMemo(()=>({status:"HOAT_DONG"}),[]),{data:re}=Ma(An),R=x.useMemo(()=>{var h,o,m;if(!((h=U==null?void 0:U.data)!=null&&h.products))return U;let a=U.data.products;return((m=(o=re==null?void 0:re.data)==null?void 0:o.promotions)==null?void 0:m.length)>0&&(a=La([...a],re.data.promotions)),{...U,data:{...U.data,products:a}}},[(Zt=U==null?void 0:U.data)==null?void 0:Zt.products,(es=re==null?void 0:re.data)==null?void 0:es.promotions]),_e=x.useMemo(()=>{var h;const a=(h=R==null?void 0:R.data)==null?void 0:h.products;return a!=null&&a.length?Ve==="default"||Ve==="newest"?a:[...a].sort((o,m)=>{var f,P;const g=o.hasDiscount?o.discountedPrice:((f=o.variants[0])==null?void 0:f.price)||0,j=m.hasDiscount?m.discountedPrice:((P=m.variants[0])==null?void 0:P.price)||0;switch(Ve){case"price-asc":return g-j;case"price-desc":return j-g;default:return 0}}):[]},[(ts=R==null?void 0:R.data)==null?void 0:ts.products,Ve]),On=x.useMemo(()=>{var m;const a=[{id:"all",name:"Tất cả sản phẩm"}],h=(m=R==null?void 0:R.data)==null?void 0:m.products;if(!(h!=null&&h.length))return a;const o=new Map;for(const g of h)g.category&&typeof g.category=="object"&&g.category.id&&g.category.name?o.has(g.category.id)||o.set(g.category.id,{id:g.category.id,name:g.category.name}):typeof g.category=="string"&&!o.has(g.category)&&o.set(g.category,{id:g.category,name:g.category});return[...a,...Array.from(o.values())]},[(ns=(ss=R==null?void 0:R.data)==null?void 0:ss.products)==null?void 0:ns.length]),te=a=>{const h=Hs(a);if(r(h),h.variants&&h.variants.length>0){const o=h.variants.find(m=>m.stock>0)||h.variants[0];l(o)}else l(null),v.warn("Sản phẩm này không có biến thể hoặc đã hết hàng.")},Mn=a=>{if(!s)return;const h=s.variants.find(o=>{var m;return((m=o.colorId)==null?void 0:m.id)===a&&o.stock>0});if(h)l(h);else{const o=s.variants.find(m=>{var g;return((g=m.colorId)==null?void 0:g.id)===a});o&&(l(o),o.stock===0&&v.warn("Màu này đã hết hàng."))}},Ln=a=>{if(!s||!(i!=null&&i.colorId))return;const h=s.variants.find(o=>{var m,g,j;return((m=o.colorId)==null?void 0:m.id)===((g=i.colorId)==null?void 0:g.id)&&((j=o.sizeId)==null?void 0:j.id)===a&&o.stock>0});if(h)l(h);else{const o=s.variants.find(m=>{var g,j,f;return((g=m.colorId)==null?void 0:g.id)===((j=i.colorId)==null?void 0:j.id)&&((f=m.sizeId)==null?void 0:f.id)===a});o&&(l(o),o.stock===0&&v.warn("Kích thước này với màu đã chọn đã hết hàng."))}},lt=(a,h)=>{var P,le,Ie,L,gt,he,Ge;const o=Hs(a),m=un(h),g=`${o.id}-${m.id}`,j=a.hasDiscount?a.discountedPrice:m.price,f={id:g,productId:o.id,variantId:m.id,name:o.name,colorName:((P=m.colorId)==null?void 0:P.name)||"N/A",colorCode:(le=m.colorId)==null?void 0:le.code,sizeName:((Ie=m.sizeId)==null?void 0:Ie.name)||((L=m.sizeId)!=null&&L.value?yt(Number(m.sizeId.value)):"N/A"),price:j,originalPrice:a.hasDiscount?a.originalPrice:void 0,discountPercent:a.hasDiscount?a.discountPercent:void 0,hasDiscount:a.hasDiscount||!1,quantity:1,image:ke(m)||"/placeholder.svg",stock:m.stock,actualColorId:(gt=m.colorId)==null?void 0:gt.id,actualSizeId:(he=m.sizeId)==null?void 0:he.id};if(d){const ce=T.find(K=>K.id===g),me=((Ge=c.find(K=>K.id===d))==null?void 0:Ge.name)||"Giỏ hàng";ce?ce.quantity<m.stock?(p(d,g,1),v.success(`Đã cập nhật số lượng sản phẩm trong ${me}.`)):v.warn("Số lượng sản phẩm trong kho không đủ."):(S(d,f),v.success(`Đã thêm sản phẩm vào ${me}`))}else{const ce=oe.find(me=>me.id===g);ce?ce.quantity<m.stock?(zt(g,1),v.success("Đã cập nhật số lượng sản phẩm.")):v.warn("Số lượng sản phẩm trong kho không đủ."):(Mt(f),v.success("Đã thêm sản phẩm vào giỏ hàng"))}},zn=()=>{if(!s||!i){v.error("Vui lòng chọn sản phẩm, màu và kích thước.");return}if(i.stock===0){v.error("Sản phẩm này đã hết hàng.");return}lt(s,i),r(null),l(null)},ct=(a,h)=>{if(d){const o=T.find(g=>g.id===a);if(!o)return;const m=o.quantity+h;if(m<=0){k(d,a);return}if(m>o.stock){v.warn(`Chỉ còn ${o.stock} sản phẩm trong kho.`);return}if(p(d,a,h),C){const g=ie();if(g<C.minOrderValue)v.warn(`Đơn hàng không còn đủ điều kiện cho mã "${C.code}". Đã xóa mã.`),I(d,0,null,"");else{let j=0;C.type==="PERCENTAGE"?(j=g*C.value/100,C.maxValue&&j>C.maxValue&&(j=C.maxValue)):C.type==="FIXED_AMOUNT"&&(j=C.value),j=Math.min(j,g),I(d,j,C,_)}}}else{const o=oe.find(g=>g.id===a);if(!o)return;const m=o.quantity+h;if(m<=0){Lt(a);return}if(m>o.stock){v.warn(`Chỉ còn ${o.stock} sản phẩm trong kho.`);return}zt(a,h)}},Kt=a=>{d?(k(d,a),v.success("Đã xóa sản phẩm khỏi giỏ hàng"),C&&(ie()<C.minOrderValue||T.length<=1)&&(v.warn(`Đơn hàng không còn đủ điều kiện cho mã "${C.code}" hoặc giỏ hàng trống. Đã xóa mã.`),I(d,0,null,""))):(Lt(a),v.success("Đã xóa sản phẩm khỏi giỏ hàng"))},{data:Ni,isLoading:Qt,refetch:Fn}=ia({queryKey:["voucherByCodeToApply",_],queryFn:()=>Ra({code:_,status:"HOAT_DONG",limit:1,page:1}),enabled:!1}),Xt=async()=>{var m,g;if(!_){v.error("Vui lòng nhập mã giảm giá.");return}const{data:a,isError:h}=await Fn();if(h){v.error("Có lỗi xảy ra khi tìm mã giảm giá."),d?I(d,0,null,""):(ee(null),Z(0));return}const o=(g=(m=a==null?void 0:a.data)==null?void 0:m.vouchers)==null?void 0:g[0];if(o){const j=ie();if(j<o.minOrderValue){v.error(`Đơn hàng chưa đạt giá trị tối thiểu ${A(o.minOrderValue)} để áp dụng mã này.`),d?I(d,0,null,""):(ee(null),Z(0));return}if(o.quantity<=o.usedCount){v.error("Mã giảm giá này đã hết lượt sử dụng."),d?I(d,0,null,""):(ee(null),Z(0));return}if(new Date(o.endDate)<new Date){v.error("Mã giảm giá đã hết hạn."),d?I(d,0,null,""):(ee(null),Z(0));return}let f=0;o.discountType==="PERCENTAGE"?(f=j*o.discountValue/100,o.maxValue&&f>o.maxValue&&(f=o.maxValue)):o.discountType==="FIXED_AMOUNT"&&(f=o.discountValue),f=Math.min(f,j),d?I(d,f,o,_):(Z(f),ee(o)),v.success(`Đã áp dụng mã giảm giá "${o.code}".`)}else v.error("Mã giảm giá không hợp lệ hoặc không tìm thấy."),d?I(d,0,null,""):(ee(null),Z(0))},A=a=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND",maximumFractionDigits:0}).format(a),Hn=a=>new Intl.DateTimeFormat("vi-VN",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(new Date(a)),$n=async()=>{var le,Ie;if(T.length===0){v.error("Giỏ hàng đang trống");return}const a=J(),h=parseFloat(Y.toString());if(G==="cash"&&(isNaN(h)||h<a)){v.error("Số tiền khách đưa không đủ hoặc không hợp lệ.");return}$t(!0);const o=new Date,m=String(o.getHours()).padStart(2,"0"),g=String(o.getMinutes()).padStart(2,"0"),j=String(o.getSeconds()).padStart(2,"0"),P={orderId:`POS${m}${g}${j}`,customer:ye||"Khách tại quầy",items:T.map(L=>({product:L.productId,quantity:L.quantity,price:L.price,variant:{colorId:L.actualColorId||"",sizeId:L.actualSizeId||""}})),subTotal:ie(),total:a,shippingAddress:{name:ye||"Khách vãng lai",phoneNumber:nt||"N/A",provinceId:"N/A",districtId:"N/A",wardId:"N/A",specificAddress:"Tại quầy"},paymentMethod:G==="cash"?"CASH":"BANK_TRANSFER",orderStatus:"HOAN_THANH",discount:F,voucher:(C==null?void 0:C.id)||""};try{const L=await wn.mutateAsync(P);if(L.success&&L.data){const gt=L.data.id,he=L.data.orderNumber||`POS-${Math.floor(1e3+Math.random()*9e3)}`;vn(a);const Ge={id:he,customer:ye||"Khách vãng lai",amount:a,time:new Date().toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit"}),status:"completed"};Cn([Ge,...Nn.slice(0,2)]),v.success(`Đã tạo đơn hàng ${he} và thanh toán thành công!`),C&&Sn(C.id,{onSuccess:()=>{v.info(`Đã cập nhật lượt sử dụng cho mã giảm giá "${C.code}".`)},onError:K=>{v.error(`Lỗi khi cập nhật mã giảm giá: ${K.message}`)}});const ce=G==="cash"&&!isNaN(h)&&h>=a?h-a:0,me={shopInfo:{name:"Clothes Shop",address:"Địa chỉ shop: 20 Hồ Tùng Mậu, Cầu Giấy, Hà Nội",phone:"0123 456 789",email:"info@clothes.com"},customerInfo:{name:ye||"Khách vãng lai",phone:nt||"N/A"},orderId:he,employee:"Nhân viên Bán Hàng",createdAt:new Date().toISOString(),items:T.map(K=>({name:K.name,quantity:K.quantity,price:K.price,total:K.price*K.quantity,color:K.colorName,size:K.sizeName})),subTotal:ie(),discount:F,voucherCode:C==null?void 0:C.code,total:a,cashReceived:G==="cash"?h:a,changeGiven:ce,paymentMethod:G==="cash"?"Tiền mặt":"Chuyển khoản"};yn(me),Gt(!0),st(),d&&E(d),be(""),ve(""),Ne("guest"),Ft("cash"),Se(""),$e(!1),Fe(!1)}else v.error(L.message||"Không thể tạo đơn hàng. Vui lòng thử lại.")}catch(L){v.error(((Ie=(le=L.response)==null?void 0:le.data)==null?void 0:Ie.message)||L.message||"Có lỗi xảy ra trong quá trình thanh toán.")}finally{$t(!1)}},ot=()=>{if(((w==null?void 0:w.items)||oe).length===0){v.error("Giỏ hàng đang trống");return}Bn(),Se(""),Ne("guest"),be(""),ve(""),$e(!1),Fe(!0)},Vn=a=>{var h;if(Ne(a),a&&a!=="guest"&&a!=="loading"&&a!=="no-customers"&&((h=z==null?void 0:z.data)!=null&&h.accounts)){const o=z.data.accounts.find(m=>m.id===a);o&&(be(o.fullName),ve(o.phoneNumber||""))}else be(""),ve("")};x.useEffect(()=>{const a=h=>{if(h.altKey&&h.key==="p"&&ot(),h.altKey&&h.key==="c"&&(T.length>0||C)&&(st(),d&&E(d),r(null),l(null),v.success("Đã xóa giỏ hàng và mã giảm giá.")),h.altKey&&h.key==="s"){const o=document.getElementById("product-search");o&&(h.preventDefault(),o.focus())}};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[T,C,ot]);const Wt=x.useMemo(()=>{var h,o;if(!((h=s==null?void 0:s.variants)!=null&&h.length))return[];const a=new Map;for(const m of s.variants)(o=m.colorId)!=null&&o.id&&!a.has(m.colorId.id)&&a.set(m.colorId.id,m.colorId);return Array.from(a.values()).filter(Boolean)},[s==null?void 0:s.id,(as=s==null?void 0:s.variants)==null?void 0:as.length]),Yt=x.useMemo(()=>{var h,o,m,g;if(!((h=s==null?void 0:s.variants)!=null&&h.length)||!((o=i==null?void 0:i.colorId)!=null&&o.id))return[];const a=new Map;for(const j of s.variants)((m=j.colorId)==null?void 0:m.id)===i.colorId.id&&((g=j.sizeId)!=null&&g.id)&&j.stock>0&&!a.has(j.sizeId.id)&&a.set(j.sizeId.id,j.sizeId);return Array.from(a.values()).filter(Boolean)},[s==null?void 0:s.id,(rs=i==null?void 0:i.colorId)==null?void 0:rs.id]),dt=x.useMemo(()=>{const a=T.reduce((o,m)=>o+m.price*m.quantity,0),h=Math.max(0,a-F);return{subtotal:a,total:h}},[T,F]),ie=()=>dt.subtotal,J=()=>dt.total,ht=dt.total;parseFloat(Y.toString());const Jt=x.useMemo(()=>{if(G!=="cash"||!Y)return 0;const a=parseFloat(Y.toString());return!isNaN(a)&&a>=ht?a-ht:0},[G,Y,ht]),mt=x.useCallback(a=>typeof a=="object"?a.name:a,[]),qn=()=>{if(!u()){v.warn("Không thể tạo thêm giỏ hàng. Tối đa 5 Hoá đơn chờ!");return}v.success(`Đã tạo giỏ hàng mới: Giỏ hàng ${c.length+1}`)},ut=a=>{it(a),qe(!0)},_n=()=>{if(Te){const a=c.find(h=>h.id===Te);a&&(y(Te),v.success(`Đã xóa ${a.name}`)),it(null),qe(!1)}},Gn=()=>{it(null),qe(!1)},xt=a=>{b(a);const h=c.find(o=>o.id===a);h&&v.info(`Đã chuyển sang ${h.name}`)},Bn=()=>{w&&(st(),w.items.forEach(a=>{Mt(a)}),Z(w.appliedDiscount),ee(w.appliedVoucher),ze(w.couponCode))};return e.jsxs("div",{className:"h-full",children:[e.jsx("div",{className:"mb-4",children:e.jsx("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-4",children:e.jsx(fa,{children:e.jsxs(ja,{children:[e.jsx(Ns,{children:e.jsx(ya,{href:"/admin/statistics",children:"Dashboard"})}),e.jsx(ba,{}),e.jsx(Ns,{children:e.jsx(va,{children:"Bán hàng tại quầy"})})]})})})}),e.jsxs("div",{className:"bg-white rounded-[6px] p-4 mb-4 shadow-sm border border-border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-maintext flex items-center gap-2",children:[e.jsx(N.Icon,{path:pt,size:1,className:"text-primary"}),"Hoá đơn chờ (",c.length,"/5)"]}),e.jsxs(D,{onClick:qn,disabled:c.length>=5,children:[e.jsx(N.Icon,{path:la,size:.7}),"Thêm mới"]})]}),c.length>0&&e.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-2",children:[c.slice(0,5).map((a,h)=>e.jsxs(X.button,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:M("relative flex items-center gap-2 p-2 rounded-sm border-2 transition-all duration-200 min-w-[140px] group",d===a.id?"border-primary bg-primary/5 text-primary shadow-md":"border-border bg-white text-maintext hover:border-primary/50 hover:bg-primary/5"),onClick:()=>xt(a.id),children:[e.jsxs("div",{className:"flex items-center gap-1 flex-1",children:[e.jsx("div",{className:M("w-2 h-2 rounded-full",a.items.length>0?"bg-green-500":"bg-gray-300")}),e.jsxs("span",{className:"text-sm font-medium truncate",children:[a.name," ",e.jsxs("span",{className:"text-sm text-maintext/70 font-semibold",children:["(",a.items.reduce((o,m)=>o+m.quantity,0),")"]})]})]}),e.jsx("button",{className:"opacity-0 group-hover:opacity-100 transition-opacity border border-red-500/70 p-1 hover:bg-red-400 bg-red-400 rounded-full hover:!text-white text-white",onClick:o=>{o.stopPropagation(),ut(a.id)},children:e.jsx(N.Icon,{path:Be,size:.7,className:"hover:!text-white"})},`delete-${a.id}`)]},a.id)),c.length>5&&e.jsxs(ps,{children:[e.jsx(fs,{asChild:!0,children:e.jsxs(D,{variant:"outline",size:"sm",className:"min-w-[100px] h-[46px] border-2 border-primary/50 flex items-center justify-center text-sm",children:["+",c.length-4," khác",e.jsx(N.Icon,{path:js,size:.7,className:"ml-1"})]})}),e.jsx(ys,{align:"end",className:"w-56",children:c.slice(4).map(a=>e.jsxs(bs,{className:"flex items-center justify-between",onClick:()=>xt(a.id),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:M("w-2 h-2 rounded-full",a.items.length>0?"bg-green-500":"bg-gray-300")}),e.jsx("span",{children:a.name}),a.items.length>0&&e.jsx(H,{variant:"secondary",className:"text-xs",children:a.items.reduce((h,o)=>h+o.quantity,0)})]}),e.jsx("button",{className:"p-1 hover:bg-red-100 rounded",onClick:h=>{h.stopPropagation(),ut(a.id)},children:e.jsx(N.Icon,{path:Be,size:.4,className:"text-red-500"})})]},a.id))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"lg:col-span-2 overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"bg-white rounded-[6px] p-4 mb-4 shadow-sm border border-border hover:shadow-md transition-shadow duration-300",children:[e.jsx("div",{className:"flex flex-col md:flex-row md:items-center gap-4 mb-4",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx(N.Icon,{path:ca,size:1,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-maintext"}),e.jsx(xe,{id:"product-search",type:"text",placeholder:"Tìm kiếm sản phẩm...",className:"w-full pl-10 pr-4 py-2.5 rounded-[6px] border border-border focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all duration-200",value:t,onChange:a=>n(a.target.value)})]})}),e.jsx("div",{className:"flex overflow-x-auto pb-2 scrollbar-thin gap-2",children:On.map(a=>e.jsx("button",{className:M("whitespace-nowrap px-4 py-2 rounded-[6px] text-sm font-medium transition-all duration-200",Ce===a.name?"bg-primary text-white shadow-sm":"bg-gray-50 text-maintext hover:bg-gray-100 hover:text-primary"),onClick:()=>{jn(a.name),r(null),l(null)},children:a.name},a.id))})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 flex-1 shadow-lg border border-border/50 hover:shadow-xl transition-all duration-300 min-h-[400px]",children:[s&&e.jsx("div",{className:"w-full flex items-center justify-between mb-4",children:e.jsxs(X.button,{className:"text-sm text-primary font-medium flex items-center gap-2 hover:text-primary/80 transition-colors bg-primary/5 px-4 py-2 rounded-full",onClick:()=>{r(null),l(null)},whileHover:{scale:1.02},whileTap:{scale:.98},children:[e.jsx(N.Icon,{path:_s,size:.7}),"Quay lại danh sách sản phẩm"]})}),s&&i?e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-8",children:[e.jsxs(X.div,{className:"lg:w-1/2",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.5},children:[e.jsxs("div",{className:"relative aspect-square w-full overflow-hidden rounded-2xl bg-gradient-to-br from-gray-50 to-white border group",children:[e.jsx("img",{src:Ue(ke(i)||ke(s.variants[0])),alt:s.name,className:"object-contain p-4 transition-transform duration-500 group-hover:scale-110"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-transparent via-transparent to-primary/5 opacity-0 group-hover:opacity-100 transition-opacity duration-500 rounded-2xl"})]}),i&&e.jsx(X.div,{whileHover:{scale:1.02},whileTap:{scale:.98},children:e.jsxs(D,{className:"w-full mt-4",onClick:zn,disabled:i.stock===0,children:[e.jsx(N.Icon,{path:oa,size:.7}),"Thêm vào giỏ hàng POS"]})})]}),e.jsxs(X.div,{className:"lg:w-1/2 space-y-8",initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.5,delay:.1},children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{variant:"secondary",className:"bg-primary/10 text-primary border-primary/20",children:mt(s.brand)}),e.jsx(H,{variant:"outline",className:"text-maintext",children:"Admin POS"})]}),e.jsx("h2",{className:"text-2xl font-bold text-maintext leading-tight",children:s.name}),e.jsxs(X.div,{className:"space-y-2",whileHover:{scale:1.05},transition:{duration:.2},children:[e.jsx("div",{className:`text-4xl font-bold ${s.hasDiscount,"text-primary"}`,children:A(s.hasDiscount?s.discountedPrice:i.price)}),s.hasDiscount&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl text-maintext line-through",children:A(s.originalPrice)}),e.jsxs(H,{variant:"destructive",className:"bg-green-500",children:["-",s.discountPercent,"% OFF"]})]})]})]}),Wt.length>0&&e.jsxs(X.div,{className:"mt-8",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.2},children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(N.Icon,{path:da,size:1,className:"text-primary"}),e.jsx("h3",{className:"text-base font-semibold text-maintext",children:"Màu sắc"}),(i==null?void 0:i.colorId)&&e.jsx(H,{variant:"secondary",className:"bg-primary/10 text-primary border-primary/20",children:i.colorId.name})]}),e.jsx("div",{className:"flex gap-4 flex-wrap",children:Wt.map(a=>{var h,o,m;return e.jsx(X.button,{className:M("relative group flex items-center justify-center w-8 h-8 rounded-full transition-all duration-300 border-2",((h=i==null?void 0:i.colorId)==null?void 0:h.id)===a.id?"border-primary ring-4 ring-primary/20 scale-110":"border-gray-200 hover:border-gray-300 hover:scale-105"),style:{backgroundColor:a.code},onClick:()=>Mn(a.id),title:a.name,whileHover:{scale:((o=i==null?void 0:i.colorId)==null?void 0:o.id)===a.id?1.1:1.05},whileTap:{scale:.95},children:((m=i==null?void 0:i.colorId)==null?void 0:m.id)===a.id&&e.jsx(N.Icon,{path:ha,size:1,className:"text-white drop-shadow-lg"})},a.id)})})]}),Yt.length>0&&(i==null?void 0:i.colorId)&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N.Icon,{path:ma,size:1,className:"text-primary"}),e.jsx("h3",{className:"text-base font-semibold text-maintext",children:"Kích thước"}),(i==null?void 0:i.sizeId)&&e.jsx(H,{variant:"secondary",className:"bg-primary/10 text-primary border-primary/20",children:i.sizeId.name||(i.sizeId.value?yt(Number(i.sizeId.value)):"N/A")})]}),e.jsx("div",{className:"flex flex-wrap gap-4",children:Yt.map(a=>{var m;const h=s.variants.find(g=>{var j,f,P;return((j=g.colorId)==null?void 0:j.id)===((f=i.colorId)==null?void 0:f.id)&&((P=g.sizeId)==null?void 0:P.id)===a.id}),o=(h==null?void 0:h.stock)||0;return e.jsxs(D,{size:"icon",variant:((m=i==null?void 0:i.sizeId)==null?void 0:m.id)===a.id?"default":"outline",className:M("transition-all duration-300",o===0&&"opacity-50 cursor-not-allowed"),onClick:()=>Ln(a.id),disabled:o===0,children:[a.name||(a.value?yt(Number(a.value)):"N/A"),o===0&&" (Hết hàng)"]},a.id)})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N.Icon,{path:ua,size:1,className:"text-primary"}),e.jsx("h3",{className:"text-base font-semibold text-maintext",children:"Tồn kho"}),(i==null?void 0:i.sizeId)&&e.jsx(H,{variant:"secondary",className:"bg-primary/10 text-primary border-primary/20",children:i.stock})]})]})]})}):e.jsxs(wa,{defaultValue:"grid",className:"w-full",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs(Na,{children:[e.jsxs(Cs,{value:"grid",className:"flex items-center gap-1 text-maintext/70",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"text-maintext",children:[e.jsx("rect",{width:"7",height:"7",x:"3",y:"3",rx:"1"}),e.jsx("rect",{width:"7",height:"7",x:"14",y:"3",rx:"1"}),e.jsx("rect",{width:"7",height:"7",x:"14",y:"14",rx:"1"}),e.jsx("rect",{width:"7",height:"7",x:"3",y:"14",rx:"1"})]}),"Lưới"]}),e.jsxs(Cs,{value:"table",className:"flex items-center gap-1 text-maintext/70",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"text-maintext",children:[e.jsx("path",{d:"M3 3h18v18H3z"}),e.jsx("path",{d:"M3 9h18"}),e.jsx("path",{d:"M3 15h18"}),e.jsx("path",{d:"M9 3v18"}),e.jsx("path",{d:"M15 3v18"})]}),"Bảng"]})]}),e.jsxs("div",{className:"text-sm text-maintext",children:["Hiển thị ",Ut?e.jsx(W,{className:"h-4 w-5 inline-block"}):_e.length," / ",((ls=(is=U==null?void 0:U.data)==null?void 0:is.pagination)==null?void 0:ls.totalItems)||0," sản phẩm"]})]}),Ut?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",children:[...Array(B.limit)].map((a,h)=>e.jsx(mi,{},h))}):Rn?e.jsx("div",{className:"text-center py-10 text-red-500",children:"Lỗi khi tải sản phẩm. Vui lòng thử lại."}):_e.length===0?e.jsx("div",{className:"text-center py-10 text-maintext",children:"Không tìm thấy sản phẩm nào."}):e.jsxs(e.Fragment,{children:[e.jsx(Ss,{value:"grid",className:"mt-0",children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",children:_e.map(a=>{var m;const h=(m=a.variants)==null?void 0:m[0],o=new Set(a.variants.map(g=>{var j;return(j=g.colorId)==null?void 0:j.id})).size;return e.jsxs(X.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},className:"bg-white rounded-[6px] border border-border shadow-sm overflow-hidden hover:shadow-md transition-all duration-300 group",children:[e.jsxs("div",{className:"relative h-48 w-full bg-gray-50 overflow-hidden cursor-pointer",onClick:()=>te(a),children:[e.jsx("img",{src:Ue(ke(h)),alt:a.name,className:"object-contain transition-transform duration-300 group-hover:scale-105"}),e.jsx("div",{className:"absolute top-2 right-2 flex flex-col gap-1",children:a.hasDiscount&&e.jsxs(H,{variant:"destructive",className:"bg-green-500 text-white",children:["-",a.discountPercent,"% OFF"]})})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"font-medium text-maintext group-hover:text-primary transition-colors truncate cursor-pointer",onClick:()=>te(a),children:a.name}),e.jsx("p",{className:"text-maintext text-sm mb-2 truncate",children:mt(a.brand)}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("p",{className:`font-medium ${a.hasDiscount,"text-primary"}`,children:h?A(a.hasDiscount?a.discountedPrice:h.price):"N/A"}),a.hasDiscount&&e.jsx("p",{className:"text-xs text-maintext line-through",children:A(a.originalPrice)})]}),a.variants.length>0&&e.jsxs("div",{className:"flex -space-x-1",children:[Array.from(new Map(a.variants.map(g=>{var j;return[(j=g.colorId)==null?void 0:j.id,g.colorId]})).values()).slice(0,3).map((g,j)=>g&&e.jsx("div",{className:"h-5 w-5 rounded-full border border-white",style:{backgroundColor:g.code},title:g.name},g.id||`color-${j}`)),o>3&&e.jsxs("div",{className:"h-5 w-5 rounded-full bg-gray-100 border border-white flex items-center justify-center text-xs text-maintext",children:["+",o-3]})]})]}),e.jsxs(D,{variant:"outline",className:"w-full mt-3 flex items-center justify-center gap-2",onClick:g=>{g.stopPropagation();const j=a.variants.find(f=>f.stock>0)||a.variants[0];j?j.stock>0?lt(a,j):v.warn("Sản phẩm này đã hết hàng."):v.warn("Sản phẩm này không có biến thể hoặc đã hết hàng.")},disabled:a.variants.every(g=>g.stock===0),children:[e.jsx(N.Icon,{path:ft,size:.7}),"Thêm vào giỏ"]})]})]},a.id)})})}),e.jsx(Ss,{value:"table",className:"mt-0",children:e.jsx("div",{className:"border border-border rounded-[6px] overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-muted/50",children:[e.jsx("th",{className:"text-left py-3 px-4 font-medium text-maintext",children:"Sản phẩm"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-maintext",children:"Thương hiệu"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-maintext",children:"Giá"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-maintext",children:"Màu sắc"}),e.jsx("th",{className:"text-left py-3 px-4 font-medium text-maintext",children:"Kho"}),e.jsx("th",{className:"text-center py-3 px-4 font-medium text-maintext",children:"Thao tác"})]})}),e.jsx("tbody",{children:_e.map(a=>{var j;const h=(j=a.variants)==null?void 0:j[0],o=a.variants.reduce((f,P)=>f+P.stock,0),m=new Set(a.variants.map(f=>{var P;return(P=f.colorId)==null?void 0:P.id})).size,g=a.variants.find(f=>f.stock>0)||a.variants[0];return e.jsxs("tr",{className:"border-t border-border hover:bg-muted/20 transition-colors cursor-pointer",children:[e.jsx("td",{className:"py-3 px-4",onClick:()=>te(a),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"relative h-10 w-10 rounded-[6px] overflow-hidden bg-gray-50",children:e.jsx("img",{src:Ue(ke(h)),alt:a.name,className:"object-contain"})}),e.jsx("span",{className:"font-medium text-maintext truncate max-w-[150px]",children:a.name})]})}),e.jsx("td",{className:"py-3 px-4 text-maintext truncate max-w-[100px]",onClick:()=>te(a),children:mt(a.brand)}),e.jsx("td",{className:"py-3 px-4",onClick:()=>te(a),children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:`font-medium ${a.hasDiscount,"text-primary"}`,children:h?A(a.hasDiscount?a.discountedPrice:h.price):"N/A"}),a.hasDiscount&&e.jsx("span",{className:"text-xs text-maintext line-through",children:A(a.originalPrice)})]})}),e.jsx("td",{className:"py-3 px-4",onClick:()=>te(a),children:a.variants.length>0&&e.jsxs("div",{className:"flex -space-x-1",children:[Array.from(new Map(a.variants.map(f=>{var P;return[(P=f.colorId)==null?void 0:P.id,f.colorId]})).values()).slice(0,3).map((f,P)=>f&&e.jsx("div",{className:"h-5 w-5 rounded-full border",style:{backgroundColor:f.code},title:f.name},f.id||`table-color-${P}`)),m>3&&e.jsxs("div",{className:"h-5 w-5 rounded-full bg-gray-100 border border-white flex items-center justify-center text-xs text-maintext",children:["+",m-3]})]})}),e.jsx("td",{className:"py-3 px-4",onClick:()=>te(a),children:e.jsx(H,{variant:o>10?"secondary":o>0?"outline":"destructive",className:"text-xs !flex-shrink-0",children:e.jsx("span",{className:"flex-shrink-0",children:o>10?"Còn hàng":o>0?"Sắp hết":"Hết hàng"})})}),e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(bt,{children:e.jsxs(vt,{children:[e.jsx(wt,{asChild:!0,children:e.jsx(D,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:f=>{f.stopPropagation(),te(a)},children:e.jsx(N.Icon,{path:xa,size:.7,className:"text-maintext"})})}),e.jsx(Xe,{children:e.jsx("p",{children:"Chi tiết"})})]})}),e.jsx(bt,{children:e.jsxs(vt,{children:[e.jsx(wt,{asChild:!0,children:e.jsx(D,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",disabled:a.variants.every(f=>f.stock===0),onClick:f=>{f.stopPropagation(),g&&(g.stock>0?lt(a,g):v.warn("Sản phẩm này đã hết hàng."))},children:e.jsx(N.Icon,{path:ft,size:.7,className:"text-maintext"})})}),e.jsx(Xe,{children:e.jsx("p",{children:"Thêm vào giỏ"})})]})})]})})]},a.id)})})]})})}),((cs=R==null?void 0:R.data)==null?void 0:cs.pagination)&&R.data.pagination.totalPages>1&&e.jsx("div",{className:"flex justify-center mt-6",children:e.jsx(Ta,{children:e.jsxs(Ia,{children:[e.jsx(se,{children:e.jsx(ka,{href:"#",onClick:a=>{a.preventDefault(),B.page>1&&ae(h=>({...h,page:h.page-1}))},disabled:B.page<=1})}),(()=>{const a=[],h=R.data.pagination.totalPages,o=B.page;if(h<=5)for(let g=1;g<=h;g++)a.push(e.jsx(se,{children:e.jsx(Ke,{href:"#",isActive:o===g,onClick:j=>{j.preventDefault(),ae(f=>({...f,page:g}))},children:g})},g));else{a.push(e.jsx(se,{children:e.jsx(Ke,{href:"#",isActive:o===1,onClick:f=>{f.preventDefault(),ae(P=>({...P,page:1}))},children:"1"})},1)),o>3&&a.push(e.jsx(se,{children:e.jsx(Es,{})},"start-ellipsis"));let g=Math.max(2,o-1),j=Math.min(h-1,o+1);o<=2&&(j=Math.min(h-1,3)),o>=h-1&&(g=Math.max(2,h-2));for(let f=g;f<=j;f++)a.push(e.jsx(se,{children:e.jsx(Ke,{href:"#",isActive:o===f,onClick:P=>{P.preventDefault(),ae(le=>({...le,page:f}))},children:f})},f));o<h-2&&a.push(e.jsx(se,{children:e.jsx(Es,{})},"end-ellipsis")),a.push(e.jsx(se,{children:e.jsx(Ke,{href:"#",isActive:o===h,onClick:f=>{f.preventDefault(),ae(P=>({...P,page:h}))},children:h})},h))}return a})(),e.jsx(se,{children:e.jsx(Pa,{href:"#",onClick:a=>{var h,o;a.preventDefault(),B.page<(((o=(h=R==null?void 0:R.data)==null?void 0:h.pagination)==null?void 0:o.totalPages)||1)&&ae(m=>({...m,page:m.page+1}))},disabled:B.page>=(((ds=(os=R==null?void 0:R.data)==null?void 0:os.pagination)==null?void 0:ds.totalPages)||1)})})]})})})]})]})]})]}),e.jsxs(Ha,{children:[e.jsx($a,{children:e.jsxs(Va,{className:"flex items-center gap-2 w-full justify-between",children:[w?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:w.name}),e.jsxs(H,{variant:"secondary",className:"text-xs",children:[T.reduce((a,h)=>a+h.quantity,0)," sản phẩm"]})]}):"Giỏ hàng chính",c.length>4&&e.jsxs(ps,{children:[e.jsx(fs,{asChild:!0,children:e.jsxs(D,{variant:"outline",size:"sm",children:[e.jsx(N.Icon,{path:pt,size:.7}),e.jsx(N.Icon,{path:js,size:.7,className:"ml-1"})]})}),e.jsx(ys,{align:"end",className:"w-56",children:c.map(a=>e.jsxs(bs,{className:"flex items-center justify-between",onClick:()=>xt(a.id),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:M("w-2 h-2 rounded-full",a.items.length>0?"bg-green-500":"bg-gray-300")}),e.jsx("span",{children:a.name}),a.items.length>0&&e.jsx(H,{variant:"secondary",className:"text-xs",children:a.items.reduce((h,o)=>h+o.quantity,0)})]}),e.jsx("button",{className:"p-1 hover:bg-red-100 rounded",onClick:h=>{h.stopPropagation(),ut(a.id)},children:e.jsx(N.Icon,{path:Be,size:.4,className:"text-red-500"})})]},a.id))})]})]})}),e.jsx(qa,{className:"space-y-4",children:T.length===0?e.jsxs("div",{className:"text-center py-8 text-maintext",children:[e.jsx(N.Icon,{path:pt,size:2,className:"mx-auto mb-2 text-gray-300"}),e.jsx("p",{children:"Giỏ hàng trống"}),e.jsx("p",{className:"text-sm text-maintext",children:"Thêm sản phẩm để bắt đầu"})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ct,{className:"h-[300px]",children:e.jsx("div",{className:"space-y-3",children:T.map(a=>e.jsxs(X.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"flex items-center gap-2",children:[e.jsx("div",{className:"relative h-20 w-20 flex-shrink-0 rounded-md overflow-hidden bg-white",children:e.jsx("img",{src:Ue(a.image),alt:a.name,height:100,width:100,draggable:"false",className:"object-contain h-full w-full flex-shrink-0"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-medium text-sm text-maintext truncate text-wrap",children:a.name}),e.jsxs("p",{className:"text-xs text-maintext",children:[a.colorName," / ",a.sizeName]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:"text-lg text-primary font-semibold",children:A(a.price)}),a.hasDiscount&&a.originalPrice&&e.jsx("span",{className:"text-sm text-maintext line-through",children:A(a.originalPrice)})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(D,{variant:"outline",size:"sm",className:"h-8 w-8 p-0",onClick:()=>ct(a.id,-1),children:e.jsx(N.Icon,{path:ga,size:.7})}),e.jsx(xe,{type:"number",value:a.quantity,onChange:h=>{const o=parseInt(h.target.value)||0;if(o<0){v.warn("Số lượng không được âm.");return}if(o>a.stock){v.warn(`Chỉ còn ${a.stock} sản phẩm trong kho.`);return}if(o===0){Kt(a.id);return}const m=o-a.quantity;m!==0&&ct(a.id,m)},onBlur:h=>{const o=h.target.value;(o===""||isNaN(parseInt(o)))&&(h.target.value=a.quantity.toString())},className:"w-16 h-8 text-center text-sm",min:"1",max:a.stock}),e.jsx(D,{variant:"outline",size:"sm",className:"h-8 w-8 p-0",onClick:()=>ct(a.id,1),disabled:a.quantity>=a.stock,children:e.jsx(N.Icon,{path:ft,size:.7})}),e.jsx(D,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-red-500 hover:text-red-700 hover:bg-red-50 bg-red-50 border border-red-500",onClick:()=>Kt(a.id),children:e.jsx(N.Icon,{path:vs,size:.7})})]})]})]},a.id))})}),e.jsx(Oe,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{placeholder:"Nhập mã giảm giá...",value:_,onChange:a=>{if(d){const h=O();h&&I(d,h.appliedDiscount,h.appliedVoucher,a.target.value)}else ze(a.target.value)},className:"flex-1"}),e.jsx(D,{variant:"default",onClick:Xt,disabled:!_||Qt,children:Qt?"Đang kiểm tra...":"Áp dụng"})]}),e.jsx(D,{variant:"link",className:"text-sm text-primary mt-1 px-0",onClick:()=>qt(!0),children:"Xem danh sách mã giảm giá"}),C&&e.jsxs("div",{className:"flex items-center justify-between p-2 bg-green-50 rounded-lg border border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N.Icon,{path:Qe,size:.7,className:"text-green-600"}),e.jsxs("span",{className:"text-sm font-medium text-green-800",children:["Mã: ",C.code]})]}),e.jsx(D,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 text-green-600 hover:text-green-800",onClick:()=>{d?I(d,0,null,""):(Z(0),ee(null),ze(""))},children:e.jsx(N.Icon,{path:Be,size:.7})})]})]}),e.jsx(Oe,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Tạm tính:"}),e.jsx("span",{children:A(ie())})]}),F>0&&e.jsxs("div",{className:"flex justify-between text-sm text-green-600",children:[e.jsx("span",{children:"Giảm giá:"}),e.jsxs("span",{children:["-",A(F)]})]}),e.jsx(Oe,{}),e.jsxs("div",{className:"flex justify-between text-lg font-semibold",children:[e.jsx("span",{children:"Tổng cộng:"}),e.jsx("span",{className:"text-primary",children:A(J())})]})]}),e.jsxs(D,{className:"w-full",onClick:ot,disabled:T.length===0,children:[e.jsx(N.Icon,{path:ws,size:.7,className:"mr-2"}),"Thanh toán (",A(J()),")"]})]})})]})]}),e.jsx(Pe,{open:xn,onOpenChange:Fe,children:e.jsx(Ee,{className:"sm:max-w-4xl",children:e.jsxs(Ct,{className:"max-h-[70vh] p-1",children:[e.jsx(De,{children:e.jsx(Re,{children:"Xác nhận thanh toán"})}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(bt,{children:e.jsxs(vt,{children:[e.jsx(wt,{asChild:!0,children:e.jsx("label",{htmlFor:"user-select",className:"text-right text-sm text-maintext cursor-help font-semibold",children:"Chọn khách hàng"})}),e.jsx(Xe,{children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{children:"Chọn khách hàng có sẵn hoặc để trống để nhập thủ công"}),((hs=z==null?void 0:z.data)==null?void 0:hs.accounts)&&e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["Có ",z.data.accounts.length," khách hàng trong hệ thống"]})]})})]})}),e.jsxs(Ts,{value:we,onValueChange:Vn,children:[e.jsx(Is,{className:"col-span-3 h-12",children:e.jsx(ks,{placeholder:`Chọn khách hàng (${((us=(ms=z==null?void 0:z.data)==null?void 0:ms.accounts)==null?void 0:us.length)||0} khách hàng)`})}),e.jsxs(Ps,{children:[e.jsx(ge,{value:"guest",children:e.jsxs("div",{className:"flex items-center gap-4 py-1",children:[e.jsx(N.Icon,{path:jt,size:.7,className:"text-gray-400"}),e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("span",{className:"text-xs text-maintext font-semibold",children:"Khách vãng lai"}),e.jsx("span",{className:"text-xs text-maintext",children:"Nhập thông tin thủ công"})]})]})}),In?e.jsx(ge,{value:"loading",disabled:!0,children:e.jsxs("div",{className:"flex items-center gap-4 py-2",children:[e.jsx("div",{className:"animate-spin h-4 w-4 border-2 border-blue-300 border-t-blue-600 rounded-full"}),e.jsx("span",{className:"text-maintext",children:"Đang tải danh sách khách hàng..."})]})}):(xs=z==null?void 0:z.data)!=null&&xs.accounts&&z.data.accounts.length>0?z.data.accounts.map(a=>e.jsx(ge,{value:a.id,children:e.jsxs("div",{className:"flex items-center gap-4 py-1",children:[e.jsx(N.Icon,{path:jt,size:.7,className:"text-primary"}),e.jsxs("div",{className:"flex flex-col min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-primary font-semibold truncate",children:a.fullName}),a.code&&e.jsx("span",{className:"px-2 py-0.5 text-xs font-mono bg-green-50 text-green-600 rounded border border-green-200",children:a.code})]}),e.jsx("div",{className:"flex items-center gap-2 text-xs text-maintext mt-0.5",children:a.phoneNumber?e.jsxs("span",{className:"flex items-center gap-1 text-maintext",children:["📱 ",a.phoneNumber]}):e.jsxs("span",{className:"flex items-center gap-1 text-maintext",children:["✉️ ",a.email]})})]})]})},a.id)):e.jsx(ge,{value:"no-customers",disabled:!0,children:e.jsxs("div",{className:"flex items-center gap-4 py-2",children:[e.jsx(N.Icon,{path:jt,size:.7,className:"text-gray-400"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-maintext font-medium",children:"Không có khách hàng nào"}),e.jsx("span",{className:"text-xs text-gray-400",children:"Vui lòng thêm khách hàng mới"})]})]})})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx("label",{htmlFor:"customer-name",className:"text-right text-sm text-maintext font-semibold",children:"Tên khách hàng"}),e.jsx(xe,{id:"customer-name",placeholder:"Tên khách hàng",className:"col-span-3",value:ye,onChange:a=>{be(a.target.value),we&&we!=="guest"&&Ne("guest")}})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx("label",{htmlFor:"customer-phone",className:"text-right text-sm text-maintext font-semibold",children:"Số điện thoại"}),e.jsx(xe,{id:"customer-phone",placeholder:"Số điện thoại",className:"col-span-3",value:nt,onChange:a=>{ve(a.target.value),we&&we!=="guest"&&Ne("guest")}})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx("label",{htmlFor:"payment-method",className:"text-right text-sm text-maintext font-semibold",children:"Thanh toán"}),e.jsxs(Ts,{value:G,onValueChange:a=>{Ft(a),$e(!1),Se(a==="transfer"?J().toString():"")},children:[e.jsx(Is,{className:"col-span-3",children:e.jsx(ks,{placeholder:"Chọn phương thức thanh toán"})}),e.jsxs(Ps,{children:[e.jsx(ge,{value:"cash",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N.Icon,{path:pa,size:.7,className:"text-maintext"}),e.jsx("span",{children:"Tiền mặt"})]})}),e.jsx(ge,{value:"transfer",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"text-maintext",children:[e.jsx("path",{d:"M4 10V4a2 2 0 0 1 2-2h8.5L20 7.5V20a2 2 0 0 1-2 2H4"}),e.jsx("polyline",{points:"14 2 14 8 20 8"}),e.jsx("path",{d:"m10 18 3-3-3-3"}),e.jsx("path",{d:"M4 18v-1a2 2 0 0 1 2-2h6"})]}),e.jsx("span",{children:"Chuyển khoản"})]})})]})]})]}),G==="cash"&&e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx("label",{htmlFor:"cash-received",className:"text-right text-sm text-maintext font-semibold",children:"Tiền khách đưa"}),e.jsx(xe,{id:"cash-received",type:"number",placeholder:"Nhập số tiền khách đưa",className:"col-span-3",value:Y,onChange:a=>Se(a.target.value),min:0})]}),G==="transfer"&&e.jsx("div",{className:"grid grid-cols-1 gap-4",children:e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 text-center",onClick:()=>{He||($e(!0),at(!0))},style:{cursor:He?"default":"pointer"},children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-maintext",children:"Quét mã QR để thanh toán"}),e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm border",children:e.jsx(hi,{value:`BANK_TRANSFER|970415|0123456789|Clothes Shop|${J()}|Thanh toan don hang ${new Date().getTime()}`,size:200})})}),e.jsxs("div",{className:"text-sm text-maintext space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Ngân hàng:"})," Vietcombank"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Số tài khoản:"})," 0123456789"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Chủ tài khoản:"})," Clothes Shop"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Số tiền:"})," ",A(J())]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Nội dung:"})," Thanh toan don hang ",new Date().getTime()]})]}),He&&e.jsx("div",{className:"mt-4 p-3 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 text-green-700",children:[e.jsx("svg",{className:"w-5 h-5",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),e.jsx("span",{className:"font-medium",children:"Thanh toán thành công!"})]})})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm text-maintext",children:[e.jsx("span",{className:"text-maintext text-base",children:"Số lượng sản phẩm:"}),e.jsx("span",{className:"text-maintext text-base",children:T.reduce((a,h)=>a+h.quantity,0)})]}),e.jsxs("div",{className:"flex justify-between text-sm text-maintext",children:[e.jsx("span",{className:"text-base",children:"Tạm tính:"}),e.jsx("span",{className:"text-base",children:A(ie())})]}),F>0&&e.jsxs("div",{className:"flex justify-between text-sm text-primary",children:[e.jsxs("span",{children:["Giảm giá (",(C==null?void 0:C.code)||"KM","):"]}),e.jsxs("span",{children:["-",A(F)]})]}),e.jsxs("div",{className:"flex justify-between font-medium text-base pt-2 border-t border-border",children:[e.jsx("span",{className:"text-maintext font-semibold",children:"Tổng thanh toán:"}),e.jsx("span",{className:"text-primary font-semibold",children:A(J())})]}),G==="cash"&&!isNaN(parseFloat(Y.toString()))&&parseFloat(Y.toString())>=J()&&Jt>=0&&e.jsxs("div",{className:"flex justify-between font-medium text-base pt-2",children:[e.jsx("span",{className:"text-maintext font-semibold",children:"Tiền thừa trả khách:"}),e.jsx("span",{className:"text-primary font-semibold",children:A(Jt)})]})]})]}),e.jsxs(Ae,{className:"pb-4",children:[e.jsx(D,{variant:"outline",onClick:()=>Fe(!1),children:"Hủy"}),e.jsx(D,{onClick:$n,disabled:Ht||G==="cash"&&(Y.toString()===""||parseFloat(Y.toString())<J()||isNaN(parseFloat(Y.toString())))||G==="transfer"&&!He,children:Ht?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Đang xử lý..."]}):e.jsxs(e.Fragment,{children:[e.jsx(N.Icon,{path:ws,size:.7,className:"mr-2"}),"Hoàn tất thanh toán"]})})]})]})})}),_t&&Bt&&e.jsx(x.Suspense,{fallback:e.jsx("div",{children:"Loading..."}),children:e.jsx(di,{open:_t,onOpenChange:Gt,invoiceData:Bt,formatCurrency:A,formatDateTimeForInvoice:Hn})}),Vt&&e.jsx(x.Suspense,{fallback:e.jsx("div",{children:"Loading..."}),children:e.jsx(pr,{open:Vt,onOpenChange:qt,onVoucherSelect:a=>{if(d){const h=O();h&&I(d,h.appliedDiscount,h.appliedVoucher,a)}else ze(a);Xt()},formatCurrency:A})}),e.jsx(Pe,{open:bn,onOpenChange:qe,children:e.jsxs(Ee,{className:"sm:max-w-md",children:[e.jsxs(De,{children:[e.jsx(Re,{children:"Xác nhận xóa giỏ hàng"}),e.jsx(Sa,{children:Te&&e.jsxs(e.Fragment,{children:['Bạn có chắc chắn muốn xóa "',(gs=c.find(a=>a.id===Te))==null?void 0:gs.name,'"?',e.jsx("br",{}),e.jsx("span",{className:"text-red-600 font-medium",children:"Hành động này không thể hoàn tác."})]})})]}),e.jsxs(Ae,{children:[e.jsx(D,{variant:"outline",onClick:Gn,children:"Hủy"}),e.jsxs(D,{variant:"destructive",onClick:_n,children:[e.jsx(N.Icon,{path:vs,size:.7,className:"mr-2"}),"Xóa giỏ hàng"]})]})]})}),e.jsx(Pe,{open:gn,onOpenChange:at,children:e.jsxs(Ee,{className:"sm:max-w-4xl",children:[e.jsx(De,{children:e.jsx(Re,{className:"text-center text-green-600",children:"Thanh toán thành công!"})}),e.jsxs("div",{className:"flex flex-col items-center py-4",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-green-600",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})}),e.jsx("h3",{className:"text-lg font-semibold text-maintext mb-2",children:"Giao dịch hoàn tất"}),e.jsx("p",{className:"text-sm text-maintext text-center mb-4",children:"Chúng tôi đã nhận được thanh toán của bạn qua chuyển khoản."}),e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 w-full border",children:e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Số tiền:"}),e.jsx("span",{className:"font-medium",children:A(J())})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Phương thức:"}),e.jsx("span",{className:"font-medium",children:"Chuyển khoản"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Thời gian:"}),e.jsx("span",{className:"font-medium",children:new Date().toLocaleTimeString("vi-VN")})]})]})})]}),e.jsx(Ae,{children:e.jsx(D,{className:"w-full",onClick:()=>at(!1),children:"Đóng"})})]})})]})}const Xi=()=>e.jsx(ui,{});export{Xi as default};
