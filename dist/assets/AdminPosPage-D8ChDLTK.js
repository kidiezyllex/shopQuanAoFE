import{ac as e,ad as t,ae as s,j as a,af as n,ag as i,v as r,V as l,w as c}from"./ui-vendor-CFM_MCUz.js";import{r as o}from"./react-vendor-B55MjJUH.js";import{k as d,r as h,B as m,y as x,t as u,D as p,a as g,d as f,g as j,I as v,l as N}from"./index-BHeY-5EX.js";import{t as y,b4 as b,a1 as w,B as C,aQ as k,U as I,b5 as S,ap as T,v as D,ad as A,aj as z,ag as E,ah as P,ai as _,a9 as $,a5 as M,b6 as O,a6 as V,a7 as H,b7 as R,f as q,a3 as F}from"./icons-vendor-BrsZP2ku.js";import{B as L,a as G,b as B,c as K,d as U,e as W}from"./breadcrumb-CP4jYkI2.js";import{T as Q,b as X,c as Y,a as Z}from"./tabs-z4DSy6tE.js";import{D as J,a as ee,b as te,c as se,e as ae,d as ne}from"./dialog-Va24CY58.js";import{S as ie,a as re,b as le,c as ce,d as oe}from"./select-C6W71KWg.js";import{B as de}from"./badge-BeHegjHt.js";import{S as he}from"./separator-CIUDwsOv.js";import{S as me}from"./skeleton-4G_X8bY4.js";import{P as xe,a as ue,b as pe,c as ge,d as fe,f as je,e as ve}from"./pagination-C8X0lLjr.js";import{b as Ne,h as ye,i as be}from"./voucher-C38MW_cY.js";import{u as we}from"./query-vendor-CBwfxcof.js";import{u as Ce,a as ke}from"./product-BXJPBtky.js";import{u as Ie}from"./promotion-DDJnNtmQ.js";import{a as Se}from"./promotions-CtwgNWvY.js";import{p as Te,c as De}from"./middleware-DTCYSWSl.js";import{g as Ae}from"./order-BDDy-DF1.js";import{C as ze,a as Ee,b as Pe,c as _e}from"./card-ClEzRAeX.js";import{S as $e}from"./scroll-area-CfH0A0Iz.js";import{T as Me,a as Oe,b as Ve,c as He,d as Re,e as qe}from"./table-DL-K3PV4.js";import{m as Fe,E as Le}from"./heavy-vendor-BfN2pHnQ.js";const Ge=e,Be=t,Ke=s,Ue=o.forwardRef((({className:e,sideOffset:t=4,...s},r)=>a.jsx(n,{children:a.jsx(i,{ref:r,sideOffset:t,className:d("z-50 overflow-hidden rounded-[6px] bg-primary px-3 py-1.5 text-xs text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]",e),...s})})));Ue.displayName=i.displayName;const We={dailySales:125e5,totalOrders:24,averageOrder:52e4,pendingOrders:3},Qe=h()(Te(((e,t)=>({stats:We,setStats:t=>e({stats:t}),updateStatsOnCheckout:s=>{const a=t().stats,n=a.dailySales+s,i=a.totalOrders+1,r=Math.round(n/i);e({stats:{...a,dailySales:n,totalOrders:i,averageOrder:r}})}})),{name:"pos-storage",storage:De((()=>localStorage))})),Xe=h(Te(((e,t)=>({items:[],appliedDiscount:0,appliedVoucher:null,couponCode:"",addToCart:s=>{const a=[...t().items],n=a.findIndex((e=>e.id===s.id));if(n>=0){if(!(a[n].quantity<s.stock))return;a[n].quantity+=1}else{const e={...s,hasDiscount:Boolean(s.hasDiscount||s.originalPrice&&s.originalPrice>s.price),discountPercent:s.discountPercent||0};a.push(e)}e({items:a})},removeFromCart:s=>{const a=t().items.filter((e=>e.id!==s));e({items:a})},updateQuantity:(s,a)=>{const n=t().items.map((e=>{if(e.id===s){const t=e.quantity+a;return t<=0?null:t>e.stock?{...e,quantity:e.stock}:{...e,quantity:t}}return e})).filter((e=>null!==e&&e.quantity>0));e({items:n})},clearCart:()=>{e({items:[],appliedDiscount:0,appliedVoucher:null,couponCode:""})},setDiscount:t=>{e({appliedDiscount:t})},setVoucher:t=>{e({appliedVoucher:t})},setCouponCode:t=>{e({couponCode:t})},calculateSubtotal:()=>t().items.reduce(((e,t)=>e+t.price*t.quantity),0),calculateTotal:()=>t().calculateSubtotal()-t().appliedDiscount})),{name:"pos-cart-storage"})),Ye=h()(Te(((e,t)=>({carts:[],activeCartId:null,maxCarts:5,createNewCart:()=>{const{carts:s,maxCarts:a}=t();if(s.length>=a)return null;const n=`cart-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,i={id:n,name:`Giỏ hàng ${s.length+1}`,items:[],appliedDiscount:0,appliedVoucher:null,couponCode:"",createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()};return e((e=>({carts:[...e.carts,i],activeCartId:n}))),n},deleteCart:t=>{e((e=>{const s=e.carts.filter((e=>e.id!==t));let a=e.activeCartId;e.activeCartId===t&&(a=s.length>0?s[0].id:null);return{carts:s.map(((e,t)=>({...e,name:`Giỏ hàng ${t+1}`,updatedAt:(new Date).toISOString()}))),activeCartId:a}}))},setActiveCart:s=>{const{carts:a}=t();a.some((e=>e.id===s))&&e({activeCartId:s})},updateCart:(t,s)=>{e((e=>({carts:e.carts.map((e=>e.id===t?{...e,...s,updatedAt:(new Date).toISOString()}:e))})))},getActiveCart:()=>{const{carts:e,activeCartId:s}=t();return e.find((e=>e.id===s))||null},clearAllCarts:()=>{e({carts:[],activeCartId:null})},addItemToCart:(t,s)=>{e((e=>({carts:e.carts.map((e=>{if(e.id!==t)return e;const a=e.items.findIndex((e=>e.id===s.id));let n;return n=a>=0?e.items.map(((e,t)=>t===a?{...e,quantity:e.quantity+s.quantity}:e)):[...e.items,s],{...e,items:n,updatedAt:(new Date).toISOString()}}))})))},removeItemFromCart:(t,s)=>{e((e=>({carts:e.carts.map((e=>e.id===t?{...e,items:e.items.filter((e=>e.id!==s)),updatedAt:(new Date).toISOString()}:e))})))},updateItemQuantityInCart:(t,s,a)=>{e((e=>({carts:e.carts.map((e=>{if(e.id!==t)return e;const n=e.items.map((e=>{if(e.id!==s)return e;const t=e.quantity+a;return t<=0?null:{...e,quantity:t}})).filter(Boolean);return{...e,items:n,updatedAt:(new Date).toISOString()}}))})))},clearCartItems:t=>{e((e=>({carts:e.carts.map((e=>e.id===t?{...e,items:[],appliedDiscount:0,appliedVoucher:null,couponCode:"",updatedAt:(new Date).toISOString()}:e))})))},setCartDiscount:(t,s,a,n)=>{e((e=>({carts:e.carts.map((e=>e.id===t?{...e,appliedDiscount:s,appliedVoucher:a||null,couponCode:n||"",updatedAt:(new Date).toISOString()}:e))})))}})),{name:"pending-carts-storage",version:1})),Ze=({open:e,onOpenChange:t,onVoucherSelect:s,formatCurrency:n})=>{var i;const{data:r,isLoading:l,isError:c}=Ne({page:1,limit:100,status:"HOAT_DONG"}),o=e=>new Date(e)<new Date,h=e=>e.quantity-e.usedCount<=0,u=e=>o(e.endDate)||h(e);return a.jsx(J,{open:e,onOpenChange:t,children:a.jsxs(ee,{className:"sm:max-w-6xl max-h-[90vh] flex flex-col ",children:[a.jsx(te,{className:"pb-6 border-b border-border",children:a.jsxs(se,{className:"flex items-center gap-2",children:[a.jsx(y.Icon,{path:b,size:1,className:"text-primary"}),a.jsx("span",{children:"Danh sách mã giảm giá"})]})}),a.jsx("div",{className:"flex-1 overflow-hidden",children:l?a.jsxs("div",{className:"space-y-4 py-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx(me,{className:"h-8 w-48"}),a.jsx(me,{className:"h-8 w-32"})]}),a.jsxs("div",{className:"border border-border rounded-xl overflow-hidden",children:[a.jsx("div",{className:"bg-gray-50 p-4 border-b",children:a.jsx("div",{className:"grid grid-cols-7 gap-4",children:[...Array(7)].map(((e,t)=>a.jsx(me,{className:"h-4 w-full"},t)))})}),[...Array(5)].map(((e,t)=>a.jsx("div",{className:"p-4 border-b border-border last:border-b-0",children:a.jsx("div",{className:"grid grid-cols-7 gap-4 items-center",children:[...Array(7)].map(((e,t)=>a.jsx(me,{className:"h-6 w-full"},t)))})},t)))]})]}):c?a.jsxs("div",{className:"flex flex-col items-center justify-center py-16",children:[a.jsx("div",{className:"h-20 w-20 rounded-full bg-red-50 flex items-center justify-center mb-6",children:a.jsx(y.Icon,{path:b,size:2,className:"text-red-500"})}),a.jsx("h3",{className:"text-xl font-semibold text-red-600 mb-2",children:"Lỗi khi tải dữ liệu"}),a.jsx("p",{className:"text-maintext text-center max-w-md",children:"Không thể tải danh sách mã giảm giá. Vui lòng kiểm tra kết nối mạng và thử lại."}),a.jsx(m,{variant:"outline",className:"mt-4",onClick:()=>window.location.reload(),children:"Thử lại"})]}):(null==(i=null==r?void 0:r.data)?void 0:i.vouchers)&&0!==r.data.vouchers.length?a.jsxs("div",{className:"py-0",children:[a.jsx("div",{className:"flex items-center justify-between mb-6",children:a.jsxs("div",{className:"flex items-center gap-6",children:[a.jsxs("div",{className:"text-sm text-maintext",children:[a.jsx("span",{className:"font-semibold text-primary text-lg",children:r.data.vouchers.length})," mã giảm giá"]}),a.jsxs("div",{className:"text-sm text-maintext",children:[a.jsx("span",{className:"font-semibold text-green-600 text-lg",children:r.data.vouchers.filter((e=>!u(e))).length})," khả dụng"]}),a.jsxs("div",{className:"text-sm text-maintext",children:[a.jsx("span",{className:"font-semibold text-red-600 text-lg",children:r.data.vouchers.filter((e=>u(e))).length})," không khả dụng"]})]})}),a.jsx("div",{className:"border border-border rounded-xl overflow-hidden shadow-sm bg-white",children:a.jsx($e,{className:"max-h-[50vh]",children:a.jsxs(Me,{children:[a.jsx(Oe,{children:a.jsxs(Ve,{children:[a.jsx(He,{className:"w-[180px]",children:"Mã giảm giá"}),a.jsx(He,{className:"w-[200px]",children:"Tên chương trình"}),a.jsx(He,{className:"text-center w-[80px]",children:"Loại"}),a.jsx(He,{className:"text-right w-[120px]",children:"Giá trị"}),a.jsx(He,{className:"text-right w-[150px]",children:"Đơn tối thiểu"}),a.jsx(He,{className:"text-center w-[80px]",children:"Còn lại"}),a.jsx(He,{className:"text-center w-[100px]",children:"Hết hạn"}),a.jsx(He,{className:"text-center w-[150px]",children:"Thao tác"})]})}),a.jsx(Re,{children:r.data.vouchers.map(((e,i)=>{const r=o(e.endDate),l=h(e),c=u(e),p=e.quantity-e.usedCount;return a.jsxs(Fe.tr,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.2,delay:.05*i},className:d("transition-all duration-200 hover:bg-gray-50/50",c&&"bg-gray-50/30 opacity-75"),children:[a.jsx(qe,{children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:d("h-2 w-2 rounded-full",c?"bg-red-400":"bg-green-400")}),a.jsxs("div",{children:[a.jsx("div",{className:d("font-mono font-bold text-sm tracking-wider",c?"text-maintext":"text-primary"),children:e.code}),a.jsxs("div",{className:"text-xs text-maintext",children:["ID: ",e.id.slice(-6)]})]})]})}),a.jsxs(qe,{children:[a.jsx("div",{className:d("font-medium text-sm leading-tight","text-maintext"),children:e.name}),a.jsxs("div",{className:"text-xs text-maintext mt-1",children:["Đã dùng: ",e.usedCount,"/",e.quantity]})]}),a.jsx(qe,{className:"text-center",children:a.jsx(de,{variant:"PERCENTAGE"===e.type?"default":"secondary",className:d("text-xs","PERCENTAGE"===e.type?"bg-blue-100 text-blue-700 border-blue-200":"bg-purple-100 text-purple-700 border-purple-200"),children:"PERCENTAGE"===e.type?"%":"VNĐ"})}),a.jsxs(qe,{className:"text-right",children:[a.jsx("div",{className:d("font-bold text-sm",c?"text-maintext":"text-primary"),children:"PERCENTAGE"===e.type?`${e.value}%`:n(e.value)}),"PERCENTAGE"===e.type&&e.maxValue&&a.jsxs("div",{className:"text-xs text-maintext",children:["Max: ",n(e.maxValue)]})]}),a.jsx(qe,{className:"text-right",children:a.jsx("div",{className:"font-semibold text-sm text-maintext",children:n(e.minOrderValue)})}),a.jsx(qe,{className:"text-center",children:a.jsx(de,{variant:p<=5?"destructive":p<=20?"outline":"secondary",className:d("text-xs font-semibold",p<=5?"bg-red-100 text-red-700 border-red-200":p<=20?"bg-yellow-100 text-yellow-700 border-yellow-200":"bg-green-100 text-green-700 border-green-200"),children:p})}),a.jsxs(qe,{className:"text-center",children:[a.jsx("div",{className:d("text-xs font-medium",r?"text-red-600":"text-maintext"),children:(g=e.endDate,new Intl.DateTimeFormat("vi-VN",{day:"2-digit",month:"2-digit",year:"numeric"}).format(new Date(g)))}),r&&a.jsx(de,{variant:"destructive",className:"text-xs mt-1",children:"Hết hạn"})]}),a.jsxs(qe,{className:"text-center",children:[a.jsx(Fe.div,{whileHover:c?{}:{scale:1.05},whileTap:c?{}:{scale:.95},children:a.jsxs(m,{size:"sm",className:d("px-4 py-2 text-xs font-semibold transition-all duration-200",c?"bg-gray-200 text-maintext cursor-not-allowed hover:bg-gray-200":"bg-gradient-to-r from-primary to-secondary hover:from-secondary hover:to-primary text-white shadow-md hover:shadow-lg"),onClick:()=>{return!c&&(a=e.code,void navigator.clipboard.writeText(a).then((()=>{x.success(`Đã sao chép mã: ${a}`),s(a),t(!1)})).catch((e=>{x.error("Không thể sao chép mã.")})));var a},disabled:c,children:[a.jsx(y.Icon,{path:w,size:.6,className:"mr-1.5"}),r?"Hết hạn":l?"Hết lượt":"Chọn mã"]})}),c&&a.jsx("div",{className:"text-xs text-red-500 mt-1 font-medium",children:r?"Đã hết hạn":"Hết lượt sử dụng"})]})]},e.id);var g}))})]})})}),a.jsx("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg border border-border",children:a.jsxs("div",{className:"flex items-center justify-between text-sm text-maintext",children:[a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"h-2 w-2 rounded-full bg-green-400"}),a.jsx("span",{children:"Khả dụng"})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"h-2 w-2 rounded-full bg-red-400"}),a.jsx("span",{children:"Không khả dụng"})]})]}),a.jsxs("div",{className:"text-xs text-maintext",children:["Cập nhật lần cuối: ",(new Date).toLocaleTimeString("vi-VN")]})]})})]}):a.jsxs("div",{className:"flex flex-col items-center justify-center py-16",children:[a.jsx("div",{className:"h-20 w-20 rounded-full bg-gray-50 flex items-center justify-center mb-6",children:a.jsx(y.Icon,{path:b,size:2,className:"text-maintext"})}),a.jsx("h3",{className:"text-xl font-semibold text-maintext mb-2",children:"Chưa có mã giảm giá"}),a.jsx("p",{className:"text-maintext text-center max-w-md",children:"Hiện tại không có mã giảm giá nào đang hoạt động trong hệ thống."})]})}),a.jsx(ae,{className:"pt-6 border-t border-border",children:a.jsxs(m,{variant:"outline",onClick:()=>t(!1),className:"px-8 py-2 font-medium",children:[a.jsx(y.Icon,{path:C,size:.7,className:"mr-2"}),"Đóng"]})})]})})};const Je=(()=>{let e=0;return()=>(e+=1,`u${`0000${(Math.random()*36**4|0).toString(36)}`.slice(-4)}${e}`)})();function et(e){const t=[];for(let s=0,a=e.length;s<a;s++)t.push(e[s]);return t}let tt=null;function st(e={}){return tt||(e.includeStyleProperties?(tt=e.includeStyleProperties,tt):(tt=et(window.getComputedStyle(document.documentElement)),tt))}function at(e,t){const s=(e.ownerDocument.defaultView||window).getComputedStyle(e).getPropertyValue(t);return s?parseFloat(s.replace("px","")):0}function nt(e,t={}){return{width:t.width||function(e){const t=at(e,"border-left-width"),s=at(e,"border-right-width");return e.clientWidth+t+s}(e),height:t.height||function(e){const t=at(e,"border-top-width"),s=at(e,"border-bottom-width");return e.clientHeight+t+s}(e)}}const it=16384;function rt(e){return new Promise(((t,s)=>{const a=new Image;a.onload=()=>{a.decode().then((()=>{requestAnimationFrame((()=>t(a)))}))},a.onerror=s,a.crossOrigin="anonymous",a.decoding="async",a.src=e}))}async function lt(e,t,s){const a="http://www.w3.org/2000/svg",n=document.createElementNS(a,"svg"),i=document.createElementNS(a,"foreignObject");return n.setAttribute("width",`${t}`),n.setAttribute("height",`${s}`),n.setAttribute("viewBox",`0 0 ${t} ${s}`),i.setAttribute("width","100%"),i.setAttribute("height","100%"),i.setAttribute("x","0"),i.setAttribute("y","0"),i.setAttribute("externalResourcesRequired","true"),n.appendChild(i),i.appendChild(e),async function(e){return Promise.resolve().then((()=>(new XMLSerializer).serializeToString(e))).then(encodeURIComponent).then((e=>`data:image/svg+xml;charset=utf-8,${e}`))}(n)}const ct=(e,t)=>{if(e instanceof t)return!0;const s=Object.getPrototypeOf(e);return null!==s&&(s.constructor.name===t.name||ct(s,t))};function ot(e,t,s,a){const n=`.${e}:${t}`,i=s.cssText?function(e){const t=e.getPropertyValue("content");return`${e.cssText} content: '${t.replace(/'|"/g,"")}';`}(s):function(e,t){return st(t).map((t=>`${t}: ${e.getPropertyValue(t)}${e.getPropertyPriority(t)?" !important":""};`)).join(" ")}(s,a);return document.createTextNode(`${n}{${i}}`)}function dt(e,t,s,a){const n=window.getComputedStyle(e,s),i=n.getPropertyValue("content");if(""===i||"none"===i)return;const r=Je();try{t.className=`${t.className} ${r}`}catch(c){return}const l=document.createElement("style");l.appendChild(ot(r,s,n,a)),t.appendChild(l)}const ht="application/font-woff",mt="image/jpeg",xt={woff:ht,woff2:ht,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:mt,jpeg:mt,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml",webp:"image/webp"};function ut(e){const t=function(e){const t=/\.([^./]*?)$/g.exec(e);return t?t[1]:""}(e).toLowerCase();return xt[t]||""}function pt(e){return-1!==e.search(/^(data:)/)}async function gt(e,t,s){const a=await fetch(e,t);if(404===a.status)throw new Error(`Resource "${a.url}" not found`);const n=await a.blob();return new Promise(((e,t)=>{const i=new FileReader;i.onerror=t,i.onloadend=()=>{try{e(s({res:a,result:i.result}))}catch(n){t(n)}},i.readAsDataURL(n)}))}const ft={};async function jt(e,t,s){const a=function(e,t,s){let a=e.replace(/\?.*/,"");return s&&(a=e),/ttf|otf|eot|woff2?/i.test(a)&&(a=a.replace(/.*\//,"")),t?`[${t}]${a}`:a}(e,t,s.includeQueryParams);if(null!=ft[a])return ft[a];let n;s.cacheBust&&(e+=(/\?/.test(e)?"&":"?")+(new Date).getTime());try{const a=await gt(e,s.fetchRequestInit,(({res:e,result:s})=>(t||(t=e.headers.get("Content-Type")||""),function(e){return e.split(/,/)[1]}(s))));n=function(e,t){return`data:${t};base64,${e}`}(a,t)}catch(i){n=s.imagePlaceholder||"";let t=`Failed to fetch resource: ${e}`;i&&(t="string"==typeof i?i:i.message)}return ft[a]=n,n}async function vt(e,t){return ct(e,HTMLCanvasElement)?async function(e){const t=e.toDataURL();return"data:,"===t?e.cloneNode(!1):rt(t)}(e):ct(e,HTMLVideoElement)?async function(e,t){if(e.currentSrc){const t=document.createElement("canvas"),s=t.getContext("2d");return t.width=e.clientWidth,t.height=e.clientHeight,null==s||s.drawImage(e,0,0,t.width,t.height),rt(t.toDataURL())}const s=e.poster,a=ut(s);return rt(await jt(s,a,t))}(e,t):ct(e,HTMLIFrameElement)?async function(e,t){var s;try{if(null===(s=null==e?void 0:e.contentDocument)||void 0===s?void 0:s.body)return await wt(e.contentDocument.body,t,!0)}catch(a){}return e.cloneNode(!1)}(e,t):e.cloneNode(yt(e))}const Nt=e=>null!=e.tagName&&"SLOT"===e.tagName.toUpperCase(),yt=e=>null!=e.tagName&&"SVG"===e.tagName.toUpperCase();function bt(e,t,s){return ct(t,Element)&&(function(e,t,s){const a=t.style;if(!a)return;const n=window.getComputedStyle(e);n.cssText?(a.cssText=n.cssText,a.transformOrigin=n.transformOrigin):st(s).forEach((s=>{let i=n.getPropertyValue(s);if("font-size"===s&&i.endsWith("px")){const e=Math.floor(parseFloat(i.substring(0,i.length-2)))-.1;i=`${e}px`}ct(e,HTMLIFrameElement)&&"display"===s&&"inline"===i&&(i="block"),"d"===s&&t.getAttribute("d")&&(i=`path(${t.getAttribute("d")})`),a.setProperty(s,i,n.getPropertyPriority(s))}))}(e,t,s),function(e,t,s){dt(e,t,":before",s),dt(e,t,":after",s)}(e,t,s),function(e,t){ct(e,HTMLTextAreaElement)&&(t.innerHTML=e.value),ct(e,HTMLInputElement)&&t.setAttribute("value",e.value)}(e,t),function(e,t){if(ct(e,HTMLSelectElement)){const s=t,a=Array.from(s.children).find((t=>e.value===t.getAttribute("value")));a&&a.setAttribute("selected","")}}(e,t)),t}async function wt(e,t,s){return s||!t.filter||t.filter(e)?Promise.resolve(e).then((e=>vt(e,t))).then((s=>async function(e,t,s){var a,n;if(yt(t))return t;let i=[];return i=Nt(e)&&e.assignedNodes?et(e.assignedNodes()):ct(e,HTMLIFrameElement)&&(null===(a=e.contentDocument)||void 0===a?void 0:a.body)?et(e.contentDocument.body.childNodes):et((null!==(n=e.shadowRoot)&&void 0!==n?n:e).childNodes),0===i.length||ct(e,HTMLVideoElement)||await i.reduce(((e,a)=>e.then((()=>wt(a,s))).then((e=>{e&&t.appendChild(e)}))),Promise.resolve()),t}(e,s,t))).then((s=>bt(e,s,t))).then((e=>async function(e,t){const s=e.querySelectorAll?e.querySelectorAll("use"):[];if(0===s.length)return e;const a={};for(let i=0;i<s.length;i++){const n=s[i].getAttribute("xlink:href");if(n){const s=e.querySelector(n),i=document.querySelector(n);s||!i||a[n]||(a[n]=await wt(i,t,!0))}}const n=Object.values(a);if(n.length){const t="http://www.w3.org/1999/xhtml",s=document.createElementNS(t,"svg");s.setAttribute("xmlns",t),s.style.position="absolute",s.style.width="0",s.style.height="0",s.style.overflow="hidden",s.style.display="none";const a=document.createElementNS(t,"defs");s.appendChild(a);for(let e=0;e<n.length;e++)a.appendChild(n[e]);e.appendChild(s)}return e}(e,t))):null}const Ct=/url\((['"]?)([^'"]+?)\1\)/g,kt=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,It=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;async function St(e,t,s,a,n){try{const i=s?function(e,t){if(e.match(/^[a-z]+:\/\//i))return e;if(e.match(/^\/\//))return window.location.protocol+e;if(e.match(/^[a-z]+:/i))return e;const s=document.implementation.createHTMLDocument(),a=s.createElement("base"),n=s.createElement("a");return s.head.appendChild(a),s.body.appendChild(n),t&&(a.href=t),n.href=e,n.href}(t,s):t,r=ut(t);let l;return n||(l=await jt(i,r,a)),e.replace(function(e){const t=e.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return new RegExp(`(url\\(['"]?)(${t})(['"]?\\))`,"g")}(t),`$1${l}$3`)}catch(i){}return e}function Tt(e){return-1!==e.search(Ct)}async function Dt(e,t,s){if(!Tt(e))return e;const a=function(e,{preferredFontFormat:t}){return t?e.replace(It,(e=>{for(;;){const[s,,a]=kt.exec(e)||[];if(!a)return"";if(a===t)return`src: ${s};`}})):e}(e,s),n=function(e){const t=[];return e.replace(Ct,((e,s,a)=>(t.push(a),e))),t.filter((e=>!pt(e)))}(a);return n.reduce(((e,a)=>e.then((e=>St(e,a,t,s)))),Promise.resolve(a))}async function At(e,t,s){var a;const n=null===(a=t.style)||void 0===a?void 0:a.getPropertyValue(e);if(n){const a=await Dt(n,null,s);return t.style.setProperty(e,a,t.style.getPropertyPriority(e)),!0}return!1}async function zt(e,t){ct(e,Element)&&(await async function(e,t){await At("background",e,t)||await At("background-image",e,t),await At("mask",e,t)||await At("-webkit-mask",e,t)||await At("mask-image",e,t)||await At("-webkit-mask-image",e,t)}(e,t),await async function(e,t){const s=ct(e,HTMLImageElement);if((!s||pt(e.src))&&(!ct(e,SVGImageElement)||pt(e.href.baseVal)))return;const a=s?e.src:e.href.baseVal,n=await jt(a,ut(a),t);await new Promise(((a,i)=>{e.onload=a,e.onerror=t.onImageErrorHandler?(...e)=>{try{a(t.onImageErrorHandler(...e))}catch(s){i(s)}}:i;const r=e;r.decode&&(r.decode=a),"lazy"===r.loading&&(r.loading="eager"),s?(e.srcset="",e.src=n):e.href.baseVal=n}))}(e,t),await async function(e,t){const s=et(e.childNodes).map((e=>zt(e,t)));await Promise.all(s).then((()=>e))}(e,t))}const Et={};async function Pt(e){let t=Et[e];if(null!=t)return t;const s=await fetch(e);return t={url:e,cssText:await s.text()},Et[e]=t,t}async function _t(e,t){let s=e.cssText;const a=/url\(["']?([^"')]+)["']?\)/g,n=(s.match(/url\([^)]+\)/g)||[]).map((async n=>{let i=n.replace(a,"$1");return i.startsWith("https://")||(i=new URL(i,e.url).href),gt(i,t.fetchRequestInit,(({result:e})=>(s=s.replace(n,`url(${e})`),[n,e])))}));return Promise.all(n).then((()=>s))}function $t(e){if(null==e)return[];const t=[];let s=e.replace(/(\/\*[\s\S]*?\*\/)/gi,"");const a=new RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");for(;;){const e=a.exec(s);if(null===e)break;t.push(e[0])}s=s.replace(a,"");const n=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,i=new RegExp("((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})","gi");for(;;){let e=n.exec(s);if(null===e){if(e=i.exec(s),null===e)break;n.lastIndex=i.lastIndex}else i.lastIndex=n.lastIndex;t.push(e[0])}return t}async function Mt(e,t){if(null==e.ownerDocument)throw new Error("Provided element is not within a Document");const s=et(e.ownerDocument.styleSheets),a=await async function(e,t){const s=[],a=[];return e.forEach((s=>{if("cssRules"in s)try{et(s.cssRules||[]).forEach(((e,n)=>{if(e.type===CSSRule.IMPORT_RULE){let i=n+1;const r=Pt(e.href).then((e=>_t(e,t))).then((e=>$t(e).forEach((e=>{try{s.insertRule(e,e.startsWith("@import")?i+=1:s.cssRules.length)}catch(t){}})))).catch((e=>{}));a.push(r)}}))}catch(n){const i=e.find((e=>null==e.href))||document.styleSheets[0];null!=s.href&&a.push(Pt(s.href).then((e=>_t(e,t))).then((e=>$t(e).forEach((e=>{i.insertRule(e,i.cssRules.length)})))).catch((e=>{})))}})),Promise.all(a).then((()=>(e.forEach((e=>{if("cssRules"in e)try{et(e.cssRules||[]).forEach((e=>{s.push(e)}))}catch(t){}})),s)))}(s,t);return function(e){return e.filter((e=>e.type===CSSRule.FONT_FACE_RULE)).filter((e=>Tt(e.style.getPropertyValue("src"))))}(a)}function Ot(e){return e.trim().replace(/["']/g,"")}async function Vt(e,t){const s=await Mt(e,t),a=function(e){const t=new Set;return function e(s){(s.style.fontFamily||getComputedStyle(s).fontFamily).split(",").forEach((e=>{t.add(Ot(e))})),Array.from(s.children).forEach((t=>{t instanceof HTMLElement&&e(t)}))}(e),t}(e);return(await Promise.all(s.filter((e=>a.has(Ot(e.style.fontFamily)))).map((e=>{const s=e.parentStyleSheet?e.parentStyleSheet.href:null;return Dt(e.cssText,s,t)})))).join("\n")}async function Ht(e,t={}){const{width:s,height:a}=nt(e,t),n=await wt(e,t,!0);await async function(e,t){const s=null!=t.fontEmbedCSS?t.fontEmbedCSS:t.skipFonts?null:await Vt(e,t);if(s){const t=document.createElement("style"),a=document.createTextNode(s);t.appendChild(a),e.firstChild?e.insertBefore(t,e.firstChild):e.appendChild(t)}}(n,t),await zt(n,t),function(e,t){const{style:s}=e;t.backgroundColor&&(s.backgroundColor=t.backgroundColor),t.width&&(s.width=`${t.width}px`),t.height&&(s.height=`${t.height}px`);const a=t.style;null!=a&&Object.keys(a).forEach((e=>{s[e]=a[e]}))}(n,t);return await lt(n,s,a)}async function Rt(e,t={}){const{width:s,height:a}=nt(e,t),n=await Ht(e,t),i=await rt(n),r=document.createElement("canvas"),l=r.getContext("2d"),c=t.pixelRatio||function(){let e,t;try{t=process}catch(a){}const s=t&&t.env?t.env.devicePixelRatio:null;return s&&(e=parseInt(s,10),Number.isNaN(e)&&(e=1)),e||window.devicePixelRatio||1}(),o=t.canvasWidth||s,d=t.canvasHeight||a;return r.width=o*c,r.height=d*c,t.skipAutoScale||function(e){(e.width>it||e.height>it)&&(e.width>it&&e.height>it?e.width>e.height?(e.height*=it/e.width,e.width=it):(e.width*=it/e.height,e.height=it):e.width>it?(e.height*=it/e.width,e.width=it):(e.width*=it/e.height,e.height=it))}(r),r.style.width=`${o}`,r.style.height=`${d}`,t.backgroundColor&&(l.fillStyle=t.backgroundColor,l.fillRect(0,0,r.width,r.height)),l.drawImage(i,0,0,r.width,r.height),r}const qt=o.forwardRef((({className:e,children:t,...s},n)=>a.jsxs(r,{ref:n,className:d("relative overflow-hidden",e),...s,children:[a.jsx(l,{className:"h-full w-full rounded-[inherit]",children:t}),a.jsx(c,{})]})));qt.displayName="CustomScrollArea";const Ft=({open:e,onOpenChange:t,invoiceData:s,formatCurrency:n,formatDateTimeForInvoice:i})=>{const[r,l]=o.useState(!1),c=o.useRef(null);if(!s)return null;return a.jsx(J,{open:e,onOpenChange:t,children:a.jsxs(ee,{className:"sm:max-w-2xl md:max-w-3xl lg:max-w-4xl max-h-[90vh] flex flex-col min-h-0",children:[a.jsx(te,{children:a.jsx(se,{className:"text-maintext text-center text-2xl font-semibold",children:"Hoá đơn bán hàng"})}),a.jsx(qt,{className:"flex-1 min-h-0 p-4 overflow-y-auto",children:a.jsxs("div",{ref:c,className:"p-4 bg-white",id:"invoice-content",children:[a.jsx("div",{className:"w-full justify-center mb-4",children:a.jsx("img",{draggable:"false",src:"/images/logo.svg",alt:"logo",width:100,height:100,className:"w-auto mx-auto h-20"})}),a.jsxs("div",{className:"text-center mb-4",children:[a.jsx("h2",{className:"text-xl font-bold",children:s.shopInfo.name}),a.jsx("p",{className:"text-sm",children:s.shopInfo.address}),a.jsxs("p",{className:"text-sm",children:["ĐT: ",s.shopInfo.phone," - Email: ",s.shopInfo.email]})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4 text-sm",children:[a.jsxs("div",{children:[a.jsxs("p",{children:[a.jsx("strong",{children:"Mã HĐ:"})," ",s.orderId]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Ngày:"})," ",i(s.createdAt)]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Nhân viên:"})," ",s.employee]})]}),a.jsxs("div",{className:"text-right",children:[a.jsxs("p",{children:[a.jsx("strong",{children:"Khách hàng:"})," ",s.customerInfo.name]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Điện thoại:"})," ",s.customerInfo.phone]})]})]}),a.jsxs(Me,{className:"mb-4 text-sm",children:[a.jsx(Oe,{children:a.jsxs(Ve,{children:[a.jsx(He,{className:"w-[40px] text-center",children:"STT"}),a.jsx(He,{children:"Tên sản phẩm"}),a.jsx(He,{className:"text-xs",children:"Màu/Size"}),a.jsx(He,{className:"text-right w-[50px]",children:"SL"}),a.jsx(He,{className:"text-right w-[100px]",children:"Đơn giá"}),a.jsx(He,{className:"text-right w-[100px]",children:"Thành tiền"})]})}),a.jsx(Re,{children:s.items.map(((e,t)=>a.jsxs(Ve,{children:[a.jsx(qe,{className:"text-center",children:t+1}),a.jsx(qe,{className:"font-medium",children:e.name}),a.jsxs(qe,{className:"text-xs",children:[e.color," / ",e.size]}),a.jsx(qe,{className:"text-right",children:e.quantity}),a.jsx(qe,{className:"text-right",children:n(e.price)}),a.jsx(qe,{className:"text-right font-semibold",children:n(e.total)})]},t)))})]}),a.jsx("div",{className:"flex justify-end mb-4",children:a.jsxs("div",{className:"w-full max-w-sm space-y-1.5 text-sm",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{children:"Tổng tiền hàng:"}),a.jsx("span",{children:n(s.subTotal)})]}),s.discount>0&&a.jsxs("div",{className:"flex justify-between text-red-600",children:[a.jsxs("span",{children:["Giảm giá (",s.voucherCode||"KM","):"]}),a.jsxs("span",{children:["-",n(s.discount)]})]}),a.jsx(he,{}),a.jsxs("div",{className:"flex justify-between font-bold text-base",children:[a.jsx("span",{children:"TỔNG THANH TOÁN:"}),a.jsx("span",{className:"text-primary",children:n(s.total)})]}),a.jsx(he,{}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{children:"Phương thức:"}),a.jsx("span",{children:s.paymentMethod})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{children:"Tiền khách đưa:"}),a.jsx("span",{children:n(s.cashReceived)})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{children:"Tiền thừa:"}),a.jsx("span",{children:n(s.changeGiven)})]})]})}),a.jsx("p",{className:"text-center text-sm mt-8",children:"Cảm ơn Quý khách và hẹn gặp lại!"}),a.jsxs("p",{className:"text-center text-xs mt-1",children:["Website: ",s.shopInfo.name.toLowerCase().replace(/ /g,""),".vn"]})]})}),a.jsxs(ae,{className:"mt-4",children:[a.jsx(m,{variant:"outline",onClick:()=>t(!1),children:"Đóng"}),a.jsxs(m,{onClick:async()=>{try{l(!0);const e=c.current;if(!e)throw new Error("Invoice element not found");const t=await async function(e,t={}){return(await Rt(e,t)).toDataURL()}(e,{quality:.95,pixelRatio:2,skipAutoScale:!0,cacheBust:!0}),a=new Le({orientation:"portrait",unit:"mm",format:"a4",putOnlyUsedFonts:!0}),n=a.internal.pageSize.getWidth(),i=a.getImageProperties(t),r=i.height*n/i.width;a.addImage(t,"PNG",0,0,n,r),a.save(`HoaDon_${s.orderId.replace(/[^a-zA-Z0-9]/g,"_")}.pdf`),x.success("Đã lưu hoá đơn PDF thành công!")}catch(e){x.error("Lỗi khi in hoá đơn PDF.")}finally{l(!1)}},disabled:r,children:[a.jsx(y.Icon,{path:k,size:.7,className:"mr-2"}),r?"Đang xử lý...":"Lưu PDF & In"]})]})]})})},Lt=({value:e,size:t=200})=>{const s=`https://api.qrserver.com/v1/create-qr-code/?size=${t}x${t}&data=${encodeURIComponent(e)}`;return a.jsx("img",{src:s,alt:"QR Code",width:t,height:t,className:"border border-gray-200 rounded"})},Gt=()=>a.jsxs("div",{className:"bg-white rounded-[6px] border border-border shadow-sm overflow-hidden",children:[a.jsx(me,{className:"h-48 w-full"}),a.jsxs("div",{className:"p-4",children:[a.jsx(me,{className:"h-4 w-3/4 mb-2"}),a.jsx(me,{className:"h-3 w-1/2 mb-2"}),a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx(me,{className:"h-4 w-1/3"}),a.jsxs("div",{className:"flex -space-x-1",children:[a.jsx(me,{className:"h-5 w-5 rounded-full"}),a.jsx(me,{className:"h-5 w-5 rounded-full"})]})]}),a.jsx(me,{className:"h-8 w-full mt-3"})]})]});function Bt(){var e,t,s,n,i,r,l,c,h,w,k,Ne,Te,De,Me,Oe,Ve,He,Re,qe;const[Le,We]=o.useState(""),[Je,et]=o.useState(null),[tt,st]=o.useState(null),{carts:at,activeCartId:nt,createNewCart:it,deleteCart:rt,setActiveCart:lt,addItemToCart:ct,removeItemFromCart:ot,updateItemQuantityInCart:dt,clearCartItems:ht,setCartDiscount:mt,getActiveCart:xt}=Ye(),ut=xt(),pt=(null==ut?void 0:ut.items)||[],gt=(null==ut?void 0:ut.appliedDiscount)||0,ft=(null==ut?void 0:ut.appliedVoucher)||null,jt=(null==ut?void 0:ut.couponCode)||"",{items:vt,appliedDiscount:Nt,appliedVoucher:yt,couponCode:bt,addToCart:wt,removeFromCart:Ct,updateQuantity:kt,clearCart:It,setDiscount:St,setVoucher:Tt,setCouponCode:Dt,calculateSubtotal:At,calculateTotal:zt}=Xe(),[Et,Pt]=o.useState("cash"),[_t,$t]=o.useState(!1),[Mt,Ot]=o.useState(""),[Vt,Ht]=o.useState(""),[Rt,qt]=o.useState("guest"),[Bt,Kt]=o.useState(!1),[Ut,Wt]=o.useState(!1),[Qt,Xt]=o.useState(!1),[Yt,Zt]=o.useState({page:1,limit:6}),[Jt,es]=o.useState({status:"HOAT_DONG"}),[ts,ss]=o.useState("newest"),[as,ns]=o.useState(!1),[is,rs]=o.useState("Tất cả sản phẩm"),[ls,cs]=o.useState(!1),[os,ds]=o.useState(""),[hs,ms]=o.useState(!1),[xs,us]=o.useState(null),[ps,gs]=o.useState(!1),[fs,js]=o.useState(null),[vs,Ns]=o.useState(!1),[ys,bs]=o.useState(null);Qe((e=>e.stats));const ws=Qe((e=>e.updateStatsOnCheckout)),Cs=Ae(),[ks,Is]=o.useState([{id:"TX-1234",customer:"Nguyễn Văn A",amount:125e4,time:"10:25",status:"completed"},{id:"TX-1233",customer:"Trần Thị B",amount:85e4,time:"09:40",status:"completed"},{id:"TX-1232",customer:"Lê Văn C",amount:21e5,time:"09:15",status:"pending"}]),{mutate:Ss}=ye(),Ts=o.useMemo((()=>({role:"CUSTOMER",status:"HOAT_DONG",limit:100})),[]),{data:Ds,isLoading:As}=u(Ts);o.useEffect((()=>{const e=setTimeout((()=>{ns(Le.trim().length>0)}),300);return()=>clearTimeout(e)}),[Le]),o.useEffect((()=>{es((e=>{var t;if("Tất cả sản phẩm"===is){const{categories:t,...s}=e;return t?s:e}{const s=[is];return(null==(t=e.categories)?void 0:t[0])===is?e:{...e,categories:s}}})),Zt((e=>({...e,page:1})))}),[is]);const zs=o.useMemo((()=>({...Yt,...Jt})),[Yt.page,Yt.limit,Jt.status,Jt.categories]),Es=Ce(zs),Ps=o.useMemo((()=>as?{keyword:Le,status:"HOAT_DONG",page:Yt.page,limit:Yt.limit,...Jt.categories&&{categories:Jt.categories}}:{keyword:""}),[as,Le,Yt.page,Yt.limit,Jt.categories]),_s=ke(Ps),{data:$s,isLoading:Ms,isError:Os}=as?_s:Es,Vs=o.useMemo((()=>({status:"HOAT_DONG"})),[]),{data:Hs}=Ie(Vs),Rs=o.useMemo((()=>{var e,t,s;if(!(null==(e=null==$s?void 0:$s.data)?void 0:e.products))return $s;let a=$s.data.products;return(null==(s=null==(t=null==Hs?void 0:Hs.data)?void 0:t.promotions)?void 0:s.length)>0&&(a=Se([...a],Hs.data.promotions)),{...$s,data:{...$s.data,products:a}}}),[null==(e=null==$s?void 0:$s.data)?void 0:e.products,null==(t=null==Hs?void 0:Hs.data)?void 0:t.promotions]),qs=o.useMemo((()=>{var e;const t=null==(e=null==Rs?void 0:Rs.data)?void 0:e.products;return(null==t?void 0:t.length)?"default"===ts||"newest"===ts?t:[...t].sort(((e,t)=>{var s,a;const n=e.hasDiscount?e.discountedPrice:(null==(s=e.variants[0])?void 0:s.price)||0,i=t.hasDiscount?t.discountedPrice:(null==(a=t.variants[0])?void 0:a.price)||0;switch(ts){case"price-asc":return n-i;case"price-desc":return i-n;default:return 0}})):[]}),[null==(s=null==Rs?void 0:Rs.data)?void 0:s.products,ts]),Fs=o.useMemo((()=>{var e;const t=[{id:"all",name:"Tất cả sản phẩm"}],s=null==(e=null==Rs?void 0:Rs.data)?void 0:e.products;if(!(null==s?void 0:s.length))return t;const a=new Map;for(const n of s)n.category&&"object"==typeof n.category&&n.(category as any)?.id&&n.category.name?a.has(n.(category as any)?.id)||a.set(n.(category as any)?.id,{id:n.(category as any)?.id,name:n.category.name}):"string"!=typeof n.category||a.has(n.category)||a.set(n.category,{id:n.category,name:n.category});return[...t,...Array.from(a.values())]}),[null==(i=null==(n=null==Rs?void 0:Rs.data)?void 0:n.products)?void 0:i.length]),Ls=e=>{if(et(e),e.variants&&e.variants.length>0){const t=e.variants.find((e=>e.stock>0))||e.variants[0];st(t)}else st(null),x.warn("Sản phẩm này không có biến thể hoặc đã hết hàng.")},Gs=(e,t)=>{var s,a,n,i,r,l,c,o,d,h;const m=`${e.id}-${t.id}`,u=e.hasDiscount?e.discountedPrice:t.price,p={id:m,productId:e.id,variantId:t.id,name:e.name,colorName:(null==(s=t.colorId)?void 0:s.name)||"N/A",colorCode:null==(a=t.colorId)?void 0:a.code,sizeName:(null==(n=t.sizeId)?void 0:n.name)||(null==(i=t.sizeId)?void 0:i.value)||"N/A",price:u,originalPrice:e.hasDiscount?e.originalPrice:void 0,discountPercent:e.hasDiscount?e.discountPercent:void 0,hasDiscount:e.hasDiscount||!1,quantity:1,image:(null==(r=t.images)?void 0:r[0])||(null==(c=null==(l=e.variants[0])?void 0:l.images)?void 0:c[0])||"/placeholder.svg",stock:t.stock,actualColorId:null==(o=t.colorId)?void 0:o.id,actualSizeId:null==(d=t.sizeId)?void 0:d.id};if(nt){const e=pt.find((e=>e.id===m)),s=(null==(h=at.find((e=>e.id===nt)))?void 0:h.name)||"Giỏ hàng";e?e.quantity<t.stock?(dt(nt,m,1),x.success(`Đã cập nhật số lượng sản phẩm trong ${s}.`)):x.warn("Số lượng sản phẩm trong kho không đủ."):(ct(nt,p),x.success(`Đã thêm sản phẩm vào ${s}`))}else{const e=vt.find((e=>e.id===m));e?e.quantity<t.stock?(kt(m,1),x.success("Đã cập nhật số lượng sản phẩm.")):x.warn("Số lượng sản phẩm trong kho không đủ."):(wt(p),x.success("Đã thêm sản phẩm vào giỏ hàng"))}},Bs=(e,t)=>{if(nt){const s=pt.find((t=>t.id===e));if(!s)return;const a=s.quantity+t;if(a<=0)return void ot(nt,e);if(a>s.stock)return void x.warn(`Chỉ còn ${s.stock} sản phẩm trong kho.`);if(dt(nt,e,t),ft){const e=sa();if(e<ft.minOrderValue)x.warn(`Đơn hàng không còn đủ điều kiện cho mã "${ft.code}". Đã xóa mã.`),mt(nt,0,null,"");else{let t=0;"PERCENTAGE"===ft.type?(t=e*ft.value/100,ft.maxValue&&t>ft.maxValue&&(t=ft.maxValue)):"FIXED_AMOUNT"===ft.type&&(t=ft.value),t=Math.min(t,e),mt(nt,t,ft,jt)}}}else{const s=vt.find((t=>t.id===e));if(!s)return;const a=s.quantity+t;if(a<=0)return void Ct(e);if(a>s.stock)return void x.warn(`Chỉ còn ${s.stock} sản phẩm trong kho.`);kt(e,t)}},Ks=e=>{if(nt){if(ot(nt,e),x.success("Đã xóa sản phẩm khỏi giỏ hàng"),ft){(sa()<ft.minOrderValue||pt.length<=1)&&(x.warn(`Đơn hàng không còn đủ điều kiện cho mã "${ft.code}" hoặc giỏ hàng trống. Đã xóa mã.`),mt(nt,0,null,""))}}else Ct(e),x.success("Đã xóa sản phẩm khỏi giỏ hàng")},{data:Us,isLoading:Ws,refetch:Qs}=we({queryKey:["voucherByCodeToApply",jt],queryFn:()=>be({code:jt,status:"HOAT_DONG",limit:1,page:1}),enabled:!1}),Xs=async()=>{var e,t;if(!jt)return void x.error("Vui lòng nhập mã giảm giá.");const{data:s,isError:a}=await Qs();if(a)return x.error("Có lỗi xảy ra khi tìm mã giảm giá."),void(nt?mt(nt,0,null,""):(Tt(null),St(0)));const n=null==(t=null==(e=null==s?void 0:s.data)?void 0:e.vouchers)?void 0:t[0];if(n){const e=sa();if(e<n.minOrderValue)return x.error(`Đơn hàng chưa đạt giá trị tối thiểu ${Ys(n.minOrderValue)} để áp dụng mã này.`),void(nt?mt(nt,0,null,""):(Tt(null),St(0)));if(n.quantity<=n.usedCount)return x.error("Mã giảm giá này đã hết lượt sử dụng."),void(nt?mt(nt,0,null,""):(Tt(null),St(0)));if(new Date(n.endDate)<new Date)return x.error("Mã giảm giá đã hết hạn."),void(nt?mt(nt,0,null,""):(Tt(null),St(0)));let t=0;"PERCENTAGE"===n.type?(t=e*n.value/100,n.maxValue&&t>n.maxValue&&(t=n.maxValue)):"FIXED_AMOUNT"===n.type&&(t=n.value),t=Math.min(t,e),nt?mt(nt,t,n,jt):(St(t),Tt(n)),x.success(`Đã áp dụng mã giảm giá "${n.code}".`)}else x.error("Mã giảm giá không hợp lệ hoặc không tìm thấy."),nt?mt(nt,0,null,""):(Tt(null),St(0))},Ys=e=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND",maximumFractionDigits:0}).format(e),Zs=()=>{0!==((null==ut?void 0:ut.items)||vt).length?(oa(),ds(""),qt("guest"),Ot(""),Ht(""),Xt(!1),$t(!0)):x.error("Giỏ hàng đang trống")};o.useEffect((()=>{const e=e=>{if(e.altKey&&"p"===e.key&&Zs(),e.altKey&&"c"===e.key&&(pt.length>0||ft)&&(It(),nt&&ht(nt),et(null),st(null),x.success("Đã xóa giỏ hàng và mã giảm giá.")),e.altKey&&"s"===e.key){const t=document.getElementById("product-search");t&&(e.preventDefault(),t.focus())}};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)}),[pt,ft,Zs]);const Js=o.useMemo((()=>{var e,t;if(!(null==(e=null==Je?void 0:Je.variants)?void 0:e.length))return[];const s=new Map;for(const a of Je.variants)(null==(t=a.colorId)?void 0:t.id)&&!s.has(a.colorId.id)&&s.set(a.colorId.id,a.colorId);return Array.from(s.values()).filter(Boolean)}),[null==Je?void 0:Je.id,null==(r=null==Je?void 0:Je.variants)?void 0:r.length]),ea=o.useMemo((()=>{var e,t,s,a;if(!(null==(e=null==Je?void 0:Je.variants)?void 0:e.length)||!(null==(t=null==tt?void 0:tt.colorId)?void 0:t.id))return[];const n=new Map;for(const i of Je.variants)(null==(s=i.colorId)?void 0:s.id)===tt.colorId.id&&(null==(a=i.sizeId)?void 0:a.id)&&i.stock>0&&!n.has(i.sizeId.id)&&n.set(i.sizeId.id,i.sizeId);return Array.from(n.values()).filter(Boolean)}),[null==Je?void 0:Je.id,null==(l=null==tt?void 0:tt.colorId)?void 0:l.id]),ta=o.useMemo((()=>{const e=pt.reduce(((e,t)=>e+t.price*t.quantity),0);return{subtotal:e,total:Math.max(0,e-gt)}}),[pt,gt]),sa=()=>ta.subtotal,aa=()=>ta.total,na=ta.total;parseFloat(os.toString());const ia=o.useMemo((()=>{if("cash"!==Et||!os)return 0;const e=parseFloat(os.toString());return!isNaN(e)&&e>=na?e-na:0}),[Et,os,na]),ra=o.useCallback((e=>"object"==typeof e?e.name:e),[]),la=e=>{js(e),gs(!0)},ca=e=>{lt(e);const t=at.find((t=>t.id===e));t&&x.info(`Đã chuyển sang ${t.name}`)},oa=()=>{ut&&(It(),ut.items.forEach((e=>{wt(e)})),St(ut.appliedDiscount),Tt(ut.appliedVoucher),Dt(ut.couponCode))};return a.jsxs("div",{className:"h-full",children:[a.jsx("div",{className:"mb-4",children:a.jsx("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-4",children:a.jsx(L,{children:a.jsxs(G,{children:[a.jsx(B,{children:a.jsx(K,{href:"/admin/statistics",children:"Dashboard"})}),a.jsx(U,{}),a.jsx(B,{children:a.jsx(W,{children:"Bán hàng tại quầy"})})]})})})}),a.jsxs("div",{className:"bg-white rounded-[6px] p-4 mb-4 shadow-sm border border-border",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsxs("h3",{className:"text-lg font-semibold text-maintext flex items-center gap-2",children:[a.jsx(y.Icon,{path:I,size:1,className:"text-primary"}),"Hoá đơn chờ (",at.length,"/5)"]}),a.jsxs(m,{onClick:()=>{it()?x.success(`Đã tạo giỏ hàng mới: Giỏ hàng ${at.length+1}`):x.warn("Không thể tạo thêm giỏ hàng. Tối đa 5 Hoá đơn chờ!")},disabled:at.length>=5,children:[a.jsx(y.Icon,{path:S,size:.7}),"Thêm mới"]})]}),at.length>0&&a.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-2",children:[at.slice(0,5).map(((e,t)=>a.jsxs(Fe.button,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:d("relative flex items-center gap-2 p-2 rounded-sm border-2 transition-all duration-200 min-w-[140px] group",nt===e.id?"border-primary bg-primary/5 text-primary shadow-md":"border-border bg-white text-maintext hover:border-primary/50 hover:bg-primary/5"),onClick:()=>ca(e.id),children:[a.jsxs("div",{className:"flex items-center gap-1 flex-1",children:[a.jsx("div",{className:d("w-2 h-2 rounded-full",e.items.length>0?"bg-green-500":"bg-gray-300")}),a.jsxs("span",{className:"text-sm font-medium truncate",children:[e.name," ",a.jsxs("span",{className:"text-sm text-maintext/70 font-semibold",children:["(",e.items.reduce(((e,t)=>e+t.quantity),0),")"]})]})]}),a.jsx("button",{className:"opacity-0 group-hover:opacity-100 transition-opacity border border-red-500/70 p-1 hover:bg-red-400 bg-red-400 rounded-full hover:!text-white text-white",onClick:t=>{t.stopPropagation(),la(e.id)},children:a.jsx(y.Icon,{path:T,size:.7,className:"hover:!text-white"})})]},e.id))),at.length>5&&a.jsxs(p,{children:[a.jsx(g,{asChild:!0,children:a.jsxs(m,{variant:"outline",size:"sm",className:"min-w-[100px] h-[46px] border-2 border-primary/50 flex items-center justify-center text-sm",children:["+",at.length-4," khác",a.jsx(y.Icon,{path:D,size:.7,className:"ml-1"})]})}),a.jsx(f,{align:"end",className:"w-56",children:at.slice(4).map((e=>a.jsxs(j,{className:"flex items-center justify-between",onClick:()=>ca(e.id),children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:d("w-2 h-2 rounded-full",e.items.length>0?"bg-green-500":"bg-gray-300")}),a.jsx("span",{children:e.name}),e.items.length>0&&a.jsx(de,{variant:"secondary",className:"text-xs",children:e.items.reduce(((e,t)=>e+t.quantity),0)})]}),a.jsx("button",{className:"p-1 hover:bg-red-100 rounded",onClick:t=>{t.stopPropagation(),la(e.id)},children:a.jsx(y.Icon,{path:T,size:.4,className:"text-red-500"})})]},e.id)))})]})]})]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[a.jsxs("div",{className:"lg:col-span-2 overflow-hidden flex flex-col",children:[a.jsxs("div",{className:"bg-white rounded-[6px] p-4 mb-4 shadow-sm border border-border hover:shadow-md transition-shadow duration-300",children:[a.jsx("div",{className:"flex flex-col md:flex-row md:items-center gap-4 mb-4",children:a.jsxs("div",{className:"relative flex-1",children:[a.jsx(y.Icon,{path:A,size:1,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-maintext"}),a.jsx(v,{id:"product-search",type:"text",placeholder:"Tìm kiếm sản phẩm...",className:"w-full pl-10 pr-4 py-2.5 rounded-[6px] border border-border focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary transition-all duration-200",value:Le,onChange:e=>We(e.target.value)})]})}),a.jsx("div",{className:"flex overflow-x-auto pb-2 scrollbar-thin gap-2",children:Fs.map((e=>a.jsx("button",{className:d("whitespace-nowrap px-4 py-2 rounded-[6px] text-sm font-medium transition-all duration-200",is===e.name?"bg-primary text-white shadow-sm":"bg-gray-50 text-maintext hover:bg-gray-100 hover:text-primary"),onClick:()=>{rs(e.name),et(null),st(null)},children:e.name},e.id)))})]}),a.jsxs("div",{className:"bg-white rounded-xl p-4 flex-1 shadow-lg border border-border/50 hover:shadow-xl transition-all duration-300 min-h-[400px]",children:[Je&&a.jsx("div",{className:"w-full flex items-center justify-between mb-4",children:a.jsxs(Fe.button,{className:"text-sm text-primary font-medium flex items-center gap-2 hover:text-primary/80 transition-colors bg-primary/5 px-4 py-2 rounded-full",onClick:()=>{et(null),st(null)},whileHover:{scale:1.02},whileTap:{scale:.98},children:[a.jsx(y.Icon,{path:C,size:.7}),"Quay lại danh sách sản phẩm"]})}),Je&&tt?a.jsx("div",{className:"mb-4",children:a.jsxs("div",{className:"flex flex-col lg:flex-row gap-8",children:[a.jsxs(Fe.div,{className:"lg:w-1/2",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.5},children:[a.jsxs("div",{className:"relative aspect-square w-full overflow-hidden rounded-2xl bg-gradient-to-br from-gray-50 to-white border group",children:[a.jsx("img",{src:N((null==(c=null==tt?void 0:tt.images)?void 0:c[0])||(null==(w=null==(h=Je.variants[0])?void 0:h.images)?void 0:w[0])),alt:Je.name,className:"object-contain p-4 transition-transform duration-500 group-hover:scale-110"}),a.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-transparent via-transparent to-primary/5 opacity-0 group-hover:opacity-100 transition-opacity duration-500 rounded-2xl"})]}),tt&&a.jsx(Fe.div,{whileHover:{scale:1.02},whileTap:{scale:.98},children:a.jsxs(m,{className:"w-full mt-4",onClick:()=>{Je&&tt?0!==tt.stock?(Gs(Je,tt),et(null),st(null)):x.error("Sản phẩm này đã hết hàng."):x.error("Vui lòng chọn sản phẩm, màu và kích thước.")},disabled:0===tt.stock,children:[a.jsx(y.Icon,{path:z,size:.7}),"Thêm vào giỏ hàng POS"]})})]}),a.jsxs(Fe.div,{className:"lg:w-1/2 space-y-8",initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.5,delay:.1},children:[a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(de,{variant:"secondary",className:"bg-primary/10 text-primary border-primary/20",children:ra(Je.brand)}),a.jsx(de,{variant:"outline",className:"text-maintext",children:"Admin POS"})]}),a.jsx("h2",{className:"text-2xl font-bold text-maintext leading-tight",children:Je.name}),a.jsxs(Fe.div,{className:"space-y-2",whileHover:{scale:1.05},transition:{duration:.2},children:[a.jsx("div",{className:"text-4xl font-bold "+(Je.hasDiscount,"text-primary"),children:Ys(Je.hasDiscount?Je.discountedPrice:tt.price)}),Je.hasDiscount&&a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-xl text-maintext line-through",children:Ys(Je.originalPrice)}),a.jsxs(de,{variant:"destructive",className:"bg-green-500",children:["-",Je.discountPercent,"% OFF"]})]})]})]}),Js.length>0&&a.jsxs(Fe.div,{className:"mt-8",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.2},children:[a.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[a.jsx(y.Icon,{path:E,size:1,className:"text-primary"}),a.jsx("h3",{className:"text-base font-semibold text-maintext",children:"Màu sắc"}),(null==tt?void 0:tt.colorId)&&a.jsx(de,{variant:"secondary",className:"bg-primary/10 text-primary border-primary/20",children:tt.colorId.name})]}),a.jsx("div",{className:"flex gap-4 flex-wrap",children:Js.map((e=>{var t,s,n;return a.jsx(Fe.button,{className:d("relative group flex items-center justify-center w-8 h-8 rounded-full transition-all duration-300 border-2",(null==(t=null==tt?void 0:tt.colorId)?void 0:t.id)===e.id?"border-primary ring-4 ring-primary/20 scale-110":"border-gray-200 hover:border-gray-300 hover:scale-105"),style:{backgroundColor:e.code},onClick:()=>(e=>{if(!Je)return;const t=Je.variants.find((t=>{var s;return(null==(s=t.colorId)?void 0:s.id)===e&&t.stock>0}));if(t)st(t);else{const t=Je.variants.find((t=>{var s;return(null==(s=t.colorId)?void 0:s.id)===e}));t&&(st(t),0===t.stock&&x.warn("Màu này đã hết hàng."))}})(e.id),title:e.name,whileHover:{scale:(null==(s=null==tt?void 0:tt.colorId)?void 0:s.id)===e.id?1.1:1.05},whileTap:{scale:.95},children:(null==(n=null==tt?void 0:tt.colorId)?void 0:n.id)===e.id&&a.jsx(y.Icon,{path:P,size:1,className:"text-white drop-shadow-lg"})},e.id)}))})]}),ea.length>0&&(null==tt?void 0:tt.colorId)&&a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(y.Icon,{path:_,size:1,className:"text-primary"}),a.jsx("h3",{className:"text-base font-semibold text-maintext",children:"Kích thước"}),(null==tt?void 0:tt.sizeId)&&a.jsx(de,{variant:"secondary",className:"bg-primary/10 text-primary border-primary/20",children:tt.sizeId.name||tt.sizeId.value})]}),a.jsx("div",{className:"flex flex-wrap gap-4",children:ea.map((e=>{var t;const s=Je.variants.find((t=>{var s,a,n;return(null==(s=t.colorId)?void 0:s.id)===(null==(a=tt.colorId)?void 0:a.id)&&(null==(n=t.sizeId)?void 0:n.id)===e.id})),n=(null==s?void 0:s.stock)||0;return a.jsxs(m,{size:"icon",variant:(null==(t=null==tt?void 0:tt.sizeId)?void 0:t.id)===e.id?"default":"outline",className:d("transition-all duration-300",0===n&&"opacity-50 cursor-not-allowed"),onClick:()=>(e=>{if(!Je||!(null==tt?void 0:tt.colorId))return;const t=Je.variants.find((t=>{var s,a,n;return(null==(s=t.colorId)?void 0:s.id)===(null==(a=tt.colorId)?void 0:a.id)&&(null==(n=t.sizeId)?void 0:n.id)===e&&t.stock>0}));if(t)st(t);else{const t=Je.variants.find((t=>{var s,a,n;return(null==(s=t.colorId)?void 0:s.id)===(null==(a=tt.colorId)?void 0:a.id)&&(null==(n=t.sizeId)?void 0:n.id)===e}));t&&(st(t),0===t.stock&&x.warn("Kích thước này với màu đã chọn đã hết hàng."))}})(e.id),disabled:0===n,children:[e.name||e.value,0===n&&" (Hết hàng)"]},e.id)}))})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(y.Icon,{path:$,size:1,className:"text-primary"}),a.jsx("h3",{className:"text-base font-semibold text-maintext",children:"Tồn kho"}),(null==tt?void 0:tt.sizeId)&&a.jsx(de,{variant:"secondary",className:"bg-primary/10 text-primary border-primary/20",children:tt.stock})]})]})]})}):a.jsxs(Q,{defaultValue:"grid",className:"w-full",children:[a.jsxs("div",{className:"flex justify-between items-center mb-4",children:[a.jsxs(X,{children:[a.jsxs(Y,{value:"grid",className:"flex items-center gap-1 text-maintext/70",children:[a.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"text-maintext",children:[a.jsx("rect",{width:"7",height:"7",x:"3",y:"3",rx:"1"}),a.jsx("rect",{width:"7",height:"7",x:"14",y:"3",rx:"1"}),a.jsx("rect",{width:"7",height:"7",x:"14",y:"14",rx:"1"}),a.jsx("rect",{width:"7",height:"7",x:"3",y:"14",rx:"1"})]}),"Lưới"]}),a.jsxs(Y,{value:"table",className:"flex items-center gap-1 text-maintext/70",children:[a.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"text-maintext",children:[a.jsx("path",{d:"M3 3h18v18H3z"}),a.jsx("path",{d:"M3 9h18"}),a.jsx("path",{d:"M3 15h18"}),a.jsx("path",{d:"M9 3v18"}),a.jsx("path",{d:"M15 3v18"})]}),"Bảng"]})]}),a.jsxs("div",{className:"text-sm text-maintext",children:["Hiển thị ",Ms?a.jsx(me,{className:"h-4 w-5 inline-block"}):qs.length," / ",(null==(Ne=null==(k=null==$s?void 0:$s.data)?void 0:k.pagination)?void 0:Ne.totalItems)||0," sản phẩm"]})]}),Ms?a.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",children:[...Array(Yt.limit)].map(((e,t)=>a.jsx(Gt,{},t)))}):Os?a.jsx("div",{className:"text-center py-10 text-red-500",children:"Lỗi khi tải sản phẩm. Vui lòng thử lại."}):0===qs.length?a.jsx("div",{className:"text-center py-10 text-maintext",children:"Không tìm thấy sản phẩm nào."}):a.jsxs(a.Fragment,{children:[a.jsx(Z,{value:"grid",className:"mt-0",children:a.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",children:qs.map((e=>{var t,s;const n=null==(t=e.variants)?void 0:t[0],i=new Set(e.variants.map((e=>{var t;return null==(t=e.colorId)?void 0:t.id}))).size;return a.jsxs(Fe.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},className:"bg-white rounded-[6px] border border-border shadow-sm overflow-hidden hover:shadow-md transition-all duration-300 group",children:[a.jsxs("div",{className:"relative h-48 w-full bg-gray-50 overflow-hidden cursor-pointer",onClick:()=>Ls(e),children:[a.jsx("img",{src:N(null==(s=null==n?void 0:n.images)?void 0:s[0]),alt:e.name,className:"object-contain transition-transform duration-300 group-hover:scale-105"}),a.jsx("div",{className:"absolute top-2 right-2 flex flex-col gap-1",children:e.hasDiscount&&a.jsxs(de,{variant:"destructive",className:"bg-green-500 text-white",children:["-",e.discountPercent,"% OFF"]})})]}),a.jsxs("div",{className:"p-4",children:[a.jsx("h3",{className:"font-medium text-maintext group-hover:text-primary transition-colors truncate cursor-pointer",onClick:()=>Ls(e),children:e.name}),a.jsx("p",{className:"text-maintext text-sm mb-2 truncate",children:ra(e.brand)}),a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsxs("div",{className:"flex flex-col",children:[a.jsx("p",{className:"font-medium "+(e.hasDiscount,"text-primary"),children:n?Ys(e.hasDiscount?e.discountedPrice:n.price):"N/A"}),e.hasDiscount&&a.jsx("p",{className:"text-xs text-maintext line-through",children:Ys(e.originalPrice)})]}),e.variants.length>0&&a.jsxs("div",{className:"flex -space-x-1",children:[Array.from(new Map(e.variants.map((e=>{var t;return[null==(t=e.colorId)?void 0:t.id,e.colorId]}))).values()).slice(0,3).map(((e,t)=>e&&a.jsx("div",{className:"h-5 w-5 rounded-full border border-white",style:{backgroundColor:e.code},title:e.name},e.id||t))),i>3&&a.jsxs("div",{className:"h-5 w-5 rounded-full bg-gray-100 border border-white flex items-center justify-center text-xs text-maintext",children:["+",i-3]})]})]}),a.jsxs(m,{variant:"outline",className:"w-full mt-3 flex items-center justify-center gap-2",onClick:t=>{t.stopPropagation();const s=e.variants.find((e=>e.stock>0))||e.variants[0];s?s.stock>0?Gs(e,s):x.warn("Sản phẩm này đã hết hàng."):x.warn("Sản phẩm này không có biến thể hoặc đã hết hàng.")},disabled:e.variants.every((e=>0===e.stock)),children:[a.jsx(y.Icon,{path:M,size:.7}),"Thêm vào giỏ"]})]})]},e.id)}))})}),a.jsx(Z,{value:"table",className:"mt-0",children:a.jsx("div",{className:"border border-border rounded-[6px] overflow-hidden",children:a.jsxs("table",{className:"w-full text-sm",children:[a.jsx("thead",{children:a.jsxs("tr",{className:"bg-muted/50",children:[a.jsx("th",{className:"text-left py-3 px-4 font-medium text-maintext",children:"Sản phẩm"}),a.jsx("th",{className:"text-left py-3 px-4 font-medium text-maintext",children:"Thương hiệu"}),a.jsx("th",{className:"text-left py-3 px-4 font-medium text-maintext",children:"Giá"}),a.jsx("th",{className:"text-left py-3 px-4 font-medium text-maintext",children:"Màu sắc"}),a.jsx("th",{className:"text-left py-3 px-4 font-medium text-maintext",children:"Kho"}),a.jsx("th",{className:"text-center py-3 px-4 font-medium text-maintext",children:"Thao tác"})]})}),a.jsx("tbody",{children:qs.map((e=>{var t,s;const n=null==(t=e.variants)?void 0:t[0],i=e.variants.reduce(((e,t)=>e+t.stock),0),r=new Set(e.variants.map((e=>{var t;return null==(t=e.colorId)?void 0:t.id}))).size,l=e.variants.find((e=>e.stock>0))||e.variants[0];return a.jsxs("tr",{className:"border-t border-border hover:bg-muted/20 transition-colors cursor-pointer",children:[a.jsx("td",{className:"py-3 px-4",onClick:()=>Ls(e),children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"relative h-10 w-10 rounded-[6px] overflow-hidden bg-gray-50",children:a.jsx("img",{src:N(null==(s=null==n?void 0:n.images)?void 0:s[0]),alt:e.name,className:"object-contain"})}),a.jsx("span",{className:"font-medium text-maintext truncate max-w-[150px]",children:e.name})]})}),a.jsx("td",{className:"py-3 px-4 text-maintext truncate max-w-[100px]",onClick:()=>Ls(e),children:ra(e.brand)}),a.jsx("td",{className:"py-3 px-4",onClick:()=>Ls(e),children:a.jsxs("div",{className:"flex flex-col",children:[a.jsx("span",{className:"font-medium "+(e.hasDiscount,"text-primary"),children:n?Ys(e.hasDiscount?e.discountedPrice:n.price):"N/A"}),e.hasDiscount&&a.jsx("span",{className:"text-xs text-maintext line-through",children:Ys(e.originalPrice)})]})}),a.jsx("td",{className:"py-3 px-4",onClick:()=>Ls(e),children:e.variants.length>0&&a.jsxs("div",{className:"flex -space-x-1",children:[Array.from(new Map(e.variants.map((e=>{var t;return[null==(t=e.colorId)?void 0:t.id,e.colorId]}))).values()).slice(0,3).map(((e,t)=>e&&a.jsx("div",{className:"h-5 w-5 rounded-full border",style:{backgroundColor:e.code},title:e.name},e.id||t))),r>3&&a.jsxs("div",{className:"h-5 w-5 rounded-full bg-gray-100 border border-white flex items-center justify-center text-xs text-maintext",children:["+",r-3]})]})}),a.jsx("td",{className:"py-3 px-4",onClick:()=>Ls(e),children:a.jsx(de,{variant:i>10?"secondary":i>0?"outline":"destructive",className:"text-xs !flex-shrink-0",children:a.jsx("span",{className:"flex-shrink-0",children:i>10?"Còn hàng":i>0?"Sắp hết":"Hết hàng"})})}),a.jsx("td",{className:"py-3 px-4 text-center",children:a.jsxs("div",{className:"flex items-center justify-center gap-2",children:[a.jsx(Ge,{children:a.jsxs(Be,{children:[a.jsx(Ke,{asChild:!0,children:a.jsx(m,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:t=>{t.stopPropagation(),Ls(e)},children:a.jsx(y.Icon,{path:O,size:.7,className:"text-maintext"})})}),a.jsx(Ue,{children:a.jsx("p",{children:"Chi tiết"})})]})}),a.jsx(Ge,{children:a.jsxs(Be,{children:[a.jsx(Ke,{asChild:!0,children:a.jsx(m,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",disabled:e.variants.every((e=>0===e.stock)),onClick:t=>{t.stopPropagation(),l&&(l.stock>0?Gs(e,l):x.warn("Sản phẩm này đã hết hàng."))},children:a.jsx(y.Icon,{path:M,size:.7,className:"text-maintext"})})}),a.jsx(Ue,{children:a.jsx("p",{children:"Thêm vào giỏ"})})]})})]})})]},e.id)}))})]})})}),(null==(Te=null==Rs?void 0:Rs.data)?void 0:Te.pagination)&&Rs.data.pagination.totalPages>1&&a.jsx("div",{className:"flex justify-center mt-6",children:a.jsx(xe,{children:a.jsxs(ue,{children:[a.jsx(pe,{children:a.jsx(ge,{href:"#",onClick:e=>{e.preventDefault(),Yt.page>1&&Zt((e=>({...e,page:e.page-1})))},disabled:Yt.page<=1})}),(()=>{const e=[],t=Rs.data.pagination.totalPages,s=Yt.page;if(t<=5)for(let n=1;n<=t;n++)e.push(a.jsx(pe,{children:a.jsx(fe,{href:"#",isActive:s===n,onClick:e=>{e.preventDefault(),Zt((e=>({...e,page:n})))},children:n})},n));else{e.push(a.jsx(pe,{children:a.jsx(fe,{href:"#",isActive:1===s,onClick:e=>{e.preventDefault(),Zt((e=>({...e,page:1})))},children:"1"})},1)),s>3&&e.push(a.jsx(pe,{children:a.jsx(je,{})},"start-ellipsis"));let n=Math.max(2,s-1),i=Math.min(t-1,s+1);s<=2&&(i=Math.min(t-1,3)),s>=t-1&&(n=Math.max(2,t-2));for(let t=n;t<=i;t++)e.push(a.jsx(pe,{children:a.jsx(fe,{href:"#",isActive:s===t,onClick:e=>{e.preventDefault(),Zt((e=>({...e,page:t})))},children:t})},t));s<t-2&&e.push(a.jsx(pe,{children:a.jsx(je,{})},"end-ellipsis")),e.push(a.jsx(pe,{children:a.jsx(fe,{href:"#",isActive:s===t,onClick:e=>{e.preventDefault(),Zt((e=>({...e,page:t})))},children:t})},t))}return e})(),a.jsx(pe,{children:a.jsx(ve,{href:"#",onClick:e=>{var t,s;e.preventDefault(),Yt.page<((null==(s=null==(t=null==Rs?void 0:Rs.data)?void 0:t.pagination)?void 0:s.totalPages)||1)&&Zt((e=>({...e,page:e.page+1})))},disabled:Yt.page>=((null==(Me=null==(De=null==Rs?void 0:Rs.data)?void 0:De.pagination)?void 0:Me.totalPages)||1)})})]})})})]})]})]})]}),a.jsxs(ze,{children:[a.jsx(Ee,{children:a.jsxs(Pe,{className:"flex items-center gap-2 w-full justify-between",children:[ut?a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{children:ut.name}),a.jsxs(de,{variant:"secondary",className:"text-xs",children:[pt.reduce(((e,t)=>e+t.quantity),0)," sản phẩm"]})]}):"Giỏ hàng chính",at.length>4&&a.jsxs(p,{children:[a.jsx(g,{asChild:!0,children:a.jsxs(m,{variant:"outline",size:"sm",children:[a.jsx(y.Icon,{path:I,size:.7}),a.jsx(y.Icon,{path:D,size:.7,className:"ml-1"})]})}),a.jsx(f,{align:"end",className:"w-56",children:at.map((e=>a.jsxs(j,{className:"flex items-center justify-between",onClick:()=>ca(e.id),children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:d("w-2 h-2 rounded-full",e.items.length>0?"bg-green-500":"bg-gray-300")}),a.jsx("span",{children:e.name}),e.items.length>0&&a.jsx(de,{variant:"secondary",className:"text-xs",children:e.items.reduce(((e,t)=>e+t.quantity),0)})]}),a.jsx("button",{className:"p-1 hover:bg-red-100 rounded",onClick:t=>{t.stopPropagation(),la(e.id)},children:a.jsx(y.Icon,{path:T,size:.4,className:"text-red-500"})})]},e.id)))})]})]})}),a.jsx(_e,{className:"space-y-4",children:0===pt.length?a.jsxs("div",{className:"text-center py-8 text-maintext",children:[a.jsx(y.Icon,{path:I,size:2,className:"mx-auto mb-2 text-gray-300"}),a.jsx("p",{children:"Giỏ hàng trống"}),a.jsx("p",{className:"text-sm text-maintext",children:"Thêm sản phẩm để bắt đầu"})]}):a.jsxs(a.Fragment,{children:[a.jsx($e,{className:"h-[300px]",children:a.jsx("div",{className:"space-y-3",children:pt.map((e=>a.jsxs(Fe.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"flex items-center gap-2",children:[a.jsx("div",{className:"relative h-20 w-20 flex-shrink-0 rounded-md overflow-hidden bg-white",children:a.jsx("img",{src:N(e.image),alt:e.name,height:100,width:100,draggable:"false",className:"object-contain h-full w-full flex-shrink-0"})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("h4",{className:"font-medium text-sm text-maintext truncate text-wrap",children:e.name}),a.jsxs("p",{className:"text-xs text-maintext",children:[e.colorName," / ",e.sizeName]}),a.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[a.jsx("span",{className:"text-lg text-primary font-semibold",children:Ys(e.price)}),e.hasDiscount&&e.originalPrice&&a.jsx("span",{className:"text-sm text-maintext line-through",children:Ys(e.originalPrice)})]}),a.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[a.jsx(m,{variant:"outline",size:"sm",className:"h-8 w-8 p-0",onClick:()=>Bs(e.id,-1),children:a.jsx(y.Icon,{path:V,size:.7})}),a.jsx(v,{type:"number",value:e.quantity,onChange:t=>{const s=parseInt(t.target.value)||0;if(s<0)return void x.warn("Số lượng không được âm.");if(s>e.stock)return void x.warn(`Chỉ còn ${e.stock} sản phẩm trong kho.`);if(0===s)return void Ks(e.id);const a=s-e.quantity;0!==a&&Bs(e.id,a)},onBlur:t=>{const s=t.target.value;(""===s||isNaN(parseInt(s)))&&(t.target.value=e.quantity.toString())},className:"w-16 h-8 text-center text-sm",min:"1",max:e.stock}),a.jsx(m,{variant:"outline",size:"sm",className:"h-8 w-8 p-0",onClick:()=>Bs(e.id,1),disabled:e.quantity>=e.stock,children:a.jsx(y.Icon,{path:M,size:.7})}),a.jsx(m,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 text-red-500 hover:text-red-700 hover:bg-red-50 bg-red-50 border border-red-500",onClick:()=>Ks(e.id),children:a.jsx(y.Icon,{path:H,size:.7})})]})]})]},e.id)))})}),a.jsx(he,{}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(v,{placeholder:"Nhập mã giảm giá...",value:jt,onChange:e=>{if(nt){const t=xt();t&&mt(nt,t.appliedDiscount,t.appliedVoucher,e.target.value)}else Dt(e.target.value)},className:"flex-1"}),a.jsx(m,{variant:"default",onClick:Xs,disabled:!jt||Ws,children:Ws?"Đang kiểm tra...":"Áp dụng"})]}),a.jsx(m,{variant:"link",className:"text-sm text-primary mt-1 px-0",onClick:()=>cs(!0),children:"Xem danh sách mã giảm giá"}),ft&&a.jsxs("div",{className:"flex items-center justify-between p-2 bg-green-50 rounded-lg border border-green-200",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(y.Icon,{path:b,size:.7,className:"text-green-600"}),a.jsxs("span",{className:"text-sm font-medium text-green-800",children:["Mã: ",ft.code]})]}),a.jsx(m,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 text-green-600 hover:text-green-800",onClick:()=>{nt?mt(nt,0,null,""):(St(0),Tt(null),Dt(""))},children:a.jsx(y.Icon,{path:T,size:.7})})]})]}),a.jsx(he,{}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex justify-between text-sm",children:[a.jsx("span",{children:"Tạm tính:"}),a.jsx("span",{children:Ys(sa())})]}),gt>0&&a.jsxs("div",{className:"flex justify-between text-sm text-green-600",children:[a.jsx("span",{children:"Giảm giá:"}),a.jsxs("span",{children:["-",Ys(gt)]})]}),a.jsx(he,{}),a.jsxs("div",{className:"flex justify-between text-lg font-semibold",children:[a.jsx("span",{children:"Tổng cộng:"}),a.jsx("span",{className:"text-primary",children:Ys(aa())})]})]}),a.jsxs(m,{className:"w-full",onClick:Zs,disabled:0===pt.length,children:[a.jsx(y.Icon,{path:R,size:.7,className:"mr-2"}),"Thanh toán (",Ys(aa()),")"]})]})})]})]}),a.jsx(J,{open:_t,onOpenChange:$t,children:a.jsx(ee,{className:"sm:max-w-4xl",children:a.jsxs($e,{className:"max-h-[70vh] p-1",children:[a.jsx(te,{children:a.jsx(se,{children:"Xác nhận thanh toán"})}),a.jsxs("div",{className:"grid gap-4 py-4",children:[a.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[a.jsx(Ge,{children:a.jsxs(Be,{children:[a.jsx(Ke,{asChild:!0,children:a.jsx("label",{htmlFor:"user-select",className:"text-right text-sm text-maintext cursor-help font-semibold",children:"Chọn khách hàng"})}),a.jsx(Ue,{children:a.jsxs("div",{className:"text-center",children:[a.jsx("p",{children:"Chọn khách hàng có sẵn hoặc để trống để nhập thủ công"}),(null==(Oe=null==Ds?void 0:Ds.data)?void 0:Oe.accounts)&&a.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:["Có ",Ds.data.accounts.length," khách hàng trong hệ thống"]})]})})]})}),a.jsxs(ie,{value:Rt,onValueChange:e=>{var t;if(qt(e),e&&"guest"!==e&&"loading"!==e&&"no-customers"!==e&&(null==(t=null==Ds?void 0:Ds.data)?void 0:t.accounts)){const t=Ds.data.accounts.find((t=>t.id===e));t&&(Ot(t.fullName),Ht(t.phoneNumber||""))}else Ot(""),Ht("")},children:[a.jsx(re,{className:"col-span-3 h-12",children:a.jsx(le,{placeholder:`Chọn khách hàng (${(null==(He=null==(Ve=null==Ds?void 0:Ds.data)?void 0:Ve.accounts)?void 0:He.length)||0} khách hàng)`})}),a.jsxs(ce,{children:[a.jsx(oe,{value:"guest",children:a.jsxs("div",{className:"flex items-center gap-4 py-1",children:[a.jsx(y.Icon,{path:q,size:.7,className:"text-gray-400"}),a.jsxs("div",{className:"flex flex-col items-start",children:[a.jsx("span",{className:"text-xs text-maintext font-semibold",children:"Khách vãng lai"}),a.jsx("span",{className:"text-xs text-maintext",children:"Nhập thông tin thủ công"})]})]})}),As?a.jsx(oe,{value:"loading",disabled:!0,children:a.jsxs("div",{className:"flex items-center gap-4 py-2",children:[a.jsx("div",{className:"animate-spin h-4 w-4 border-2 border-blue-300 border-t-blue-600 rounded-full"}),a.jsx("span",{className:"text-maintext",children:"Đang tải danh sách khách hàng..."})]})}):(null==(Re=null==Ds?void 0:Ds.data)?void 0:Re.accounts)&&Ds.data.accounts.length>0?Ds.data.accounts.map((e=>a.jsx(oe,{value:e.id,children:a.jsxs("div",{className:"flex items-center gap-4 py-1",children:[a.jsx(y.Icon,{path:q,size:.7,className:"text-primary"}),a.jsxs("div",{className:"flex flex-col min-w-0 flex-1",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-primary font-semibold truncate",children:e.fullName}),e.code&&a.jsx("span",{className:"px-2 py-0.5 text-xs font-mono bg-green-50 text-green-600 rounded border border-green-200",children:e.code})]}),a.jsx("div",{className:"flex items-center gap-2 text-xs text-maintext mt-0.5",children:e.phoneNumber?a.jsxs("span",{className:"flex items-center gap-1 text-maintext",children:["📱 ",e.phoneNumber]}):a.jsxs("span",{className:"flex items-center gap-1 text-maintext",children:["✉️ ",e.email]})})]})]})},e.id))):a.jsx(oe,{value:"no-customers",disabled:!0,children:a.jsxs("div",{className:"flex items-center gap-4 py-2",children:[a.jsx(y.Icon,{path:q,size:.7,className:"text-gray-400"}),a.jsxs("div",{className:"flex flex-col",children:[a.jsx("span",{className:"text-maintext font-medium",children:"Không có khách hàng nào"}),a.jsx("span",{className:"text-xs text-gray-400",children:"Vui lòng thêm khách hàng mới"})]})]})})]})]})]}),a.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[a.jsx("label",{htmlFor:"customer-name",className:"text-right text-sm text-maintext font-semibold",children:"Tên khách hàng"}),a.jsx(v,{id:"customer-name",placeholder:"Tên khách hàng",className:"col-span-3",value:Mt,onChange:e=>{Ot(e.target.value),Rt&&"guest"!==Rt&&qt("guest")}})]}),a.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[a.jsx("label",{htmlFor:"customer-phone",className:"text-right text-sm text-maintext font-semibold",children:"Số điện thoại"}),a.jsx(v,{id:"customer-phone",placeholder:"Số điện thoại",className:"col-span-3",value:Vt,onChange:e=>{Ht(e.target.value),Rt&&"guest"!==Rt&&qt("guest")}})]}),a.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[a.jsx("label",{htmlFor:"payment-method",className:"text-right text-sm text-maintext font-semibold",children:"Thanh toán"}),a.jsxs(ie,{value:Et,onValueChange:e=>{Pt(e),Xt(!1),ds("transfer"===e?aa().toString():"")},children:[a.jsx(re,{className:"col-span-3",children:a.jsx(le,{placeholder:"Chọn phương thức thanh toán"})}),a.jsxs(ce,{children:[a.jsx(oe,{value:"cash",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(y.Icon,{path:F,size:.7,className:"text-maintext"}),a.jsx("span",{children:"Tiền mặt"})]})}),a.jsx(oe,{value:"transfer",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"text-maintext",children:[a.jsx("path",{d:"M4 10V4a2 2 0 0 1 2-2h8.5L20 7.5V20a2 2 0 0 1-2 2H4"}),a.jsx("polyline",{points:"14 2 14 8 20 8"}),a.jsx("path",{d:"m10 18 3-3-3-3"}),a.jsx("path",{d:"M4 18v-1a2 2 0 0 1 2-2h6"})]}),a.jsx("span",{children:"Chuyển khoản"})]})})]})]})]}),"cash"===Et&&a.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[a.jsx("label",{htmlFor:"cash-received",className:"text-right text-sm text-maintext font-semibold",children:"Tiền khách đưa"}),a.jsx(v,{id:"cash-received",type:"number",placeholder:"Nhập số tiền khách đưa",className:"col-span-3",value:os,onChange:e=>ds(e.target.value),min:0})]}),"transfer"===Et&&a.jsx("div",{className:"grid grid-cols-1 gap-4",children:a.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 text-center",onClick:()=>{Qt||(Xt(!0),Wt(!0))},style:{cursor:Qt?"default":"pointer"},children:[a.jsx("h3",{className:"text-lg font-semibold mb-4 text-maintext",children:"Quét mã QR để thanh toán"}),a.jsx("div",{className:"flex justify-center mb-4",children:a.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm border",children:a.jsx(Lt,{value:`BANK_TRANSFER|970415|0123456789|Clothes Shop|${aa()}|Thanh toan don hang ${(new Date).getTime()}`,size:200})})}),a.jsxs("div",{className:"text-sm text-maintext space-y-1",children:[a.jsxs("p",{children:[a.jsx("strong",{children:"Ngân hàng:"})," Vietcombank"]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Số tài khoản:"})," 0123456789"]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Chủ tài khoản:"})," Clothes Shop"]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Số tiền:"})," ",Ys(aa())]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Nội dung:"})," Thanh toan don hang ",(new Date).getTime()]})]}),Qt&&a.jsx("div",{className:"mt-4 p-3 bg-green-50 border border-green-200 rounded-lg",children:a.jsxs("div",{className:"flex items-center justify-center gap-2 text-green-700",children:[a.jsx("svg",{className:"w-5 h-5",viewBox:"0 0 20 20",children:a.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),a.jsx("span",{className:"font-medium",children:"Thanh toán thành công!"})]})})]})}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex justify-between text-sm text-maintext",children:[a.jsx("span",{className:"text-maintext text-base",children:"Số lượng sản phẩm:"}),a.jsx("span",{className:"text-maintext text-base",children:pt.reduce(((e,t)=>e+t.quantity),0)})]}),a.jsxs("div",{className:"flex justify-between text-sm text-maintext",children:[a.jsx("span",{className:"text-base",children:"Tạm tính:"}),a.jsx("span",{className:"text-base",children:Ys(sa())})]}),gt>0&&a.jsxs("div",{className:"flex justify-between text-sm text-primary",children:[a.jsxs("span",{children:["Giảm giá (",(null==ft?void 0:ft.code)||"KM","):"]}),a.jsxs("span",{children:["-",Ys(gt)]})]}),a.jsxs("div",{className:"flex justify-between font-medium text-base pt-2 border-t border-border",children:[a.jsx("span",{className:"text-maintext font-semibold",children:"Tổng thanh toán:"}),a.jsx("span",{className:"text-primary font-semibold",children:Ys(aa())})]}),"cash"===Et&&!isNaN(parseFloat(os.toString()))&&parseFloat(os.toString())>=aa()&&ia>=0&&a.jsxs("div",{className:"flex justify-between font-medium text-base pt-2",children:[a.jsx("span",{className:"text-maintext font-semibold",children:"Tiền thừa trả khách:"}),a.jsx("span",{className:"text-primary font-semibold",children:Ys(ia)})]})]})]}),a.jsxs(ae,{className:"pb-4",children:[a.jsx(m,{variant:"outline",onClick:()=>$t(!1),children:"Hủy"}),a.jsx(m,{onClick:async()=>{var e,t;if(0===pt.length)return void x.error("Giỏ hàng đang trống");const s=aa(),a=parseFloat(os.toString());if("cash"===Et&&(isNaN(a)||a<s))return void x.error("Số tiền khách đưa không đủ hoặc không hợp lệ.");Kt(!0);const n=new Date,i={orderId:`POS${String(n.getHours()).padStart(2,"0")}${String(n.getMinutes()).padStart(2,"0")}${String(n.getSeconds()).padStart(2,"0")}`,customer:Mt||"Khách tại quầy",items:pt.map((e=>({product:e.productId,quantity:e.quantity,price:e.price,variant:{colorId:e.actualColorId||"",sizeId:e.actualSizeId||""}}))),subTotal:sa(),total:s,shippingAddress:{name:Mt||"Khách vãng lai",phoneNumber:Vt||"N/A",provinceId:"N/A",districtId:"N/A",wardId:"N/A",specificAddress:"Tại quầy"},paymentMethod:"cash"===Et?"CASH":"BANK_TRANSFER",orderStatus:"HOAN_THANH",discount:gt,voucher:(null==ft?void 0:ft.id)||""};try{const e=await Cs.mutateAsync(i);if(e.success&&e.data){e.data.id;const t=e.data.orderNumber||`POS-${Math.floor(1e3+9e3*Math.random())}`;ws(s);const n={id:t,customer:Mt||"Khách vãng lai",amount:s,time:(new Date).toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit"}),status:"completed"};Is([n,...ks.slice(0,2)]),x.success(`Đã tạo đơn hàng ${t} và thanh toán thành công!`),ft&&Ss(ft.id,{onSuccess:()=>{x.info(`Đã cập nhật lượt sử dụng cho mã giảm giá "${ft.code}".`)},onError:e=>{x.error(`Lỗi khi cập nhật mã giảm giá: ${e.message}`)}});const i="cash"===Et&&!isNaN(a)&&a>=s?a-s:0,r={shopInfo:{name:"Clothes Shop",address:"Địa chỉ shop: 20 Hồ Tùng Mậu, Cầu Giấy, Hà Nội",phone:"0123 456 789",email:"info@clothes.com"},customerInfo:{name:Mt||"Khách vãng lai",phone:Vt||"N/A"},orderId:t,employee:"Nhân viên Bán Hàng",createdAt:(new Date).toISOString(),items:pt.map((e=>({name:e.name,quantity:e.quantity,price:e.price,total:e.price*e.quantity,color:e.colorName,size:e.sizeName}))),subTotal:sa(),discount:gt,voucherCode:null==ft?void 0:ft.code,total:s,cashReceived:"cash"===Et?a:s,changeGiven:i,paymentMethod:"cash"===Et?"Tiền mặt":"Chuyển khoản"};us(r),ms(!0),It(),nt&&ht(nt),Ot(""),Ht(""),qt("guest"),Pt("cash"),ds(""),Xt(!1),$t(!1)}else x.error(e.message||"Không thể tạo đơn hàng. Vui lòng thử lại.")}catch(r){x.error((null==(t=null==(e=r.response)?void 0:e.data)?void 0:t.message)||r.message||"Có lỗi xảy ra trong quá trình thanh toán.")}finally{Kt(!1)}},disabled:Bt||"cash"===Et&&(""===os.toString()||parseFloat(os.toString())<aa()||isNaN(parseFloat(os.toString())))||"transfer"===Et&&!Qt,children:Bt?a.jsxs(a.Fragment,{children:[a.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:[a.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),a.jsx("path",{className:"opacity-75",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Đang xử lý..."]}):a.jsxs(a.Fragment,{children:[a.jsx(y.Icon,{path:R,size:.7,className:"mr-2"}),"Hoàn tất thanh toán"]})})]})]})})}),hs&&xs&&a.jsx(o.Suspense,{fallback:a.jsx("div",{children:"Loading..."}),children:a.jsx(Ft,{open:hs,onOpenChange:ms,invoiceData:xs,formatCurrency:Ys,formatDateTimeForInvoice:e=>new Intl.DateTimeFormat("vi-VN",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(new Date(e))})}),ls&&a.jsx(o.Suspense,{fallback:a.jsx("div",{children:"Loading..."}),children:a.jsx(Ze,{open:ls,onOpenChange:cs,onVoucherSelect:e=>{if(nt){const t=xt();t&&mt(nt,t.appliedDiscount,t.appliedVoucher,e)}else Dt(e);Xs()},formatCurrency:Ys})}),a.jsx(J,{open:ps,onOpenChange:gs,children:a.jsxs(ee,{className:"sm:max-w-md",children:[a.jsxs(te,{children:[a.jsx(se,{children:"Xác nhận xóa giỏ hàng"}),a.jsx(ne,{children:fs&&a.jsxs(a.Fragment,{children:['Bạn có chắc chắn muốn xóa "',null==(qe=at.find((e=>e.id===fs)))?void 0:qe.name,'"?',a.jsx("br",{}),a.jsx("span",{className:"text-red-600 font-medium",children:"Hành động này không thể hoàn tác."})]})})]}),a.jsxs(ae,{children:[a.jsx(m,{variant:"outline",onClick:()=>{js(null),gs(!1)},children:"Hủy"}),a.jsxs(m,{variant:"destructive",onClick:()=>{if(fs){const e=at.find((e=>e.id===fs));e&&(rt(fs),x.success(`Đã xóa ${e.name}`)),js(null),gs(!1)}},children:[a.jsx(y.Icon,{path:H,size:.7,className:"mr-2"}),"Xóa giỏ hàng"]})]})]})}),a.jsx(J,{open:Ut,onOpenChange:Wt,children:a.jsxs(ee,{className:"sm:max-w-4xl",children:[a.jsx(te,{children:a.jsx(se,{className:"text-center text-green-600",children:"Thanh toán thành công!"})}),a.jsxs("div",{className:"flex flex-col items-center py-4",children:[a.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mb-4",children:a.jsx("svg",{className:"w-8 h-8 text-green-600",viewBox:"0 0 20 20",children:a.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})}),a.jsx("h3",{className:"text-lg font-semibold text-maintext mb-2",children:"Giao dịch hoàn tất"}),a.jsx("p",{className:"text-sm text-maintext text-center mb-4",children:"Chúng tôi đã nhận được thanh toán của bạn qua chuyển khoản."}),a.jsx("div",{className:"bg-gray-50 rounded-lg p-4 w-full border",children:a.jsxs("div",{className:"text-sm space-y-1",children:[a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{children:"Số tiền:"}),a.jsx("span",{className:"font-medium",children:Ys(aa())})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{children:"Phương thức:"}),a.jsx("span",{className:"font-medium",children:"Chuyển khoản"})]}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{children:"Thời gian:"}),a.jsx("span",{className:"font-medium",children:(new Date).toLocaleTimeString("vi-VN")})]})]})})]}),a.jsx(ae,{children:a.jsx(m,{className:"w-full",onClick:()=>Wt(!1),children:"Đóng"})})]})})]})}const Kt=()=>a.jsx(Bt,{});export{Kt as default};
