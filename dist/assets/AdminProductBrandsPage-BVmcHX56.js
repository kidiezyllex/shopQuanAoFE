import{a as i,aJ as q,j as e,k as G,ao as se,q as P,B as x,aa as te,a2 as l,bg as ae,bh as ne,a6 as O}from"./index-Dpx_4rWJ.js";import{C as ie,c as le}from"./card-fT6uSY2F.js";import{u as re,b as ce,c as he,d as xe,e as de}from"./attributes-Bjak6hx3.js";import{B as me,a as oe,b as I,c as R,d as J,e as ue}from"./breadcrumb-CJedQ5QG.js";import{T as U,a as $,b as k,c as j,d as W,e as m}from"./table-BeX0puEz.js";import{S as Q,a as L,b as V,c as z,d as S}from"./select-CS4vNzI5.js";import{L as F}from"./label-B0XdI4bT.js";import{D as K,h as b,a as A,b as E,c as _,e as X,i as pe}from"./dialog-BuHyDe_9.js";import"./createLucideIcon-BdgKQErZ.js";import"./index-BdQq_4o_.js";import"./index-qvEK80KO.js";import"./check-CyKb8IHM.js";function je(){const[o,B]=i.useState(""),[u,p]=i.useState({}),{data:t,isLoading:C,isError:g}=re(u),f=ce(),y=q(),[T,r]=i.useState(!1),[N,c]=i.useState(null),[a,D]=i.useState(!1),[v,h]=i.useState(null),[n,H]=i.useState(!1),w=i.useMemo(()=>{if(!(t!=null&&t.data)||!o.trim())return t==null?void 0:t.data;const s=o.toLowerCase().trim();return t.data.filter(d=>d.name.toLowerCase().includes(s))},[t==null?void 0:t.data,o]),Y=(s,d)=>{if(d==="all"||d===""){const M={...u};delete M[s],p(M)}else p({...u,[s]:d})},Z=async s=>{try{await f.mutateAsync(s,{onSuccess:()=>{O.success("Đã xóa thương hiệu thành công"),y.invalidateQueries({queryKey:["brands"]})}})}catch{O.error("Xóa thương hiệu thất bại")}},ee=s=>new Intl.DateTimeFormat("vi-VN",{day:"2-digit",month:"2-digit",year:"numeric"}).format(new Date(s));return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-between items-start",children:e.jsx(me,{children:e.jsxs(oe,{children:[e.jsx(I,{children:e.jsx(R,{href:"/admin/statistics",children:"Dashboard"})}),e.jsx(J,{}),e.jsx(I,{children:e.jsx(R,{href:"/admin/products",children:"Quản lý sản phẩm"})}),e.jsx(J,{}),e.jsx(I,{children:e.jsx(ue,{children:"Thương hiệu"})})]})})}),e.jsx(ie,{className:"mb-4",children:e.jsx(le,{className:"py-4",children:e.jsxs("div",{className:"flex flex-col space-y-4 md:space-y-0 md:flex-row md:justify-between md:items-center gap-2",children:[e.jsxs("div",{className:"relative flex-1 max-w-4xl",children:[e.jsx(G.Icon,{path:se,size:.7,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-maintext"}),e.jsx(P,{type:"text",placeholder:"Tìm kiếm theo tên thương hiệu...",className:"pl-10 pr-4 py-2 w-full border rounded-[6px]",value:o,onChange:s=>B(s.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(Q,{value:u.status||"all",onValueChange:s=>Y("status",s),children:[e.jsx(L,{children:e.jsx(V,{placeholder:"Tất cả trạng thái"})}),e.jsxs(z,{children:[e.jsx(S,{value:"all",children:"Tất cả trạng thái"}),e.jsx(S,{value:"HOAT_DONG",children:"Hoạt động"}),e.jsx(S,{value:"KHONG_HOAT_DONG",children:"Không hoạt động"})]})]}),e.jsxs(K,{open:n,onOpenChange:H,children:[e.jsx(b,{asChild:!0,children:e.jsxs(x,{onClick:()=>H(!0),children:[e.jsx(G.Icon,{path:te,size:.7}),"Thêm thương hiệu mới"]})}),e.jsx(ye,{isOpen:n,onClose:()=>H(!1)})]})]})]})})}),C?e.jsx("div",{className:"bg-white rounded-[6px] shadow-sm overflow-visible",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(U,{children:[e.jsx($,{children:e.jsxs(k,{children:[e.jsx(j,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"ID"}),e.jsx(j,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"Tên thương hiệu"}),e.jsx(j,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"Trạng thái"}),e.jsx(j,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"Ngày cập nhật"}),e.jsx(j,{className:"px-4 py-4 text-right text-sm font-medium text-maintext",children:"Thao tác"})]})}),e.jsx(W,{children:[...Array(5)].map((s,d)=>e.jsxs(k,{children:[e.jsx(m,{className:"px-4 py-4 whitespace-nowrap",children:e.jsx(l,{className:"h-4 w-[80px]"})}),e.jsx(m,{className:"px-4 py-4 whitespace-nowrap",children:e.jsx(l,{className:"h-4 w-[160px]"})}),e.jsx(m,{className:"px-4 py-4 whitespace-nowrap",children:e.jsx(l,{className:"h-6 w-[100px] rounded-full"})}),e.jsx(m,{className:"px-4 py-4 whitespace-nowrap",children:e.jsx(l,{className:"h-4 w-[100px]"})}),e.jsx(m,{className:"px-4 py-4 whitespace-nowrap text-right",children:e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsx(l,{className:"h-8 w-8 rounded-[6px]"}),e.jsx(l,{className:"h-8 w-8 rounded-[6px]"})]})})]},d))})]})})}):g?e.jsxs("div",{className:"bg-white rounded-[6px] shadow-sm p-4 text-center",children:[e.jsx("p",{className:"text-red-500",children:"Đã xảy ra lỗi khi tải dữ liệu. Vui lòng thử lại sau."}),e.jsx(x,{variant:"outline",className:"mt-4",onClick:()=>y.invalidateQueries({queryKey:["brands"]}),children:"Thử lại"})]}):e.jsx("div",{className:"bg-white rounded-[6px] shadow-sm overflow-visible",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(U,{children:[e.jsx($,{children:e.jsxs(k,{children:[e.jsx(j,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"ID"}),e.jsx(j,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"Tên thương hiệu"}),e.jsx(j,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"Trạng thái"}),e.jsx(j,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"Ngày cập nhật"}),e.jsx(j,{className:"px-4 py-4 text-right text-sm font-medium text-maintext",children:"Thao tác"})]})}),e.jsx(W,{children:w!=null&&w.length?w.map(s=>e.jsxs(k,{className:"hover:bg-gray-50",children:[e.jsx(m,{className:"px-4 py-4 whitespace-nowrap text-sm text-maintext",children:s==null?void 0:s.id}),e.jsx(m,{className:"px-4 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-maintext",children:s.name})}),e.jsx(m,{className:"px-4 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${s.status==="HOAT_DONG"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:s.status==="HOAT_DONG"?"Hoạt động":"Không hoạt động"})}),e.jsx(m,{className:"px-4 py-4 whitespace-nowrap text-sm text-maintext",children:ee(s.updatedAt)}),e.jsx(m,{className:"px-4 py-4 whitespace-nowrap text-right",children:e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsxs(K,{open:a&&v===(s==null?void 0:s.id),onOpenChange:d=>{D(d),d||h(null)},children:[e.jsx(b,{asChild:!0,children:e.jsx(x,{variant:"outline",size:"icon",title:"Sửa",onClick:()=>{h(s==null?void 0:s.id),D(!0)},children:e.jsx(G.Icon,{path:ae,size:.7})})}),v===(s==null?void 0:s.id)&&e.jsx(ge,{brandId:s==null?void 0:s.id,isOpen:a,onClose:()=>{D(!1),h(null)}})]}),e.jsxs(K,{open:T&&N===(s==null?void 0:s.id),onOpenChange:r,children:[e.jsx(b,{asChild:!0,children:e.jsx(x,{variant:"outline",size:"icon",onClick:()=>{c(s==null?void 0:s.id),r(!0)},title:"Xóa",children:e.jsx(G.Icon,{path:ne,size:.7})})}),e.jsxs(A,{children:[e.jsx(E,{children:e.jsx(_,{children:"Xác nhận xóa thương hiệu"})}),e.jsx("p",{children:"Bạn có chắc chắn muốn xóa thương hiệu này không?"}),e.jsxs(X,{children:[e.jsx(pe,{asChild:!0,children:e.jsx(x,{variant:"outline",onClick:()=>r(!1),children:"Hủy"})}),e.jsx(x,{variant:"destructive",onClick:()=>{N&&(Z(N),r(!1))},children:"Xóa"})]})]})]})]})})]},s==null?void 0:s.id)):e.jsx(k,{children:e.jsx(m,{colSpan:5,className:"px-4 py-8 text-center text-maintext",children:"Không tìm thấy thương hiệu nào"})})})]})})})]})}function ge({brandId:o,isOpen:B,onClose:u}){const p=q(),{data:t,isLoading:C,isError:g}=xe(o),f=de(),[y,T]=i.useState({name:"",status:"HOAT_DONG"}),[r,N]=i.useState({name:""});i.useEffect(()=>{t!=null&&t.data&&T({name:t.data.name,status:t.data.status})},[t]);const c=h=>{const{name:n,value:H}=h.target;T(w=>({...w,[n]:H})),r[n]&&N(w=>({...w,[n]:""}))},a=h=>{T(n=>({...n,status:h}))},D=()=>{let h=!0;const n={...r};return y.name.trim()||(n.name="Tên thương hiệu không được để trống",h=!1),N(n),h},v=async h=>{if(h.preventDefault(),!!D())try{await f.mutateAsync({brandId:o,payload:y},{onSuccess:()=>{O.success("Cập nhật thương hiệu thành công"),p.invalidateQueries({queryKey:["brand",o]}),p.invalidateQueries({queryKey:["brands"]}),u()},onError:n=>{O.error("Cập nhật thương hiệu thất bại: "+n.message)}})}catch{O.error("Đã xảy ra lỗi khi cập nhật thương hiệu")}};return C?e.jsxs(A,{className:"sm:max-w-4xl",children:[e.jsx(E,{children:e.jsx(_,{children:e.jsx(l,{className:"h-8 w-[200px]"})})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{className:"h-4 w-[100px]"}),e.jsx(l,{className:"h-10 w-full"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{className:"h-4 w-[100px]"}),e.jsx(l,{className:"h-10 w-full"})]}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx(l,{className:"h-10 w-[100px]"}),e.jsx(l,{className:"h-10 w-[150px]"})]})]})]}):g||!t?e.jsxs(A,{className:"sm:max-w-4xl",children:[e.jsx(E,{children:e.jsx(_,{children:"Lỗi"})}),e.jsxs("div",{className:"py-4 text-center",children:[e.jsx("p",{className:"text-red-500 mb-4",children:"Đã xảy ra lỗi khi tải dữ liệu thương hiệu."}),e.jsxs("div",{className:"flex justify-center space-x-4",children:[e.jsx(x,{variant:"outline",onClick:u,children:"Đóng"}),e.jsx(x,{onClick:()=>p.invalidateQueries({queryKey:["brand",o]}),children:"Thử lại"})]})]})]}):e.jsxs(A,{className:"sm:max-w-4xl",children:[e.jsx(E,{children:e.jsxs(_,{children:["Chỉnh sửa thương hiệu: ",t.data.name]})}),e.jsxs("form",{onSubmit:v,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"name",children:"Tên thương hiệu"}),e.jsx(P,{id:"name",name:"name",placeholder:"Nhập tên thương hiệu",value:y.name,onChange:c,className:r.name?"border-red-500":""}),r.name&&e.jsx("p",{className:"text-red-500 text-sm",children:r.name})]}),e.jsx("div",{className:"space-y-2",children:e.jsxs(Q,{value:y.status,onValueChange:a,children:[e.jsx(L,{id:"status",children:e.jsx(V,{placeholder:"Chọn trạng thái"})}),e.jsxs(z,{children:[e.jsx(S,{value:"HOAT_DONG",children:"Hoạt động"}),e.jsx(S,{value:"KHONG_HOAT_DONG",children:"Không hoạt động"})]})]})}),e.jsxs(X,{children:[e.jsx(x,{type:"button",variant:"outline",onClick:u,children:"Hủy"}),e.jsx(x,{type:"submit",disabled:f.isPending,children:f.isPending?"Đang xử lý...":"Cập nhật thương hiệu"})]})]})]})}function ye({isOpen:o,onClose:B}){const u=q(),p=he(),[t,C]=i.useState({name:"",status:"HOAT_DONG"}),[g,f]=i.useState({name:""}),y=c=>{const{name:a,value:D}=c.target;C(v=>({...v,[a]:D})),g[a]&&f(v=>({...v,[a]:""}))},T=c=>{C(a=>({...a,status:c}))},r=()=>{let c=!0;const a={...g};return t.name.trim()||(a.name="Tên thương hiệu không được để trống",c=!1),f(a),c},N=async c=>{if(c.preventDefault(),!!r())try{await p.mutateAsync(t,{onSuccess:()=>{O.success("Thêm thương hiệu thành công"),u.invalidateQueries({queryKey:["brands"]}),C({name:"",status:"HOAT_DONG"}),B()},onError:a=>{a.message==="Duplicate entry. This record already exists."||O.error("Thêm thương hiệu thất bại: Thương hiệu đã tồn tại")}})}catch(a){console.error(a)}};return e.jsxs(A,{className:"sm:max-w-4xl",children:[e.jsx(E,{children:e.jsx(_,{children:"Thêm thương hiệu mới"})}),e.jsxs("form",{onSubmit:N,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"create-name",children:"Tên thương hiệu"}),e.jsx(P,{id:"create-name",name:"name",placeholder:"Nhập tên thương hiệu",value:t.name,onChange:y,className:g.name?"border-red-500":""}),g.name&&e.jsx("p",{className:"text-red-500 text-sm",children:g.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"create-status",children:"Trạng thái"}),e.jsxs(Q,{value:t.status,onValueChange:T,children:[e.jsx(L,{id:"create-status",children:e.jsx(V,{placeholder:"Chọn trạng thái"})}),e.jsxs(z,{children:[e.jsx(S,{value:"HOAT_DONG",children:"Hoạt động"}),e.jsx(S,{value:"KHONG_HOAT_DONG",children:"Không hoạt động"})]})]})]}),e.jsxs(X,{children:[e.jsx(x,{type:"button",variant:"outline",onClick:B,children:"Hủy"}),e.jsx(x,{type:"submit",disabled:p.isPending,children:p.isPending?"Đang xử lý...":"Thêm thương hiệu"})]})]})]})}const Ae=()=>e.jsx(je,{});export{Ae as default};
