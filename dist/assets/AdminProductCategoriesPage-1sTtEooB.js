import{a as r,aJ as Q,j as e,k as G,ao as te,q as L,B as h,aa as ne,a2 as c,bg as ie,bh as le,a6 as v}from"./index-Dpx_4rWJ.js";import{C as re,c as ce}from"./card-fT6uSY2F.js";import{a as de,f as he,g as xe,h as me,i as oe}from"./attributes-Bjak6hx3.js";import{B as ue,a as pe,b as q,c as U,d as $,e as je}from"./breadcrumb-CJedQ5QG.js";import{T as W,a as Y,b as k,c as f,d as Z,e as m}from"./table-BeX0puEz.js";import{S as V,a as z,b as X,c as M,d as w}from"./select-CS4vNzI5.js";import{L as I}from"./label-B0XdI4bT.js";import{D as B,h as P,a as A,b as E,c as F,e as R,i as fe}from"./dialog-BuHyDe_9.js";import"./createLucideIcon-BdgKQErZ.js";import"./index-BdQq_4o_.js";import"./index-qvEK80KO.js";import"./check-CyKb8IHM.js";function Ne(){const[o,O]=r.useState(""),[u,p]=r.useState({}),[i,b]=r.useState(!1),{data:a,isLoading:N,isError:g}=de(u),y=he(),j=Q(),[D,n]=r.useState(!1),[t,S]=r.useState(null),[C,d]=r.useState(!1),[l,H]=r.useState(null),[T,K]=r.useState(!1),_=r.useMemo(()=>{if(!(a!=null&&a.data)||!o.trim())return a==null?void 0:a.data;const s=o.toLowerCase().trim();return a.data.filter(x=>x.name.toLowerCase().includes(s))},[a==null?void 0:a.data,o]),ee=(s,x)=>{if(x==="all"||x===""){const J={...u};delete J[s],p(J)}else p({...u,[s]:x})},se=async s=>{try{await y.mutateAsync(s,{onSuccess:()=>{v.success("Đã xóa danh mục thành công"),j.invalidateQueries({queryKey:["categories"]})}})}catch{v.error("Xóa danh mục thất bại")}},ae=s=>new Intl.DateTimeFormat("vi-VN",{day:"2-digit",month:"2-digit",year:"numeric"}).format(new Date(s));return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-between items-start",children:e.jsx(ue,{children:e.jsxs(pe,{children:[e.jsx(q,{children:e.jsx(U,{href:"/admin/statistics",children:"Dashboard"})}),e.jsx($,{}),e.jsx(q,{children:e.jsx(U,{href:"/admin/products",children:"Quản lý sản phẩm"})}),e.jsx($,{}),e.jsx(q,{children:e.jsx(je,{children:"Danh mục"})})]})})}),e.jsx(re,{className:"mb-4",children:e.jsx(ce,{className:"py-4",children:e.jsxs("div",{className:"flex flex-col space-y-4 md:space-y-0 md:flex-row md:justify-between md:items-center gap-2",children:[e.jsxs("div",{className:"relative flex-1 max-w-4xl",children:[e.jsx(G.Icon,{path:te,size:.7,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-maintext"}),e.jsx(L,{type:"text",placeholder:"Tìm kiếm theo tên danh mục...",className:"pl-10 pr-4 py-2 w-full border rounded-[6px]",value:o,onChange:s=>O(s.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(V,{value:u.status||"all",onValueChange:s=>ee("status",s),children:[e.jsx(z,{children:e.jsx(X,{placeholder:"Tất cả trạng thái"})}),e.jsxs(M,{children:[e.jsx(w,{value:"all",children:"Tất cả trạng thái"}),e.jsx(w,{value:"HOAT_DONG",children:"Hoạt động"}),e.jsx(w,{value:"KHONG_HOAT_DONG",children:"Không hoạt động"})]})]}),e.jsxs(B,{open:T,onOpenChange:K,children:[e.jsx(P,{asChild:!0,children:e.jsxs(h,{onClick:()=>K(!0),children:[e.jsx(G.Icon,{path:ne,size:.7}),"Thêm danh mục mới"]})}),e.jsx(Ce,{isOpen:T,onClose:()=>K(!1)})]})]})]})})}),N?e.jsx("div",{className:"bg-white rounded-[6px] shadow-sm overflow-visible",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(W,{children:[e.jsx(Y,{children:e.jsxs(k,{children:[e.jsx(f,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"ID"}),e.jsx(f,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"Tên danh mục"}),e.jsx(f,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"Trạng thái"}),e.jsx(f,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"Ngày cập nhật"}),e.jsx(f,{className:"px-4 py-4 text-right text-sm font-medium text-maintext",children:"Thao tác"})]})}),e.jsx(Z,{children:[...Array(5)].map((s,x)=>e.jsxs(k,{children:[e.jsx(m,{className:"px-4 py-4 whitespace-nowrap",children:e.jsx(c,{className:"h-4 w-[80px]"})}),e.jsx(m,{className:"px-4 py-4 whitespace-nowrap",children:e.jsx(c,{className:"h-4 w-[160px]"})}),e.jsx(m,{className:"px-4 py-4 whitespace-nowrap",children:e.jsx(c,{className:"h-6 w-[100px] rounded-full"})}),e.jsx(m,{className:"px-4 py-4 whitespace-nowrap",children:e.jsx(c,{className:"h-4 w-[100px]"})}),e.jsx(m,{className:"px-4 py-4 whitespace-nowrap text-right",children:e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsx(c,{className:"h-8 w-8 rounded-[6px]"}),e.jsx(c,{className:"h-8 w-8 rounded-[6px]"})]})})]},x))})]})})}):g?e.jsxs("div",{className:"bg-white rounded-[6px] shadow-sm p-4 text-center",children:[e.jsx("p",{className:"text-red-500",children:"Đã xảy ra lỗi khi tải dữ liệu. Vui lòng thử lại sau."}),e.jsx(h,{variant:"outline",className:"mt-4",onClick:()=>j.invalidateQueries({queryKey:["categories"]}),children:"Thử lại"})]}):e.jsx("div",{className:"bg-white rounded-[6px] shadow-sm overflow-visible",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(W,{children:[e.jsx(Y,{children:e.jsxs(k,{children:[e.jsx(f,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"ID"}),e.jsx(f,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"Tên danh mục"}),e.jsx(f,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"Trạng thái"}),e.jsx(f,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"Ngày cập nhật"}),e.jsx(f,{className:"px-4 py-4 text-right text-sm font-medium text-maintext",children:"Thao tác"})]})}),e.jsx(Z,{children:_!=null&&_.length?_.map(s=>e.jsxs(k,{className:"hover:bg-gray-50",children:[e.jsx(m,{className:"px-4 py-4 whitespace-nowrap text-sm text-maintext",children:s==null?void 0:s.id}),e.jsx(m,{className:"px-4 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-maintext",children:s.name})}),e.jsx(m,{className:"px-4 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${s.status==="HOAT_DONG"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:s.status==="HOAT_DONG"?"Hoạt động":"Không hoạt động"})}),e.jsx(m,{className:"px-4 py-4 whitespace-nowrap text-sm text-maintext",children:ae(s.updatedAt)}),e.jsx(m,{className:"px-4 py-4 whitespace-nowrap text-right",children:e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsxs(B,{open:C&&l===(s==null?void 0:s.id),onOpenChange:x=>{d(x),x||H(null)},children:[e.jsx(P,{asChild:!0,children:e.jsx(h,{variant:"outline",size:"icon",title:"Sửa",onClick:()=>{H(s==null?void 0:s.id),d(!0)},children:e.jsx(G.Icon,{path:ie,size:.7})})}),l===(s==null?void 0:s.id)&&e.jsx(ge,{categoryId:s==null?void 0:s.id,isOpen:C,onClose:()=>{d(!1),H(null)}})]}),e.jsxs(B,{open:D&&t===(s==null?void 0:s.id),onOpenChange:n,children:[e.jsx(P,{asChild:!0,children:e.jsx(h,{variant:"outline",size:"icon",onClick:()=>{S(s==null?void 0:s.id),n(!0)},title:"Xóa",children:e.jsx(G.Icon,{path:le,size:.7})})}),e.jsxs(A,{children:[e.jsx(E,{children:e.jsx(F,{children:"Xác nhận xóa danh mục"})}),e.jsx("p",{children:"Bạn có chắc chắn muốn xóa danh mục này không?"}),e.jsxs(R,{children:[e.jsx(fe,{asChild:!0,children:e.jsx(h,{variant:"outline",onClick:()=>n(!1),children:"Hủy"})}),e.jsx(h,{variant:"destructive",onClick:()=>{t&&(se(t),n(!1))},children:"Xóa"})]})]})]})]})})]},s==null?void 0:s.id)):e.jsx(k,{children:e.jsx(m,{colSpan:5,className:"px-4 py-8 text-center text-maintext",children:"Không tìm thấy danh mục nào"})})})]})})})]})}function ge({categoryId:o,isOpen:O,onClose:u}){const p=Q(),{data:i,isLoading:b,isError:a}=me(o),N=oe(),[g,y]=r.useState({name:"",status:"HOAT_DONG"}),[j,D]=r.useState({name:""});r.useEffect(()=>{i!=null&&i.data&&y({name:i.data.name,status:i.data.status})},[i]);const n=d=>{const{name:l,value:H}=d.target;y(T=>({...T,[l]:H})),j[l]&&D(T=>({...T,[l]:""}))},t=d=>{y(l=>({...l,status:d}))},S=()=>{let d=!0;const l={...j};return g.name.trim()||(l.name="Tên danh mục không được để trống",d=!1),D(l),d},C=async d=>{if(d.preventDefault(),!!S())try{await N.mutateAsync({categoryId:o,payload:g},{onSuccess:()=>{v.success("Cập nhật danh mục thành công"),p.invalidateQueries({queryKey:["category",o]}),p.invalidateQueries({queryKey:["categories"]}),u()},onError:l=>{v.error("Cập nhật danh mục thất bại: "+l.message)}})}catch{v.error("Đã xảy ra lỗi khi cập nhật danh mục")}};return b?e.jsxs(A,{className:"sm:max-w-4xl",children:[e.jsx(E,{children:e.jsx(F,{children:e.jsx(c,{className:"h-8 w-[200px]"})})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{className:"h-4 w-[100px]"}),e.jsx(c,{className:"h-10 w-full"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{className:"h-4 w-[100px]"}),e.jsx(c,{className:"h-10 w-full"})]}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx(c,{className:"h-10 w-[100px]"}),e.jsx(c,{className:"h-10 w-[150px]"})]})]})]}):a||!i?e.jsxs(A,{className:"sm:max-w-4xl",children:[e.jsx(E,{children:e.jsx(F,{children:"Lỗi"})}),e.jsxs("div",{className:"py-4 text-center",children:[e.jsx("p",{className:"text-red-500 mb-4",children:"Đã xảy ra lỗi khi tải dữ liệu danh mục."}),e.jsxs("div",{className:"flex justify-center space-x-4",children:[e.jsx(h,{variant:"outline",onClick:u,children:"Đóng"}),e.jsx(h,{onClick:()=>p.invalidateQueries({queryKey:["category",o]}),children:"Thử lại"})]})]})]}):e.jsxs(A,{className:"sm:max-w-4xl",children:[e.jsx(E,{children:e.jsxs(F,{children:["Chỉnh sửa danh mục: ",i.data.name]})}),e.jsxs("form",{onSubmit:C,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{htmlFor:"name",children:"Tên danh mục"}),e.jsx(L,{id:"name",name:"name",placeholder:"Nhập tên danh mục",value:g.name,onChange:n,className:j.name?"border-red-500":""}),j.name&&e.jsx("p",{className:"text-red-500 text-sm",children:j.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{htmlFor:"status",children:"Trạng thái"}),e.jsxs(V,{value:g.status,onValueChange:t,children:[e.jsx(z,{id:"status",children:e.jsx(X,{placeholder:"Chọn trạng thái"})}),e.jsxs(M,{children:[e.jsx(w,{value:"HOAT_DONG",children:"Hoạt động"}),e.jsx(w,{value:"KHONG_HOAT_DONG",children:"Không hoạt động"})]})]})]}),e.jsxs(R,{children:[e.jsx(h,{type:"button",variant:"outline",onClick:u,children:"Hủy"}),e.jsx(h,{type:"submit",disabled:N.isPending,children:N.isPending?"Đang xử lý...":"Cập nhật danh mục"})]})]})]})}function Ce({isOpen:o,onClose:O}){const u=Q(),p=xe(),[i,b]=r.useState({name:"",status:"HOAT_DONG"}),[a,N]=r.useState({name:""}),g=n=>{const{name:t,value:S}=n.target;b(C=>({...C,[t]:S})),a[t]&&N(C=>({...C,[t]:""}))},y=n=>{b(t=>({...t,status:n}))},j=()=>{let n=!0;const t={...a};return i.name.trim()||(t.name="Tên danh mục không được để trống",n=!1),N(t),n},D=async n=>{if(n.preventDefault(),!!j())try{await p.mutateAsync(i,{onSuccess:()=>{v.success("Thêm danh mục thành công"),u.invalidateQueries({queryKey:["categories"]}),b({name:"",status:"HOAT_DONG"}),O()},onError:t=>{t.message==="Duplicate entry. This record already exists."||v.error("Thêm danh mục thất bại: Danh mục đã tồn tại")}})}catch(t){console.error(t)}};return e.jsxs(A,{className:"sm:max-w-4xl",children:[e.jsx(E,{children:e.jsx(F,{children:"Thêm danh mục mới"})}),e.jsxs("form",{onSubmit:D,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{htmlFor:"create-name",children:"Tên danh mục"}),e.jsx(L,{id:"create-name",name:"name",placeholder:"Nhập tên danh mục",value:i.name,onChange:g,className:a.name?"border-red-500":""}),a.name&&e.jsx("p",{className:"text-red-500 text-sm",children:a.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{htmlFor:"create-status",children:"Trạng thái"}),e.jsxs(V,{value:i.status,onValueChange:y,children:[e.jsx(z,{id:"create-status",children:e.jsx(X,{placeholder:"Chọn trạng thái"})}),e.jsxs(M,{children:[e.jsx(w,{value:"HOAT_DONG",children:"Hoạt động"}),e.jsx(w,{value:"KHONG_HOAT_DONG",children:"Không hoạt động"})]})]})]}),e.jsxs(R,{children:[e.jsx(h,{type:"button",variant:"outline",onClick:O,children:"Hủy"}),e.jsx(h,{type:"submit",disabled:p.isPending,children:p.isPending?"Đang xử lý...":"Thêm danh mục"})]})]})]})}const Fe=()=>e.jsx(Ne,{});export{Fe as default};
