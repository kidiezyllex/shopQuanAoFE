import{j as e}from"./ui-vendor-CFM_MCUz.js";import{r as s}from"./react-vendor-B55MjJUH.js";import{C as a,c as t}from"./card-ClEzRAeX.js";import{S as n}from"./skeleton-4G_X8bY4.js";import{t as i,ad as l,a5 as c,aL as r,aM as d}from"./icons-vendor-BrsZP2ku.js";import{I as x,B as h,y as m}from"./index-BHeY-5EX.js";import{a as o,f as j,g as p,h as u,i as g}from"./attributes-DYSh1UfM.js";import{d as N}from"./query-vendor-CBwfxcof.js";import{B as y,a as f,b as v,c as w,d as D,e as T}from"./breadcrumb-CP4jYkI2.js";import{T as C,a as b,b as O,c as H,d as _,e as S}from"./table-DL-K3PV4.js";import{S as k,a as A,b as G,c as K,d as I}from"./select-C6W71KWg.js";import{L as F}from"./label-Bm9nFuXD.js";import"./heavy-vendor-BfN2pHnQ.js";function q(){const[p,u]=s.useState(""),[g,F]=s.useState({}),[q,z]=s.useState(!1),{data:E,isLoading:V,isError:P}=o(g),X=j(),B=N(),[M,J]=s.useState(!1),[R,U]=s.useState(null),[W,Y]=s.useState(!1),[Z,$]=s.useState(null),[ee,se]=s.useState(!1),ae=s.useMemo((()=>{if(!(null==E?void 0:E.data)||!p.trim())return null==E?void 0:E.data;const e=p.toLowerCase().trim();return E.data.filter((s=>s.name.toLowerCase().includes(e)))}),[null==E?void 0:E.data,p]);return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-between items-start",children:e.jsx(y,{children:e.jsxs(f,{children:[e.jsx(v,{children:e.jsx(w,{href:"/admin/statistics",children:"Dashboard"})}),e.jsx(D,{}),e.jsx(v,{children:e.jsx(w,{href:"/admin/products",children:"Quản lý sản phẩm"})}),e.jsx(D,{}),e.jsx(v,{children:e.jsx(T,{children:"Danh mục"})})]})})}),e.jsx(a,{className:"mb-4",children:e.jsx(t,{className:"py-4",children:e.jsxs("div",{className:"flex flex-col space-y-4 md:space-y-0 md:flex-row md:justify-between md:items-center gap-2",children:[e.jsxs("div",{className:"relative flex-1 max-w-4xl",children:[e.jsx(i.Icon,{path:l,size:.7,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-maintext"}),e.jsx(x,{type:"text",placeholder:"Tìm kiếm theo tên danh mục...",className:"pl-10 pr-4 py-2 w-full border rounded-[6px]",value:p,onChange:e=>u(e.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(k,{value:g.status||"all",onValueChange:e=>((e,s)=>{if("all"===s||""===s){const s={...g};delete s[e],F(s)}else F({...g,[e]:s})})("status",e),children:[e.jsx(A,{children:e.jsx(G,{placeholder:"Tất cả trạng thái"})}),e.jsxs(K,{children:[e.jsx(I,{value:"all",children:"Tất cả trạng thái"}),e.jsx(I,{value:"HOAT_DONG",children:"Hoạt động"}),e.jsx(I,{value:"KHONG_HOAT_DONG",children:"Không hoạt động"})]})]}),e.jsxs(Dialog,{open:ee,onOpenChange:se,children:[e.jsx(DialogTrigger,{asChild:!0,children:e.jsxs(h,{onClick:()=>se(!0),children:[e.jsx(i.Icon,{path:c,size:.7}),"Thêm danh mục mới"]})}),e.jsx(Q,{isOpen:ee,onClose:()=>se(!1)})]})]})]})})}),V?e.jsx("div",{className:"bg-white rounded-[6px] shadow-sm overflow-visible",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(C,{children:[e.jsx(b,{children:e.jsxs(O,{children:[e.jsx(H,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"ID"}),e.jsx(H,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"Tên danh mục"}),e.jsx(H,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"Trạng thái"}),e.jsx(H,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"Ngày cập nhật"}),e.jsx(H,{className:"px-4 py-4 text-right text-sm font-medium text-maintext",children:"Thao tác"})]})}),e.jsx(_,{children:[...Array(5)].map(((s,a)=>e.jsxs(O,{children:[e.jsx(S,{className:"px-4 py-4 whitespace-nowrap",children:e.jsx(n,{className:"h-4 w-[80px]"})}),e.jsx(S,{className:"px-4 py-4 whitespace-nowrap",children:e.jsx(n,{className:"h-4 w-[160px]"})}),e.jsx(S,{className:"px-4 py-4 whitespace-nowrap",children:e.jsx(n,{className:"h-6 w-[100px] rounded-full"})}),e.jsx(S,{className:"px-4 py-4 whitespace-nowrap",children:e.jsx(n,{className:"h-4 w-[100px]"})}),e.jsx(S,{className:"px-4 py-4 whitespace-nowrap text-right",children:e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsx(n,{className:"h-8 w-8 rounded-[6px]"}),e.jsx(n,{className:"h-8 w-8 rounded-[6px]"})]})})]},a)))})]})})}):P?e.jsxs("div",{className:"bg-white rounded-[6px] shadow-sm p-4 text-center",children:[e.jsx("p",{className:"text-red-500",children:"Đã xảy ra lỗi khi tải dữ liệu. Vui lòng thử lại sau."}),e.jsx(h,{variant:"outline",className:"mt-4",onClick:()=>B.invalidateQueries({queryKey:["categories"]}),children:"Thử lại"})]}):e.jsx("div",{className:"bg-white rounded-[6px] shadow-sm overflow-visible",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(C,{children:[e.jsx(b,{children:e.jsxs(O,{children:[e.jsx(H,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"ID"}),e.jsx(H,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"Tên danh mục"}),e.jsx(H,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"Trạng thái"}),e.jsx(H,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"Ngày cập nhật"}),e.jsx(H,{className:"px-4 py-4 text-right text-sm font-medium text-maintext",children:"Thao tác"})]})}),e.jsx(_,{children:(null==ae?void 0:ae.length)?ae.map((s=>{return e.jsxs(O,{className:"hover:bg-gray-50",children:[e.jsx(S,{className:"px-4 py-4 whitespace-nowrap text-sm text-maintext",children:s.id}),e.jsx(S,{className:"px-4 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-maintext",children:s.name})}),e.jsx(S,{className:"px-4 py-4 whitespace-nowrap",children:e.jsx("span",{className:"px-2 py-1 text-xs rounded-full "+("HOAT_DONG"===s.status?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:"HOAT_DONG"===s.status?"Hoạt động":"Không hoạt động"})}),e.jsx(S,{className:"px-4 py-4 whitespace-nowrap text-sm text-maintext",children:(a=s.updatedAt,new Intl.DateTimeFormat("vi-VN",{day:"2-digit",month:"2-digit",year:"numeric"}).format(new Date(a)))}),e.jsx(S,{className:"px-4 py-4 whitespace-nowrap text-right",children:e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsxs(Dialog,{open:W&&Z===s.id,onOpenChange:e=>{Y(e),e||$(null)},children:[e.jsx(DialogTrigger,{asChild:!0,children:e.jsx(h,{variant:"outline",size:"icon",title:"Sửa",onClick:()=>{$(s.id),Y(!0)},children:e.jsx(i.Icon,{path:r,size:.7})})}),Z===s.id&&e.jsx(L,{categoryId:s.id,isOpen:W,onClose:()=>{Y(!1),$(null)}})]}),e.jsxs(Dialog,{open:M&&R===s.id,onOpenChange:J,children:[e.jsx(DialogTrigger,{asChild:!0,children:e.jsx(h,{variant:"outline",size:"icon",onClick:()=>{U(s.id),J(!0)},title:"Xóa",children:e.jsx(i.Icon,{path:d,size:.7})})}),e.jsxs(DialogContent,{children:[e.jsx(DialogHeader,{children:e.jsx(DialogTitle,{children:"Xác nhận xóa danh mục"})}),e.jsx("p",{children:"Bạn có chắc chắn muốn xóa danh mục này không?"}),e.jsxs(DialogFooter,{children:[e.jsx(DialogClose,{asChild:!0,children:e.jsx(h,{variant:"outline",onClick:()=>J(!1),children:"Hủy"})}),e.jsx(h,{variant:"destructive",onClick:()=>{R&&((async e=>{try{await X.mutateAsync(e,{onSuccess:()=>{m.success("Đã xóa danh mục thành công"),B.invalidateQueries({queryKey:["categories"]})}})}catch(s){m.error("Xóa danh mục thất bại")}})(R),J(!1))},children:"Xóa"})]})]})]})]})})]},s.id);var a})):e.jsx(O,{children:e.jsx(S,{colSpan:5,className:"px-4 py-8 text-center text-maintext",children:"Không tìm thấy danh mục nào"})})})]})})})]})}function L({categoryId:a,isOpen:t,onClose:i}){const l=N(),{data:c,isLoading:r,isError:d}=u(a),o=g(),[j,p]=s.useState({name:"",status:"HOAT_DONG"}),[y,f]=s.useState({name:""});s.useEffect((()=>{(null==c?void 0:c.data)&&p({name:c.data.name,status:c.data.status})}),[c]);return r?e.jsxs(DialogContent,{className:"sm:max-w-4xl",children:[e.jsx(DialogHeader,{children:e.jsx(DialogTitle,{children:e.jsx(n,{className:"h-8 w-[200px]"})})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{className:"h-4 w-[100px]"}),e.jsx(n,{className:"h-10 w-full"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{className:"h-4 w-[100px]"}),e.jsx(n,{className:"h-10 w-full"})]}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx(n,{className:"h-10 w-[100px]"}),e.jsx(n,{className:"h-10 w-[150px]"})]})]})]}):d||!c?e.jsxs(DialogContent,{className:"sm:max-w-4xl",children:[e.jsx(DialogHeader,{children:e.jsx(DialogTitle,{children:"Lỗi"})}),e.jsxs("div",{className:"py-4 text-center",children:[e.jsx("p",{className:"text-red-500 mb-4",children:"Đã xảy ra lỗi khi tải dữ liệu danh mục."}),e.jsxs("div",{className:"flex justify-center space-x-4",children:[e.jsx(h,{variant:"outline",onClick:i,children:"Đóng"}),e.jsx(h,{onClick:()=>l.invalidateQueries({queryKey:["category",a]}),children:"Thử lại"})]})]})]}):e.jsxs(DialogContent,{className:"sm:max-w-4xl",children:[e.jsx(DialogHeader,{children:e.jsxs(DialogTitle,{children:["Chỉnh sửa danh mục: ",c.data.name]})}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),(()=>{let e=!0;const s={...y};return j.name.trim()||(s.name="Tên danh mục không được để trống",e=!1),f(s),e})())try{await o.mutateAsync({categoryId:a,payload:j},{onSuccess:()=>{m.success("Cập nhật danh mục thành công"),l.invalidateQueries({queryKey:["category",a]}),l.invalidateQueries({queryKey:["categories"]}),i()},onError:e=>{m.error("Cập nhật danh mục thất bại: "+e.message)}})}catch(s){m.error("Đã xảy ra lỗi khi cập nhật danh mục")}},className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"name",children:"Tên danh mục"}),e.jsx(x,{id:"name",name:"name",placeholder:"Nhập tên danh mục",value:j.name,onChange:e=>{const{name:s,value:a}=e.target;p((e=>({...e,[s]:a}))),y[s]&&f((e=>({...e,[s]:""})))},className:y.name?"border-red-500":""}),y.name&&e.jsx("p",{className:"text-red-500 text-sm",children:y.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"status",children:"Trạng thái"}),e.jsxs(k,{value:j.status,onValueChange:e=>{p((s=>({...s,status:e})))},children:[e.jsx(A,{id:"status",children:e.jsx(G,{placeholder:"Chọn trạng thái"})}),e.jsxs(K,{children:[e.jsx(I,{value:"HOAT_DONG",children:"Hoạt động"}),e.jsx(I,{value:"KHONG_HOAT_DONG",children:"Không hoạt động"})]})]})]}),e.jsxs(DialogFooter,{children:[e.jsx(h,{type:"button",variant:"outline",onClick:i,children:"Hủy"}),e.jsx(h,{type:"submit",disabled:o.isPending,children:o.isPending?"Đang xử lý...":"Cập nhật danh mục"})]})]})]})}function Q({isOpen:a,onClose:t}){const n=N(),i=p(),[l,c]=s.useState({name:"",status:"HOAT_DONG"}),[r,d]=s.useState({name:""});return e.jsxs(DialogContent,{className:"sm:max-w-4xl",children:[e.jsx(DialogHeader,{children:e.jsx(DialogTitle,{children:"Thêm danh mục mới"})}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),(()=>{let e=!0;const s={...r};return l.name.trim()||(s.name="Tên danh mục không được để trống",e=!1),d(s),e})())try{await i.mutateAsync(l,{onSuccess:()=>{m.success("Thêm danh mục thành công"),n.invalidateQueries({queryKey:["categories"]}),c({name:"",status:"HOAT_DONG"}),t()},onError:e=>{"Duplicate entry. This record already exists."===e.message||m.error("Thêm danh mục thất bại: Danh mục đã tồn tại")}})}catch(s){}},className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"create-name",children:"Tên danh mục"}),e.jsx(x,{id:"create-name",name:"name",placeholder:"Nhập tên danh mục",value:l.name,onChange:e=>{const{name:s,value:a}=e.target;c((e=>({...e,[s]:a}))),r[s]&&d((e=>({...e,[s]:""})))},className:r.name?"border-red-500":""}),r.name&&e.jsx("p",{className:"text-red-500 text-sm",children:r.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"create-status",children:"Trạng thái"}),e.jsxs(k,{value:l.status,onValueChange:e=>{c((s=>({...s,status:e})))},children:[e.jsx(A,{id:"create-status",children:e.jsx(G,{placeholder:"Chọn trạng thái"})}),e.jsxs(K,{children:[e.jsx(I,{value:"HOAT_DONG",children:"Hoạt động"}),e.jsx(I,{value:"KHONG_HOAT_DONG",children:"Không hoạt động"})]})]})]}),e.jsxs(DialogFooter,{children:[e.jsx(h,{type:"button",variant:"outline",onClick:t,children:"Hủy"}),e.jsx(h,{type:"submit",disabled:i.isPending,children:i.isPending?"Đang xử lý...":"Thêm danh mục"})]})]})]})}const z=()=>e.jsx(q,{});export{z as default};
