import{a as S,j as e,q as z,B as g,k as N,bU as me,aQ as ne,bV as xe,A as R,m as X,ar as ue,bq as te,bW as pe,bX as q,U as ge,w as je,aa as fe,a6 as I}from"./index-Dpx_4rWJ.js";import{d as ye}from"./product-SA3ZOUlJ.js";import{u as Ne,c as be}from"./cloudinary-sSJFoiWJ.js";import{B as ve,a as Ce,b as L,c as Y,d as Z,e as Ie}from"./breadcrumb-CJedQ5QG.js";import{C as E,a as M,b as H,c as Q,e as D}from"./card-fT6uSY2F.js";import{L as j}from"./label-B0XdI4bT.js";import{T as we}from"./textarea-D-7Bay0_.js";import{T as ke,b as Se,c as ee,a as se}from"./tabs-BXj1bKUw.js";import{S as B,a as P,b as $,c as A,d as G}from"./select-CS4vNzI5.js";import{j as ie,o as ce,u as Ve,a as ze,p as Te}from"./attributes-Bjak6hx3.js";import{g as O}from"./sizeMapping-RjPPY2bw.js";import{C as ae}from"./checkbox-BwYGdXvN.js";import{D as Fe,a as Be,i as Pe}from"./dialog-BuHyDe_9.js";import"./createLucideIcon-BdgKQErZ.js";import"./index-BdQq_4o_.js";import"./index-qvEK80KO.js";import"./check-CyKb8IHM.js";const $e=({variant:t,onChange:a,onImageUpload:m,onRemoveImage:f,uploading:x})=>{var y;const b=S.useRef(null),{data:u}=ie(),{data:v}=ce(),C=i=>{const{name:l,value:n}=i.target;a(l==="price"||l==="stock"?{...t,[l]:parseInt(n)||0}:{...t,[l]:n})},w=i=>{a({...t,colorId:i})},T=i=>{a({...t,sizeId:i})},k=async i=>{const l=i.target.files;if(l&&l.length>0){for(let n=0;n<l.length;n++)await m(l[n]);b.current&&(b.current.value="")}},p=()=>{const i=t.price||0,l=Math.round(i*25912.04/1e3)*1e3;a({...t,price:l})};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(j,{htmlFor:`colorId-${t.colorId}`,children:["Màu sắc ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(B,{value:t.colorId,onValueChange:w,required:!0,children:[e.jsx(P,{id:`colorId-${t.colorId}`,className:"w-full",children:e.jsx($,{placeholder:"Chọn màu sắc",children:t.colorId&&((y=((u==null?void 0:u.data)||[]).find(i=>{var l;return i.id.toString()===((l=t.colorId)==null?void 0:l.toString())}))==null?void 0:y.name)||"Chọn màu sắc"})}),e.jsx(A,{children:((u==null?void 0:u.data)||[]).map(i=>e.jsx(G,{value:i.id.toString(),children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("span",{children:i.name}),e.jsx("div",{className:"w-4 h-4 rounded-full border border-gray-300 ml-2",style:{backgroundColor:i.code}})]})},i.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(j,{htmlFor:`sizeId-${t.sizeId}`,children:["Kích thước ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(B,{value:t.sizeId,onValueChange:T,required:!0,children:[e.jsx(P,{id:`sizeId-${t.sizeId}`,className:"w-full",children:e.jsx($,{placeholder:"Chọn kích thước",children:t.sizeId?(()=>{const i=((v==null?void 0:v.data)||[]).find(l=>{var n;return l.id.toString()===((n=t.sizeId)==null?void 0:n.toString())});return i?O(i.value):"Chọn kích thước"})():"Chọn kích thước"})}),e.jsx(A,{children:((v==null?void 0:v.data)||[]).map(i=>e.jsx(G,{value:i.id.toString(),children:O(i.value)},i.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(j,{htmlFor:`price-${t.price}`,children:["Giá ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(z,{id:`price-${t.price}`,name:"price",type:"number",min:"0",value:t.price||"",onChange:C,placeholder:"Nhập giá (đơn vị $ hoặc VNĐ)",required:!0,className:"flex-1"}),e.jsxs(g,{type:"button",variant:"default",className:"gap-1",onClick:p,title:"Chuyển đổi từ USD sang VNĐ (1 USD = 25,912.04 VNĐ)",children:[e.jsx(N.Icon,{path:me,size:.7,className:"text-white"}),"Chuyển sang đơn vị VNĐ"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:`stock-${t.stock}`,children:"Số lượng tồn kho"}),e.jsx(z,{id:`stock-${t.stock}`,name:"stock",type:"number",min:"0",value:t.stock||"",onChange:C,placeholder:"Nhập số lượng tồn kho"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{children:"Hình ảnh sản phẩm"}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{type:"file",ref:b,onChange:k,accept:"image/*",multiple:!0,className:"hidden"}),e.jsx(g,{type:"button",variant:"outline",onClick:()=>{var i;return(i=b.current)==null?void 0:i.click()},disabled:x,className:"flex items-center gap-2",children:x?e.jsxs(e.Fragment,{children:[e.jsx(N.Icon,{path:ne,size:.7,className:"animate-spin"}),"Đang tải..."]}):e.jsxs(e.Fragment,{children:[e.jsx(N.Icon,{path:xe,size:.7}),"Tải lên hình ảnh"]})})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-2",children:t.images&&t.images.length>0?e.jsx(R,{children:t.images.map((i,l)=>e.jsxs(X.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{duration:.2},className:"relative group rounded-[6px] overflow-hidden border border-gray-200",style:{aspectRatio:"1/1"},children:[e.jsx("img",{src:ue(i),alt:`Variant image ${l+1}`,className:"object-contain"}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-40 transition-all flex items-center justify-center",children:e.jsx(g,{type:"button",variant:"destructive",size:"icon",className:"opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>f(l),children:e.jsx(N.Icon,{path:te,size:.7})})})]},l))}):e.jsx("div",{className:"flex items-center justify-center border border-dashed border-gray-300 rounded-[6px] text-maintext",style:{aspectRatio:"1/1"},children:e.jsxs("div",{className:"flex flex-col items-center p-4",children:[e.jsx(N.Icon,{path:pe,size:1.5}),e.jsx("p",{className:"text-xs mt-2",children:"Chưa có hình ảnh"})]})})})]})]})]})},Ae=({baseVariant:t,onGenerate:a,onClose:m})=>{const{data:f}=ie(),{data:x}=ce(),[b,u]=S.useState([]),v=(n,r)=>{const h=1+(r-38)*.02;return Math.round(n*h/1e3)*1e3};S.useEffect(()=>{if(f!=null&&f.data&&(x!=null&&x.data)&&t.price>0){const n=[];f.data.forEach(r=>{x.data.forEach(d=>{const h=v(t.price,d.value);n.push({id:`${r.id}-${d.id}`,colorId:r.id,sizeId:d.id,price:h,stock:10,images:t.images?[...t.images]:[],selected:!0,colorName:r.name,sizeName:O(d.value),sizeValue:d.value})})}),n.sort((r,d)=>r.sizeValue!==d.sizeValue?r.sizeValue-d.sizeValue:r.colorName.localeCompare(d.colorName)),n.length>0&&(n[0].stock=t.stock??0),u(n)}},[f,x,t.price,t.stock,t.colorId,t.sizeId,t.images]);const C=n=>{u(r=>r.map(d=>({...d,selected:n})))},w=(n,r)=>{u(d=>d.map(h=>h.id===n?{...h,selected:r}:h))},T=(n,r)=>{u(d=>d.map(h=>h.id===n?{...h,stock:r}:h))},k=()=>{const n=b.filter(r=>r.selected).map(r=>({colorId:r.colorId,sizeId:r.sizeId,price:r.price,stock:r.stock,images:r.images}));a(n)},p=b.filter(n=>n.selected).length,y=b.length,i=n=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND",maximumFractionDigits:0}).format(n),l=n=>{var r;return(r=f==null?void 0:f.data)==null?void 0:r.find(d=>d.id===n)};return e.jsx(Fe,{open:!0,onOpenChange:m,children:e.jsx(Be,{className:"bg-white rounded-lg max-w-6xl w-full max-h-[90vh] overflow-hidden p-0",children:e.jsxs(E,{className:"border-0 shadow-none",children:[e.jsx(M,{className:"flex flex-row items-center justify-between border-b",children:e.jsx(H,{className:"flex items-center justify-between w-full",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N.Icon,{path:q,size:.7,className:"text-primary"}),"Generate tất cả biến thể"]})})}),e.jsx(Q,{className:"p-4 overflow-y-auto max-h-[calc(90vh-200px)]",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(ae,{id:"select-all",checked:p===y,onCheckedChange:C}),e.jsxs(j,{htmlFor:"select-all",className:"font-medium",children:["Chọn tất cả (",p,"/",y,")"]})]}),e.jsx("div",{className:"text-sm text-maintext",children:"Giá được tính tự động theo size (size lớn hơn = giá cao hơn)"})]}),e.jsx("div",{className:"grid gap-4",children:e.jsx(R,{children:b.map((n,r)=>{const d=l(n.colorId);return e.jsx(X.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{delay:r*.02},className:`
                          border rounded-lg p-4 transition-all
                          ${n.selected?"border-primary bg-primary/5":"border-gray-200 bg-gray-50"}
                        `,children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(ae,{checked:n.selected,onCheckedChange:h=>w(n.id,h)}),e.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 rounded-full border border-gray-300",style:{backgroundColor:(d==null?void 0:d.code)||"#000"}}),e.jsx("span",{className:"font-medium",children:n.colorName})]}),e.jsx("div",{className:"text-maintext",children:"•"}),e.jsxs("div",{className:"font-medium",children:["Size ",n.sizeValue]}),e.jsx("div",{className:"text-maintext",children:"•"}),e.jsx("div",{className:"font-semibold text-primary",children:i(n.price)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{htmlFor:`stock-${n.id}`,className:"text-sm",children:"Số lượng:"}),e.jsx(z,{id:`stock-${n.id}`,type:"number",min:"0",value:n.stock||"",onChange:h=>T(n.id,parseInt(h.target.value)||0),className:"w-20",placeholder:"0"})]})]})},n.id)})})})]})}),e.jsxs("div",{className:"border-t p-4 flex justify-between items-center",children:[e.jsxs("div",{className:"text-sm text-maintext",children:["Đã chọn ",p," biến thể"]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(Pe,{asChild:!0,children:e.jsx(g,{variant:"outline",children:"Hủy"})}),e.jsxs(g,{onClick:k,disabled:p===0,className:"flex items-center gap-2",children:[e.jsx(N.Icon,{path:q,size:.7}),"Tạo ",p," biến thể"]})]})]})]})})})},Ge={name:"",brand:"",category:"",material:"",description:"",weight:0,variants:[{colorId:"",sizeId:"",price:0,stock:0,images:[]}]};function Ue(){var K,W,J;const t=ge(),[a,m]=S.useState(Ge),[f,x]=S.useState("info"),[b,u]=S.useState(!1),[v,C]=S.useState(!1),w=ye(),T=Ne(),k=s=>{const{name:c,value:o}=s.target;m(c==="weight"?{...a,[c]:parseFloat(o)||0}:{...a,[c]:o})},{data:p}=Ve(),{data:y}=ze(),{data:i}=Te(),l=()=>{m({...a,variants:[...a.variants,{colorId:"",sizeId:"",price:0,stock:0,images:[]}]})},n=s=>{m({...a,variants:a.variants.filter((c,o)=>o!==s)})},r=(s,c)=>{const o=[...a.variants];o[s]=c,m({...a,variants:o})},d=async(s,c)=>{var o;try{u(!0);const V=be(s),U=await T.mutateAsync(V),F=[...a.variants];F[c].images=[...F[c].images||[],(o=U==null?void 0:U.data)==null?void 0:o.imageUrl],m({...a,variants:F}),I.success("Tải lên hình ảnh thành công")}catch(V){I.error("Tải lên hình ảnh thất bại"),console.error(V)}finally{u(!1)}},h=(s,c)=>{var V;const o=[...a.variants];o[s].images=(V=o[s].images)==null?void 0:V.filter((U,F)=>F!==c),m({...a,variants:o})},re=async s=>{if(s.preventDefault(),!a.name||!a.brand||!a.category){I.error("Vui lòng điền đầy đủ thông tin sản phẩm"),x("info");return}if(a.variants.some(c=>!c.colorId||!c.sizeId||c.price<=0)){I.error("Vui lòng điền đầy đủ thông tin biến thể"),x("variants");return}try{await w.mutateAsync(a,{onSuccess:()=>{I.success("Tạo sản phẩm thành công"),t("/admin/products")},onError:c=>{console.error("Chi tiết lỗi:",c)}})}catch{I.error("Vui lòng cung cấp đầy đủ thông tin sản phẩm")}},le=()=>{const s=!!a.name&&!!a.brand&&!!a.category,c=a.variants.every(o=>!!o.colorId&&!!o.sizeId&&o.price>0);return s&&c},de=()=>{const s=[];return a.name.trim()||s.push("Tên sản phẩm"),a.brand||s.push("Thương hiệu"),a.category||s.push("Danh mục"),a.material||s.push("Chất liệu"),s},oe=()=>{const s=de();if(s.length>0){I.error(`Vui lòng điền đầy đủ thông tin: ${s.join(", ")}`);return}x("variants")},he=s=>{m({...a,variants:s}),C(!1),I.success(`Đã tạo ${s.length} biến thể`)},_=()=>{const s=a.variants[0];return s&&s.colorId&&s.sizeId&&s.price>0};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(ve,{children:e.jsxs(Ce,{children:[e.jsx(L,{children:e.jsx(Y,{href:"/admin/statistics",children:"Dashboard"})}),e.jsx(Z,{}),e.jsx(L,{children:e.jsx(Y,{href:"/admin/products",children:"Quản lý sản phẩm"})}),e.jsx(Z,{}),e.jsx(L,{children:e.jsx(Ie,{children:"Thêm sản phẩm mới"})})]})}),e.jsxs(g,{variant:"outline",onClick:()=>t(-1),className:"flex items-center gap-2",children:[e.jsx(N.Icon,{path:je,size:.7}),"Quay lại"]})]}),e.jsx("form",{onSubmit:re,children:e.jsxs(ke,{value:f,onValueChange:x,className:"space-y-4",children:[e.jsxs(Se,{className:"grid w-full md:w-[400px] grid-cols-2",children:[e.jsx(ee,{value:"info",children:"Thông tin cơ bản"}),e.jsx(ee,{value:"variants",children:"Biến thể sản phẩm"})]}),e.jsx(se,{value:"info",className:"space-y-4",children:e.jsxs(E,{children:[e.jsx(M,{children:e.jsx(H,{children:"Thông tin cơ bản"})}),e.jsxs(Q,{className:"space-y-4 text-maintext",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(j,{htmlFor:"name",children:["Tên sản phẩm ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(z,{id:"name",name:"name",value:a.name,onChange:k,placeholder:"Nhập tên sản phẩm",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(j,{htmlFor:"brand",children:["Thương hiệu ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(B,{value:a.brand,onValueChange:s=>m({...a,brand:s}),children:[e.jsx(P,{children:e.jsx($,{placeholder:"Chọn thương hiệu",children:a.brand&&((K=((p==null?void 0:p.data)||[]).find(s=>{var c;return s.id.toString()===((c=a.brand)==null?void 0:c.toString())}))==null?void 0:K.name)||"Chọn thương hiệu"})}),e.jsx(A,{children:((p==null?void 0:p.data)||[]).map(s=>e.jsx(G,{value:s.id.toString(),children:s.name},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(j,{htmlFor:"category",children:["Danh mục ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(B,{value:a.category,onValueChange:s=>m({...a,category:s}),children:[e.jsx(P,{children:e.jsx($,{placeholder:"Chọn danh mục",children:a.category&&((W=((y==null?void 0:y.data)||[]).find(s=>{var c;return s.id.toString()===((c=a.category)==null?void 0:c.toString())}))==null?void 0:W.name)||"Chọn danh mục"})}),e.jsx(A,{children:((y==null?void 0:y.data)||[]).map(s=>e.jsx(G,{value:s.id.toString(),children:s.name},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(j,{htmlFor:"material",children:["Chất liệu ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(B,{value:a.material,onValueChange:s=>m({...a,material:s}),children:[e.jsx(P,{children:e.jsx($,{placeholder:"Chọn chất liệu",children:a.material&&((J=((i==null?void 0:i.data)||[]).find(s=>{var c;return s.id.toString()===((c=a.material)==null?void 0:c.toString())}))==null?void 0:J.name)||"Chọn chất liệu"})}),e.jsx(A,{children:((i==null?void 0:i.data)||[]).map(s=>e.jsx(G,{value:s.id.toString(),children:s.name},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"weight",children:"Trọng lượng (gram)"}),e.jsx(z,{id:"weight",name:"weight",type:"number",min:"0",value:a.weight||"",onChange:k,placeholder:"Nhập trọng lượng"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(j,{htmlFor:"description",children:"Mô tả sản phẩm"}),e.jsx(we,{id:"description",name:"description",value:a.description,onChange:k,placeholder:"Nhập mô tả sản phẩm",rows:5})]})]}),e.jsxs(D,{className:"flex justify-between",children:[e.jsx(g,{type:"button",variant:"outline",onClick:()=>t(-1),children:"Hủy"}),e.jsx(g,{type:"button",onClick:oe,children:"Tiếp theo"})]})]})}),e.jsx(se,{value:"variants",className:"space-y-4",children:e.jsxs(E,{children:[e.jsx(M,{className:"flex flex-row items-center justify-between",children:e.jsxs(H,{className:"flex items-center justify-between w-full",children:["Biến thể sản phẩm",e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(g,{type:"button",variant:"outline",onClick:()=>C(!0),disabled:!_(),className:"flex items-center gap-1",title:_()?"":"Vui lòng hoàn thành biến thể đầu tiên",children:[e.jsx(N.Icon,{path:q,size:.7}),"Generate tất cả biến thể"]}),e.jsxs(g,{type:"button",variant:"outline",onClick:l,className:"flex items-center gap-1",children:[e.jsx(N.Icon,{path:fe,size:.7}),"Thêm biến thể"]}),e.jsx(g,{type:"submit",disabled:!le()||w.isPending,className:"flex items-center gap-2",children:w.isPending?e.jsxs(e.Fragment,{children:[e.jsx(N.Icon,{path:ne,size:.7,className:"animate-spin"}),"Đang xử lý..."]}):"Tạo sản phẩm"})]})]})}),e.jsx(Q,{className:"space-y-4 text-maintext",children:e.jsx(R,{children:a.variants.map((s,c)=>e.jsxs(X.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.2},className:"border p-4 rounded-[6px]",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-lg font-medium",children:["Biến thể #",c+1]}),a.variants.length>1&&e.jsxs(g,{type:"button",variant:"destructive",size:"sm",onClick:()=>n(c),className:"flex items-center gap-1",children:[e.jsx(N.Icon,{path:te,size:.7}),"Xóa"]})]}),e.jsx($e,{variant:s,onChange:o=>r(c,o),onImageUpload:o=>d(o,c),onRemoveImage:o=>h(c,o),uploading:b})]},c))})}),e.jsx(D,{className:"flex justify-between",children:e.jsx(g,{type:"button",variant:"outline",onClick:()=>x("info"),children:"Quay lại"})})]})})]})}),e.jsx(R,{children:v&&e.jsx(Ae,{baseVariant:a.variants[0],onGenerate:he,onClose:()=>C(!1)})})]})}const ss=()=>e.jsx(Ue,{});export{ss as default};
