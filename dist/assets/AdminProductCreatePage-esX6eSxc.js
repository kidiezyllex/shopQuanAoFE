import{j as e}from"./ui-vendor-CFM_MCUz.js";import{r as s,u as a}from"./react-vendor-B55MjJUH.js";import{d as i}from"./product-BXJPBtky.js";import{u as n,c as t}from"./cloudinary-CyDYQiY2.js";import{B as l,a as r,b as c,c as d,d as o,e as h}from"./breadcrumb-CP4jYkI2.js";import{I as m,B as x,l as p,y as j}from"./index-BHeY-5EX.js";import{C as u,a as g,b as v,c as f,e as y}from"./card-ClEzRAeX.js";import{L as N}from"./label-Bm9nFuXD.js";import{T as b}from"./textarea-DHkaMSo6.js";import{T as C,b as I,c as k,a as w}from"./tabs-z4DSy6tE.js";import{t as z,b8 as V,aC as F,b9 as T,aX as $,ba as _,M as S,bb as D,a5 as q}from"./icons-vendor-BrsZP2ku.js";import{S as G,a as A,b as B,c as M,d as R}from"./select-C6W71KWg.js";import{j as U,o as E,u as H,a as Q,p as P}from"./attributes-DYSh1UfM.js";import{A as X,m as K}from"./heavy-vendor-BfN2pHnQ.js";import{C as L}from"./checkbox-4N58UvKV.js";import"./query-vendor-CBwfxcof.js";const O=({variant:a,onChange:i,onImageUpload:n,onRemoveImage:t,uploading:l})=>{const r=s.useRef(null),{data:c}=U(),{data:d}=E(),o=e=>{const{name:s,value:n}=e.target;i("price"===s||"stock"===s?{...a,[s]:parseInt(n)||0}:{...a,[s]:n})};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(N,{htmlFor:`colorId-${a.colorId}`,children:["Màu sắc ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(G,{value:a.colorId,onValueChange:e=>{i({...a,colorId:e})},required:!0,children:[e.jsx(A,{id:`colorId-${a.colorId}`,className:"w-full",children:e.jsx(B,{placeholder:"Chọn màu sắc"})}),e.jsx(M,{children:((null==c?void 0:c.data)||[]).map((s=>e.jsx(R,{value:s._id,children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("span",{children:s.name}),e.jsx("div",{className:"w-4 h-4 rounded-full border border-gray-300 ml-2",style:{backgroundColor:s.code}})]})},s._id)))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(N,{htmlFor:`sizeId-${a.sizeId}`,children:["Kích thước ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(G,{value:a.sizeId,onValueChange:e=>{i({...a,sizeId:e})},required:!0,children:[e.jsx(A,{id:`sizeId-${a.sizeId}`,className:"w-full",children:e.jsx(B,{placeholder:"Chọn kích thước"})}),e.jsx(M,{children:((null==d?void 0:d.data)||[]).map((s=>e.jsx(R,{value:s._id,children:s.value},s._id)))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(N,{htmlFor:`price-${a.price}`,children:["Giá ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(m,{id:`price-${a.price}`,name:"price",type:"number",min:"0",value:a.price||"",onChange:o,placeholder:"Nhập giá (đơn vị $ hoặc VNĐ)",required:!0,className:"flex-1"}),e.jsxs(x,{type:"button",variant:"default",className:"gap-1",onClick:()=>{const e=a.price||0,s=1e3*Math.round(25912.04*e/1e3);i({...a,price:s})},title:"Chuyển đổi từ USD sang VNĐ (1 USD = 25,912.04 VNĐ)",children:[e.jsx(z.Icon,{path:V,size:.7,className:"text-white"}),"Chuyển sang đơn vị VNĐ"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:`stock-${a.stock}`,children:"Số lượng tồn kho"}),e.jsx(m,{id:`stock-${a.stock}`,name:"stock",type:"number",min:"0",value:a.stock||"",onChange:o,placeholder:"Nhập số lượng tồn kho"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{children:"Hình ảnh sản phẩm"}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{type:"file",ref:r,onChange:async e=>{const s=e.target.files;if(s&&s.length>0){for(let e=0;e<s.length;e++)await n(s[e]);r.current&&(r.current.value="")}},accept:"image/*",multiple:!0,className:"hidden"}),e.jsx(x,{type:"button",variant:"outline",onClick:()=>{var e;return null==(e=r.current)?void 0:e.click()},disabled:l,className:"flex items-center gap-2",children:l?e.jsxs(e.Fragment,{children:[e.jsx(z.Icon,{path:F,size:.7,className:"animate-spin"}),"Đang tải..."]}):e.jsxs(e.Fragment,{children:[e.jsx(z.Icon,{path:T,size:.7}),"Tải lên hình ảnh"]})})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-2",children:a.images&&a.images.length>0?e.jsx(X,{children:a.images.map(((s,a)=>e.jsxs(K.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{duration:.2},className:"relative group rounded-[6px] overflow-hidden border border-gray-200",style:{aspectRatio:"1/1"},children:[e.jsx("img",{src:p(s),alt:`Variant image ${a+1}`,className:"object-contain"}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-40 transition-all flex items-center justify-center",children:e.jsx(x,{type:"button",variant:"destructive",size:"icon",className:"opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>t(a),children:e.jsx(z.Icon,{path:$,size:.7})})})]},a)))}):e.jsx("div",{className:"flex items-center justify-center border border-dashed border-gray-300 rounded-[6px] text-maintext",style:{aspectRatio:"1/1"},children:e.jsxs("div",{className:"flex flex-col items-center p-4",children:[e.jsx(z.Icon,{path:_,size:1.5}),e.jsx("p",{className:"text-xs mt-2",children:"Chưa có hình ảnh"})]})})})]})]})]})},J=({baseVariant:a,onGenerate:i,onClose:n})=>{const{data:t}=U(),{data:l}=E(),[r,c]=s.useState([]);s.useEffect((()=>{if((null==t?void 0:t.data)&&(null==l?void 0:l.data)&&a.price>0){const e=[];t.data.forEach((s=>{l.data.forEach((i=>{const n=((e,s)=>{const a=1+.02*(s-38);return 1e3*Math.round(e*a/1e3)})(a.price,i.value);e.push({id:`${s._id}-${i._id}`,colorId:s._id,sizeId:i._id,price:n,stock:10,images:a.images?[...a.images]:[],selected:!0,colorName:s.name,sizeName:`Size ${i.value}`,sizeValue:i.value})}))})),e.sort(((e,s)=>e.sizeValue!==s.sizeValue?e.sizeValue-s.sizeValue:e.colorName.localeCompare(s.colorName))),e.length>0&&(e[0].stock=a.stock??0),c(e)}}),[t,l,a.price,a.stock,a.colorId,a.sizeId,a.images]);const d=r.filter((e=>e.selected)).length,o=r.length;return e.jsx(Dialog,{open:!0,onOpenChange:n,children:e.jsx(DialogContent,{className:"bg-white rounded-lg max-w-6xl w-full max-h-[90vh] overflow-hidden p-0",children:e.jsxs(u,{className:"border-0 shadow-none",children:[e.jsx(g,{className:"flex flex-row items-center justify-between border-b",children:e.jsx(v,{className:"flex items-center justify-between w-full",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z.Icon,{path:mdiAutoFix,size:.7,className:"text-primary"}),"Generate tất cả biến thể"]})})}),e.jsx(f,{className:"p-4 overflow-y-auto max-h-[calc(90vh-200px)]",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(L,{id:"select-all",checked:d===o,onCheckedChange:e=>{c((s=>s.map((s=>({...s,selected:e})))))}}),e.jsxs(N,{htmlFor:"select-all",className:"font-medium",children:["Chọn tất cả (",d,"/",o,")"]})]}),e.jsx("div",{className:"text-sm text-maintext",children:"Giá được tính tự động theo size (size lớn hơn = giá cao hơn)"})]}),e.jsx("div",{className:"grid gap-4",children:e.jsx(X,{children:r.map(((s,a)=>{const i=(n=s.colorId,null==(l=null==t?void 0:t.data)?void 0:l.find((e=>e._id===n)));var n,l,r;return e.jsx(K.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{delay:.02*a},className:`\n                          border rounded-lg p-4 transition-all\n                          ${s.selected?"border-primary bg-primary/5":"border-gray-200 bg-gray-50"}\n                        `,children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(L,{checked:s.selected,onCheckedChange:e=>((e,s)=>{c((a=>a.map((a=>a.id===e?{...a,selected:s}:a))))})(s.id,e)}),e.jsxs("div",{className:"flex items-center gap-4 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 rounded-full border border-gray-300",style:{backgroundColor:(null==i?void 0:i.code)||"#000"}}),e.jsx("span",{className:"font-medium",children:s.colorName})]}),e.jsx("div",{className:"text-maintext",children:"•"}),e.jsxs("div",{className:"font-medium",children:["Size ",s.sizeValue]}),e.jsx("div",{className:"text-maintext",children:"•"}),e.jsx("div",{className:"font-semibold text-primary",children:(r=s.price,new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND",maximumFractionDigits:0}).format(r))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N,{htmlFor:`stock-${s.id}`,className:"text-sm",children:"Số lượng:"}),e.jsx(m,{id:`stock-${s.id}`,type:"number",min:"0",value:s.stock||"",onChange:e=>{return a=s.id,i=parseInt(e.target.value)||0,void c((e=>e.map((e=>e.id===a?{...e,stock:i}:e))));var a,i},className:"w-20",placeholder:"0"})]})]})},s.id)}))})})]})}),e.jsxs("div",{className:"border-t p-4 flex justify-between items-center",children:[e.jsxs("div",{className:"text-sm text-maintext",children:["Đã chọn ",d," biến thể"]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(DialogClose,{asChild:!0,children:e.jsx(x,{variant:"outline",children:"Hủy"})}),e.jsxs(x,{onClick:()=>{const e=r.filter((e=>e.selected)).map((e=>({colorId:e.colorId,sizeId:e.sizeId,price:e.price,stock:e.stock,images:e.images})));i(e)},disabled:0===d,className:"flex items-center gap-2",children:[e.jsx(z.Icon,{path:mdiAutoFix,size:.7}),"Tạo ",d," biến thể"]})]})]})]})})})},W={name:"",brand:"",category:"",material:"",description:"",weight:0,variants:[{colorId:"",sizeId:"",price:0,stock:0,images:[]}]};function Y(){const p=a(),[V,T]=s.useState(W),[_,U]=s.useState("info"),[E,L]=s.useState(!1),[Y,Z]=s.useState(!1),ee=i(),se=n(),ae=e=>{const{name:s,value:a}=e.target;T("weight"===s?{...V,[s]:parseFloat(a)||0}:{...V,[s]:a})},{data:ie}=H(),{data:ne}=Q(),{data:te}=P(),le=()=>{const e=V.variants[0];return e&&e.colorId&&e.sizeId&&e.price>0};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(l,{children:e.jsxs(r,{children:[e.jsx(c,{children:e.jsx(d,{href:"/admin/statistics",children:"Dashboard"})}),e.jsx(o,{}),e.jsx(c,{children:e.jsx(d,{href:"/admin/products",children:"Quản lý sản phẩm"})}),e.jsx(o,{}),e.jsx(c,{children:e.jsx(h,{children:"Thêm sản phẩm mới"})})]})}),e.jsxs(x,{variant:"outline",onClick:()=>p(-1),className:"flex items-center gap-2",children:[e.jsx(z.Icon,{path:S,size:.7}),"Quay lại"]})]}),e.jsx("form",{onSubmit:async e=>{if(e.preventDefault(),!V.name||!V.brand||!V.category)return j.error("Vui lòng điền đầy đủ thông tin sản phẩm"),void U("info");if(V.variants.some((e=>!e.colorId||!e.sizeId||e.price<=0)))return j.error("Vui lòng điền đầy đủ thông tin biến thể"),void U("variants");try{await ee.mutateAsync(V,{onSuccess:()=>{j.success("Tạo sản phẩm thành công"),p("/admin/products")},onError:e=>{}})}catch(s){j.error("Vui lòng cung cấp đầy đủ thông tin sản phẩm")}},children:e.jsxs(C,{value:_,onValueChange:U,className:"space-y-4",children:[e.jsxs(I,{className:"grid w-full md:w-[400px] grid-cols-2",children:[e.jsx(k,{value:"info",children:"Thông tin cơ bản"}),e.jsx(k,{value:"variants",children:"Biến thể sản phẩm"})]}),e.jsx(w,{value:"info",className:"space-y-4",children:e.jsxs(u,{children:[e.jsx(g,{children:e.jsx(v,{children:"Thông tin cơ bản"})}),e.jsxs(f,{className:"space-y-4 text-maintext",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(N,{htmlFor:"name",children:["Tên sản phẩm ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(m,{id:"name",name:"name",value:V.name,onChange:ae,placeholder:"Nhập tên sản phẩm",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(N,{htmlFor:"brand",children:["Thương hiệu ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(G,{value:V.brand,onValueChange:e=>T({...V,brand:e}),children:[e.jsx(A,{children:e.jsx(B,{placeholder:"Chọn thương hiệu"})}),e.jsx(M,{children:((null==ie?void 0:ie.data)||[]).map((s=>e.jsx(R,{value:s._id,children:s.name},s._id)))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(N,{htmlFor:"category",children:["Danh mục ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(G,{value:V.category,onValueChange:e=>T({...V,category:e}),children:[e.jsx(A,{children:e.jsx(B,{placeholder:"Chọn danh mục"})}),e.jsx(M,{children:((null==ne?void 0:ne.data)||[]).map((s=>e.jsx(R,{value:s._id,children:s.name},s._id)))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(N,{htmlFor:"material",children:["Chất liệu ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(G,{value:V.material,onValueChange:e=>T({...V,material:e}),children:[e.jsx(A,{children:e.jsx(B,{placeholder:"Chọn chất liệu"})}),e.jsx(M,{children:((null==te?void 0:te.data)||[]).map((s=>e.jsx(R,{value:s._id,children:s.name},s._id)))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"weight",children:"Trọng lượng (gram)"}),e.jsx(m,{id:"weight",name:"weight",type:"number",min:"0",value:V.weight||"",onChange:ae,placeholder:"Nhập trọng lượng"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"description",children:"Mô tả sản phẩm"}),e.jsx(b,{id:"description",name:"description",value:V.description,onChange:ae,placeholder:"Nhập mô tả sản phẩm",rows:5})]})]}),e.jsxs(y,{className:"flex justify-between",children:[e.jsx(x,{type:"button",variant:"outline",onClick:()=>p(-1),children:"Hủy"}),e.jsx(x,{type:"button",onClick:()=>{const e=(()=>{const e=[];return V.name.trim()||e.push("Tên sản phẩm"),V.brand||e.push("Thương hiệu"),V.category||e.push("Danh mục"),V.material||e.push("Chất liệu"),e})();e.length>0?j.error(`Vui lòng điền đầy đủ thông tin: ${e.join(", ")}`):U("variants")},children:"Tiếp theo"})]})]})}),e.jsx(w,{value:"variants",className:"space-y-4",children:e.jsxs(u,{children:[e.jsx(g,{className:"flex flex-row items-center justify-between",children:e.jsxs(v,{className:"flex items-center justify-between w-full",children:["Biến thể sản phẩm",e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(x,{type:"button",variant:"outline",onClick:()=>Z(!0),disabled:!le(),className:"flex items-center gap-1",title:le()?"":"Vui lòng hoàn thành biến thể đầu tiên",children:[e.jsx(z.Icon,{path:D,size:.7}),"Generate tất cả biến thể"]}),e.jsxs(x,{type:"button",variant:"outline",onClick:()=>{T({...V,variants:[...V.variants,{colorId:"",sizeId:"",price:0,stock:0,images:[]}]})},className:"flex items-center gap-1",children:[e.jsx(z.Icon,{path:q,size:.7}),"Thêm biến thể"]}),e.jsx(x,{type:"submit",disabled:!(()=>{const e=!!V.name&&!!V.brand&&!!V.category,s=V.variants.every((e=>!!e.colorId&&!!e.sizeId&&e.price>0));return e&&s})()||ee.isPending,className:"flex items-center gap-2",children:ee.isPending?e.jsxs(e.Fragment,{children:[e.jsx(z.Icon,{path:F,size:.7,className:"animate-spin"}),"Đang xử lý..."]}):"Tạo sản phẩm"})]})]})}),e.jsx(f,{className:"space-y-4 text-maintext",children:e.jsx(X,{children:V.variants.map(((s,a)=>e.jsxs(K.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.2},className:"border p-4 rounded-[6px]",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-lg font-medium",children:["Biến thể #",a+1]}),V.variants.length>1&&e.jsxs(x,{type:"button",variant:"destructive",size:"sm",onClick:()=>(e=>{T({...V,variants:V.variants.filter(((s,a)=>a!==e))})})(a),className:"flex items-center gap-1",children:[e.jsx(z.Icon,{path:$,size:.7}),"Xóa"]})]}),e.jsx(O,{variant:s,onChange:e=>((e,s)=>{const a=[...V.variants];a[e]=s,T({...V,variants:a})})(a,e),onImageUpload:e=>(async(e,s)=>{var a;try{L(!0);const i=t(e),n=await se.mutateAsync(i),l=[...V.variants];l[s].images=[...l[s].images||[],null==(a=null==n?void 0:n.data)?void 0:a.imageUrl],T({...V,variants:l}),j.success("Tải lên hình ảnh thành công")}catch(i){j.error("Tải lên hình ảnh thất bại")}finally{L(!1)}})(e,a),onRemoveImage:e=>((e,s)=>{var a;const i=[...V.variants];i[e].images=null==(a=i[e].images)?void 0:a.filter(((e,a)=>a!==s)),T({...V,variants:i})})(a,e),uploading:E})]},a)))})}),e.jsx(y,{className:"flex justify-between",children:e.jsx(x,{type:"button",variant:"outline",onClick:()=>U("info"),children:"Quay lại"})})]})})]})}),e.jsx(X,{children:Y&&e.jsx(J,{baseVariant:V.variants[0],onGenerate:e=>{T({...V,variants:e}),Z(!1),j.success(`Đã tạo ${e.length} biến thể`)},onClose:()=>Z(!1)})})]})}const Z=()=>e.jsx(Y,{});export{Z as default};
