import{U as ce,a as v,j as e,a2 as C,B as x,k as d,w as K,q as w,aQ as I,A as re,m as le,bV as de,bq as he,bW as me,a6 as l,b9 as oe}from"./index-Dpx_4rWJ.js";import{b as xe,e as pe,f as ue,g as je,h as ge}from"./product-SA3ZOUlJ.js";import{u as ye,c as fe}from"./cloudinary-sSJFoiWJ.js";import{B as F,a as B,b as h,c as u,d as j,e as V}from"./breadcrumb-CJedQ5QG.js";import{C as f,a as S,c as k,b as z,e as be}from"./card-fT6uSY2F.js";import{L as m}from"./label-B0XdI4bT.js";import{T as Ne}from"./textarea-D-7Bay0_.js";import{T as ve,b as Ce,c as D,a as O}from"./tabs-BXj1bKUw.js";import{S as we}from"./switch-KIImwJ91.js";import{S as G,a as E,b as L,c as H,d as _}from"./select-CS4vNzI5.js";import"./createLucideIcon-BdgKQErZ.js";import"./index-qvEK80KO.js";import"./index-BdQq_4o_.js";import"./check-CyKb8IHM.js";function Ie({params:b}){const T=ce(),{id:p}=b,[q,M]=v.useState("info"),[Q,$]=v.useState(!1),{data:r,isLoading:W,isError:J}=xe(p),P=pe(),R=ue(),N=je(),g=ge(),X=ye(),[i,o]=v.useState({});v.useEffect(()=>{if(r&&r.data){const s=r.data;o({name:s.name,brand:typeof s.brand=="string"?s.brand:s.brand.name,category:typeof s.category=="string"?s.category:s.category.name,material:typeof s.material=="string"?s.material:s.material.name,description:s.description,weight:s.weight,status:s.status})}},[r]);const A=s=>{const{name:a,value:t}=s.target;o(a==="weight"?{...i,[a]:parseFloat(t)||0}:{...i,[a]:t})},Y=async s=>{const a=s?"HOAT_DONG":"KHONG_HOAT_DONG",t={status:a};try{await R.mutateAsync({productId:p,payload:t},{onSuccess:()=>{l.success("Cập nhật trạng thái thành công"),o({...i,status:a})}})}catch{l.error("Cập nhật trạng thái thất bại")}},Z=async(s,a)=>{const t={variantUpdates:[{variantId:s,stock:a}]};try{await N.mutateAsync({productId:p,payload:t},{onSuccess:()=>{l.success("Cập nhật số lượng tồn kho thành công")}})}catch{l.error("Cập nhật số lượng tồn kho thất bại")}},ee=async(s,a)=>{var t;try{$(!0);const n=fe(s),c=await X.mutateAsync(n),y=r==null?void 0:r.data.variants.find(ie=>ie.id===a);if(!y){l.error("Không tìm thấy biến thể");return}const U=[...y.images,(t=c==null?void 0:c.data)==null?void 0:t.imageUrl],ne={variantId:a,images:U};await g.mutateAsync({productId:p,payload:ne},{onSuccess:()=>{l.success("Cập nhật hình ảnh thành công")}})}catch{l.error("Cập nhật hình ảnh thất bại")}finally{$(!1)}},se=async(s,a)=>{try{const t=r==null?void 0:r.data.variants.find(y=>y.id===s);if(!t){l.error("Không tìm thấy biến thể");return}const n=t.images.filter((y,U)=>U!==a),c={variantId:s,images:n};await g.mutateAsync({productId:p,payload:c},{onSuccess:()=>{l.success("Cập nhật hình ảnh thành công")}})}catch{l.error("Cập nhật hình ảnh thất bại")}},ae=async s=>{s.preventDefault();try{await P.mutateAsync({productId:p,payload:i},{onSuccess:()=>{l.success("Cập nhật thông tin thành công")}})}catch{l.error("Cập nhật thông tin thất bại")}};if(W)return e.jsxs("div",{className:"space-y-4",children:[e.jsx(F,{children:e.jsxs(B,{children:[e.jsx(h,{children:e.jsx(u,{href:"/admin/statistics",children:"Dashboard"})}),e.jsx(j,{}),e.jsx(h,{children:e.jsx(u,{href:"/admin/products",children:"Sản phẩm"})}),e.jsx(j,{}),e.jsx(h,{children:e.jsx(V,{children:"Chi tiết sản phẩm"})})]})}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(C,{className:"h-8 w-48"}),e.jsx(C,{className:"h-10 w-28"})]}),e.jsxs(f,{children:[e.jsx(S,{children:e.jsx(C,{className:"h-7 w-40"})}),e.jsx(k,{className:"space-y-4",children:[...Array(6)].map((s,a)=>e.jsx(C,{className:"h-12 w-full"},a))})]})]});if(J||!(r!=null&&r.data))return e.jsxs("div",{className:"space-y-4",children:[e.jsx(F,{children:e.jsxs(B,{children:[e.jsx(h,{children:e.jsx(u,{href:"/admin/statistics",children:"Dashboard"})}),e.jsx(j,{}),e.jsx(h,{children:e.jsx(u,{href:"/admin/products",children:"Sản phẩm"})}),e.jsx(j,{}),e.jsx(h,{children:e.jsx(V,{children:"Chi tiết sản phẩm"})})]})}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Chi tiết sản phẩm"}),e.jsxs(x,{variant:"outline",onClick:()=>T(-1),className:"flex items-center gap-2",children:[e.jsx(d.Icon,{path:K,size:.7}),"Quay lại"]})]}),e.jsxs(f,{className:"text-center p-4",children:[e.jsx("p",{className:"text-red-500 mb-4",children:"Đã xảy ra lỗi khi tải thông tin sản phẩm."}),e.jsx(x,{variant:"outline",onClick:()=>T(-1),children:"Quay lại"})]})]});const te=r.data;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(F,{children:e.jsxs(B,{children:[e.jsx(h,{children:e.jsx(u,{href:"/admin/statistics",children:"Dashboard"})}),e.jsx(j,{}),e.jsx(h,{children:e.jsx(u,{href:"/admin/products",children:"Quản lý sản phẩm"})}),e.jsx(j,{}),e.jsx(h,{children:e.jsx(V,{children:"Chỉnh sửa sản phẩm"})})]})}),e.jsxs(x,{variant:"outline",onClick:()=>T(-1),className:"flex items-center gap-2",children:[e.jsx(d.Icon,{path:K,size:.7}),"Quay lại"]})]}),e.jsxs(ve,{value:q,onValueChange:M,className:"space-y-4",children:[e.jsxs(Ce,{className:"grid w-full md:w-[500px] grid-cols-3",children:[e.jsx(D,{value:"info",children:"Thông tin cơ bản"}),e.jsx(D,{value:"variants",children:"Biến thể"}),e.jsx(D,{value:"status",children:"Trạng thái"})]}),e.jsx(O,{value:"info",className:"space-y-4 text-maintext",children:e.jsxs(f,{className:"mb-4",children:[e.jsx(S,{children:e.jsx(z,{children:"Thông tin cơ bản"})}),e.jsxs("form",{onSubmit:ae,children:[e.jsxs(k,{className:"space-y-4 text-maintext",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"name",children:"Tên sản phẩm"}),e.jsx(w,{id:"name",name:"name",value:i.name||"",onChange:A,placeholder:"Nhập tên sản phẩm"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"brand",children:"Thương hiệu"}),e.jsxs(G,{value:i.brand||"",onValueChange:s=>o({...i,brand:s}),children:[e.jsx(E,{children:e.jsx(L,{placeholder:"Chọn thương hiệu"})}),e.jsx(H,{children:["Prada","Uniqlo","Balenciaga","Chanel","Louis Vuitton"].map(s=>e.jsx(_,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"category",children:"Danh mục"}),e.jsxs(G,{value:i.category||"",onValueChange:s=>o({...i,category:s}),children:[e.jsx(E,{children:e.jsx(L,{placeholder:"Chọn danh mục"})}),e.jsx(H,{children:["Giày thể thao","Giày chạy bộ","Giày đá bóng","Giày thời trang"].map(s=>e.jsx(_,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"material",children:"Chất liệu"}),e.jsxs(G,{value:i.material||"",onValueChange:s=>o({...i,material:s}),children:[e.jsx(E,{children:e.jsx(L,{placeholder:"Chọn chất liệu"})}),e.jsx(H,{children:["Canvas","Da","Vải","Nhựa","Cao su"].map(s=>e.jsx(_,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"weight",children:"Trọng lượng (gram)"}),e.jsx(w,{id:"weight",name:"weight",type:"number",min:"0",value:i.weight||"",onChange:A,placeholder:"Nhập trọng lượng"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"description",children:"Mô tả sản phẩm"}),e.jsx(Ne,{id:"description",name:"description",value:i.description||"",onChange:A,placeholder:"Nhập mô tả sản phẩm",rows:5})]})]}),e.jsx(be,{className:"flex justify-end",children:e.jsx(x,{type:"submit",disabled:P.isPending,className:"flex items-center gap-2",children:P.isPending?e.jsxs(e.Fragment,{children:[e.jsx(d.Icon,{path:I,size:.7,className:"animate-spin"}),"Đang cập nhật..."]}):"Cập nhật thông tin"})})]})]})}),e.jsx(O,{value:"variants",className:"space-y-4 text-maintext",children:e.jsxs(f,{className:"mb-4",children:[e.jsx(S,{children:e.jsx(z,{children:"Biến thể sản phẩm"})}),e.jsx(k,{className:"space-y-4",children:e.jsx(re,{children:te.variants.map(s=>{var a,t;return e.jsxs(le.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.2},className:"border p-4 rounded-[6px]",children:[e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium",children:[s.colorId.name," - ",s.sizeId.name]}),e.jsxs("p",{className:"text-sm text-maintext",children:["Giá: ",new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND",maximumFractionDigits:0}).format(s.price)]})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:`stock-${s.id}`,className:"text-maintext",children:"Số lượng tồn kho"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{id:`stock-${s.id}`,type:"number",min:"0",defaultValue:s.stock,placeholder:"Nhập số lượng tồn kho"}),e.jsx(x,{type:"button",onClick:n=>{const c=n.currentTarget.previousElementSibling;Z(s.id,parseInt(c.value)||0)},disabled:N.isPending,children:N.isPending&&((t=(a=N.variables)==null?void 0:a.payload.variantUpdates[0])==null?void 0:t.variantId)===s.id?e.jsx(d.Icon,{path:I,size:.7,className:"animate-spin"}):"Cập nhật"})]})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{className:"text-maintext",children:"Hình ảnh sản phẩm"}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{type:"file",id:`file-upload-${s.id}`,onChange:n=>{const c=n.target.files;c&&c.length>0&&(ee(c[0],s.id),n.target.value="")},accept:"image/*",className:"hidden"}),e.jsx(x,{type:"button",variant:"outline",onClick:()=>{var n;return(n=document.getElementById(`file-upload-${s.id}`))==null?void 0:n.click()},disabled:Q||g.isPending,className:"flex items-center gap-2",children:Q?e.jsxs(e.Fragment,{children:[e.jsx(d.Icon,{path:I,size:.7,className:"animate-spin"}),"Đang tải..."]}):e.jsxs(e.Fragment,{children:[e.jsx(d.Icon,{path:de,size:.7}),"Tải lên hình ảnh"]})})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-2",children:s.images.length>0?s.images.map((n,c)=>e.jsxs("div",{className:"relative group rounded-[6px] overflow-hidden border border-gray-200",style:{aspectRatio:"1/1"},children:[e.jsx("img",{src:n,alt:`Variant image ${c+1}`,className:"object-cover w-full h-full"}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-40 transition-all flex items-center justify-center",children:e.jsx(x,{type:"button",variant:"destructive",size:"icon",className:"opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>se(s.id,c),disabled:g.isPending,children:g.isPending?e.jsx(d.Icon,{path:I,size:.7,className:"animate-spin"}):e.jsx(d.Icon,{path:he,size:.7})})})]},c)):e.jsx("div",{className:"flex items-center justify-center border border-dashed border-gray-300 rounded-[6px] text-maintext",style:{aspectRatio:"1/1"},children:e.jsxs("div",{className:"flex flex-col items-center p-4",children:[e.jsx(d.Icon,{path:me,size:1.5}),e.jsx("p",{className:"text-xs mt-2",children:"Chưa có hình ảnh"})]})})})]})]})]},s.id)})})})]})}),e.jsx(O,{value:"status",className:"space-y-4 text-maintext",children:e.jsxs(f,{className:"mb-4",children:[e.jsx(S,{children:e.jsx(z,{children:"Trạng thái sản phẩm"})}),e.jsx(k,{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border rounded-[6px]",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-maintext",children:"Trạng thái hoạt động"}),e.jsx("p",{className:"text-sm text-maintext",children:i.status==="HOAT_DONG"?"Sản phẩm đang được hiển thị và có thể mua":"Sản phẩm đang bị ẩn và không thể mua"})]}),e.jsx(we,{checked:i.status==="HOAT_DONG",onCheckedChange:Y,disabled:R.isPending,className:"data-[state=checked]:bg-green-600"})]})})]})})]})]})}const Le=()=>{const{id:b}=oe();return b?e.jsx(Ie,{params:{id:b}}):e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Sửa sản phẩm"}),e.jsx("p",{className:"text-gray-600",children:"ID sản phẩm không hợp lệ"})]})};export{Le as default};
