import{j as s}from"./ui-vendor-CFM_MCUz.js";import{u as e,r as a,i as n}from"./react-vendor-B55MjJUH.js";import{b as i,e as t,f as c,g as r,h as l}from"./product-BXJPBtky.js";import{u as d,c as h}from"./cloudinary-CyDYQiY2.js";import{B as m,a as o,b as x,c as p,d as j,e as u}from"./breadcrumb-CP4jYkI2.js";import{B as g,I as y,y as v}from"./index-BHeY-5EX.js";import{C as f,a as N,c as b,b as C,e as w}from"./card-ClEzRAeX.js";import{L as I}from"./label-Bm9nFuXD.js";import{T as k}from"./textarea-DHkaMSo6.js";import{T as S,b as T,c as _,a as A}from"./tabs-z4DSy6tE.js";import{S as D}from"./switch-2xj7mmYN.js";import{S as F}from"./skeleton-4G_X8bY4.js";import{t as z,M as G,aC as V,b9 as O,aX as P,ba as H}from"./icons-vendor-BrsZP2ku.js";import{S as B,a as $,b as E,c as Q,d as K}from"./select-C6W71KWg.js";import{A as U,m as q}from"./heavy-vendor-BfN2pHnQ.js";import"./query-vendor-CBwfxcof.js";function L({params:n}){const L=e(),{id:M}=n,[R,X]=a.useState("info"),[J,W]=a.useState(!1),{data:Y,isLoading:Z,isError:ss}=i(M),es=t(),as=c(),ns=r(),is=l(),ts=d(),[cs,rs]=a.useState({});a.useEffect((()=>{if(Y&&Y.data){const s=Y.data;rs({name:s.name,brand:"string"==typeof s.brand?s.brand:s.brand.name,category:"string"==typeof s.category?s.category:s.category.name,material:"string"==typeof s.material?s.material:s.material.name,description:s.description,weight:s.weight,status:s.status})}}),[Y]);const ls=s=>{const{name:e,value:a}=s.target;rs("weight"===e?{...cs,[e]:parseFloat(a)||0}:{...cs,[e]:a})};if(Z)return s.jsxs("div",{className:"space-y-4",children:[s.jsx(m,{children:s.jsxs(o,{children:[s.jsx(x,{children:s.jsx(p,{href:"/admin/statistics",children:"Dashboard"})}),s.jsx(j,{}),s.jsx(x,{children:s.jsx(p,{href:"/admin/products",children:"Sản phẩm"})}),s.jsx(j,{}),s.jsx(x,{children:s.jsx(u,{children:"Chi tiết sản phẩm"})})]})}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx(F,{className:"h-8 w-48"}),s.jsx(F,{className:"h-10 w-28"})]}),s.jsxs(f,{children:[s.jsx(N,{children:s.jsx(F,{className:"h-7 w-40"})}),s.jsx(b,{className:"space-y-4",children:[...Array(6)].map(((e,a)=>s.jsx(F,{className:"h-12 w-full"},a)))})]})]});if(ss||!(null==Y?void 0:Y.data))return s.jsxs("div",{className:"space-y-4",children:[s.jsx(m,{children:s.jsxs(o,{children:[s.jsx(x,{children:s.jsx(p,{href:"/admin/statistics",children:"Dashboard"})}),s.jsx(j,{}),s.jsx(x,{children:s.jsx(p,{href:"/admin/products",children:"Sản phẩm"})}),s.jsx(j,{}),s.jsx(x,{children:s.jsx(u,{children:"Chi tiết sản phẩm"})})]})}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("h1",{className:"text-2xl font-bold",children:"Chi tiết sản phẩm"}),s.jsxs(g,{variant:"outline",onClick:()=>L(-1),className:"flex items-center gap-2",children:[s.jsx(z.Icon,{path:G,size:.7}),"Quay lại"]})]}),s.jsxs(f,{className:"text-center p-4",children:[s.jsx("p",{className:"text-red-500 mb-4",children:"Đã xảy ra lỗi khi tải thông tin sản phẩm."}),s.jsx(g,{variant:"outline",onClick:()=>L(-1),children:"Quay lại"})]})]});const ds=Y.data;return s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex justify-between items-start",children:[s.jsx(m,{children:s.jsxs(o,{children:[s.jsx(x,{children:s.jsx(p,{href:"/admin/statistics",children:"Dashboard"})}),s.jsx(j,{}),s.jsx(x,{children:s.jsx(p,{href:"/admin/products",children:"Quản lý sản phẩm"})}),s.jsx(j,{}),s.jsx(x,{children:s.jsx(u,{children:"Chỉnh sửa sản phẩm"})})]})}),s.jsxs(g,{variant:"outline",onClick:()=>L(-1),className:"flex items-center gap-2",children:[s.jsx(z.Icon,{path:G,size:.7}),"Quay lại"]})]}),s.jsxs(S,{value:R,onValueChange:X,className:"space-y-4",children:[s.jsxs(T,{className:"grid w-full md:w-[500px] grid-cols-3",children:[s.jsx(_,{value:"info",children:"Thông tin cơ bản"}),s.jsx(_,{value:"variants",children:"Biến thể"}),s.jsx(_,{value:"status",children:"Trạng thái"})]}),s.jsx(A,{value:"info",className:"space-y-4 text-maintext",children:s.jsxs(f,{className:"mb-4",children:[s.jsx(N,{children:s.jsx(C,{children:"Thông tin cơ bản"})}),s.jsxs("form",{onSubmit:async s=>{s.preventDefault();try{await es.mutateAsync({productId:M,payload:cs},{onSuccess:()=>{v.success("Cập nhật thông tin thành công")}})}catch(e){v.error("Cập nhật thông tin thất bại")}},children:[s.jsxs(b,{className:"space-y-4 text-maintext",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(I,{htmlFor:"name",children:"Tên sản phẩm"}),s.jsx(y,{id:"name",name:"name",value:cs.name||"",onChange:ls,placeholder:"Nhập tên sản phẩm"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(I,{htmlFor:"brand",children:"Thương hiệu"}),s.jsxs(B,{value:cs.brand||"",onValueChange:s=>rs({...cs,brand:s}),children:[s.jsx($,{children:s.jsx(E,{placeholder:"Chọn thương hiệu"})}),s.jsx(Q,{children:["Nike","Adidas","Puma","Converse","Vans"].map((e=>s.jsx(K,{value:e,children:e},e)))})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(I,{htmlFor:"category",children:"Danh mục"}),s.jsxs(B,{value:cs.category||"",onValueChange:s=>rs({...cs,category:s}),children:[s.jsx($,{children:s.jsx(E,{placeholder:"Chọn danh mục"})}),s.jsx(Q,{children:["Giày thể thao","Giày chạy bộ","Giày đá bóng","Giày thời trang"].map((e=>s.jsx(K,{value:e,children:e},e)))})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(I,{htmlFor:"material",children:"Chất liệu"}),s.jsxs(B,{value:cs.material||"",onValueChange:s=>rs({...cs,material:s}),children:[s.jsx($,{children:s.jsx(E,{placeholder:"Chọn chất liệu"})}),s.jsx(Q,{children:["Canvas","Da","Vải","Nhựa","Cao su"].map((e=>s.jsx(K,{value:e,children:e},e)))})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(I,{htmlFor:"weight",children:"Trọng lượng (gram)"}),s.jsx(y,{id:"weight",name:"weight",type:"number",min:"0",value:cs.weight||"",onChange:ls,placeholder:"Nhập trọng lượng"})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(I,{htmlFor:"description",children:"Mô tả sản phẩm"}),s.jsx(k,{id:"description",name:"description",value:cs.description||"",onChange:ls,placeholder:"Nhập mô tả sản phẩm",rows:5})]})]}),s.jsx(w,{className:"flex justify-end",children:s.jsx(g,{type:"submit",disabled:es.isPending,className:"flex items-center gap-2",children:es.isPending?s.jsxs(s.Fragment,{children:[s.jsx(z.Icon,{path:V,size:.7,className:"animate-spin"}),"Đang cập nhật..."]}):"Cập nhật thông tin"})})]})]})}),s.jsx(A,{value:"variants",className:"space-y-4 text-maintext",children:s.jsxs(f,{className:"mb-4",children:[s.jsx(N,{children:s.jsx(C,{children:"Biến thể sản phẩm"})}),s.jsx(b,{className:"space-y-4",children:s.jsx(U,{children:ds.variants.map((e=>{var a,n;return s.jsxs(q.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.2},className:"border p-4 rounded-[6px]",children:[s.jsx("div",{className:"flex justify-between items-center mb-4",children:s.jsxs("div",{children:[s.jsxs("h3",{className:"text-lg font-medium",children:[e.colorId.name," - ",e.sizeId.name]}),s.jsxs("p",{className:"text-sm text-maintext",children:["Giá: ",new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND",maximumFractionDigits:0}).format(e.price)]})]})}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:s.jsxs("div",{className:"space-y-2",children:[s.jsx(I,{htmlFor:`stock-${e.id}`,className:"text-maintext",children:"Số lượng tồn kho"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(y,{id:`stock-${e.id}`,type:"number",min:"0",defaultValue:e.stock,placeholder:"Nhập số lượng tồn kho"}),s.jsx(g,{type:"button",onClick:s=>{const a=s.currentTarget.previousElementSibling;(async(s,e)=>{const a={variantUpdates:[{variantId:s,stock:e}]};try{await ns.mutateAsync({productId:M,payload:a},{onSuccess:()=>{v.success("Cập nhật số lượng tồn kho thành công")}})}catch(n){v.error("Cập nhật số lượng tồn kho thất bại")}})(e.id,parseInt(a.value)||0)},disabled:ns.isPending,children:ns.isPending&&(null==(n=null==(a=ns.variables)?void 0:a.payload.variantUpdates[0])?void 0:n.variantId)===e.id?s.jsx(z.Icon,{path:V,size:.7,className:"animate-spin"}):"Cập nhật"})]})]})}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(I,{className:"text-maintext",children:"Hình ảnh sản phẩm"}),s.jsxs("div",{className:"flex flex-col gap-4",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(y,{type:"file",id:`file-upload-${e.id}`,onChange:s=>{const a=s.target.files;a&&a.length>0&&((async(s,e)=>{var a;try{W(!0);const n=h(s),i=await ts.mutateAsync(n),t=null==Y?void 0:Y.data.variants.find((s=>s.id===e));if(!t)return void v.error("Không tìm thấy biến thể");const c=[...t.images,null==(a=null==i?void 0:i.data)?void 0:a.imageUrl],r={variantId:e,images:c};await is.mutateAsync({productId:M,payload:r},{onSuccess:()=>{v.success("Cập nhật hình ảnh thành công")}})}catch(n){v.error("Cập nhật hình ảnh thất bại")}finally{W(!1)}})(a[0],e.id),s.target.value="")},accept:"image/*",className:"hidden"}),s.jsx(g,{type:"button",variant:"outline",onClick:()=>{var s;return null==(s=document.getElementById(`file-upload-${e.id}`))?void 0:s.click()},disabled:J||is.isPending,className:"flex items-center gap-2",children:J?s.jsxs(s.Fragment,{children:[s.jsx(z.Icon,{path:V,size:.7,className:"animate-spin"}),"Đang tải..."]}):s.jsxs(s.Fragment,{children:[s.jsx(z.Icon,{path:O,size:.7}),"Tải lên hình ảnh"]})})]}),s.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-2",children:e.images.length>0?e.images.map(((a,n)=>s.jsxs("div",{className:"relative group rounded-[6px] overflow-hidden border border-gray-200",style:{aspectRatio:"1/1"},children:[s.jsx("img",{src:a,alt:`Variant image ${n+1}`,className:"object-cover w-full h-full"}),s.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-40 transition-all flex items-center justify-center",children:s.jsx(g,{type:"button",variant:"destructive",size:"icon",className:"opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>(async(s,e)=>{try{const a=null==Y?void 0:Y.data.variants.find((e=>e.id===s));if(!a)return void v.error("Không tìm thấy biến thể");const n=a.images.filter(((s,a)=>a!==e)),i={variantId:s,images:n};await is.mutateAsync({productId:M,payload:i},{onSuccess:()=>{v.success("Cập nhật hình ảnh thành công")}})}catch(a){v.error("Cập nhật hình ảnh thất bại")}})(e.id,n),disabled:is.isPending,children:is.isPending?s.jsx(z.Icon,{path:V,size:.7,className:"animate-spin"}):s.jsx(z.Icon,{path:P,size:.7})})})]},n))):s.jsx("div",{className:"flex items-center justify-center border border-dashed border-gray-300 rounded-[6px] text-maintext",style:{aspectRatio:"1/1"},children:s.jsxs("div",{className:"flex flex-col items-center p-4",children:[s.jsx(z.Icon,{path:H,size:1.5}),s.jsx("p",{className:"text-xs mt-2",children:"Chưa có hình ảnh"})]})})})]})]})]},e.id)}))})})]})}),s.jsx(A,{value:"status",className:"space-y-4 text-maintext",children:s.jsxs(f,{className:"mb-4",children:[s.jsx(N,{children:s.jsx(C,{children:"Trạng thái sản phẩm"})}),s.jsx(b,{className:"space-y-4",children:s.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border rounded-[6px]",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium text-maintext",children:"Trạng thái hoạt động"}),s.jsx("p",{className:"text-sm text-maintext",children:"HOAT_DONG"===cs.status?"Sản phẩm đang được hiển thị và có thể mua":"Sản phẩm đang bị ẩn và không thể mua"})]}),s.jsx(D,{checked:"HOAT_DONG"===cs.status,onCheckedChange:async s=>{const e=s?"HOAT_DONG":"KHONG_HOAT_DONG",a={status:e};try{await as.mutateAsync({productId:M,payload:a},{onSuccess:()=>{v.success("Cập nhật trạng thái thành công"),rs({...cs,status:e})}})}catch(n){v.error("Cập nhật trạng thái thất bại")}},disabled:as.isPending,className:"data-[state=checked]:bg-green-600"})]})})]})})]})]})}const M=()=>{const{id:e}=n();return e?s.jsx(L,{params:{id:e}}):s.jsxs("div",{className:"container mx-auto px-4 py-8",children:[s.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Sửa sản phẩm"}),s.jsx("p",{className:"text-gray-600",children:"ID sản phẩm không hợp lệ"})]})};export{M as default};
