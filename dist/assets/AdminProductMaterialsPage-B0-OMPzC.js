import{j as e}from"./ui-vendor-CFM_MCUz.js";import{r as s}from"./react-vendor-B55MjJUH.js";import{C as a,c as t}from"./card-ClEzRAeX.js";import{S as i}from"./skeleton-4G_X8bY4.js";import{t as n,ad as l,a5 as r,aL as c,aM as x}from"./icons-vendor-BrsZP2ku.js";import{I as d,B as h,y as m}from"./index-BHeY-5EX.js";import{p as o,q as u,r as j,s as p,t as g}from"./attributes-DYSh1UfM.js";import{d as N}from"./query-vendor-CBwfxcof.js";import{B as y,a as v,b as f,c as w,d as C,e as D}from"./breadcrumb-CP4jYkI2.js";import{T,a as b,b as O,c as H,d as _,e as S}from"./table-DL-K3PV4.js";import{S as k,a as A,b as G,c as K,d as I}from"./select-C6W71KWg.js";import{L as q}from"./label-Bm9nFuXD.js";import"./heavy-vendor-BfN2pHnQ.js";function F(){const[j,p]=s.useState(""),[g,q]=s.useState({}),[F,z]=s.useState(!1),{data:E,isLoading:V,isError:P}=o(g),X=u(),B=N(),[M,J]=s.useState(!1),[R,U]=s.useState(null),[W,Y]=s.useState(!1),[Z,$]=s.useState(null),[ee,se]=s.useState(!1),ae=s.useMemo((()=>{if(!(null==E?void 0:E.data)||!j.trim())return null==E?void 0:E.data;const e=j.toLowerCase().trim();return E.data.filter((s=>s.name.toLowerCase().includes(e)))}),[null==E?void 0:E.data,j]);return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-between items-start",children:e.jsx(y,{children:e.jsxs(v,{children:[e.jsx(f,{children:e.jsx(w,{href:"/admin/statistics",children:"Dashboard"})}),e.jsx(C,{}),e.jsx(f,{children:e.jsx(w,{href:"/admin/products",children:"Quản lý sản phẩm"})}),e.jsx(C,{}),e.jsx(f,{children:e.jsx(D,{children:"Chất liệu"})})]})})}),e.jsx(a,{className:"mb-4",children:e.jsx(t,{className:"py-4",children:e.jsxs("div",{className:"flex flex-col space-y-4 md:space-y-0 md:flex-row md:justify-between md:items-center",children:[e.jsxs("div",{className:"relative flex-1 max-w-4xl",children:[e.jsx(n.Icon,{path:l,size:.7,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-maintext"}),e.jsx(d,{type:"text",placeholder:"Tìm kiếm theo tên chất liệu...",className:"pl-10 pr-4 py-2 w-full border rounded-[6px]",value:j,onChange:e=>p(e.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(k,{value:g.status||"all",onValueChange:e=>((e,s)=>{if("all"===s||""===s){const s={...g};delete s[e],q(s)}else q({...g,[e]:s})})("status",e),children:[e.jsx(A,{children:e.jsx(G,{placeholder:"Tất cả trạng thái"})}),e.jsxs(K,{children:[e.jsx(I,{value:"all",children:"Tất cả trạng thái"}),e.jsx(I,{value:"HOAT_DONG",children:"Hoạt động"}),e.jsx(I,{value:"KHONG_HOAT_DONG",children:"Không hoạt động"})]})]}),e.jsxs(Dialog,{open:ee,onOpenChange:se,children:[e.jsx(DialogTrigger,{asChild:!0,children:e.jsxs(h,{onClick:()=>se(!0),children:[e.jsx(n.Icon,{path:r,size:.7}),"Thêm chất liệu mới"]})}),e.jsx(Q,{isOpen:ee,onClose:()=>se(!1)})]})]})]})})}),V?e.jsx("div",{className:"bg-white rounded-[6px] shadow-sm overflow-visible",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(T,{children:[e.jsx(b,{children:e.jsxs(O,{children:[e.jsx(H,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"ID"}),e.jsx(H,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"Tên chất liệu"}),e.jsx(H,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"Trạng thái"}),e.jsx(H,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"Ngày cập nhật"}),e.jsx(H,{className:"px-4 py-4 text-right text-sm font-medium text-maintext",children:"Thao tác"})]})}),e.jsx(_,{children:[...Array(5)].map(((s,a)=>e.jsxs(O,{children:[e.jsx(S,{className:"px-4 py-4 whitespace-nowrap",children:e.jsx(i,{className:"h-4 w-[80px]"})}),e.jsx(S,{className:"px-4 py-4 whitespace-nowrap",children:e.jsx(i,{className:"h-4 w-[160px]"})}),e.jsx(S,{className:"px-4 py-4 whitespace-nowrap",children:e.jsx(i,{className:"h-6 w-[100px] rounded-full"})}),e.jsx(S,{className:"px-4 py-4 whitespace-nowrap",children:e.jsx(i,{className:"h-4 w-[100px]"})}),e.jsx(S,{className:"px-4 py-4 whitespace-nowrap text-right",children:e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsx(i,{className:"h-8 w-8 rounded-[6px]"}),e.jsx(i,{className:"h-8 w-8 rounded-[6px]"})]})})]},a)))})]})})}):P?e.jsxs("div",{className:"bg-white rounded-[6px] shadow-sm p-4 text-center",children:[e.jsx("p",{className:"text-red-500",children:"Đã xảy ra lỗi khi tải dữ liệu. Vui lòng thử lại sau."}),e.jsx(h,{variant:"outline",className:"mt-4",onClick:()=>B.invalidateQueries({queryKey:["materials"]}),children:"Thử lại"})]}):e.jsx("div",{className:"bg-white rounded-[6px] shadow-sm overflow-visible",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(T,{children:[e.jsx(b,{children:e.jsxs(O,{children:[e.jsx(H,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"ID"}),e.jsx(H,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"Tên chất liệu"}),e.jsx(H,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"Trạng thái"}),e.jsx(H,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"Ngày cập nhật"}),e.jsx(H,{className:"px-4 py-4 text-right text-sm font-medium text-maintext",children:"Thao tác"})]})}),e.jsx(_,{children:(null==ae?void 0:ae.length)?ae.map((s=>{return e.jsxs(O,{className:"hover:bg-gray-50",children:[e.jsx(S,{className:"px-4 py-4 whitespace-nowrap text-sm text-maintext",children:s._id}),e.jsx(S,{className:"px-4 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-maintext",children:s.name})}),e.jsx(S,{className:"px-4 py-4 whitespace-nowrap",children:e.jsx("span",{className:"px-2 py-1 text-xs rounded-full "+("HOAT_DONG"===s.status?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:"HOAT_DONG"===s.status?"Hoạt động":"Không hoạt động"})}),e.jsx(S,{className:"px-4 py-4 whitespace-nowrap text-sm text-maintext",children:(a=s.updatedAt,new Intl.DateTimeFormat("vi-VN",{day:"2-digit",month:"2-digit",year:"numeric"}).format(new Date(a)))}),e.jsx(S,{className:"px-4 py-4 whitespace-nowrap text-right",children:e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsxs(Dialog,{open:W&&Z===s._id,onOpenChange:e=>{Y(e),e||$(null)},children:[e.jsx(DialogTrigger,{asChild:!0,children:e.jsx(h,{variant:"outline",size:"icon",title:"Sửa",onClick:()=>{$(s._id),Y(!0)},children:e.jsx(n.Icon,{path:c,size:.7})})}),Z===s._id&&e.jsx(L,{materialId:s._id,isOpen:W,onClose:()=>{Y(!1),$(null)}})]}),e.jsxs(Dialog,{open:M&&R===s._id,onOpenChange:J,children:[e.jsx(DialogTrigger,{asChild:!0,children:e.jsx(h,{variant:"outline",size:"icon",onClick:()=>{U(s._id),J(!0)},title:"Xóa",children:e.jsx(n.Icon,{path:x,size:.7})})}),e.jsxs(DialogContent,{children:[e.jsx(DialogHeader,{children:e.jsx(DialogTitle,{children:"Xác nhận xóa chất liệu"})}),e.jsx("p",{children:"Bạn có chắc chắn muốn xóa chất liệu này không?"}),e.jsxs(DialogFooter,{children:[e.jsx(DialogClose,{asChild:!0,children:e.jsx(h,{variant:"outline",onClick:()=>J(!1),children:"Hủy"})}),e.jsx(h,{variant:"destructive",onClick:()=>{R&&((async e=>{try{await X.mutateAsync(e,{onSuccess:()=>{m.success("Đã xóa chất liệu thành công"),B.invalidateQueries({queryKey:["materials"]})}})}catch(s){m.error("Xóa chất liệu thất bại")}})(R),J(!1))},children:"Xóa"})]})]})]})]})})]},s._id);var a})):e.jsx(O,{children:e.jsx(S,{colSpan:5,className:"px-4 py-8 text-center text-maintext",children:"Không tìm thấy chất liệu nào"})})})]})})})]})}function L({materialId:a,isOpen:t,onClose:n}){const l=N(),{data:r,isLoading:c,isError:x}=p(a),o=g(),[u,j]=s.useState({name:"",status:"HOAT_DONG"}),[y,v]=s.useState({name:""});s.useEffect((()=>{(null==r?void 0:r.data)&&j({name:r.data.name,status:r.data.status})}),[r]);return c?e.jsxs(DialogContent,{className:"sm:max-w-4xl",children:[e.jsx(DialogHeader,{children:e.jsx(DialogTitle,{children:e.jsx(i,{className:"h-8 w-[200px]"})})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{className:"h-4 w-[100px]"}),e.jsx(i,{className:"h-10 w-full"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{className:"h-4 w-[100px]"}),e.jsx(i,{className:"h-10 w-full"})]}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx(i,{className:"h-10 w-[100px]"}),e.jsx(i,{className:"h-10 w-[150px]"})]})]})]}):x||!r?e.jsxs(DialogContent,{className:"sm:max-w-4xl",children:[e.jsx(DialogHeader,{children:e.jsx(DialogTitle,{children:"Lỗi"})}),e.jsxs("div",{className:"py-4 text-center",children:[e.jsx("p",{className:"text-red-500 mb-4",children:"Đã xảy ra lỗi khi tải dữ liệu chất liệu."}),e.jsxs("div",{className:"flex justify-center space-x-4",children:[e.jsx(h,{variant:"outline",onClick:n,children:"Đóng"}),e.jsx(h,{onClick:()=>l.invalidateQueries({queryKey:["material",a]}),children:"Thử lại"})]})]})]}):e.jsxs(DialogContent,{className:"sm:max-w-4xl",children:[e.jsx(DialogHeader,{children:e.jsxs(DialogTitle,{children:["Chỉnh sửa chất liệu: ",r.data.name]})}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),(()=>{let e=!0;const s={...y};return u.name.trim()||(s.name="Tên chất liệu không được để trống",e=!1),v(s),e})())try{await o.mutateAsync({materialId:a,payload:u},{onSuccess:()=>{m.success("Cập nhật chất liệu thành công"),l.invalidateQueries({queryKey:["material",a]}),l.invalidateQueries({queryKey:["materials"]}),n()},onError:e=>{m.error("Cập nhật chất liệu thất bại: "+e.message)}})}catch(s){m.error("Đã xảy ra lỗi khi cập nhật chất liệu")}},className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"name",children:"Tên chất liệu"}),e.jsx(d,{id:"name",name:"name",placeholder:"Nhập tên chất liệu",value:u.name,onChange:e=>{const{name:s,value:a}=e.target;j((e=>({...e,[s]:a}))),y[s]&&v((e=>({...e,[s]:""})))},className:y.name?"border-red-500":""}),y.name&&e.jsx("p",{className:"text-red-500 text-sm",children:y.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"status",children:"Trạng thái"}),e.jsxs(k,{value:u.status,onValueChange:e=>{j((s=>({...s,status:e})))},children:[e.jsx(A,{id:"status",children:e.jsx(G,{placeholder:"Chọn trạng thái"})}),e.jsxs(K,{children:[e.jsx(I,{value:"HOAT_DONG",children:"Hoạt động"}),e.jsx(I,{value:"KHONG_HOAT_DONG",children:"Không hoạt động"})]})]})]}),e.jsxs(DialogFooter,{children:[e.jsx(h,{type:"button",variant:"outline",onClick:n,children:"Hủy"}),e.jsx(h,{type:"submit",disabled:o.isPending,children:o.isPending?"Đang xử lý...":"Cập nhật chất liệu"})]})]})]})}function Q({isOpen:a,onClose:t}){const i=N(),n=j(),[l,r]=s.useState({name:"",status:"HOAT_DONG"}),[c,x]=s.useState({name:""});return e.jsxs(DialogContent,{className:"sm:max-w-4xl",children:[e.jsx(DialogHeader,{children:e.jsx(DialogTitle,{children:"Thêm chất liệu mới"})}),e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),(()=>{let e=!0;const s={...c};return l.name.trim()||(s.name="Tên chất liệu không được để trống",e=!1),x(s),e})())try{await n.mutateAsync(l,{onSuccess:()=>{m.success("Thêm chất liệu thành công"),i.invalidateQueries({queryKey:["materials"]}),r({name:"",status:"HOAT_DONG"}),t()},onError:e=>{m.error("Thêm chất liệu thất bại: "+e.message)}})}catch(s){}},className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"create-name",children:"Tên chất liệu"}),e.jsx(d,{id:"create-name",name:"name",placeholder:"Nhập tên chất liệu",value:l.name,onChange:e=>{const{name:s,value:a}=e.target;r((e=>({...e,[s]:a}))),c[s]&&x((e=>({...e,[s]:""})))},className:c.name?"border-red-500":""}),c.name&&e.jsx("p",{className:"text-red-500 text-sm",children:c.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{htmlFor:"create-status",children:"Trạng thái"}),e.jsxs(k,{value:l.status,onValueChange:e=>{r((s=>({...s,status:e})))},children:[e.jsx(A,{id:"create-status",children:e.jsx(G,{placeholder:"Chọn trạng thái"})}),e.jsxs(K,{children:[e.jsx(I,{value:"HOAT_DONG",children:"Hoạt động"}),e.jsx(I,{value:"KHONG_HOAT_DONG",children:"Không hoạt động"})]})]})]}),e.jsxs(DialogFooter,{children:[e.jsx(h,{type:"button",variant:"outline",onClick:t,children:"Hủy"}),e.jsx(h,{type:"submit",disabled:n.isPending,children:n.isPending?"Đang xử lý...":"Thêm chất liệu"})]})]})]})}const z=()=>e.jsx(F,{});export{z as default};
