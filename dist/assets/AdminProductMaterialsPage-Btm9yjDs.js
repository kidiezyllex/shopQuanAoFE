import{a as c,aJ as Q,j as e,k as G,ao as ae,q as L,B as x,aa as ne,a2 as r,bg as ie,bh as le,a6 as w}from"./index-Dpx_4rWJ.js";import{C as ce,c as re}from"./card-fT6uSY2F.js";import{p as he,q as xe,r as de,s as oe,t as me}from"./attributes-Bjak6hx3.js";import{B as ue,a as pe,b as q,c as J,d as U,e as je}from"./breadcrumb-CJedQ5QG.js";import{T as W,a as Y,b as A,c as g,d as Z,e as d}from"./table-BeX0puEz.js";import{S as V,a as z,b as X,c as R,d as C}from"./select-CS4vNzI5.js";import{L as I}from"./label-B0XdI4bT.js";import{D as B,h as P,a as E,b as M,c as F,e as $,i as ge}from"./dialog-BuHyDe_9.js";import"./createLucideIcon-BdgKQErZ.js";import"./index-BdQq_4o_.js";import"./index-qvEK80KO.js";import"./check-CyKb8IHM.js";function fe(){const[o,O]=c.useState(""),[m,u]=c.useState({}),[i,b]=c.useState(!1),{data:t,isLoading:f,isError:N}=he(m),v=xe(),p=Q(),[T,n]=c.useState(!1),[a,S]=c.useState(null),[y,h]=c.useState(!1),[l,H]=c.useState(null),[D,K]=c.useState(!1),_=c.useMemo(()=>{if(!(t!=null&&t.data)||!o.trim())return t==null?void 0:t.data;const s=o.toLowerCase().trim();return t.data.filter(j=>j.name.toLowerCase().includes(s))},[t==null?void 0:t.data,o]),ee=(s,j)=>{if(j==="all"||j===""){const k={...m};delete k[s],u(k)}else u({...m,[s]:j})},se=async s=>{try{await v.mutateAsync(s,{onSuccess:()=>{w.success("Đã xóa chất liệu thành công"),p.invalidateQueries({queryKey:["materials"]})}})}catch{w.error("Xóa chất liệu thất bại")}},te=s=>new Intl.DateTimeFormat("vi-VN",{day:"2-digit",month:"2-digit",year:"numeric"}).format(new Date(s));return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-between items-start",children:e.jsx(ue,{children:e.jsxs(pe,{children:[e.jsx(q,{children:e.jsx(J,{href:"/admin/statistics",children:"Dashboard"})}),e.jsx(U,{}),e.jsx(q,{children:e.jsx(J,{href:"/admin/products",children:"Quản lý sản phẩm"})}),e.jsx(U,{}),e.jsx(q,{children:e.jsx(je,{children:"Chất liệu"})})]})})}),e.jsx(ce,{className:"mb-4",children:e.jsx(re,{className:"py-4",children:e.jsxs("div",{className:"flex flex-col space-y-4 md:space-y-0 md:flex-row md:justify-between md:items-center gap-2 gap-2",children:[e.jsxs("div",{className:"relative flex-1 max-w-4xl",children:[e.jsx(G.Icon,{path:ae,size:.7,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-maintext"}),e.jsx(L,{type:"text",placeholder:"Tìm kiếm theo tên chất liệu...",className:"pl-10 pr-4 py-2 w-full border rounded-[6px]",value:o,onChange:s=>O(s.target.value)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(V,{value:m.status||"all",onValueChange:s=>ee("status",s),children:[e.jsx(z,{children:e.jsx(X,{placeholder:"Tất cả trạng thái"})}),e.jsxs(R,{children:[e.jsx(C,{value:"all",children:"Tất cả trạng thái"}),e.jsx(C,{value:"HOAT_DONG",children:"Hoạt động"}),e.jsx(C,{value:"KHONG_HOAT_DONG",children:"Không hoạt động"})]})]}),e.jsxs(B,{open:D,onOpenChange:K,children:[e.jsx(P,{asChild:!0,children:e.jsxs(x,{onClick:()=>K(!0),children:[e.jsx(G.Icon,{path:ne,size:.7}),"Thêm chất liệu mới"]})}),e.jsx(ye,{isOpen:D,onClose:()=>K(!1)})]})]})]})})}),f?e.jsx("div",{className:"bg-white rounded-[6px] shadow-sm overflow-visible",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(W,{children:[e.jsx(Y,{children:e.jsxs(A,{children:[e.jsx(g,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"ID"}),e.jsx(g,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"Tên chất liệu"}),e.jsx(g,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"Trạng thái"}),e.jsx(g,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"Ngày cập nhật"}),e.jsx(g,{className:"px-4 py-4 text-right text-sm font-medium text-maintext",children:"Thao tác"})]})}),e.jsx(Z,{children:[...Array(5)].map((s,j)=>e.jsxs(A,{children:[e.jsx(d,{className:"px-4 py-4 whitespace-nowrap",children:e.jsx(r,{className:"h-4 w-[80px]"})}),e.jsx(d,{className:"px-4 py-4 whitespace-nowrap",children:e.jsx(r,{className:"h-4 w-[160px]"})}),e.jsx(d,{className:"px-4 py-4 whitespace-nowrap",children:e.jsx(r,{className:"h-6 w-[100px] rounded-full"})}),e.jsx(d,{className:"px-4 py-4 whitespace-nowrap",children:e.jsx(r,{className:"h-4 w-[100px]"})}),e.jsx(d,{className:"px-4 py-4 whitespace-nowrap text-right",children:e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsx(r,{className:"h-8 w-8 rounded-[6px]"}),e.jsx(r,{className:"h-8 w-8 rounded-[6px]"})]})})]},j))})]})})}):N?e.jsxs("div",{className:"bg-white rounded-[6px] shadow-sm p-4 text-center",children:[e.jsx("p",{className:"text-red-500",children:"Đã xảy ra lỗi khi tải dữ liệu. Vui lòng thử lại sau."}),e.jsx(x,{variant:"outline",className:"mt-4",onClick:()=>p.invalidateQueries({queryKey:["materials"]}),children:"Thử lại"})]}):e.jsx("div",{className:"bg-white rounded-[6px] shadow-sm overflow-visible",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(W,{children:[e.jsx(Y,{children:e.jsxs(A,{children:[e.jsx(g,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"ID"}),e.jsx(g,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"Tên chất liệu"}),e.jsx(g,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"Trạng thái"}),e.jsx(g,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"Ngày cập nhật"}),e.jsx(g,{className:"px-4 py-4 text-right text-sm font-medium text-maintext",children:"Thao tác"})]})}),e.jsx(Z,{children:_!=null&&_.length?_.map((s,j)=>e.jsxs(A,{className:"hover:bg-gray-50",children:[e.jsx(d,{className:"px-4 py-4 whitespace-nowrap text-sm text-maintext",children:s==null?void 0:s.id}),e.jsx(d,{className:"px-4 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-maintext",children:s.name})}),e.jsx(d,{className:"px-4 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${s.status==="HOAT_DONG"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:s.status==="HOAT_DONG"?"Hoạt động":"Không hoạt động"})}),e.jsx(d,{className:"px-4 py-4 whitespace-nowrap text-sm text-maintext",children:te(s.updatedAt)}),e.jsx(d,{className:"px-4 py-4 whitespace-nowrap text-right",children:e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsxs(B,{open:y&&l===(s==null?void 0:s.id),onOpenChange:k=>{h(k),k||H(null)},children:[e.jsx(P,{asChild:!0,children:e.jsx(x,{variant:"outline",size:"icon",title:"Sửa",onClick:()=>{H(s==null?void 0:s.id),h(!0)},children:e.jsx(G.Icon,{path:ie,size:.7})})}),l===(s==null?void 0:s.id)&&e.jsx(Ne,{materialId:s==null?void 0:s.id,isOpen:y,onClose:()=>{h(!1),H(null)}})]}),e.jsxs(B,{open:T&&a===(s==null?void 0:s.id),onOpenChange:n,children:[e.jsx(P,{asChild:!0,children:e.jsx(x,{variant:"outline",size:"icon",onClick:()=>{S(s==null?void 0:s.id),n(!0)},title:"Xóa",children:e.jsx(G.Icon,{path:le,size:.7})})}),e.jsxs(E,{children:[e.jsx(M,{children:e.jsx(F,{children:"Xác nhận xóa chất liệu"})}),e.jsx("p",{children:"Bạn có chắc chắn muốn xóa chất liệu này không?"}),e.jsxs($,{children:[e.jsx(ge,{asChild:!0,children:e.jsx(x,{variant:"outline",onClick:()=>n(!1),children:"Hủy"})}),e.jsx(x,{variant:"destructive",onClick:()=>{a&&(se(a),n(!1))},children:"Xóa"})]})]})]})]})})]},(s==null?void 0:s.id)||`material-${j}`)):e.jsx(A,{children:e.jsx(d,{colSpan:5,className:"px-4 py-8 text-center text-maintext",children:"Không tìm thấy chất liệu nào"})})})]})})})]})}function Ne({materialId:o,isOpen:O,onClose:m}){const u=Q(),{data:i,isLoading:b,isError:t}=oe(o),f=me(),[N,v]=c.useState({name:"",status:"HOAT_DONG"}),[p,T]=c.useState({name:""});c.useEffect(()=>{i!=null&&i.data&&v({name:i.data.name,status:i.data.status})},[i]);const n=h=>{const{name:l,value:H}=h.target;v(D=>({...D,[l]:H})),p[l]&&T(D=>({...D,[l]:""}))},a=h=>{v(l=>({...l,status:h}))},S=()=>{let h=!0;const l={...p};return N.name.trim()||(l.name="Tên chất liệu không được để trống",h=!1),T(l),h},y=async h=>{if(h.preventDefault(),!!S())try{await f.mutateAsync({materialId:o,payload:N},{onSuccess:()=>{w.success("Cập nhật chất liệu thành công"),u.invalidateQueries({queryKey:["material",o]}),u.invalidateQueries({queryKey:["materials"]}),m()},onError:l=>{w.error("Cập nhật chất liệu thất bại: "+l.message)}})}catch{w.error("Đã xảy ra lỗi khi cập nhật chất liệu")}};return b?e.jsxs(E,{className:"sm:max-w-4xl",children:[e.jsx(M,{children:e.jsx(F,{children:e.jsx(r,{className:"h-8 w-[200px]"})})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{className:"h-4 w-[100px]"}),e.jsx(r,{className:"h-10 w-full"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{className:"h-4 w-[100px]"}),e.jsx(r,{className:"h-10 w-full"})]}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx(r,{className:"h-10 w-[100px]"}),e.jsx(r,{className:"h-10 w-[150px]"})]})]})]}):t||!i?e.jsxs(E,{className:"sm:max-w-4xl",children:[e.jsx(M,{children:e.jsx(F,{children:"Lỗi"})}),e.jsxs("div",{className:"py-4 text-center",children:[e.jsx("p",{className:"text-red-500 mb-4",children:"Đã xảy ra lỗi khi tải dữ liệu chất liệu."}),e.jsxs("div",{className:"flex justify-center space-x-4",children:[e.jsx(x,{variant:"outline",onClick:m,children:"Đóng"}),e.jsx(x,{onClick:()=>u.invalidateQueries({queryKey:["material",o]}),children:"Thử lại"})]})]})]}):e.jsxs(E,{className:"sm:max-w-4xl",children:[e.jsx(M,{children:e.jsxs(F,{children:["Chỉnh sửa chất liệu: ",i.data.name]})}),e.jsxs("form",{onSubmit:y,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{htmlFor:"name",children:"Tên chất liệu"}),e.jsx(L,{id:"name",name:"name",placeholder:"Nhập tên chất liệu",value:N.name,onChange:n,className:p.name?"border-red-500":""}),p.name&&e.jsx("p",{className:"text-red-500 text-sm",children:p.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{htmlFor:"status",children:"Trạng thái"}),e.jsxs(V,{value:N.status,onValueChange:a,children:[e.jsx(z,{id:"status",children:e.jsx(X,{placeholder:"Chọn trạng thái"})}),e.jsxs(R,{children:[e.jsx(C,{value:"HOAT_DONG",children:"Hoạt động"}),e.jsx(C,{value:"KHONG_HOAT_DONG",children:"Không hoạt động"})]})]})]}),e.jsxs($,{children:[e.jsx(x,{type:"button",variant:"outline",onClick:m,children:"Hủy"}),e.jsx(x,{type:"submit",disabled:f.isPending,children:f.isPending?"Đang xử lý...":"Cập nhật chất liệu"})]})]})]})}function ye({isOpen:o,onClose:O}){const m=Q(),u=de(),[i,b]=c.useState({name:"",status:"HOAT_DONG"}),[t,f]=c.useState({name:""}),N=n=>{const{name:a,value:S}=n.target;b(y=>({...y,[a]:S})),t[a]&&f(y=>({...y,[a]:""}))},v=n=>{b(a=>({...a,status:n}))},p=()=>{let n=!0;const a={...t};return i.name.trim()||(a.name="Tên chất liệu không được để trống",n=!1),f(a),n},T=async n=>{if(n.preventDefault(),!!p())try{await u.mutateAsync(i,{onSuccess:()=>{w.success("Thêm chất liệu thành công"),m.invalidateQueries({queryKey:["materials"]}),b({name:"",status:"HOAT_DONG"}),O()},onError:a=>{w.error("Thêm chất liệu thất bại: "+a.message)}})}catch(a){console.error(a)}};return e.jsxs(E,{className:"sm:max-w-4xl",children:[e.jsx(M,{children:e.jsx(F,{children:"Thêm chất liệu mới"})}),e.jsxs("form",{onSubmit:T,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{htmlFor:"create-name",children:"Tên chất liệu"}),e.jsx(L,{id:"create-name",name:"name",placeholder:"Nhập tên chất liệu",value:i.name,onChange:N,className:t.name?"border-red-500":""}),t.name&&e.jsx("p",{className:"text-red-500 text-sm",children:t.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{htmlFor:"create-status",children:"Trạng thái"}),e.jsxs(V,{value:i.status,onValueChange:v,children:[e.jsx(z,{id:"create-status",children:e.jsx(X,{placeholder:"Chọn trạng thái"})}),e.jsxs(R,{children:[e.jsx(C,{value:"HOAT_DONG",children:"Hoạt động"}),e.jsx(C,{value:"KHONG_HOAT_DONG",children:"Không hoạt động"})]})]})]}),e.jsxs($,{children:[e.jsx(x,{type:"button",variant:"outline",onClick:O,children:"Hủy"}),e.jsx(x,{type:"submit",disabled:u.isPending,children:u.isPending?"Đang xử lý...":"Thêm chất liệu"})]})]})]})}const Me=()=>e.jsx(fe,{});export{Me as default};
