import{j as e}from"./ui-vendor-CFM_MCUz.js";import{u as s,r as i}from"./react-vendor-B55MjJUH.js";import{C as t,a,b as n,c as r}from"./card-ClEzRAeX.js";import{B as c,I as d,y as l}from"./index-BHeY-5EX.js";import{L as o}from"./label-Bm9nFuXD.js";import{T as h}from"./textarea-DHkaMSo6.js";import{B as m,a as x,b as p,c as u,d as j,e as g}from"./breadcrumb-CP4jYkI2.js";import{t as v}from"./icons-vendor-BrsZP2ku.js";import{b as f}from"./promotion-DDJnNtmQ.js";import{u as y}from"./product-BXJPBtky.js";import{C as N}from"./checkbox-4N58UvKV.js";import{B as b}from"./badge-BeHegjHt.js";import{m as D}from"./heavy-vendor-BfN2pHnQ.js";import"./query-vendor-CBwfxcof.js";function T(){var T,k;const C=s(),w=f(),{data:P}=y({limit:100,status:"HOAT_DONG"}),[S,I]=i.useState({name:"",description:"",discountPercent:0,products:[],startDate:"",endDate:""}),[F,_]=i.useState([]),[q,A]=i.useState(!0),L=(e,s)=>{I((i=>({...i,[e]:s})))};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(m,{children:e.jsxs(x,{children:[e.jsx(p,{children:e.jsx(u,{href:"/admin/statistics",children:"Dashboard"})}),e.jsx(j,{}),e.jsx(p,{children:e.jsx(u,{href:"/admin/discounts",children:"Quản lý khuyến mãii"})}),e.jsx(j,{}),e.jsx(p,{children:e.jsx(u,{href:"/admin/discounts/promotions",children:"Chiến dịch khuyến mãi"})}),e.jsx(j,{}),e.jsx(p,{children:e.jsx(g,{children:"Tạo mới"})})]})}),e.jsxs(c,{variant:"outline",onClick:()=>C(-1),className:"flex items-center gap-2",children:[e.jsx(v.Icon,{path:mdiArrowLeft,size:.7}),"Quay lại"]})]}),e.jsx(D.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:e.jsxs(t,{children:[e.jsx(a,{children:e.jsxs(n,{className:"flex items-center gap-2",children:[e.jsx(v.Icon,{path:mdiPercent,size:1,className:"text-primary"}),"Tạo chiến dịch khuyến mãi mới"]})}),e.jsx(r,{children:e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),!S.name.trim())return void l.error("Vui lòng nhập tên chiến dịch");if(S.discountPercent<=0||S.discountPercent>100)return void l.error("Phần trăm giảm giá phải từ 1% đến 100%");if(!S.startDate||!S.endDate)return void l.error("Vui lòng chọn thời gian bắt đầu và kết thúc");const s=new Date,i=new Date(S.startDate),t=new Date(S.endDate);if(i<=s)return void l.error("Thời gian bắt đầu phải sau thời điểm hiện tại");if(t<=s)return void l.error("Thời gian kết thúc phải sau thời điểm hiện tại");if(i>=t)return void l.error("Thời gian kết thúc phải sau thời gian bắt đầu");const a={...S,products:q?[]:F};try{await w.mutateAsync(a,{onSuccess:()=>{l.success("Tạo chiến dịch khuyến mãi thành công"),C("/admin/discounts/promotions")}})}catch(n){l.error("Tạo chiến dịch khuyến mãi thất bại")}},className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"name",children:"Tên chiến dịch *"}),e.jsx(d,{id:"name",value:S.name,onChange:e=>L("name",e.target.value),placeholder:"Nhập tên chiến dịch khuyến mãi",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"discountPercent",children:"Phần trăm giảm giá (%) *"}),e.jsx(d,{id:"discountPercent",type:"number",min:"1",max:"100",value:S.discountPercent,onChange:e=>L("discountPercent",parseInt(e.target.value)||0),placeholder:"Nhập phần trăm giảm giá",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"description",children:"Mô tả"}),e.jsx(h,{id:"description",value:S.description,onChange:e=>L("description",e.target.value),placeholder:"Nhập mô tả cho chiến dịch khuyến mãi",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"startDate",children:"Thời gian bắt đầu *"}),e.jsx(d,{id:"startDate",type:"datetime-local",value:"string"==typeof S.startDate?S.startDate:"",onChange:e=>L("startDate",e.target.value),min:(new Date).toISOString().slice(0,16),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"endDate",children:"Thời gian kết thúc *"}),e.jsx(d,{id:"endDate",type:"datetime-local",value:"string"==typeof S.endDate?S.endDate:"",onChange:e=>L("endDate",e.target.value),min:"string"==typeof S.startDate&&S.startDate?S.startDate:(new Date).toISOString().slice(0,16),required:!0})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(o,{className:"text-base font-semibold",children:"Áp dụng cho sản phẩm"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(N,{id:"applyToAll",checked:q,onCheckedChange:e=>{A(e),e&&_([])}}),e.jsx(o,{htmlFor:"applyToAll",className:"text-sm font-medium",children:"Áp dụng cho tất cả sản phẩm"})]}),!q&&e.jsxs(D.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3},className:"space-y-4",children:[e.jsx("div",{className:"border rounded-lg p-4 max-h-96 overflow-y-auto",children:e.jsx("div",{className:"space-y-3",children:null==(k=null==(T=null==P?void 0:P.data)?void 0:T.products)?void 0:k.map((s=>e.jsxs("div",{className:"flex items-center space-x-3 p-2 hover:bg-gray-50 rounded",children:[e.jsx(N,{id:`product-${s.id}`,checked:F.includes(s.id),onCheckedChange:e=>((e,s)=>{_(s?s=>[...s,e]:s=>s.filter((s=>s!==e)))})(s.id,e)}),e.jsxs("div",{className:"flex-1",children:[e.jsx(o,{htmlFor:`product-${s.id}`,className:"text-sm font-medium cursor-pointer",children:s.name}),e.jsxs("div",{className:"text-xs text-maintext",children:["Mã: ",s.code," | Thương hiệu: ","string"==typeof s.brand?s.brand:s.brand.name]})]})]},s.id)))})}),F.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(o,{className:"text-sm font-medium",children:["Đã chọn ",F.length," sản phẩm:"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:F.map((s=>{var i,t;const a=null==(t=null==(i=null==P?void 0:P.data)?void 0:i.products)?void 0:t.find((e=>e.id===s));return a?e.jsx(b,{variant:"secondary",className:"text-xs",children:a.name},s):null}))})]})]})]}),e.jsx(t,{className:"bg-blue-50 border-blue-200",children:e.jsx(r,{className:"pt-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(v.Icon,{path:mdiInformation,size:1,className:"text-blue-600 mt-0.5"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-semibold text-blue-900",children:"Tóm tắt chiến dịch"}),e.jsxs("div",{className:"text-sm text-blue-800 space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Tên:"})," ",S.name||"Chưa nhập"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Giảm giá:"})," ",S.discountPercent,"%"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Thời gian:"})," ",S.startDate?new Date(S.startDate).toLocaleString("vi-VN"):"Chưa chọn"," - ",S.endDate?new Date(S.endDate).toLocaleString("vi-VN"):"Chưa chọn"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Áp dụng:"})," ",q?"Tất cả sản phẩm":`${F.length} sản phẩm được chọn`]})]})]})]})})}),e.jsxs("div",{className:"flex justify-end space-x-4 pt-6",children:[e.jsx(c,{type:"button",variant:"outline",onClick:()=>C(-1),children:"Hủy"}),e.jsx(c,{type:"submit",disabled:w.isPending,className:"min-w-[120px]",children:w.isPending?e.jsxs(e.Fragment,{children:[e.jsx(v.Icon,{path:mdiLoading,size:.7,className:"mr-2 animate-spin"}),"Đang tạo..."]}):"Tạo chiến dịch"})]})]})})]})})]})}const k=()=>e.jsx(T,{});export{k as default};
