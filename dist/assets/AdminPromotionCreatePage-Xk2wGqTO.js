import{U as L,a as f,j as e,B as v,k as m,m as P,q as x,a6 as r}from"./index-Dpx_4rWJ.js";import{C as T,a as q,b as z,c as k}from"./card-fT6uSY2F.js";import{L as n}from"./label-B0XdI4bT.js";import{T as O}from"./textarea-D-7Bay0_.js";import{B as V,a as H,b as u,c as N,d as b,e as $}from"./breadcrumb-CJedQ5QG.js";import{b as E}from"./promotion-BheM1RSV.js";import{u as G}from"./product-SA3ZOUlJ.js";import{C as S}from"./checkbox-BwYGdXvN.js";import{B as M}from"./badge-CA2Kv9aL.js";import"./createLucideIcon-BdgKQErZ.js";import"./index-qvEK80KO.js";import"./check-CyKb8IHM.js";function Q(){var D,C;const p=L(),j=E(),{data:d}=G({limit:100,status:"HOAT_DONG"}),[t,w]=f.useState({name:"",description:"",discountPercent:0,products:[],startDate:"",endDate:""}),[l,g]=f.useState([]),[h,B]=f.useState(!0),o=(s,a)=>{w(i=>({...i,[s]:a}))},A=(s,a)=>{g(a?i=>[...i,s]:i=>i.filter(c=>c!==s))},I=s=>{B(s),s&&g([])},F=async s=>{if(s.preventDefault(),!t.name.trim()){r.error("Vui lòng nhập tên chiến dịch");return}if(t.discountPercent<=0||t.discountPercent>100){r.error("Phần trăm giảm giá phải từ 1% đến 100%");return}if(!t.startDate||!t.endDate){r.error("Vui lòng chọn thời gian bắt đầu và kết thúc");return}const a=new Date,i=new Date(t.startDate),c=new Date(t.endDate);if(i<=a){r.error("Thời gian bắt đầu phải sau thời điểm hiện tại");return}if(c<=a){r.error("Thời gian kết thúc phải sau thời điểm hiện tại");return}if(i>=c){r.error("Thời gian kết thúc phải sau thời gian bắt đầu");return}const y={...t,products:h?[]:l};try{await j.mutateAsync(y,{onSuccess:()=>{r.success("Tạo chiến dịch khuyến mãi thành công"),p("/admin/discounts/promotions")}})}catch{r.error("Tạo chiến dịch khuyến mãi thất bại")}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(V,{children:e.jsxs(H,{children:[e.jsx(u,{children:e.jsx(N,{href:"/admin/statistics",children:"Dashboard"})}),e.jsx(b,{}),e.jsx(u,{children:e.jsx(N,{href:"/admin/discounts",children:"Quản lý khuyến mãii"})}),e.jsx(b,{}),e.jsx(u,{children:e.jsx(N,{href:"/admin/discounts/promotions",children:"Chiến dịch khuyến mãi"})}),e.jsx(b,{}),e.jsx(u,{children:e.jsx($,{children:"Tạo mới"})})]})}),e.jsxs(v,{variant:"outline",onClick:()=>p(-1),className:"flex items-center gap-2",children:[e.jsx(m.Icon,{path:mdiArrowLeft,size:.7}),"Quay lại"]})]}),e.jsx(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:e.jsxs(T,{children:[e.jsx(q,{children:e.jsxs(z,{className:"flex items-center gap-2",children:[e.jsx(m.Icon,{path:mdiPercent,size:1,className:"text-primary"}),"Tạo chiến dịch khuyến mãi mới"]})}),e.jsx(k,{children:e.jsxs("form",{onSubmit:F,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"name",children:"Tên chiến dịch *"}),e.jsx(x,{id:"name",value:t.name,onChange:s=>o("name",s.target.value),placeholder:"Nhập tên chiến dịch khuyến mãi",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"discountPercent",children:"Phần trăm giảm giá (%) *"}),e.jsx(x,{id:"discountPercent",type:"number",min:"1",max:"100",value:t.discountPercent,onChange:s=>o("discountPercent",parseInt(s.target.value)||0),placeholder:"Nhập phần trăm giảm giá",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"description",children:"Mô tả"}),e.jsx(O,{id:"description",value:t.description,onChange:s=>o("description",s.target.value),placeholder:"Nhập mô tả cho chiến dịch khuyến mãi",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"startDate",children:"Thời gian bắt đầu *"}),e.jsx(x,{id:"startDate",type:"datetime-local",value:typeof t.startDate=="string"?t.startDate:"",onChange:s=>o("startDate",s.target.value),min:new Date().toISOString().slice(0,16),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"endDate",children:"Thời gian kết thúc *"}),e.jsx(x,{id:"endDate",type:"datetime-local",value:typeof t.endDate=="string"?t.endDate:"",onChange:s=>o("endDate",s.target.value),min:typeof t.startDate=="string"&&t.startDate?t.startDate:new Date().toISOString().slice(0,16),required:!0})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(n,{className:"text-base font-semibold",children:"Áp dụng cho sản phẩm"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(S,{id:"applyToAll",checked:h,onCheckedChange:I}),e.jsx(n,{htmlFor:"applyToAll",className:"text-sm font-medium",children:"Áp dụng cho tất cả sản phẩm"})]}),!h&&e.jsxs(P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3},className:"space-y-4",children:[e.jsx("div",{className:"border rounded-lg p-4 max-h-96 overflow-y-auto",children:e.jsx("div",{className:"space-y-3",children:(C=(D=d==null?void 0:d.data)==null?void 0:D.products)==null?void 0:C.map(s=>e.jsxs("div",{className:"flex items-center space-x-3 p-2 hover:bg-gray-50 rounded",children:[e.jsx(S,{id:`product-${s.id}`,checked:l.includes(s.id),onCheckedChange:a=>A(s.id,a)}),e.jsxs("div",{className:"flex-1",children:[e.jsx(n,{htmlFor:`product-${s.id}`,className:"text-sm font-medium cursor-pointer",children:s.name}),e.jsxs("div",{className:"text-xs text-maintext",children:["Mã: ",s.code," | Thương hiệu: ",typeof s.brand=="string"?s.brand:s.brand.name]})]})]},s.id))})}),l.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(n,{className:"text-sm font-medium",children:["Đã chọn ",l.length," sản phẩm:"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:l.map(s=>{var i,c;const a=(c=(i=d==null?void 0:d.data)==null?void 0:i.products)==null?void 0:c.find(y=>y.id===s);return a?e.jsx(M,{variant:"secondary",className:"text-xs",children:a.name},s):null})})]})]})]}),e.jsx(T,{className:"bg-blue-50 border-blue-200",children:e.jsx(k,{className:"pt-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(m.Icon,{path:mdiInformation,size:1,className:"text-blue-600 mt-0.5"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-semibold text-blue-900",children:"Tóm tắt chiến dịch"}),e.jsxs("div",{className:"text-sm text-blue-800 space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Tên:"})," ",t.name||"Chưa nhập"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Giảm giá:"})," ",t.discountPercent,"%"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Thời gian:"})," ",t.startDate?new Date(t.startDate).toLocaleString("vi-VN"):"Chưa chọn"," - ",t.endDate?new Date(t.endDate).toLocaleString("vi-VN"):"Chưa chọn"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Áp dụng:"})," ",h?"Tất cả sản phẩm":`${l.length} sản phẩm được chọn`]})]})]})]})})}),e.jsxs("div",{className:"flex justify-end space-x-4 pt-6",children:[e.jsx(v,{type:"button",variant:"outline",onClick:()=>p(-1),children:"Hủy"}),e.jsx(v,{type:"submit",disabled:j.isPending,className:"min-w-[120px]",children:j.isPending?e.jsxs(e.Fragment,{children:[e.jsx(m.Icon,{path:mdiLoading,size:.7,className:"mr-2 animate-spin"}),"Đang tạo..."]}):"Tạo chiến dịch"})]})]})})]})})]})}const ie=()=>e.jsx(Q,{});export{ie as default};
