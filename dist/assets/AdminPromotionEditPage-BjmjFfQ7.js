import{U as E,a as j,j as e,a2 as d,B as g,k as y,w as K,m as B,aq as Q,q as f,az as $,aQ as M,a6 as l,b9 as U}from"./index-Dpx_4rWJ.js";import{C as P,a as F,c as C,b as R}from"./card-fT6uSY2F.js";import{L as c}from"./label-B0XdI4bT.js";import{T as J}from"./textarea-D-7Bay0_.js";import{S as W,a as X,b as Y,c as Z,d as H}from"./select-CS4vNzI5.js";import{B as ee,a as se,b as N,c as S,d as w,e as te}from"./breadcrumb-CJedQ5QG.js";import{c as ae,d as ne}from"./promotion-BheM1RSV.js";import{u as ie}from"./product-SA3ZOUlJ.js";import{C as L}from"./checkbox-BwYGdXvN.js";import{B as re}from"./badge-CA2Kv9aL.js";import"./index-BdQq_4o_.js";import"./index-qvEK80KO.js";import"./createLucideIcon-BdgKQErZ.js";import"./check-CyKb8IHM.js";function ce(){var A,I;const h=E(),T=useParams().id,{data:r,isLoading:G}=ae(T),v=ne(),{data:o}=ie({limit:100,status:"HOAT_DONG"}),[t,k]=j.useState({name:"",description:"",discountPercent:0,products:[],startDate:"",endDate:"",status:"HOAT_DONG"}),[m,u]=j.useState([]),[p,D]=j.useState(!0);j.useEffect(()=>{if(r!=null&&r.data){const s=r.data,i=new Date(s.startDate),n=new Date(s.endDate);k({name:s.name,description:s.description||"",discountPercent:s.discountPercent,products:Array.isArray(s.products)?s.products.map(a=>typeof a=="string"?a:a.id):[],startDate:i.toISOString().slice(0,16),endDate:n.toISOString().slice(0,16),status:s.status}),Array.isArray(s.products)&&s.products.length>0?(D(!1),u(s.products.map(a=>typeof a=="string"?a:a.id))):(D(!0),u([]))}},[r]);const x=(s,i)=>{k(n=>({...n,[s]:i}))},q=(s,i)=>{u(i?n=>[...n,s]:n=>n.filter(a=>a!==s))},V=s=>{D(s),s&&u([])},_=async s=>{var O;if(s.preventDefault(),!((O=t.name)!=null&&O.trim())){l.error("Vui lòng nhập tên chiến dịch");return}if(!t.discountPercent||t.discountPercent<=0||t.discountPercent>100){l.error("Phần trăm giảm giá phải từ 1% đến 100%");return}if(!t.startDate||!t.endDate){l.error("Vui lòng chọn thời gian bắt đầu và kết thúc");return}const i=new Date,n=new Date(t.startDate),a=new Date(t.endDate),b=new Date(r.data.startDate);if(n.getTime()!==b.getTime()&&n<=i){l.error("Thời gian bắt đầu mới phải sau thời điểm hiện tại");return}if(a<=i){l.error("Thời gian kết thúc phải sau thời điểm hiện tại");return}if(n>=a){l.error("Thời gian kết thúc phải sau thời gian bắt đầu");return}const z={...t,products:p?[]:m};try{await v.mutateAsync({promotionId:T,payload:z},{onSuccess:()=>{l.success("Cập nhật chiến dịch khuyến mãi thành công"),h("/admin/discounts/promotions")}})}catch{l.error("Cập nhật chiến dịch khuyến mãi thất bại")}};return G?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(d,{className:"h-6 w-96"}),e.jsx(d,{className:"h-10 w-24"})]}),e.jsxs(P,{children:[e.jsx(F,{children:e.jsx(d,{className:"h-8 w-64"})}),e.jsxs(C,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(d,{className:"h-20 w-full"}),e.jsx(d,{className:"h-20 w-full"})]}),e.jsx(d,{className:"h-24 w-full"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(d,{className:"h-20 w-full"}),e.jsx(d,{className:"h-20 w-full"})]})]})]})]}):r!=null&&r.data?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(ee,{children:e.jsxs(se,{children:[e.jsx(N,{children:e.jsx(S,{href:"/admin/statistics",children:"Dashboard"})}),e.jsx(w,{}),e.jsx(N,{children:e.jsx(S,{href:"/admin/discounts",children:"Quản lý khuyến mãii"})}),e.jsx(w,{}),e.jsx(N,{children:e.jsx(S,{href:"/admin/discounts/promotions",children:"Chiến dịch khuyến mãi"})}),e.jsx(w,{}),e.jsx(N,{children:e.jsx(te,{children:"Chỉnh sửa"})})]})}),e.jsxs(g,{variant:"outline",onClick:()=>h(-1),className:"flex items-center gap-2",children:[e.jsx(y.Icon,{path:K,size:.7}),"Quay lại"]})]}),e.jsx(B.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:e.jsxs(P,{children:[e.jsx(F,{children:e.jsxs(R,{className:"flex items-center gap-2",children:[e.jsx(y.Icon,{path:Q,size:1,className:"text-primary"}),"Chỉnh sửa chiến dịch khuyến mãi"]})}),e.jsx(C,{children:e.jsxs("form",{onSubmit:_,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"name",children:"Tên chiến dịch *"}),e.jsx(f,{id:"name",value:t.name,onChange:s=>x("name",s.target.value),placeholder:"Nhập tên chiến dịch khuyến mãi",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"discountPercent",children:"Phần trăm giảm giá (%) *"}),e.jsx(f,{id:"discountPercent",type:"number",min:"1",max:"100",value:t.discountPercent,onChange:s=>x("discountPercent",parseInt(s.target.value)||0),placeholder:"Nhập phần trăm giảm giá",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"description",children:"Mô tả"}),e.jsx(J,{id:"description",value:t.description,onChange:s=>x("description",s.target.value),placeholder:"Nhập mô tả cho chiến dịch khuyến mãi",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"startDate",children:"Thời gian bắt đầu *"}),e.jsx(f,{id:"startDate",type:"datetime-local",value:typeof t.startDate=="string"?t.startDate:"",onChange:s=>x("startDate",s.target.value),min:new Date().toISOString().slice(0,16),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"endDate",children:"Thời gian kết thúc *"}),e.jsx(f,{id:"endDate",type:"datetime-local",value:typeof t.endDate=="string"?t.endDate:"",onChange:s=>x("endDate",s.target.value),min:typeof t.startDate=="string"&&t.startDate?t.startDate:new Date().toISOString().slice(0,16),required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"status",children:"Trạng thái"}),e.jsxs(W,{value:t.status,onValueChange:s=>x("status",s),children:[e.jsx(X,{children:e.jsx(Y,{placeholder:"Chọn trạng thái"})}),e.jsxs(Z,{children:[e.jsx(H,{value:"HOAT_DONG",children:"Hoạt động"}),e.jsx(H,{value:"KHONG_HOAT_DONG",children:"Không hoạt động"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(c,{className:"text-base font-semibold",children:"Áp dụng cho sản phẩm"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(L,{id:"applyToAll",checked:p,onCheckedChange:V}),e.jsx(c,{htmlFor:"applyToAll",className:"text-sm font-medium",children:"Áp dụng cho tất cả sản phẩm"})]}),!p&&e.jsxs(B.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3},className:"space-y-4",children:[e.jsx("div",{className:"border rounded-lg p-4 max-h-96 overflow-y-auto",children:e.jsx("div",{className:"space-y-3",children:(I=(A=o==null?void 0:o.data)==null?void 0:A.products)==null?void 0:I.map(s=>e.jsxs("div",{className:"flex items-center space-x-3 p-2 hover:bg-gray-50 rounded",children:[e.jsx(L,{id:`product-${s.id}`,checked:m.includes(s.id),onCheckedChange:i=>q(s.id,i)}),e.jsxs("div",{className:"flex-1",children:[e.jsx(c,{htmlFor:`product-${s.id}`,className:"text-sm font-medium cursor-pointer",children:s.name}),e.jsxs("div",{className:"text-xs text-maintext",children:["Mã: ",s.code," | Thương hiệu: ",typeof s.brand=="string"?s.brand:s.brand.name]})]})]},s.id))})}),m.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(c,{className:"text-sm font-medium",children:["Đã chọn ",m.length," sản phẩm:"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:m.map(s=>{var n,a;const i=(a=(n=o==null?void 0:o.data)==null?void 0:n.products)==null?void 0:a.find(b=>b.id===s);return i?e.jsx(re,{variant:"secondary",className:"text-xs",children:i.name},s):null})})]})]})]}),e.jsx(P,{className:"bg-blue-50 border-blue-200",children:e.jsx(C,{className:"pt-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(y.Icon,{path:$,size:1,className:"text-blue-600 mt-0.5"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-semibold text-blue-900",children:"Tóm tắt chiến dịch"}),e.jsxs("div",{className:"text-sm text-blue-800 space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Mã:"})," ",r.data.code]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Tên:"})," ",t.name||"Chưa nhập"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Giảm giá:"})," ",t.discountPercent,"%"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Thời gian:"})," ",t.startDate?new Date(t.startDate).toLocaleString("vi-VN"):"Chưa chọn"," - ",t.endDate?new Date(t.endDate).toLocaleString("vi-VN"):"Chưa chọn"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Áp dụng:"})," ",p?"Tất cả sản phẩm":`${m.length} sản phẩm được chọn`]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Trạng thái:"})," ",t.status==="HOAT_DONG"?"Hoạt động":"Không hoạt động"]})]})]})]})})}),e.jsxs("div",{className:"flex justify-end space-x-4 pt-6",children:[e.jsx(g,{type:"button",variant:"outline",onClick:()=>h(-1),children:"Hủy"}),e.jsx(g,{type:"submit",disabled:v.isPending,className:"min-w-[120px]",children:v.isPending?e.jsxs(e.Fragment,{children:[e.jsx(y.Icon,{path:M,size:.7,className:"mr-2 animate-spin"}),"Đang cập nhật..."]}):"Cập nhật chiến dịch"})]})]})})]})})]}):e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-red-500",children:"Không tìm thấy chiến dịch khuyến mãi"}),e.jsx(g,{variant:"outline",className:"mt-4",onClick:()=>h(-1),children:"Quay lại"})]})})}const Pe=()=>{const{id:h}=U();return h?e.jsx(ce,{params:{id:h}}):e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Sửa khuyến mãi"}),e.jsx("p",{className:"text-gray-600",children:"ID khuyến mãi không hợp lệ"})]})};export{Pe as default};
