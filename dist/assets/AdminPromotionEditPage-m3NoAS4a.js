import{j as s}from"./ui-vendor-CFM_MCUz.js";import{u as e,r as a,i as t}from"./react-vendor-B55MjJUH.js";import{C as i,a as n,c as r,b as c}from"./card-ClEzRAeX.js";import{B as d,I as l,y as h}from"./index-BHeY-5EX.js";import{L as o}from"./label-Bm9nFuXD.js";import{T as m}from"./textarea-DHkaMSo6.js";import{S as x,a as p,b as u,c as j,d as g}from"./select-C6W71KWg.js";import{B as v,a as y,b as N,c as f,d as D,e as b}from"./breadcrumb-CP4jYkI2.js";import{t as C,M as k,af as w,an as T,aC as S}from"./icons-vendor-BrsZP2ku.js";import{c as P,d as O}from"./promotion-DDJnNtmQ.js";import{u as _}from"./product-BXJPBtky.js";import{C as A}from"./checkbox-4N58UvKV.js";import{B as I}from"./badge-BeHegjHt.js";import{S as F}from"./skeleton-4G_X8bY4.js";import{m as H}from"./heavy-vendor-BfN2pHnQ.js";import"./query-vendor-CBwfxcof.js";function G(){var t,G;const q=e(),V=useParams().id,{data:z,isLoading:K}=P(V),L=O(),{data:M}=_({limit:100,status:"HOAT_DONG"}),[B,Q]=a.useState({name:"",description:"",discountPercent:0,products:[],startDate:"",endDate:"",status:"HOAT_DONG"}),[$,E]=a.useState([]),[J,R]=a.useState(!0);a.useEffect((()=>{if(null==z?void 0:z.data){const s=z.data,e=new Date(s.startDate),a=new Date(s.endDate);Q({name:s.name,description:s.description||"",discountPercent:s.discountPercent,products:Array.isArray(s.products)?s.products.map((s=>"string"==typeof s?s:s._id)):[],startDate:e.toISOString().slice(0,16),endDate:a.toISOString().slice(0,16),status:s.status}),Array.isArray(s.products)&&s.products.length>0?(R(!1),E(s.products.map((s=>"string"==typeof s?s:s._id)))):(R(!0),E([]))}}),[z]);const U=(s,e)=>{Q((a=>({...a,[s]:e})))};return K?s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx(F,{className:"h-6 w-96"}),s.jsx(F,{className:"h-10 w-24"})]}),s.jsxs(i,{children:[s.jsx(n,{children:s.jsx(F,{className:"h-8 w-64"})}),s.jsxs(r,{className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsx(F,{className:"h-20 w-full"}),s.jsx(F,{className:"h-20 w-full"})]}),s.jsx(F,{className:"h-24 w-full"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsx(F,{className:"h-20 w-full"}),s.jsx(F,{className:"h-20 w-full"})]})]})]})]}):(null==z?void 0:z.data)?s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx(v,{children:s.jsxs(y,{children:[s.jsx(N,{children:s.jsx(f,{href:"/admin/statistics",children:"Dashboard"})}),s.jsx(D,{}),s.jsx(N,{children:s.jsx(f,{href:"/admin/discounts",children:"Quản lý Đợt khuyến mãii"})}),s.jsx(D,{}),s.jsx(N,{children:s.jsx(f,{href:"/admin/discounts/promotions",children:"Chiến dịch khuyến mãi"})}),s.jsx(D,{}),s.jsx(N,{children:s.jsx(b,{children:"Chỉnh sửa"})})]})}),s.jsxs(d,{variant:"outline",onClick:()=>q(-1),className:"flex items-center gap-2",children:[s.jsx(C.Icon,{path:k,size:.7}),"Quay lại"]})]}),s.jsx(H.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:s.jsxs(i,{children:[s.jsx(n,{children:s.jsxs(c,{className:"flex items-center gap-2",children:[s.jsx(C.Icon,{path:w,size:1,className:"text-primary"}),"Chỉnh sửa chiến dịch khuyến mãi"]})}),s.jsx(r,{children:s.jsxs("form",{onSubmit:async s=>{var e;if(s.preventDefault(),!(null==(e=B.name)?void 0:e.trim()))return void h.error("Vui lòng nhập tên chiến dịch");if(!B.discountPercent||B.discountPercent<=0||B.discountPercent>100)return void h.error("Phần trăm giảm giá phải từ 1% đến 100%");if(!B.startDate||!B.endDate)return void h.error("Vui lòng chọn thời gian bắt đầu và kết thúc");const a=new Date,t=new Date(B.startDate),i=new Date(B.endDate),n=new Date(z.data.startDate);if(t.getTime()!==n.getTime()&&t<=a)return void h.error("Thời gian bắt đầu mới phải sau thời điểm hiện tại");if(i<=a)return void h.error("Thời gian kết thúc phải sau thời điểm hiện tại");if(t>=i)return void h.error("Thời gian kết thúc phải sau thời gian bắt đầu");const r={...B,products:J?[]:$};try{await L.mutateAsync({promotionId:V,payload:r},{onSuccess:()=>{h.success("Cập nhật chiến dịch khuyến mãi thành công"),q("/admin/discounts/promotions")}})}catch(c){h.error("Cập nhật chiến dịch khuyến mãi thất bại")}},className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(o,{htmlFor:"name",children:"Tên chiến dịch *"}),s.jsx(l,{id:"name",value:B.name,onChange:s=>U("name",s.target.value),placeholder:"Nhập tên chiến dịch khuyến mãi",required:!0})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(o,{htmlFor:"discountPercent",children:"Phần trăm giảm giá (%) *"}),s.jsx(l,{id:"discountPercent",type:"number",min:"1",max:"100",value:B.discountPercent,onChange:s=>U("discountPercent",parseInt(s.target.value)||0),placeholder:"Nhập phần trăm giảm giá",required:!0})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(o,{htmlFor:"description",children:"Mô tả"}),s.jsx(m,{id:"description",value:B.description,onChange:s=>U("description",s.target.value),placeholder:"Nhập mô tả cho chiến dịch khuyến mãi",rows:3})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx(o,{htmlFor:"startDate",children:"Thời gian bắt đầu *"}),s.jsx(l,{id:"startDate",type:"datetime-local",value:"string"==typeof B.startDate?B.startDate:"",onChange:s=>U("startDate",s.target.value),min:(new Date).toISOString().slice(0,16),required:!0})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(o,{htmlFor:"endDate",children:"Thời gian kết thúc *"}),s.jsx(l,{id:"endDate",type:"datetime-local",value:"string"==typeof B.endDate?B.endDate:"",onChange:s=>U("endDate",s.target.value),min:"string"==typeof B.startDate&&B.startDate?B.startDate:(new Date).toISOString().slice(0,16),required:!0})]})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(o,{htmlFor:"status",children:"Trạng thái"}),s.jsxs(x,{value:B.status,onValueChange:s=>U("status",s),children:[s.jsx(p,{children:s.jsx(u,{placeholder:"Chọn trạng thái"})}),s.jsxs(j,{children:[s.jsx(g,{value:"HOAT_DONG",children:"Hoạt động"}),s.jsx(g,{value:"KHONG_HOAT_DONG",children:"Không hoạt động"})]})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx(o,{className:"text-base font-semibold",children:"Áp dụng cho sản phẩm"}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(A,{id:"applyToAll",checked:J,onCheckedChange:s=>{R(s),s&&E([])}}),s.jsx(o,{htmlFor:"applyToAll",className:"text-sm font-medium",children:"Áp dụng cho tất cả sản phẩm"})]}),!J&&s.jsxs(H.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3},className:"space-y-4",children:[s.jsx("div",{className:"border rounded-lg p-4 max-h-96 overflow-y-auto",children:s.jsx("div",{className:"space-y-3",children:null==(G=null==(t=null==M?void 0:M.data)?void 0:t.products)?void 0:G.map((e=>s.jsxs("div",{className:"flex items-center space-x-3 p-2 hover:bg-gray-50 rounded",children:[s.jsx(A,{id:`product-${e._id}`,checked:$.includes(e._id),onCheckedChange:s=>((s,e)=>{E(e?e=>[...e,s]:e=>e.filter((e=>e!==s)))})(e._id,s)}),s.jsxs("div",{className:"flex-1",children:[s.jsx(o,{htmlFor:`product-${e._id}`,className:"text-sm font-medium cursor-pointer",children:e.name}),s.jsxs("div",{className:"text-xs text-maintext",children:["Mã: ",e.code," | Thương hiệu: ","string"==typeof e.brand?e.brand:e.brand.name]})]})]},e._id)))})}),$.length>0&&s.jsxs("div",{className:"space-y-2",children:[s.jsxs(o,{className:"text-sm font-medium",children:["Đã chọn ",$.length," sản phẩm:"]}),s.jsx("div",{className:"flex flex-wrap gap-2",children:$.map((e=>{var a,t;const i=null==(t=null==(a=null==M?void 0:M.data)?void 0:a.products)?void 0:t.find((s=>s._id===e));return i?s.jsx(I,{variant:"secondary",className:"text-xs",children:i.name},e):null}))})]})]})]}),s.jsx(i,{className:"bg-blue-50 border-blue-200",children:s.jsx(r,{className:"pt-6",children:s.jsxs("div",{className:"flex items-start gap-4",children:[s.jsx(C.Icon,{path:T,size:1,className:"text-blue-600 mt-0.5"}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("h4",{className:"font-semibold text-blue-900",children:"Tóm tắt chiến dịch"}),s.jsxs("div",{className:"text-sm text-blue-800 space-y-1",children:[s.jsxs("p",{children:[s.jsx("strong",{children:"Mã:"})," ",z.data.code]}),s.jsxs("p",{children:[s.jsx("strong",{children:"Tên:"})," ",B.name||"Chưa nhập"]}),s.jsxs("p",{children:[s.jsx("strong",{children:"Giảm giá:"})," ",B.discountPercent,"%"]}),s.jsxs("p",{children:[s.jsx("strong",{children:"Thời gian:"})," ",B.startDate?new Date(B.startDate).toLocaleString("vi-VN"):"Chưa chọn"," - ",B.endDate?new Date(B.endDate).toLocaleString("vi-VN"):"Chưa chọn"]}),s.jsxs("p",{children:[s.jsx("strong",{children:"Áp dụng:"})," ",J?"Tất cả sản phẩm":`${$.length} sản phẩm được chọn`]}),s.jsxs("p",{children:[s.jsx("strong",{children:"Trạng thái:"})," ","HOAT_DONG"===B.status?"Hoạt động":"Không hoạt động"]})]})]})]})})}),s.jsxs("div",{className:"flex justify-end space-x-4 pt-6",children:[s.jsx(d,{type:"button",variant:"outline",onClick:()=>q(-1),children:"Hủy"}),s.jsx(d,{type:"submit",disabled:L.isPending,className:"min-w-[120px]",children:L.isPending?s.jsxs(s.Fragment,{children:[s.jsx(C.Icon,{path:S,size:.7,className:"mr-2 animate-spin"}),"Đang cập nhật..."]}):"Cập nhật chiến dịch"})]})]})})]})})]}):s.jsx("div",{className:"space-y-4",children:s.jsxs("div",{className:"text-center py-12",children:[s.jsx("p",{className:"text-red-500",children:"Không tìm thấy chiến dịch khuyến mãi"}),s.jsx(d,{variant:"outline",className:"mt-4",onClick:()=>q(-1),children:"Quay lại"})]})})}const q=()=>{const{id:e}=t();return e?s.jsx(G,{params:{id:e}}):s.jsxs("div",{className:"container mx-auto px-4 py-8",children:[s.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Sửa khuyến mãi"}),s.jsx("p",{className:"text-gray-600",children:"ID khuyến mãi không hợp lệ"})]})};export{q as default};
