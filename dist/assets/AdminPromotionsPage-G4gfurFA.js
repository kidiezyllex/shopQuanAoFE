import{a as o,aJ as E,j as e,B as i,k as c,aa as L,ao as X,q as v,bf as R,ap as V,A as Y,m as J,a2 as b,aq as W,bg as Z,bh as ee,aQ as ae,a6 as H}from"./index-Dpx_4rWJ.js";import{C as te,c as se}from"./card-fT6uSY2F.js";import{u as ne,a as ie}from"./promotion-BheM1RSV.js";import{B as le,a as ce,b as T,c as B,d as I,e as re}from"./breadcrumb-CJedQ5QG.js";import{T as de,a as xe,b as C,c as d,d as oe,e as r}from"./table-BeX0puEz.js";import{S as me,a as he,b as pe,c as ue,d as D}from"./select-CS4vNzI5.js";import{B as p}from"./badge-CA2Kv9aL.js";import{D as ge,a as je,b as fe,c as ye,e as Ne,i as ve}from"./dialog-BuHyDe_9.js";import"./createLucideIcon-BdgKQErZ.js";import"./index-BdQq_4o_.js";import"./index-qvEK80KO.js";import"./check-CyKb8IHM.js";function be(){var O,z;const[m,P]=o.useState(""),[l,x]=o.useState({page:1,limit:10}),[u,A]=o.useState(!1),{data:t,isLoading:F,isError:U}=ne(l),g=ie(),k=E(),[K,j]=o.useState(!1),[w,_]=o.useState(null);o.useEffect(()=>{const a=setTimeout(()=>{if(m.trim())x(s=>({...s,search:m,page:1}));else{const{search:s,...n}=l;x({...n,page:1})}},500);return()=>clearTimeout(a)},[m]);const f=(a,s)=>{if(s===""){const n={...l};delete n[a],x({...n,page:1})}else x({...l,[a]:s,page:1})},G=()=>{P(""),x({page:1,limit:10})},Q=async a=>{try{await g.mutateAsync(a,{onSuccess:()=>{H.success("Đã xóa chiến dịch khuyến mãi thành công"),k.invalidateQueries({queryKey:["promotions"]}),j(!1)}})}catch{H.error("Xóa chiến dịch khuyến mãi thất bại")}},h=a=>{x({...l,page:a})},S=a=>{const s=new Date(a),n=String(s.getUTCDate()).padStart(2,"0"),y=String(s.getUTCMonth()+1).padStart(2,"0"),N=s.getUTCFullYear(),M=String(s.getUTCHours()).padStart(2,"0"),q=String(s.getUTCMinutes()).padStart(2,"0");return`${M}:${q} ${n}/${y}/${N}`},$=a=>{const s=new Date,n=Date.UTC(s.getFullYear(),s.getMonth(),s.getDate(),s.getHours(),s.getMinutes(),s.getSeconds()),y=new Date(a.startDate).getTime(),N=new Date(a.endDate).getTime();return a.status==="KHONG_HOAT_DONG"?e.jsx(p,{variant:"destructive",children:"Không hoạt động"}):a.status==="HOAT_DONG"?n<y?e.jsx(p,{variant:"secondary",children:"Chưa bắt đầu"}):n>N?e.jsx(p,{variant:"outline",children:"Đã kết thúc"}):e.jsx(p,{variant:"default",children:"Đang hoạt động"}):e.jsx(p,{variant:"secondary",children:"Không xác định"})};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(le,{children:e.jsxs(ce,{children:[e.jsx(T,{children:e.jsx(B,{href:"/admin/statistics",children:"Dashboard"})}),e.jsx(I,{}),e.jsx(T,{children:e.jsx(B,{href:"/admin/discounts",children:"Quản lý khuyến mãii"})}),e.jsx(I,{}),e.jsx(T,{children:e.jsx(re,{children:"Chiến dịch khuyến mãi"})})]})}),e.jsx("div",{className:"flex space-x-2",children:e.jsx("a",{href:"/admin/discounts/promotions/create",className:"flex items-center gap-2",children:e.jsxs(i,{className:"flex items-center gap-2",children:[e.jsx(c.Icon,{path:L,size:.7}),"Thêm chiến dịch khuyến mãi"]})})})]}),e.jsx(te,{className:"mb-4",children:e.jsxs(se,{className:"py-4",children:[e.jsxs("div",{className:"flex flex-col space-y-4 md:space-y-0 md:flex-row md:justify-between md:items-center gap-2",children:[e.jsxs("div",{className:"relative flex-1 max-w-4xl",children:[e.jsx(c.Icon,{path:X,size:.7,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-maintext"}),e.jsx(v,{type:"text",placeholder:"Tìm kiếm theo tên chiến dịch...",className:"pl-10 pr-4 py-2 w-full border rounded-[6px]",value:m,onChange:a=>P(a.target.value)})]}),e.jsxs("div",{className:"flex space-x-2",children:[(u||m||Object.keys(l).filter(a=>a!=="page"&&a!=="limit").length>0)&&e.jsxs(i,{variant:"outline",className:"flex items-center",onClick:G,children:[e.jsx(c.Icon,{path:R,size:.7,className:"mr-2"}),"Clear bộ lọc"]}),e.jsxs(i,{variant:"outline",className:"flex items-center",onClick:()=>A(!u),children:[e.jsx(c.Icon,{path:V,size:.7,className:"mr-2"}),u?"Ẩn bộ lọc":"Hiện bộ lọc"]})]})]}),e.jsx(Y,{children:u&&e.jsx(J.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3},className:"mt-4 pt-4 border-t",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-maintext mb-2 font-semibold",children:"Trạng thái"}),e.jsxs(me,{value:l.status||"",onValueChange:a=>f("status",a==="all"?void 0:a),children:[e.jsx(he,{children:e.jsx(pe,{placeholder:"Tất cả trạng thái"})}),e.jsxs(ue,{children:[e.jsx(D,{value:"all",children:"Tất cả trạng thái"}),e.jsx(D,{value:"HOAT_DONG",children:"Hoạt động"}),e.jsx(D,{value:"KHONG_HOAT_DONG",children:"Không hoạt động"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-maintext mb-2 font-semibold",children:"Thời gian bắt đầu"}),e.jsx(v,{type:"date",value:l.startDate||"",onChange:a=>f("startDate",a.target.value),className:"w-full",placeholder:"Từ ngày"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-maintext mb-2 font-semibold",children:"Thời gian kết thúc"}),e.jsx(v,{type:"date",value:l.endDate||"",onChange:a=>f("endDate",a.target.value),className:"w-full",placeholder:"Đến ngày"})]})]})})})]})}),F?e.jsx("div",{className:"bg-white rounded-[6px] shadow-sm p-4 space-y-4",children:[...Array(5)].map((a,s)=>e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(b,{className:"h-12 w-12 rounded-[6px]"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{className:"h-4 w-[250px]"}),e.jsx(b,{className:"h-4 w-[200px]"})]})]},s))}):U?e.jsxs("div",{className:"bg-white rounded-[6px] shadow-sm p-4 text-center",children:[e.jsx("p",{className:"text-red-500",children:"Đã xảy ra lỗi khi tải dữ liệu. Vui lòng thử lại sau."}),e.jsx(i,{variant:"outline",className:"mt-4",onClick:()=>k.invalidateQueries({queryKey:["promotions"]}),children:"Thử lại"})]}):e.jsxs("div",{className:"bg-white rounded-[6px] shadow-sm overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(de,{children:[e.jsx(xe,{children:e.jsxs(C,{children:[e.jsx(d,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"Mã"}),e.jsx(d,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"Tên chiến dịch"}),e.jsx(d,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"Giảm giá"}),e.jsx(d,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"Sản phẩm"}),e.jsx(d,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"Thời gian"}),e.jsx(d,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"Trạng thái"}),e.jsx(d,{className:"px-4 py-4 text-center text-sm font-medium text-maintext",children:"Thao tác"})]})}),e.jsx(oe,{children:(z=(O=t==null?void 0:t.data)==null?void 0:O.promotions)!=null&&z.length?t.data.promotions.map(a=>e.jsxs(C,{children:[e.jsx(r,{className:"px-4 py-4 text-sm",children:e.jsx("span",{className:"font-mono font-medium",children:a.code})}),e.jsx(r,{className:"px-4 py-4 text-sm",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:a.name}),a.description&&e.jsx("div",{className:"text-xs text-maintext mt-1 line-clamp-2",children:a.description})]})}),e.jsx(r,{className:"px-4 py-4 text-sm",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(c.Icon,{path:W,size:.7,className:"text-primary"}),e.jsxs("span",{className:"font-medium text-primary",children:[a.discountPercent,"%"]})]})}),e.jsx(r,{className:"px-4 py-4 text-sm",children:Array.isArray(a.products)?e.jsx("span",{className:"text-maintext",children:a.products.length===0?"Tất cả sản phẩm":`${a.products.length} sản phẩm`}):e.jsx("span",{className:"text-maintext",children:"Tất cả sản phẩm"})}),e.jsx(r,{className:"px-4 py-4 text-sm",children:e.jsxs("div",{className:"text-xs",children:[e.jsx("div",{children:S(a.startDate)}),e.jsxs("div",{className:"text-maintext",children:["đến ",S(a.endDate)]})]})}),e.jsx(r,{className:"px-4 py-4 text-sm",children:$(a)}),e.jsx(r,{className:"px-4 py-4 text-sm text-right",children:e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsx("a",{href:`/admin/discounts/promotions/edit/${a.id}`,children:e.jsx(i,{variant:"outline",size:"icon",title:"Sửa",children:e.jsx(c.Icon,{path:Z,size:.7})})}),e.jsx(i,{variant:"outline",size:"icon",onClick:()=>{_(a.id),j(!0)},title:"Xóa",children:e.jsx(c.Icon,{path:ee,size:.7})})]})})]},a.id)):e.jsx(C,{children:e.jsx(r,{colSpan:7,className:"px-4 py-8 text-center text-maintext",children:"Không tìm thấy chiến dịch khuyến mãi nào"})})})]})}),t&&t.data&&t.data.pagination&&e.jsxs("div",{className:"flex justify-center items-center space-x-2 p-4 border-t",children:[e.jsxs(i,{variant:"outline",size:"icon",onClick:()=>h(1),disabled:t.data.pagination.currentPage===1,children:[e.jsx("span",{className:"sr-only",children:"Trang đầu"}),e.jsx("span",{children:"«"})]}),e.jsxs(i,{variant:"outline",size:"icon",onClick:()=>h(t.data.pagination.currentPage-1),disabled:t.data.pagination.currentPage===1,children:[e.jsx("span",{className:"sr-only",children:"Trang trước"}),e.jsx("span",{children:"‹"})]}),[...Array(t.data.pagination.totalPages)].map((a,s)=>{const n=s+1;return n===1||n===t.data.pagination.totalPages||n>=t.data.pagination.currentPage-2&&n<=t.data.pagination.currentPage+2?e.jsx(i,{variant:n===t.data.pagination.currentPage?"default":"outline",size:"icon",onClick:()=>h(n),children:n},n):n===t.data.pagination.currentPage-3||n===t.data.pagination.currentPage+3?e.jsx("span",{children:"..."},n):null}),e.jsxs(i,{variant:"outline",size:"icon",onClick:()=>h(t.data.pagination.currentPage+1),disabled:t.data.pagination.currentPage===t.data.pagination.totalPages,children:[e.jsx("span",{className:"sr-only",children:"Trang sau"}),e.jsx("span",{children:"›"})]}),e.jsxs(i,{variant:"outline",size:"icon",onClick:()=>h(t.data.pagination.totalPages),disabled:t.data.pagination.currentPage===t.data.pagination.totalPages,children:[e.jsx("span",{className:"sr-only",children:"Trang cuối"}),e.jsx("span",{children:"»"})]})]})]}),e.jsx(ge,{open:K,onOpenChange:j,children:e.jsxs(je,{children:[e.jsx(fe,{children:e.jsx(ye,{children:"Xác nhận xóa chiến dịch khuyến mãi"})}),e.jsx("p",{className:"py-4",children:"Bạn có chắc chắn muốn xóa chiến dịch khuyến mãi này không? Hành động này không thể hoàn tác."}),e.jsxs(Ne,{children:[e.jsx(ve,{asChild:!0,children:e.jsx(i,{variant:"outline",children:"Hủy"})}),e.jsx(i,{variant:"destructive",onClick:()=>w&&Q(w),disabled:g.isPending,children:g.isPending?e.jsxs(e.Fragment,{children:[e.jsx(c.Icon,{path:ae,size:.7,className:"mr-2 animate-spin"}),"Đang xóa..."]}):"Xóa"})]})]})})]})}const Ae=()=>e.jsx(be,{});export{Ae as default};
