import{j as e}from"./ui-vendor-CFM_MCUz.js";import{r as a}from"./react-vendor-B55MjJUH.js";import{C as s,c as t}from"./card-ClEzRAeX.js";import{S as n}from"./skeleton-4G_X8bY4.js";import{t as i,a5 as l,ad as c,aK as r,ae as d,af as x,aL as o,aM as m,aC as h}from"./icons-vendor-BrsZP2ku.js";import{B as p,I as j,y as u}from"./index-BHeY-5EX.js";import{u as g,a as f}from"./promotion-DDJnNtmQ.js";import{d as N}from"./query-vendor-CBwfxcof.js";import{B as v,a as y,b,c as T,d as k,e as C}from"./breadcrumb-CP4jYkI2.js";import{T as D,a as w,b as S,c as P,d as z,e as H}from"./table-DL-K3PV4.js";import{S as O,a as A,b as I,c as K,d as _}from"./select-C6W71KWg.js";import{B as G}from"./badge-BeHegjHt.js";import{A as $,m as M}from"./heavy-vendor-BfN2pHnQ.js";function U(){var U,B;const[F,X]=a.useState(""),[q,Q]=a.useState({page:1,limit:10}),[E,L]=a.useState(!1),{data:V,isLoading:Y,isError:J}=g(q),R=f(),W=N(),[Z,ee]=a.useState(!1),[ae,se]=a.useState(null);a.useEffect((()=>{const e=setTimeout((()=>{if(F.trim())Q((e=>({...e,search:F,page:1})));else{const{search:e,...a}=q;Q({...a,page:1})}}),500);return()=>clearTimeout(e)}),[F]);const te=(e,a)=>{if(""===a){const a={...q};delete a[e],Q({...a,page:1})}else Q({...q,[e]:a,page:1})},ne=e=>{Q({...q,page:e})},ie=e=>{const a=new Date(e),s=String(a.getUTCDate()).padStart(2,"0"),t=String(a.getUTCMonth()+1).padStart(2,"0"),n=a.getUTCFullYear();return`${String(a.getUTCHours()).padStart(2,"0")}:${String(a.getUTCMinutes()).padStart(2,"0")} ${s}/${t}/${n}`},le=a=>{const s=new Date,t=Date.UTC(s.getFullYear(),s.getMonth(),s.getDate(),s.getHours(),s.getMinutes(),s.getSeconds()),n=new Date(a.startDate).getTime(),i=new Date(a.endDate).getTime();return"KHONG_HOAT_DONG"===a.status?e.jsx(G,{variant:"destructive",children:"Không hoạt động"}):"HOAT_DONG"===a.status?t<n?e.jsx(G,{variant:"secondary",children:"Chưa bắt đầu"}):t>i?e.jsx(G,{variant:"outline",children:"Đã kết thúc"}):e.jsx(G,{variant:"default",children:"Đang hoạt động"}):e.jsx(G,{variant:"secondary",children:"Không xác định"})};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(v,{children:e.jsxs(y,{children:[e.jsx(b,{children:e.jsx(T,{href:"/admin/statistics",children:"Dashboard"})}),e.jsx(k,{}),e.jsx(b,{children:e.jsx(T,{href:"/admin/discounts",children:"Quản lý Đợt khuyến mãii"})}),e.jsx(k,{}),e.jsx(b,{children:e.jsx(C,{children:"Chiến dịch khuyến mãi"})})]})}),e.jsx("div",{className:"flex space-x-2",children:e.jsx("a",{href:"/admin/discounts/promotions/create",className:"flex items-center gap-2",children:e.jsxs(p,{className:"flex items-center gap-2",children:[e.jsx(i.Icon,{path:l,size:.7}),"Thêm chiến dịch khuyến mãi"]})})})]}),e.jsx(s,{className:"mb-4",children:e.jsxs(t,{className:"py-4",children:[e.jsxs("div",{className:"flex flex-col space-y-4 md:space-y-0 md:flex-row md:justify-between md:items-center gap-2",children:[e.jsxs("div",{className:"relative flex-1 max-w-4xl",children:[e.jsx(i.Icon,{path:c,size:.7,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-maintext"}),e.jsx(j,{type:"text",placeholder:"Tìm kiếm theo tên chiến dịch...",className:"pl-10 pr-4 py-2 w-full border rounded-[6px]",value:F,onChange:e=>X(e.target.value)})]}),e.jsxs("div",{className:"flex space-x-2",children:[(E||F||Object.keys(q).filter((e=>"page"!==e&&"limit"!==e)).length>0)&&e.jsxs(p,{variant:"outline",className:"flex items-center",onClick:()=>{X(""),Q({page:1,limit:10})},children:[e.jsx(i.Icon,{path:r,size:.7,className:"mr-2"}),"Clear bộ lọc"]}),e.jsxs(p,{variant:"outline",className:"flex items-center",onClick:()=>L(!E),children:[e.jsx(i.Icon,{path:d,size:.7,className:"mr-2"}),E?"Ẩn bộ lọc":"Hiện bộ lọc"]})]})]}),e.jsx($,{children:E&&e.jsx(M.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3},className:"mt-4 pt-4 border-t",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-maintext mb-2 font-semibold",children:"Trạng thái"}),e.jsxs(O,{value:q.status||"",onValueChange:e=>te("status","all"===e?void 0:e),children:[e.jsx(A,{children:e.jsx(I,{placeholder:"Tất cả trạng thái"})}),e.jsxs(K,{children:[e.jsx(_,{value:"all",children:"Tất cả trạng thái"}),e.jsx(_,{value:"HOAT_DONG",children:"Hoạt động"}),e.jsx(_,{value:"KHONG_HOAT_DONG",children:"Không hoạt động"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-maintext mb-2 font-semibold",children:"Thời gian bắt đầu"}),e.jsx(j,{type:"date",value:q.startDate||"",onChange:e=>te("startDate",e.target.value),className:"w-full",placeholder:"Từ ngày"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-maintext mb-2 font-semibold",children:"Thời gian kết thúc"}),e.jsx(j,{type:"date",value:q.endDate||"",onChange:e=>te("endDate",e.target.value),className:"w-full",placeholder:"Đến ngày"})]})]})})})]})}),Y?e.jsx("div",{className:"bg-white rounded-[6px] shadow-sm p-4 space-y-4",children:[...Array(5)].map(((a,s)=>e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(n,{className:"h-12 w-12 rounded-[6px]"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{className:"h-4 w-[250px]"}),e.jsx(n,{className:"h-4 w-[200px]"})]})]},s)))}):J?e.jsxs("div",{className:"bg-white rounded-[6px] shadow-sm p-4 text-center",children:[e.jsx("p",{className:"text-red-500",children:"Đã xảy ra lỗi khi tải dữ liệu. Vui lòng thử lại sau."}),e.jsx(p,{variant:"outline",className:"mt-4",onClick:()=>W.invalidateQueries({queryKey:["promotions"]}),children:"Thử lại"})]}):e.jsxs("div",{className:"bg-white rounded-[6px] shadow-sm overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(D,{children:[e.jsx(w,{children:e.jsxs(S,{children:[e.jsx(P,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"Mã"}),e.jsx(P,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"Tên chiến dịch"}),e.jsx(P,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"Giảm giá"}),e.jsx(P,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"Sản phẩm"}),e.jsx(P,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"Thời gian"}),e.jsx(P,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"Trạng thái"}),e.jsx(P,{className:"px-4 py-4 text-center text-sm font-medium text-maintext",children:"Thao tác"})]})}),e.jsx(z,{children:(null==(B=null==(U=null==V?void 0:V.data)?void 0:U.promotions)?void 0:B.length)?V.data.promotions.map((a=>e.jsxs(S,{children:[e.jsx(H,{className:"px-4 py-4 text-sm",children:e.jsx("span",{className:"font-mono font-medium",children:a.code})}),e.jsx(H,{className:"px-4 py-4 text-sm",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:a.name}),a.description&&e.jsx("div",{className:"text-xs text-maintext mt-1 line-clamp-2",children:a.description})]})}),e.jsx(H,{className:"px-4 py-4 text-sm",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(i.Icon,{path:x,size:.7,className:"text-primary"}),e.jsxs("span",{className:"font-medium text-primary",children:[a.discountPercent,"%"]})]})}),e.jsx(H,{className:"px-4 py-4 text-sm",children:Array.isArray(a.products)?e.jsx("span",{className:"text-maintext",children:0===a.products.length?"Tất cả sản phẩm":`${a.products.length} sản phẩm`}):e.jsx("span",{className:"text-maintext",children:"Tất cả sản phẩm"})}),e.jsx(H,{className:"px-4 py-4 text-sm",children:e.jsxs("div",{className:"text-xs",children:[e.jsx("div",{children:ie(a.startDate)}),e.jsxs("div",{className:"text-maintext",children:["đến ",ie(a.endDate)]})]})}),e.jsx(H,{className:"px-4 py-4 text-sm",children:le(a)}),e.jsx(H,{className:"px-4 py-4 text-sm text-right",children:e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsx("a",{href:`/admin/discounts/promotions/edit/${a.id}`,children:e.jsx(p,{variant:"outline",size:"icon",title:"Sửa",children:e.jsx(i.Icon,{path:o,size:.7})})}),e.jsx(p,{variant:"outline",size:"icon",onClick:()=>{se(a.id),ee(!0)},title:"Xóa",children:e.jsx(i.Icon,{path:m,size:.7})})]})})]},a.id))):e.jsx(S,{children:e.jsx(H,{colSpan:7,className:"px-4 py-8 text-center text-maintext",children:"Không tìm thấy chiến dịch khuyến mãi nào"})})})]})}),V&&V.data&&V.data.pagination&&e.jsxs("div",{className:"flex justify-center items-center space-x-2 p-4 border-t",children:[e.jsxs(p,{variant:"outline",size:"icon",onClick:()=>ne(1),disabled:1===V.data.pagination.currentPage,children:[e.jsx("span",{className:"sr-only",children:"Trang đầu"}),e.jsx("span",{children:"«"})]}),e.jsxs(p,{variant:"outline",size:"icon",onClick:()=>ne(V.data.pagination.currentPage-1),disabled:1===V.data.pagination.currentPage,children:[e.jsx("span",{className:"sr-only",children:"Trang trước"}),e.jsx("span",{children:"‹"})]}),[...Array(V.data.pagination.totalPages)].map(((a,s)=>{const t=s+1;return 1===t||t===V.data.pagination.totalPages||t>=V.data.pagination.currentPage-2&&t<=V.data.pagination.currentPage+2?e.jsx(p,{variant:t===V.data.pagination.currentPage?"default":"outline",size:"icon",onClick:()=>ne(t),children:t},t):t===V.data.pagination.currentPage-3||t===V.data.pagination.currentPage+3?e.jsx("span",{children:"..."},t):null})),e.jsxs(p,{variant:"outline",size:"icon",onClick:()=>ne(V.data.pagination.currentPage+1),disabled:V.data.pagination.currentPage===V.data.pagination.totalPages,children:[e.jsx("span",{className:"sr-only",children:"Trang sau"}),e.jsx("span",{children:"›"})]}),e.jsxs(p,{variant:"outline",size:"icon",onClick:()=>ne(V.data.pagination.totalPages),disabled:V.data.pagination.currentPage===V.data.pagination.totalPages,children:[e.jsx("span",{className:"sr-only",children:"Trang cuối"}),e.jsx("span",{children:"»"})]})]})]}),e.jsx(Dialog,{open:Z,onOpenChange:ee,children:e.jsxs(DialogContent,{children:[e.jsx(DialogHeader,{children:e.jsx(DialogTitle,{children:"Xác nhận xóa chiến dịch khuyến mãi"})}),e.jsx("p",{className:"py-4",children:"Bạn có chắc chắn muốn xóa chiến dịch khuyến mãi này không? Hành động này không thể hoàn tác."}),e.jsxs(DialogFooter,{children:[e.jsx(DialogClose,{asChild:!0,children:e.jsx(p,{variant:"outline",children:"Hủy"})}),e.jsx(p,{variant:"destructive",onClick:()=>ae&&(async e=>{try{await R.mutateAsync(e,{onSuccess:()=>{u.success("Đã xóa chiến dịch khuyến mãi thành công"),W.invalidateQueries({queryKey:["promotions"]}),ee(!1)}})}catch(a){u.error("Xóa chiến dịch khuyến mãi thất bại")}})(ae),disabled:R.isPending,children:R.isPending?e.jsxs(e.Fragment,{children:[e.jsx(i.Icon,{path:h,size:.7,className:"mr-2 animate-spin"}),"Đang xóa..."]}):"Xóa"})]})]})})]})}const B=()=>e.jsx(U,{});export{B as default};
