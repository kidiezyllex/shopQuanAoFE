import{j as e}from"./ui-vendor-CFM_MCUz.js";import{r as s,u as a}from"./react-vendor-B55MjJUH.js";import{C as t,a as n,b as i,c as r}from"./card-ClEzRAeX.js";import{B as l,I as c,y as d}from"./index-BHeY-5EX.js";import{T as o}from"./textarea-DHkaMSo6.js";import{S as m,a as h,b as x,c as u,d as j}from"./select-C6W71KWg.js";import{C as p}from"./checkbox-4N58UvKV.js";import{B as v}from"./badge-BeHegjHt.js";import{T as f,a as g,b as N,c as b,d as y,e as I}from"./table-DL-K3PV4.js";import{B as z,a as C,b as _,c as T,d as k,e as q}from"./breadcrumb-CP4jYkI2.js";import{k as w}from"./return-4pcPvvv5.js";import{t as S,M as A,bc as V,a9 as D,a6 as L,a5 as B}from"./icons-vendor-BrsZP2ku.js";import"./query-vendor-CBwfxcof.js";import"./heavy-vendor-BfN2pHnQ.js";function H(){const[H,Q]=s.useState(null),[E,M]=s.useState(null),[O,F]=s.useState([]),[G,K]=s.useState(""),[R,U]=s.useState([]),[Z,J]=s.useState([]),[P,W]=s.useState(!1),X=w(),Y=a(),$=[{id:"1",fullName:"Nguyễn Văn A",email:"a@example.com",phoneNumber:"0123456789"},{id:"2",fullName:"Trần Thị B",email:"b@example.com",phoneNumber:"0987654321"}],ee=[{id:"1",code:"ORD001",totalAmount:15e5,createdAt:"2024-01-15T10:00:00Z",status:"HOAN_THANH",items:[{id:"1",product:{id:"p1",name:"Giày thể thao Nike",code:"NIKE001",images:["/placeholder.jpg"]},variant:{colorId:"red",sizeId:"42",color:{name:"Đỏ"},size:{name:"42"}},quantity:2,price:75e4}]}];s.useEffect((()=>{if(G.trim()){const e=$.filter((e=>e.fullName.toLowerCase().includes(G.toLowerCase())||e.email.toLowerCase().includes(G.toLowerCase())||e.phoneNumber.includes(G)));U(e)}else U([])}),[G]),s.useEffect((()=>{J(H?ee:[])}),[H]);const se=e=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND",maximumFractionDigits:0}).format(e),ae=e=>new Date(e).toLocaleDateString("vi-VN"),te=(e,s)=>{F((a=>a.map(((a,t)=>t===e?{...a,quantity:Math.max(1,Math.min(s,a.maxQuantity))}:a))))},ne=e=>O.some((s=>s.product===e.(product as any)?.id&&s.variant.colorId===e.variant.colorId&&s.variant.sizeId===e.variant.sizeId)),ie=()=>O.reduce(((e,s)=>e+s.price*s.quantity),0);return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(z,{children:e.jsxs(C,{children:[e.jsx(_,{children:e.jsx(T,{href:"/admin/statistics",children:"Dashboard"})}),e.jsx(k,{}),e.jsx(_,{children:e.jsx(T,{href:"/admin/returns",children:"Quản lý trả hàng"})}),e.jsx(k,{}),e.jsx(_,{children:e.jsx(q,{children:"Tạo yêu cầu trả hàng mới"})})]})}),e.jsx("a",{href:"/admin/returns",className:"mr-2",children:e.jsxs(l,{variant:"outline",children:[e.jsx(S.Icon,{path:A,size:.7,className:"mr-2"}),"Quay lại"]})})]}),e.jsxs(t,{children:[e.jsx(n,{children:e.jsxs(i,{className:"flex items-center gap-2",children:[e.jsx(S.Icon,{path:V,size:1}),"Chọn khách hàng"]})}),e.jsx(r,{children:H?e.jsxs("div",{className:"flex items-center justify-between p-4 bg-green-50 border border-green-200 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:H.fullName}),e.jsx("p",{className:"text-sm text-maintext",children:H.email}),e.jsx("p",{className:"text-sm text-maintext",children:H.phoneNumber})]}),e.jsx(l,{variant:"outline",onClick:()=>Q(null),children:"Thay đổi"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"relative",children:e.jsx(c,{placeholder:"Tìm khách hàng theo tên, email hoặc số điện thoại...",value:G,onChange:e=>K(e.target.value)})}),R.length>0&&e.jsx("div",{className:"border rounded-lg max-h-60 overflow-y-auto",children:R.map((s=>e.jsxs("div",{className:"p-3 hover:bg-gray-50 cursor-pointer border-b last:border-b-0",onClick:()=>(e=>{Q(e),M(null),F([]),K(""),U([])})(s),children:[e.jsx("h4",{className:"font-medium",children:s.fullName}),e.jsx("p",{className:"text-sm text-maintext",children:s.email}),e.jsx("p",{className:"text-sm text-maintext",children:s.phoneNumber})]},s.id)))})]})})]}),H&&e.jsxs(t,{children:[e.jsx(n,{children:e.jsxs(i,{className:"flex items-center gap-2",children:[e.jsx(S.Icon,{path:D,size:1}),"Chọn đơn hàng"]})}),e.jsx(r,{children:E?e.jsxs("div",{className:"flex items-center justify-between p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold",children:["#",E.code]}),e.jsxs("p",{className:"text-sm text-maintext",children:["Ngày đặt: ",ae(E.createdAt)]}),e.jsxs("p",{className:"text-sm text-maintext",children:["Tổng tiền: ",se(E.totalAmount)]}),e.jsx(v,{variant:"outline",className:"bg-green-50 text-green-600 border-green-200 mt-1",children:E.status})]}),e.jsx(l,{variant:"outline",onClick:()=>M(null),children:"Thay đổi"})]}):e.jsx("div",{className:"space-y-4",children:e.jsxs(m,{onValueChange:e=>{const s=Z.find((s=>s.id===e));M(s||null),F([])},children:[e.jsx(h,{children:e.jsx(x,{placeholder:"Chọn đơn hàng đã hoàn thành..."})}),e.jsx(u,{children:Z.map((s=>e.jsx(j,{value:s.id,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{children:["#",s.code]}),e.jsxs("span",{className:"text-sm text-maintext",children:[ae(s.createdAt)," - ",se(s.totalAmount)]})]})},s.id)))})]})})})]}),E&&e.jsxs(t,{children:[e.jsx(n,{children:e.jsx(i,{children:"Chọn sản phẩm cần trả"})}),e.jsx(r,{children:e.jsx("div",{className:"space-y-4",children:E.items.map(((s,a)=>{var t,n,i,r;return e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(p,{checked:ne(s),onCheckedChange:e=>((e,s)=>{if(s){const s={product:e.(product as any)?.id,variant:e.variant,quantity:1,maxQuantity:e.quantity,price:e.price,reason:""};F((e=>[...e,s]))}else F((s=>s.filter((s=>!(s.product===e.(product as any)?.id&&s.variant.colorId===e.variant.colorId&&s.variant.sizeId===e.variant.sizeId)))))})(s,e)}),e.jsx("img",{src:s.product.images[0]||"/placeholder.jpg",alt:s.product.name,width:80,height:80,className:"rounded-md object-cover"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium",children:s.product.name}),e.jsxs("p",{className:"text-sm text-maintext",children:["SKU: ",s.product.code]}),e.jsxs("p",{className:"text-sm text-maintext",children:[null==(t=s.variant.color)?void 0:t.name," - ",null==(n=s.variant.size)?void 0:n.name]}),e.jsxs("p",{className:"text-sm text-maintext",children:["Đã mua: ",s.quantity," | Giá: ",se(s.price)]})]})]}),ne(s)&&e.jsxs("div",{className:"mt-4 space-y-3 pl-8",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Số lượng trả:"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{const e=O.findIndex((e=>e.product===s.(product as any)?.id&&e.variant.colorId===s.variant.colorId&&e.variant.sizeId===s.variant.sizeId));-1!==e&&te(e,O[e].quantity-1)},children:e.jsx(S.Icon,{path:L,size:.7})}),e.jsx(c,{type:"number",min:"1",max:s.quantity,value:(null==(i=O.find((e=>e.product===s.(product as any)?.id&&e.variant.colorId===s.variant.colorId&&e.variant.sizeId===s.variant.sizeId)))?void 0:i.quantity)||1,onChange:e=>{const a=O.findIndex((e=>e.product===s.(product as any)?.id&&e.variant.colorId===s.variant.colorId&&e.variant.sizeId===s.variant.sizeId));-1!==a&&te(a,parseInt(e.target.value)||1)},className:"w-20 text-center"}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{const e=O.findIndex((e=>e.product===s.(product as any)?.id&&e.variant.colorId===s.variant.colorId&&e.variant.sizeId===s.variant.sizeId));-1!==e&&te(e,O[e].quantity+1)},children:e.jsx(S.Icon,{path:B,size:.7})})]})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Lý do trả hàng *"}),e.jsx(o,{placeholder:"Nhập lý do trả hàng...",value:(null==(r=O.find((e=>e.product===s.(product as any)?.id&&e.variant.colorId===s.variant.colorId&&e.variant.sizeId===s.variant.sizeId)))?void 0:r.reason)||"",onChange:e=>{const a=O.findIndex((e=>e.product===s.(product as any)?.id&&e.variant.colorId===s.variant.colorId&&e.variant.sizeId===s.variant.sizeId));-1!==a&&((e,s)=>{F((a=>a.map(((a,t)=>t===e?{...a,reason:s}:a))))})(a,e.target.value)},rows:2})]})]})]},a)}))})})]}),O.length>0&&e.jsxs(t,{children:[e.jsx(n,{children:e.jsx(i,{children:"Tóm tắt yêu cầu trả hàng"})}),e.jsxs(r,{children:[e.jsxs(f,{children:[e.jsx(g,{children:e.jsxs(N,{children:[e.jsx(b,{children:"Sản phẩm"}),e.jsx(b,{children:"Số lượng"}),e.jsx(b,{children:"Đơn giá"}),e.jsx(b,{children:"Thành tiền"})]})}),e.jsx(y,{children:O.map(((s,a)=>{var t,n;const i=null==E?void 0:E.items.find((e=>e.(product as any)?.id===s.product&&e.variant.colorId===s.variant.colorId&&e.variant.sizeId===s.variant.sizeId));return e.jsxs(N,{children:[e.jsx(I,{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:null==i?void 0:i.product.name}),e.jsxs("p",{className:"text-sm text-maintext",children:[null==(t=null==i?void 0:i.variant.color)?void 0:t.name," - ",null==(n=null==i?void 0:i.variant.size)?void 0:n.name]})]})}),e.jsx(I,{children:s.quantity}),e.jsx(I,{children:se(s.price)}),e.jsx(I,{children:se(s.price*s.quantity)})]},a)}))})]}),e.jsx("div",{className:"border-t pt-4 mt-4",children:e.jsxs("div",{className:"flex justify-between items-center text-lg font-semibold",children:[e.jsx("span",{children:"Tổng tiền hoàn trả:"}),e.jsx("span",{className:"text-primary",children:se(ie())})]})})]})]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("a",{href:"/admin/returns",children:e.jsx(l,{variant:"outline",disabled:P,children:"Hủy"})}),e.jsx(l,{onClick:async()=>{if(!H||!E||0===O.length)return void d.error("Vui lòng chọn khách hàng, đơn hàng và sản phẩm cần trả");if(O.some((e=>!e.reason.trim())))d.error("Vui lòng nhập lý do trả hàng cho tất cả sản phẩm");else{W(!0);try{const e={originalOrder:E.id,customer:H.id,items:O.map((e=>({product:e.product,variant:e.variant,quantity:e.quantity,price:e.price,reason:e.reason}))),totalRefund:ie()};await X.mutateAsync(e),d.success("Tạo yêu cầu trả hàng thành công"),Y("/admin/returns")}catch(e){d.error("Tạo yêu cầu trả hàng thất bại")}finally{W(!1)}}},disabled:P||!H||!E||0===O.length,children:P?"Đang tạo...":"Tạo yêu cầu trả hàng"})]})]})}const Q=()=>e.jsx(H,{});export{Q as default};
