import{a as h,U as $,j as e,B as m,k as g,w as ee,bZ as ae,q as P,ae as se,ab as ne,aa as te,a6 as f}from"./index-Dpx_4rWJ.js";import{C as N,a as b,b as I,c as y}from"./card-fT6uSY2F.js";import{T as re}from"./textarea-D-7Bay0_.js";import{S as ie,a as ce,b as le,c as de,d as oe}from"./select-CS4vNzI5.js";import{C as he}from"./checkbox-BwYGdXvN.js";import{B as xe}from"./badge-CA2Kv9aL.js";import{T as me,a as ue,b as Q,c as C,d as pe,e as S}from"./table-BeX0puEz.js";import{B as je,a as ve,b as q,c as M,d as F,e as ge}from"./breadcrumb-CJedQ5QG.js";import{k as fe}from"./return-D2yKC1D3.js";import"./index-BdQq_4o_.js";import"./index-qvEK80KO.js";import"./createLucideIcon-BdgKQErZ.js";import"./check-CyKb8IHM.js";function Ne(){const[d,A]=h.useState(null),[c,z]=h.useState(null),[i,u]=h.useState([]),[p,B]=h.useState(""),[R,T]=h.useState([]),[L,V]=h.useState([]),[k,D]=h.useState(!1),G=fe(),K=$(),U=[{id:"1",fullName:"Nguyễn Văn A",email:"a@example.com",phoneNumber:"0123456789"},{id:"2",fullName:"Trần Thị B",email:"b@example.com",phoneNumber:"0987654321"}],Z=[{id:"1",code:"ORD001",totalAmount:15e5,createdAt:"2024-01-15T10:00:00Z",status:"HOAN_THANH",items:[{id:"1",product:{id:"p1",name:"Giày thể thao Nike",code:"NIKE001",images:["/placeholder.jpg"]},variant:{colorId:"red",sizeId:"42",color:{name:"Đỏ"},size:{name:"42"}},quantity:2,price:75e4}]}];h.useEffect(()=>{if(p.trim()){const a=U.filter(n=>n.fullName.toLowerCase().includes(p.toLowerCase())||n.email.toLowerCase().includes(p.toLowerCase())||n.phoneNumber.includes(p));T(a)}else T([])},[p]),h.useEffect(()=>{V(d?Z:[])},[d]);const j=a=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND",maximumFractionDigits:0}).format(a),E=a=>new Date(a).toLocaleDateString("vi-VN"),_=a=>{A(a),z(null),u([]),B(""),T([])},J=a=>{const n=L.find(s=>s.id===a);z(n||null),u([])},W=(a,n)=>{if(n){const s={product:a.product.id,variant:a.variant,quantity:1,maxQuantity:a.quantity,price:a.price,reason:""};u(r=>[...r,s])}else u(s=>s.filter(r=>!(r.product===a.product.id&&r.variant.colorId===a.variant.colorId&&r.variant.sizeId===a.variant.sizeId)))},w=(a,n)=>{u(s=>s.map((r,o)=>o===a?{...r,quantity:Math.max(1,Math.min(n,r.maxQuantity))}:r))},X=(a,n)=>{u(s=>s.map((r,o)=>o===a?{...r,reason:n}:r))},H=a=>i.some(n=>n.product===a.product.id&&n.variant.colorId===a.variant.colorId&&n.variant.sizeId===a.variant.sizeId),O=()=>i.reduce((a,n)=>a+n.price*n.quantity,0),Y=async()=>{if(!d||!c||i.length===0){f.error("Vui lòng chọn khách hàng, đơn hàng và sản phẩm cần trả");return}if(i.some(n=>!n.reason.trim())){f.error("Vui lòng nhập lý do trả hàng cho tất cả sản phẩm");return}D(!0);try{const n={originalOrder:c.id,customer:d.id,items:i.map(s=>({product:s.product,variant:s.variant,quantity:s.quantity,price:s.price,reason:s.reason})),totalRefund:O()};await G.mutateAsync(n),f.success("Tạo yêu cầu trả hàng thành công"),K("/admin/returns")}catch{f.error("Tạo yêu cầu trả hàng thất bại")}finally{D(!1)}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(je,{children:e.jsxs(ve,{children:[e.jsx(q,{children:e.jsx(M,{href:"/admin/statistics",children:"Dashboard"})}),e.jsx(F,{}),e.jsx(q,{children:e.jsx(M,{href:"/admin/returns",children:"Quản lý trả hàng"})}),e.jsx(F,{}),e.jsx(q,{children:e.jsx(ge,{children:"Tạo yêu cầu trả hàng mới"})})]})}),e.jsx("a",{href:"/admin/returns",className:"mr-2",children:e.jsxs(m,{variant:"outline",children:[e.jsx(g.Icon,{path:ee,size:.7,className:"mr-2"}),"Quay lại"]})})]}),e.jsxs(N,{children:[e.jsx(b,{children:e.jsxs(I,{className:"flex items-center gap-2",children:[e.jsx(g.Icon,{path:ae,size:1}),"Chọn khách hàng"]})}),e.jsx(y,{children:d?e.jsxs("div",{className:"flex items-center justify-between p-4 bg-green-50 border border-green-200 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:d.fullName}),e.jsx("p",{className:"text-sm text-maintext",children:d.email}),e.jsx("p",{className:"text-sm text-maintext",children:d.phoneNumber})]}),e.jsx(m,{variant:"outline",onClick:()=>A(null),children:"Thay đổi"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"relative",children:e.jsx(P,{placeholder:"Tìm khách hàng theo tên, email hoặc số điện thoại...",value:p,onChange:a=>B(a.target.value)})}),R.length>0&&e.jsx("div",{className:"border rounded-lg max-h-60 overflow-y-auto",children:R.map(a=>e.jsxs("div",{className:"p-3 hover:bg-gray-50 cursor-pointer border-b last:border-b-0",onClick:()=>_(a),children:[e.jsx("h4",{className:"font-medium",children:a.fullName}),e.jsx("p",{className:"text-sm text-maintext",children:a.email}),e.jsx("p",{className:"text-sm text-maintext",children:a.phoneNumber})]},a.id))})]})})]}),d&&e.jsxs(N,{children:[e.jsx(b,{children:e.jsxs(I,{className:"flex items-center gap-2",children:[e.jsx(g.Icon,{path:se,size:1}),"Chọn đơn hàng"]})}),e.jsx(y,{children:c?e.jsxs("div",{className:"flex items-center justify-between p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold",children:["#",c.code]}),e.jsxs("p",{className:"text-sm text-maintext",children:["Ngày đặt: ",E(c.createdAt)]}),e.jsxs("p",{className:"text-sm text-maintext",children:["Tổng tiền: ",j(c.totalAmount)]}),e.jsx(xe,{variant:"outline",className:"bg-green-50 text-green-600 border-green-200 mt-1",children:c.status})]}),e.jsx(m,{variant:"outline",onClick:()=>z(null),children:"Thay đổi"})]}):e.jsx("div",{className:"space-y-4",children:e.jsxs(ie,{onValueChange:J,children:[e.jsx(ce,{children:e.jsx(le,{placeholder:"Chọn đơn hàng đã hoàn thành..."})}),e.jsx(de,{children:L.map(a=>e.jsx(oe,{value:a.id,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{children:["#",a.code]}),e.jsxs("span",{className:"text-sm text-maintext",children:[E(a.createdAt)," - ",j(a.totalAmount)]})]})},a.id))})]})})})]}),c&&e.jsxs(N,{children:[e.jsx(b,{children:e.jsx(I,{children:"Chọn sản phẩm cần trả"})}),e.jsx(y,{children:e.jsx("div",{className:"space-y-4",children:c.items.map((a,n)=>{var s,r,o,v;return e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(he,{checked:H(a),onCheckedChange:t=>W(a,t)}),e.jsx("img",{src:a.product.images[0]||"/placeholder.jpg",alt:a.product.name,width:80,height:80,className:"rounded-md object-cover"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium",children:a.product.name}),e.jsxs("p",{className:"text-sm text-maintext",children:["SKU: ",a.product.code]}),e.jsxs("p",{className:"text-sm text-maintext",children:[(s=a.variant.color)==null?void 0:s.name," - ",(r=a.variant.size)==null?void 0:r.name]}),e.jsxs("p",{className:"text-sm text-maintext",children:["Đã mua: ",a.quantity," | Giá: ",j(a.price)]})]})]}),H(a)&&e.jsxs("div",{className:"mt-4 space-y-3 pl-8",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Số lượng trả:"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(m,{variant:"outline",size:"sm",onClick:()=>{const t=i.findIndex(l=>l.product===a.product.id&&l.variant.colorId===a.variant.colorId&&l.variant.sizeId===a.variant.sizeId);t!==-1&&w(t,i[t].quantity-1)},children:e.jsx(g.Icon,{path:ne,size:.7})}),e.jsx(P,{type:"number",min:"1",max:a.quantity,value:((o=i.find(t=>t.product===a.product.id&&t.variant.colorId===a.variant.colorId&&t.variant.sizeId===a.variant.sizeId))==null?void 0:o.quantity)||1,onChange:t=>{const l=i.findIndex(x=>x.product===a.product.id&&x.variant.colorId===a.variant.colorId&&x.variant.sizeId===a.variant.sizeId);l!==-1&&w(l,parseInt(t.target.value)||1)},className:"w-20 text-center"}),e.jsx(m,{variant:"outline",size:"sm",onClick:()=>{const t=i.findIndex(l=>l.product===a.product.id&&l.variant.colorId===a.variant.colorId&&l.variant.sizeId===a.variant.sizeId);t!==-1&&w(t,i[t].quantity+1)},children:e.jsx(g.Icon,{path:te,size:.7})})]})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Lý do trả hàng *"}),e.jsx(re,{placeholder:"Nhập lý do trả hàng...",value:((v=i.find(t=>t.product===a.product.id&&t.variant.colorId===a.variant.colorId&&t.variant.sizeId===a.variant.sizeId))==null?void 0:v.reason)||"",onChange:t=>{const l=i.findIndex(x=>x.product===a.product.id&&x.variant.colorId===a.variant.colorId&&x.variant.sizeId===a.variant.sizeId);l!==-1&&X(l,t.target.value)},rows:2})]})]})]},n)})})})]}),i.length>0&&e.jsxs(N,{children:[e.jsx(b,{children:e.jsx(I,{children:"Tóm tắt yêu cầu trả hàng"})}),e.jsxs(y,{children:[e.jsxs(me,{children:[e.jsx(ue,{children:e.jsxs(Q,{children:[e.jsx(C,{children:"Sản phẩm"}),e.jsx(C,{children:"Số lượng"}),e.jsx(C,{children:"Đơn giá"}),e.jsx(C,{children:"Thành tiền"})]})}),e.jsx(pe,{children:i.map((a,n)=>{var r,o;const s=c==null?void 0:c.items.find(v=>v.product.id===a.product&&v.variant.colorId===a.variant.colorId&&v.variant.sizeId===a.variant.sizeId);return e.jsxs(Q,{children:[e.jsx(S,{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s==null?void 0:s.product.name}),e.jsxs("p",{className:"text-sm text-maintext",children:[(r=s==null?void 0:s.variant.color)==null?void 0:r.name," - ",(o=s==null?void 0:s.variant.size)==null?void 0:o.name]})]})}),e.jsx(S,{children:a.quantity}),e.jsx(S,{children:j(a.price)}),e.jsx(S,{children:j(a.price*a.quantity)})]},n)})})]}),e.jsx("div",{className:"border-t pt-4 mt-4",children:e.jsxs("div",{className:"flex justify-between items-center text-lg font-semibold",children:[e.jsx("span",{children:"Tổng tiền hoàn trả:"}),e.jsx("span",{className:"text-primary",children:j(O())})]})})]})]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("a",{href:"/admin/returns",children:e.jsx(m,{variant:"outline",disabled:k,children:"Hủy"})}),e.jsx(m,{onClick:Y,disabled:k||!d||!c||i.length===0,children:k?"Đang tạo...":"Tạo yêu cầu trả hàng"})]})]})}const Le=()=>e.jsx(Ne,{});export{Le as default};
