import{a as I,U as Y,j as s,B as m,k as x,w as F,ad as V,ab as X,q as $,aa as G,br as J,a6 as T,b9 as W}from"./index-Dpx_4rWJ.js";import{C as u,c as j,a as w,b as q}from"./card-fT6uSY2F.js";import{T as Z}from"./textarea-D-7Bay0_.js";import{B as p}from"./badge-CA2Kv9aL.js";import{T as ss,a as es,b as H,c as g,d as as,e as N}from"./table-BeX0puEz.js";import{B as ns,a as ts,b as S,c as A,d as L,e as rs}from"./breadcrumb-CJedQ5QG.js";import{j as cs,l as is}from"./return-D2yKC1D3.js";import{f as ls,l as ds}from"./index-VIuxkY8Z.js";import"./createLucideIcon-BdgKQErZ.js";import"./typeof-QjJsDpFa.js";function hs({params:o}){const{id:B}=o,[d,f]=I.useState([]),[y,R]=I.useState(!1),{data:r,isLoading:z,isError:Q}=cs(B),K=is(),_=Y();I.useEffect(()=>{if(r!=null&&r.data){const e=r.data.items.map(a=>{var t,c,h,k,E;return{product:typeof a.product=="string"?a.product:a.product.id,variant:a.variant,quantity:a.quantity,price:a.price,reason:a.reason||"",maxQuantity:a.quantity+5,productName:typeof a.product=="string"?"Sản phẩm":a.product.name,productCode:typeof a.product=="string"?a.product:a.product.code,productImage:typeof a.product=="string"?"/placeholder.jpg":((t=a.product.images)==null?void 0:t[0])||"/placeholder.jpg",variantInfo:`${((h=(c=a.variant)==null?void 0:c.color)==null?void 0:h.name)||"N/A"} - ${((E=(k=a.variant)==null?void 0:k.size)==null?void 0:E.name)||"N/A"}`}});f(e)}},[r]);const i=e=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND",maximumFractionDigits:0}).format(e),D=e=>ls(new Date(e),"dd/MM/yyyy HH:mm",{locale:ds}),M=e=>{switch(e){case"CHO_XU_LY":return s.jsx(p,{variant:"outline",className:"bg-yellow-50 text-yellow-600 border-yellow-200",children:"Chờ xử lý"});case"DA_HOAN_TIEN":return s.jsx(p,{variant:"outline",className:"bg-green-50 text-green-600 border-green-200",children:"Đã hoàn tiền"});case"DA_HUY":return s.jsx(p,{variant:"outline",className:"bg-red-50 text-red-600 border-red-200",children:"Đã hủy"});default:return s.jsx(p,{variant:"outline",children:"Không xác định"})}},b=(e,a)=>{f(t=>t.map((c,h)=>h===e?{...c,quantity:Math.max(1,Math.min(a,c.maxQuantity))}:c))},O=(e,a)=>{f(t=>t.map((c,h)=>h===e?{...c,reason:a}:c))},v=()=>d.reduce((e,a)=>e+a.price*a.quantity,0),P=async()=>{if(d.length===0){T.error("Phải có ít nhất một sản phẩm trong yêu cầu trả hàng");return}R(!0);try{const e={items:d.map(a=>({product:a.product,variant:a.variant,quantity:a.quantity,price:a.price,reason:a.reason})),totalRefund:v()};await K.mutateAsync({returnId:B,payload:e}),T.success("Cập nhật yêu cầu trả hàng thành công"),_("/admin/returns")}catch{T.error("Cập nhật yêu cầu trả hàng thất bại")}finally{R(!1)}};if(z)return s.jsxs("div",{className:"space-y-4",children:[s.jsx("div",{className:"h-8 bg-gray-200 rounded animate-pulse"}),s.jsx("div",{className:"h-64 bg-gray-200 rounded animate-pulse"}),s.jsx("div",{className:"h-64 bg-gray-200 rounded animate-pulse"})]});if(Q||!(r!=null&&r.data))return s.jsxs("div",{className:"text-center py-8",children:[s.jsx("p",{className:"text-red-500",children:"Không thể tải thông tin yêu cầu trả hàng"}),s.jsx("a",{href:"/admin/returns",className:"mt-4",children:s.jsx(m,{className:"mt-4",children:"Quay lại danh sách"})})]});const n=r.data,C=typeof n.customer=="string"?{fullName:"Không có thông tin",email:"",phoneNumber:""}:n.customer,U=typeof n.originalOrder=="string"?{code:n.originalOrder}:n.originalOrder,l=n.status==="CHO_XU_LY";return s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex justify-between items-start",children:[s.jsx(ns,{children:s.jsxs(ts,{children:[s.jsx(S,{children:s.jsx(A,{href:"/admin/statistics",children:"Dashboard"})}),s.jsx(L,{}),s.jsx(S,{children:s.jsx(A,{href:"/admin/returns",children:"Quản lý trả hàng"})}),s.jsx(L,{}),s.jsx(S,{children:s.jsx(rs,{children:"Chỉnh sửa yêu cầu trả hàng"})})]})}),s.jsx("a",{href:"/admin/returns",className:"mr-2",children:s.jsxs(m,{variant:"outline",children:[s.jsx(x.Icon,{path:F,size:.7,className:"mr-2"}),"Quay lại"]})})]}),!l&&s.jsx(u,{className:"border-orange-200 bg-orange-50",children:s.jsx(j,{className:"p-4",children:s.jsxs("div",{className:"flex items-center gap-2 text-orange-700",children:[s.jsx(x.Icon,{path:V,size:.8}),s.jsx("p",{className:"font-medium",children:'Không thể chỉnh sửa yêu cầu trả hàng này vì trạng thái không phải "Chờ xử lý"'})]})})}),s.jsxs(u,{children:[s.jsx(w,{children:s.jsxs(q,{className:"flex items-center justify-between",children:[s.jsx("span",{children:"Thông tin yêu cầu trả hàng"}),M(n.status)]})}),s.jsx(j,{children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"font-semibold",children:"Thông tin yêu cầu"}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[s.jsxs("div",{children:[s.jsx("span",{className:"text-maintext",children:"Mã yêu cầu:"}),s.jsxs("span",{className:"ml-2 font-medium",children:["#",n.code]})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-maintext",children:"Ngày tạo:"}),s.jsx("span",{className:"ml-2 font-medium",children:D(n.createdAt)})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-maintext",children:"Đơn hàng gốc:"}),s.jsxs("span",{className:"ml-2 font-medium",children:["#",U.code]})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-maintext",children:"Tổng tiền hiện tại:"}),s.jsx("span",{className:"ml-2 font-medium text-primary",children:i(n.totalRefund)})]})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h3",{className:"font-semibold",children:"Thông tin khách hàng"}),s.jsxs("div",{className:"grid grid-cols-1 gap-4 text-sm",children:[s.jsxs("div",{children:[s.jsx("span",{className:"text-maintext",children:"Tên khách hàng:"}),s.jsx("span",{className:"ml-2 font-medium",children:C.fullName})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-maintext",children:"Email:"}),s.jsx("span",{className:"ml-2 font-medium",children:C.email||"Không có"})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-maintext",children:"Số điện thoại:"}),s.jsx("span",{className:"ml-2 font-medium",children:C.phoneNumber||"Không có"})]})]})]})]})})]}),s.jsxs(u,{children:[s.jsxs(w,{children:[s.jsx(q,{children:"Sản phẩm trả hàng"}),l&&s.jsx("p",{className:"text-sm text-maintext",children:"Bạn có thể chỉnh sửa số lượng và lý do trả hàng cho từng sản phẩm"})]}),s.jsx(j,{children:s.jsx("div",{className:"space-y-4",children:d.map((e,a)=>s.jsxs("div",{className:"border rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-start gap-4",children:[s.jsx("img",{src:e.productImage,alt:e.productName,width:80,height:80,className:"rounded-md object-cover"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h4",{className:"font-medium",children:e.productName}),s.jsxs("p",{className:"text-sm text-maintext",children:["SKU: ",e.productCode]}),s.jsx("p",{className:"text-sm text-maintext",children:e.variantInfo}),s.jsxs("p",{className:"text-sm text-maintext",children:["Giá: ",i(e.price)]})]}),l&&s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"text-sm font-medium",children:"Số lượng:"}),s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(m,{variant:"outline",size:"sm",onClick:()=>b(a,e.quantity-1),disabled:e.quantity<=1,children:s.jsx(x.Icon,{path:X,size:.7})}),s.jsx($,{type:"number",min:"1",max:e.maxQuantity,value:e.quantity,onChange:t=>b(a,parseInt(t.target.value)||1),className:"w-20 text-center"}),s.jsx(m,{variant:"outline",size:"sm",onClick:()=>b(a,e.quantity+1),disabled:e.quantity>=e.maxQuantity,children:s.jsx(x.Icon,{path:G,size:.7})})]})]}),!l&&s.jsxs("div",{className:"text-right",children:[s.jsx("p",{className:"text-sm text-maintext",children:"Số lượng"}),s.jsx("p",{className:"font-medium",children:e.quantity})]})]}),l&&s.jsxs("div",{className:"mt-4",children:[s.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Lý do trả hàng"}),s.jsx(Z,{placeholder:"Nhập lý do trả hàng...",value:e.reason||"",onChange:t=>O(a,t.target.value),rows:2})]}),!l&&e.reason&&s.jsxs("div",{className:"mt-4",children:[s.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Lý do trả hàng"}),s.jsx("p",{className:"text-sm text-maintext p-2 bg-gray-50 rounded",children:e.reason})]}),s.jsx("div",{className:"mt-2 pt-2 border-t",children:s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-sm text-maintext",children:"Thành tiền:"}),s.jsx("span",{className:"font-medium",children:i(e.price*e.quantity)})]})})]},a))})})]}),s.jsxs(u,{children:[s.jsx(w,{children:s.jsx(q,{children:"Tóm tắt"})}),s.jsxs(j,{children:[s.jsxs(ss,{children:[s.jsx(es,{children:s.jsxs(H,{children:[s.jsx(g,{children:"Sản phẩm"}),s.jsx(g,{children:"Số lượng"}),s.jsx(g,{children:"Đơn giá"}),s.jsx(g,{children:"Thành tiền"})]})}),s.jsx(as,{children:d.map((e,a)=>s.jsxs(H,{children:[s.jsx(N,{children:s.jsxs("div",{children:[s.jsx("p",{className:"font-medium",children:e.productName}),s.jsx("p",{className:"text-sm text-maintext",children:e.variantInfo})]})}),s.jsx(N,{children:e.quantity}),s.jsx(N,{children:i(e.price)}),s.jsx(N,{children:i(e.price*e.quantity)})]},a))})]}),s.jsxs("div",{className:"border-t pt-4 mt-4",children:[s.jsxs("div",{className:"flex justify-between items-center text-lg font-semibold",children:[s.jsx("span",{children:"Tổng tiền hoàn trả mới:"}),s.jsx("span",{className:"text-primary",children:i(v())})]}),v()!==n.totalRefund&&s.jsxs("div",{className:"flex justify-between items-center text-sm text-maintext mt-1",children:[s.jsx("span",{children:"Tổng tiền cũ:"}),s.jsx("span",{children:i(n.totalRefund)})]})]})]})]}),l&&s.jsxs("div",{className:"flex justify-end gap-4",children:[s.jsx("a",{href:"/admin/returns",children:s.jsx(m,{variant:"outline",disabled:y,children:"Hủy"})}),s.jsxs(m,{onClick:P,disabled:y||d.length===0,children:[s.jsx(x.Icon,{path:J,size:.7,className:"mr-2"}),y?"Đang lưu...":"Lưu thay đổi"]})]})]})}const bs=()=>{const{id:o}=W();return o?s.jsx(hs,{params:{id:o}}):s.jsxs("div",{className:"container mx-auto px-4 py-8",children:[s.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Sửa trả hàng"}),s.jsx("p",{className:"text-gray-600",children:"ID trả hàng không hợp lệ"})]})};export{bs as default};
