import{j as e}from"./ui-vendor-CFM_MCUz.js";import{r as s,u as a,i as t}from"./react-vendor-B55MjJUH.js";import{C as n,c as i,a as r,b as c}from"./card-ClEzRAeX.js";import{B as l,I as d,y as m}from"./index-BHeY-5EX.js";import{T as h}from"./textarea-DHkaMSo6.js";import{B as x}from"./badge-BeHegjHt.js";import{T as o,a as j,b as u,c as p,d as g,e as N}from"./table-DL-K3PV4.js";import{B as f,a as y,b as v,c as b,d as q,e as I}from"./breadcrumb-CP4jYkI2.js";import{j as w,l as C}from"./return-4pcPvvv5.js";import{t as T,M as S,a8 as k,a6 as z,a5 as _,aY as A}from"./icons-vendor-BrsZP2ku.js";import{f as D}from"./utils-vendor-C6znz4jh.js";import{l as H}from"./index-DwIVA3Vd.js";import"./query-vendor-CBwfxcof.js";import"./heavy-vendor-BfN2pHnQ.js";function K({params:t}){const{id:K}=t,[Q,L]=s.useState([]),[M,O]=s.useState(!1),{data:B,isLoading:E,isError:R}=w(K),U=C(),Y=a();s.useEffect((()=>{if(null==B?void 0:B.data){const e=B.data.items.map((e=>{var s,a,t,n,i;return{product:"string"==typeof e.product?e.product:e.(product as any)?.id,variant:e.variant,quantity:e.quantity,price:e.price,reason:e.reason||"",maxQuantity:e.quantity+5,productName:"string"==typeof e.product?"Sản phẩm":e.product.name,productCode:"string"==typeof e.product?e.product:e.product.code,productImage:"string"==typeof e.product?"/placeholder.jpg":(null==(s=e.product.images)?void 0:s[0])||"/placeholder.jpg",variantInfo:`${(null==(t=null==(a=e.variant)?void 0:a.color)?void 0:t.name)||"N/A"} - ${(null==(i=null==(n=e.variant)?void 0:n.size)?void 0:i.name)||"N/A"}`}}));L(e)}}),[B]);const F=e=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND",maximumFractionDigits:0}).format(e),V=(e,s)=>{L((a=>a.map(((a,t)=>t===e?{...a,quantity:Math.max(1,Math.min(s,a.maxQuantity))}:a))))},X=()=>Q.reduce(((e,s)=>e+s.price*s.quantity),0);if(E)return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"h-64 bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"h-64 bg-gray-200 rounded animate-pulse"})]});if(R||!(null==B?void 0:B.data))return e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-red-500",children:"Không thể tải thông tin yêu cầu trả hàng"}),e.jsx("a",{href:"/admin/returns",className:"mt-4",children:e.jsx(l,{className:"mt-4",children:"Quay lại danh sách"})})]});const $=B.data,G="string"==typeof $.customer?{fullName:"Không có thông tin",email:"",phoneNumber:""}:$.customer,P="string"==typeof $.originalOrder?{code:$.originalOrder}:$.originalOrder,J="CHO_XU_LY"===$.status;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(f,{children:e.jsxs(y,{children:[e.jsx(v,{children:e.jsx(b,{href:"/admin/statistics",children:"Dashboard"})}),e.jsx(q,{}),e.jsx(v,{children:e.jsx(b,{href:"/admin/returns",children:"Quản lý trả hàng"})}),e.jsx(q,{}),e.jsx(v,{children:e.jsx(I,{children:"Chỉnh sửa yêu cầu trả hàng"})})]})}),e.jsx("a",{href:"/admin/returns",className:"mr-2",children:e.jsxs(l,{variant:"outline",children:[e.jsx(T.Icon,{path:S,size:.7,className:"mr-2"}),"Quay lại"]})})]}),!J&&e.jsx(n,{className:"border-orange-200 bg-orange-50",children:e.jsx(i,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2 text-orange-700",children:[e.jsx(T.Icon,{path:k,size:.8}),e.jsx("p",{className:"font-medium",children:'Không thể chỉnh sửa yêu cầu trả hàng này vì trạng thái không phải "Chờ xử lý"'})]})})}),e.jsxs(n,{children:[e.jsx(r,{children:e.jsxs(c,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Thông tin yêu cầu trả hàng"}),(s=>{switch(s){case"CHO_XU_LY":return e.jsx(x,{variant:"outline",className:"bg-yellow-50 text-yellow-600 border-yellow-200",children:"Chờ xử lý"});case"DA_HOAN_TIEN":return e.jsx(x,{variant:"outline",className:"bg-green-50 text-green-600 border-green-200",children:"Đã hoàn tiền"});case"DA_HUY":return e.jsx(x,{variant:"outline",className:"bg-red-50 text-red-600 border-red-200",children:"Đã hủy"});default:return e.jsx(x,{variant:"outline",children:"Không xác định"})}})($.status)]})}),e.jsx(i,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold",children:"Thông tin yêu cầu"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-maintext",children:"Mã yêu cầu:"}),e.jsxs("span",{className:"ml-2 font-medium",children:["#",$.code]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-maintext",children:"Ngày tạo:"}),e.jsx("span",{className:"ml-2 font-medium",children:(W=$.createdAt,D(new Date(W),"dd/MM/yyyy HH:mm",{locale:H}))})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-maintext",children:"Đơn hàng gốc:"}),e.jsxs("span",{className:"ml-2 font-medium",children:["#",P.code]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-maintext",children:"Tổng tiền hiện tại:"}),e.jsx("span",{className:"ml-2 font-medium text-primary",children:F($.totalRefund)})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold",children:"Thông tin khách hàng"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-maintext",children:"Tên khách hàng:"}),e.jsx("span",{className:"ml-2 font-medium",children:G.fullName})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-maintext",children:"Email:"}),e.jsx("span",{className:"ml-2 font-medium",children:G.email||"Không có"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-maintext",children:"Số điện thoại:"}),e.jsx("span",{className:"ml-2 font-medium",children:G.phoneNumber||"Không có"})]})]})]})]})})]}),e.jsxs(n,{children:[e.jsxs(r,{children:[e.jsx(c,{children:"Sản phẩm trả hàng"}),J&&e.jsx("p",{className:"text-sm text-maintext",children:"Bạn có thể chỉnh sửa số lượng và lý do trả hàng cho từng sản phẩm"})]}),e.jsx(i,{children:e.jsx("div",{className:"space-y-4",children:Q.map(((s,a)=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("img",{src:s.productImage,alt:s.productName,width:80,height:80,className:"rounded-md object-cover"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium",children:s.productName}),e.jsxs("p",{className:"text-sm text-maintext",children:["SKU: ",s.productCode]}),e.jsx("p",{className:"text-sm text-maintext",children:s.variantInfo}),e.jsxs("p",{className:"text-sm text-maintext",children:["Giá: ",F(s.price)]})]}),J&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Số lượng:"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(l,{variant:"outline",size:"sm",onClick:()=>V(a,s.quantity-1),disabled:s.quantity<=1,children:e.jsx(T.Icon,{path:z,size:.7})}),e.jsx(d,{type:"number",min:"1",max:s.maxQuantity,value:s.quantity,onChange:e=>V(a,parseInt(e.target.value)||1),className:"w-20 text-center"}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>V(a,s.quantity+1),disabled:s.quantity>=s.maxQuantity,children:e.jsx(T.Icon,{path:_,size:.7})})]})]}),!J&&e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-maintext",children:"Số lượng"}),e.jsx("p",{className:"font-medium",children:s.quantity})]})]}),J&&e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Lý do trả hàng"}),e.jsx(h,{placeholder:"Nhập lý do trả hàng...",value:s.reason||"",onChange:e=>((e,s)=>{L((a=>a.map(((a,t)=>t===e?{...a,reason:s}:a))))})(a,e.target.value),rows:2})]}),!J&&s.reason&&e.jsxs("div",{className:"mt-4",children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Lý do trả hàng"}),e.jsx("p",{className:"text-sm text-maintext p-2 bg-gray-50 rounded",children:s.reason})]}),e.jsx("div",{className:"mt-2 pt-2 border-t",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-maintext",children:"Thành tiền:"}),e.jsx("span",{className:"font-medium",children:F(s.price*s.quantity)})]})})]},a)))})})]}),e.jsxs(n,{children:[e.jsx(r,{children:e.jsx(c,{children:"Tóm tắt"})}),e.jsxs(i,{children:[e.jsxs(o,{children:[e.jsx(j,{children:e.jsxs(u,{children:[e.jsx(p,{children:"Sản phẩm"}),e.jsx(p,{children:"Số lượng"}),e.jsx(p,{children:"Đơn giá"}),e.jsx(p,{children:"Thành tiền"})]})}),e.jsx(g,{children:Q.map(((s,a)=>e.jsxs(u,{children:[e.jsx(N,{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.productName}),e.jsx("p",{className:"text-sm text-maintext",children:s.variantInfo})]})}),e.jsx(N,{children:s.quantity}),e.jsx(N,{children:F(s.price)}),e.jsx(N,{children:F(s.price*s.quantity)})]},a)))})]}),e.jsxs("div",{className:"border-t pt-4 mt-4",children:[e.jsxs("div",{className:"flex justify-between items-center text-lg font-semibold",children:[e.jsx("span",{children:"Tổng tiền hoàn trả mới:"}),e.jsx("span",{className:"text-primary",children:F(X())})]}),X()!==$.totalRefund&&e.jsxs("div",{className:"flex justify-between items-center text-sm text-maintext mt-1",children:[e.jsx("span",{children:"Tổng tiền cũ:"}),e.jsx("span",{children:F($.totalRefund)})]})]})]})]}),J&&e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("a",{href:"/admin/returns",children:e.jsx(l,{variant:"outline",disabled:M,children:"Hủy"})}),e.jsxs(l,{onClick:async()=>{if(0!==Q.length){O(!0);try{const e={items:Q.map((e=>({product:e.product,variant:e.variant,quantity:e.quantity,price:e.price,reason:e.reason}))),totalRefund:X()};await U.mutateAsync({returnId:K,payload:e}),m.success("Cập nhật yêu cầu trả hàng thành công"),Y("/admin/returns")}catch(e){m.error("Cập nhật yêu cầu trả hàng thất bại")}finally{O(!1)}}else m.error("Phải có ít nhất một sản phẩm trong yêu cầu trả hàng")},disabled:M||0===Q.length,children:[e.jsx(T.Icon,{path:A,size:.7,className:"mr-2"}),M?"Đang lưu...":"Lưu thay đổi"]})]})]});var W}const Q=()=>{const{id:s}=t();return s?e.jsx(K,{params:{id:s}}):e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Sửa trả hàng"}),e.jsx("p",{className:"text-gray-600",children:"ID trả hàng không hợp lệ"})]})};export{Q as default};
