import{a as u,j as e,an as me,aA as _e,k as i,aK as Me,p as $,ad as G,aM as He,B as x,aB as ze,q as J,ao as z,t as ue,aJ as Re,bY as Ke,aa as Pe,ap as Ue,A as Be,m as Ee,aL as ie,a2 as _,G as Le,H as Fe,b3 as Ye,M as Ve,P as R,O as Q,bg as Xe,bh as qe,a6 as H,at as Qe}from"./index-Dpx_4rWJ.js";import{C as k,c as A}from"./card-fT6uSY2F.js";import{e as $e,f as Ge,g as Je,h as We,i as Ze,j as Ie}from"./return-D2yKC1D3.js";import{B as es,a as ss,b as ce,c as as,d as ts,e as ns}from"./breadcrumb-CJedQ5QG.js";import{T as W,a as Z,b as M,c as o,d as I,e as h}from"./table-BeX0puEz.js";import{B as p}from"./badge-CA2Kv9aL.js";import{T as ls,b as is,c as K}from"./tabs-BXj1bKUw.js";import{P as re,a as de,b as oe,C as he}from"./calendar-DHAspv0I.js";import{S as cs,a as rs,b as ds,c as os,d as xe}from"./select-CS4vNzI5.js";import{D as P,a as U,b as B,c as E,e as je,i as hs}from"./dialog-BuHyDe_9.js";import{f as T,l as ge}from"./index-VIuxkY8Z.js";import"./createLucideIcon-BdgKQErZ.js";import"./typeof-QjJsDpFa.js";import"./index-BdQq_4o_.js";import"./index-qvEK80KO.js";import"./check-CyKb8IHM.js";const xs=_e("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),pe=u.forwardRef(({className:j,variant:N,...a},m)=>e.jsx("div",{ref:m,role:"alert",className:me(xs({variant:N}),j),...a}));pe.displayName="Alert";const Ne=u.forwardRef(({className:j,...N},a)=>e.jsx("div",{ref:a,className:me("text-sm [&_p]:leading-relaxed",j),...N}));Ne.displayName="AlertDescription";function ms({isOpen:j,onClose:N,onConfirm:a,returnId:m,currentStatus:C,isLoading:f=!1}){const[t,c]=u.useState(""),r=v=>{switch(v){case"DA_HOAN_TIEN":return{label:"Phê duyệt hoàn tiền",color:"text-green-600",bgColor:"bg-green-50",borderColor:"border-green-200",icon:$,description:"Yêu cầu trả hàng sẽ được phê duyệt và tiền sẽ được hoàn trả cho khách hàng."};case"DA_HUY":return{label:"Từ chối yêu cầu",color:"text-red-600",bgColor:"bg-red-50",borderColor:"border-red-200",icon:G,description:"Yêu cầu trả hàng sẽ bị từ chối và không có tiền hoàn trả."};default:return null}},w=async()=>{!t||t!=="DA_HOAN_TIEN"&&t!=="DA_HUY"||(await a(m,t),c(""))},S=()=>{c(""),N()},n=t?r(t):null;return e.jsx(P,{open:j,onOpenChange:S,children:e.jsxs(U,{className:"max-w-4xl",children:[e.jsx(B,{children:e.jsxs(E,{className:"flex items-center gap-2",children:[e.jsx(i.Icon,{path:Me,size:1,className:"text-orange-500"}),"Cập nhật trạng thái yêu cầu trả hàng"]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-maintext mb-2",children:"Trạng thái hiện tại:"}),e.jsx(p,{variant:"outline",className:"bg-yellow-50 text-yellow-600 border-yellow-200",children:"Chờ xử lý"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Chọn trạng thái mới:"}),e.jsxs(cs,{value:t,onValueChange:c,children:[e.jsx(rs,{children:e.jsx(ds,{placeholder:"Chọn trạng thái..."})}),e.jsxs(os,{children:[e.jsx(xe,{value:"DA_HOAN_TIEN",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(i.Icon,{path:$,size:.7,className:"text-green-600"}),"Phê duyệt hoàn tiền"]})}),e.jsx(xe,{value:"DA_HUY",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(i.Icon,{path:G,size:.7,className:"text-red-600"}),"Từ chối yêu cầu"]})})]})]})]}),n&&e.jsxs(pe,{className:`${n.bgColor} ${n.borderColor}`,children:[e.jsx(i.Icon,{path:n.icon,size:.7,className:n.color}),e.jsxs(Ne,{className:n.color,children:[e.jsx("strong",{children:n.label}),e.jsx("br",{}),n.description,t==="DA_HOAN_TIEN"&&e.jsxs("div",{className:"mt-2 p-2 bg-blue-50 border border-blue-200 rounded text-blue-700",children:[e.jsx(i.Icon,{path:He,size:.7,className:"inline mr-1"}),e.jsx("strong",{children:"Lưu ý:"})," Khi phê duyệt hoàn tiền, hệ thống sẽ tự động cộng lại số lượng sản phẩm vào kho."]})]})]})]}),e.jsxs(je,{children:[e.jsx(x,{variant:"outline",onClick:S,disabled:f,children:"Hủy"}),e.jsx(x,{onClick:w,disabled:!t||f,variant:t==="DA_HOAN_TIEN"?"default":"destructive",children:f?"Đang cập nhật...":"Xác nhận cập nhật"})]})]})})}function us({isOpen:j,onClose:N}){const[a,m]=u.useState(""),[C,f]=u.useState(!1),{data:t,isLoading:c,refetch:r}=$e({query:a}),w=()=>{a.trim()&&(f(!0),r())},S=l=>{l.key==="Enter"&&w()},n=l=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND",maximumFractionDigits:0}).format(l),v=l=>T(new Date(l),"dd/MM/yyyy HH:mm",{locale:ge}),g=l=>{switch(l){case"CHO_XU_LY":return e.jsx(p,{variant:"outline",className:"bg-yellow-50 text-yellow-600 border-yellow-200",children:"Chờ xử lý"});case"DA_HOAN_TIEN":return e.jsx(p,{variant:"outline",className:"bg-green-50 text-green-600 border-green-200",children:"Đã hoàn tiền"});case"DA_HUY":return e.jsx(p,{variant:"outline",className:"bg-red-50 text-red-600 border-red-200",children:"Đã hủy"});default:return e.jsx(p,{variant:"outline",children:"Không xác định"})}},b=()=>{m(""),f(!1),N()};return e.jsx(P,{open:j,onOpenChange:b,children:e.jsxs(U,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(B,{children:e.jsxs(E,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Tìm kiếm nâng cao"}),e.jsx(x,{variant:"ghost",size:"icon",onClick:b,children:e.jsx(i.Icon,{path:ze,size:.7})})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(k,{children:e.jsxs(A,{className:"p-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"flex-1",children:e.jsx(J,{placeholder:"Tìm theo mã yêu cầu trả hàng hoặc mã đơn hàng gốc...",value:a,onChange:l=>m(l.target.value),onKeyPress:S,className:"w-full"})}),e.jsxs(x,{onClick:w,disabled:!a.trim()||c,children:[e.jsx(i.Icon,{path:z,size:.7,className:"mr-2"}),c?"Đang tìm...":"Tìm kiếm"]})]}),e.jsxs("div",{className:"mt-3 text-sm text-maintext",children:[e.jsx("p",{children:e.jsx("strong",{children:"Gợi ý tìm kiếm:"})}),e.jsxs("ul",{className:"list-disc list-inside mt-1 space-y-1",children:[e.jsx("li",{children:"Nhập mã yêu cầu trả hàng (ví dụ: RT001)"}),e.jsx("li",{children:"Nhập mã đơn hàng gốc (ví dụ: ORD001)"}),e.jsx("li",{children:"Nhập một phần của mã để tìm kiếm gần đúng"})]})]})]})}),C&&e.jsx(k,{children:e.jsxs(A,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"Kết quả tìm kiếm"}),c?e.jsx("div",{className:"space-y-4",children:[1,2,3].map(l=>e.jsx("div",{className:"h-16 bg-gray-100 rounded-lg animate-pulse"},l))}):(t==null?void 0:t.data.length)===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(i.Icon,{path:z,size:2,className:"mx-auto text-gray-400 mb-4"}),e.jsx("p",{className:"text-maintext",children:"Không tìm thấy yêu cầu trả hàng nào phù hợp"}),e.jsx("p",{className:"text-sm text-maintext mt-1",children:"Thử tìm kiếm với từ khóa khác hoặc kiểm tra lại mã yêu cầu"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-sm text-maintext",children:["Tìm thấy ",e.jsx("strong",{children:t==null?void 0:t.data.length}),' kết quả cho "',a,'"']}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(W,{children:[e.jsx(Z,{children:e.jsxs(M,{children:[e.jsx(o,{children:"Mã yêu cầu"}),e.jsx(o,{children:"Khách hàng"}),e.jsx(o,{children:"Đơn hàng gốc"}),e.jsx(o,{children:"Ngày tạo"}),e.jsx(o,{children:"Số tiền hoàn trả"}),e.jsx(o,{children:"Trạng thái"}),e.jsx(o,{className:"text-right",children:"Thao tác"})]})}),e.jsx(I,{children:t==null?void 0:t.data.map(l=>e.jsxs(M,{children:[e.jsx(h,{className:"font-medium",children:l.code}),e.jsx(h,{children:typeof l.customer=="string"?l.customer:l.customer.fullName}),e.jsx(h,{children:typeof l.originalOrder=="string"?l.originalOrder:l.originalOrder.code}),e.jsx(h,{children:v(l.createdAt)}),e.jsx(h,{children:n(l.totalRefund)}),e.jsx(h,{children:g(l.status)}),e.jsx(h,{className:"text-right",children:e.jsx("a",{href:`/admin/returns/edit/${l==null?void 0:l.id}`,children:e.jsx(x,{size:"icon",variant:"ghost",onClick:b,children:e.jsx(i.Icon,{path:ue,size:.7})})})})]},l==null?void 0:l.id))})]})})]})]})})]})]})})}function js(){const[j,N]=u.useState(""),[a,m]=u.useState({page:1,limit:10}),[C,f]=u.useState(!1),[t,c]=u.useState({}),{data:r,isLoading:w,isError:S}=Ge(a),n=Je(),v=We(),{data:g}=Ze(),b=Re(),[l,L]=u.useState(!1),[ee,fe]=u.useState(null),[se,ye]=u.useState("all"),[ve,ae]=u.useState(!1),[be,Ce]=u.useState(null),[F,Y]=u.useState({isOpen:!1,returnId:"",currentStatus:""}),[we,te]=u.useState(!1);u.useEffect(()=>{const s=setTimeout(()=>{j.trim()?m(d=>({...d,page:1})):m({...a,page:1})},500);return()=>clearTimeout(s)},[j]),u.useEffect(()=>{const s=Se(se);if(s)m({...a,status:s,page:1});else{const{status:d,...D}=a;m({...D,page:1})}},[se]);const Se=s=>{switch(s){case"pending":return"CHO_XU_LY";case"refunded":return"DA_HOAN_TIEN";case"cancelled":return"DA_HUY";default:return}},De=(s,d)=>{if(d===""){const D={...a};delete D[s],m({...D,page:1})}else m({...a,[s]:d,page:1})},ne=s=>{c(s);const d={...a};s.from?d.startDate=T(s.from,"yyyy-MM-dd"):delete d.startDate,s.to?d.endDate=T(s.to,"yyyy-MM-dd"):delete d.endDate,m({...d,page:1})},Te=async s=>{try{await n.mutateAsync(s,{onSuccess:()=>{H.success("Đã xóa yêu cầu trả hàng thành công"),b.invalidateQueries({queryKey:["returns"]}),b.invalidateQueries({queryKey:["returnStats"]}),L(!1)}})}catch{H.error("Xóa yêu cầu trả hàng thất bại")}},le=async(s,d)=>{try{await v.mutateAsync({returnId:s,payload:{status:d}},{onSuccess:()=>{H.success("Đã cập nhật trạng thái thành công"),b.invalidateQueries({queryKey:["returns"]}),b.invalidateQueries({queryKey:["returnStats"]}),b.invalidateQueries({queryKey:["return",s]}),Y({isOpen:!1,returnId:"",currentStatus:""})}})}catch{H.error("Cập nhật trạng thái thất bại")}},V=s=>{m({...a,page:s})},X=s=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND",maximumFractionDigits:0}).format(s),q=s=>T(new Date(s),"dd/MM/yyyy HH:mm",{locale:ge}),ke=s=>{switch(s){case"CHO_XU_LY":return e.jsx(p,{variant:"outline",className:"bg-yellow-50 text-yellow-600 border-yellow-200",children:"Chờ xử lý"});case"DA_HOAN_TIEN":return e.jsx(p,{variant:"outline",className:"bg-green-50 text-primary border-green-200",children:"Đã hoàn tiền"});case"DA_HUY":return e.jsx(p,{variant:"outline",className:"bg-red-50 text-red-600 border-red-200",children:"Đã hủy"});default:return e.jsx(p,{variant:"outline",children:"Không xác định"})}},Ae=()=>{if(!(r!=null&&r.data.returns.length)){H.error("Không có dữ liệu để xuất");return}const d=[["Mã yêu cầu","Khách hàng","Đơn hàng gốc","Ngày tạo","Số tiền hoàn trả","Trạng thái"].join(","),...r.data.returns.map(y=>[y.code,typeof y.customer=="string"?y.customer:y.customer.fullName,typeof y.originalOrder=="string"?y.originalOrder:y.originalOrder.code,q(y.createdAt),y.totalRefund,y.status].join(","))].join(`
`),D=new Blob([d],{type:"text/csv;charset=utf-8;"}),O=document.createElement("a"),Oe=URL.createObjectURL(D);O.setAttribute("href",Oe),O.setAttribute("download",`returns_${T(new Date,"yyyy-MM-dd")}.csv`),O.style.visibility="hidden",document.body.appendChild(O),O.click(),document.body.removeChild(O)};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(es,{children:e.jsxs(ss,{children:[e.jsx(ce,{children:e.jsx(as,{href:"/admin/statistics",children:"Dashboard"})}),e.jsx(ts,{}),e.jsx(ce,{children:e.jsx(ns,{children:"Quản lý trả hàng"})})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(x,{variant:"outline",onClick:()=>te(!0),children:[e.jsx(i.Icon,{path:z,size:.7,className:"mr-2"}),"Tìm kiếm nâng cao"]}),e.jsxs(x,{variant:"outline",onClick:Ae,children:[e.jsx(i.Icon,{path:Ke,size:.7,className:"mr-2"}),"Xuất CSV"]}),e.jsx("a",{href:"/admin/returns/create",className:"flex items-center gap-2",children:e.jsxs(x,{className:"flex items-center gap-2",children:[e.jsx(i.Icon,{path:Pe,size:.7}),"Tạo yêu cầu trả hàng mới"]})})]})]}),g&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(k,{children:e.jsx(A,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("p",{className:"text-sm text-maintext",children:"Tổng số đơn trả"}),e.jsx("h3",{className:"text-2xl font-bold",children:g.data.totalReturns})]})})}),e.jsx(k,{children:e.jsx(A,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("p",{className:"text-sm text-maintext",children:"Đang chờ xử lý"}),e.jsx("h3",{className:"text-2xl font-bold",children:g.data.pendingReturns})]})})}),e.jsx(k,{children:e.jsx(A,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("p",{className:"text-sm text-maintext",children:"Đã hoàn tiền"}),e.jsx("h3",{className:"text-2xl font-bold",children:g.data.refundedReturns})]})})}),e.jsx(k,{children:e.jsx(A,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("p",{className:"text-sm text-maintext",children:"Tổng tiền hoàn trả"}),e.jsx("h3",{className:"text-2xl font-bold",children:X(g.data.totalRefundAmount)})]})})})]}),e.jsx(k,{className:"mb-4",children:e.jsx(A,{className:"py-4",children:e.jsxs(ls,{defaultValue:"all",onValueChange:ye,children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between mb-4",children:[e.jsxs(is,{className:"h-9",children:[e.jsx(K,{value:"all",className:"px-4 text-maintext",children:"Tất cả"}),e.jsx(K,{value:"pending",className:"px-4 text-maintext",children:"Chờ xử lý"}),e.jsx(K,{value:"refunded",className:"px-4 text-maintext",children:"Đã hoàn tiền"}),e.jsx(K,{value:"cancelled",className:"px-4 text-maintext",children:"Đã hủy"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row w-full sm:w-auto gap-2",children:[e.jsxs("div",{className:"relative w-full sm:w-80",children:[e.jsx(J,{placeholder:"Tìm theo mã, tên KH, SĐT...",value:j,onChange:s=>N(s.target.value),className:"pl-10 w-full"}),e.jsx("div",{className:"absolute left-3 top-2.5 text-maintext",children:e.jsx(i.Icon,{path:z,size:.7})})]}),e.jsxs(x,{variant:"outline",onClick:()=>f(!C),className:"flex items-center",children:[e.jsx(i.Icon,{path:Ue,size:.7,className:"mr-2"}),"Bộ lọc",(a.customer||a.startDate||a.endDate)&&e.jsx(p,{className:"ml-2 bg-primary h-5 w-5 p-0 flex items-center justify-center",children:[a.customer,a.startDate,a.endDate].filter(Boolean).length})]})]})]}),e.jsx(Be,{children:C&&e.jsxs(Ee.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3},className:"bg-slate-50 p-4 rounded-[6px] mb-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Khách hàng"}),e.jsx(J,{placeholder:"Tìm theo tên khách hàng",value:a.customer||"",onChange:s=>De("customer",s.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Từ ngày"}),e.jsxs(re,{children:[e.jsx(de,{asChild:!0,children:e.jsxs(x,{variant:"outline",className:"w-full justify-start text-left font-normal",children:[e.jsx(i.Icon,{path:ie,size:.7,className:"mr-2"}),t.from?T(t.from,"dd/MM/yyyy"):"Chọn ngày"]})}),e.jsx(oe,{className:"w-auto p-0",align:"start",children:e.jsx(he,{mode:"single",selected:t.from,onSelect:s=>ne({...t,from:s}),initialFocus:!0})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Đến ngày"}),e.jsxs(re,{children:[e.jsx(de,{asChild:!0,children:e.jsxs(x,{variant:"outline",className:"w-full justify-start text-left font-normal",children:[e.jsx(i.Icon,{path:ie,size:.7,className:"mr-2"}),t.to?T(t.to,"dd/MM/yyyy"):"Chọn ngày"]})}),e.jsx(oe,{className:"w-auto p-0",align:"start",children:e.jsx(he,{mode:"single",selected:t.to,onSelect:s=>ne({...t,to:s}),initialFocus:!0})})]})]})]}),e.jsx("div",{className:"flex gap-2 mt-4",children:e.jsx(x,{variant:"outline",size:"sm",onClick:()=>{c({}),m({page:1,limit:10})},children:"Xóa bộ lọc"})})]})}),w?e.jsx("div",{className:"space-y-4",children:[...Array(5)].map((s,d)=>e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(_,{className:"h-12 w-12 rounded-[6px]"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(_,{className:"h-4 w-[250px]"}),e.jsx(_,{className:"h-4 w-[200px]"})]})]},d))}):S?e.jsx("div",{className:"text-center py-10",children:e.jsx("p",{className:"text-red-500",children:"Đã xảy ra lỗi khi tải dữ liệu. Vui lòng thử lại sau."})}):(r==null?void 0:r.data.returns.length)===0?e.jsx("div",{className:"text-center py-10",children:e.jsx("p",{className:"text-maintext",children:"Không có yêu cầu trả hàng nào"})}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(W,{children:[e.jsx(Z,{children:e.jsxs(M,{children:[e.jsx(o,{className:"w-[120px]",children:"Mã yêu cầu"}),e.jsx(o,{children:"Khách hàng"}),e.jsx(o,{children:"Đơn hàng gốc"}),e.jsx(o,{children:"Ngày tạo"}),e.jsx(o,{children:"Số tiền hoàn trả"}),e.jsx(o,{children:"Trạng thái"}),e.jsx(o,{className:"text-right",children:"Thao tác"})]})}),e.jsx(I,{children:r==null?void 0:r.data.returns.map(s=>e.jsxs(M,{children:[e.jsx(h,{className:"font-medium",children:s.code}),e.jsx(h,{children:typeof s.customer=="string"?s.customer:s.customer.fullName}),e.jsx(h,{children:typeof s.originalOrder=="string"?s.originalOrder:s.originalOrder.code}),e.jsx(h,{children:q(s.createdAt)}),e.jsx(h,{children:X(s.totalRefund)}),e.jsx(h,{children:ke(s.status)}),e.jsx(h,{className:"text-right",children:e.jsxs(Le,{children:[e.jsx(Fe,{asChild:!0,children:e.jsx(x,{size:"icon",variant:"outline",children:e.jsx(i.Icon,{path:Ye,size:.7})})}),e.jsxs(Ve,{align:"end",children:[e.jsxs(R,{className:"cursor-pointer text-maintext",onClick:()=>{Ce(s==null?void 0:s.id),ae(!0)},children:[e.jsx(i.Icon,{path:ue,size:.7,className:"mr-2"}),e.jsx("span",{className:"text-maintext text-sm",children:"Xem chi tiết"})]}),s.status==="CHO_XU_LY"&&e.jsxs(e.Fragment,{children:[e.jsx(Q,{}),e.jsx("a",{href:`/admin/returns/edit/${s==null?void 0:s.id}`,children:e.jsxs(R,{className:"cursor-pointer text-maintext",children:[e.jsx(i.Icon,{path:Xe,size:.7,className:"mr-2 text-blue-400"}),e.jsx("span",{className:"text-maintext text-sm",children:"Chỉnh sửa"})]})}),e.jsx(Q,{}),e.jsxs(R,{className:"cursor-pointer text-green-600",onClick:()=>Y({isOpen:!0,returnId:s==null?void 0:s.id,currentStatus:s.status}),children:[e.jsx(i.Icon,{path:$,size:.7,className:"mr-2 text-green-400 "}),e.jsx("span",{className:"text-sm text-maintext",children:"Cập nhật trạng thái"})]}),e.jsx(Q,{}),e.jsxs(R,{className:"cursor-pointer text-red-600",onClick:()=>{fe(s==null?void 0:s.id),L(!0)},children:[e.jsx(i.Icon,{path:qe,size:.7,className:"mr-2 text-red-400 "}),e.jsx("span",{className:"text-sm text-maintext",children:"Xóa yêu cầu"})]})]})]})]})})]},s==null?void 0:s.id))})]})}),r&&r.data.pagination.totalPages>1&&e.jsx("div",{className:"flex justify-center mt-6",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(x,{variant:"outline",onClick:()=>V(Math.max(1,a.page||0)),disabled:a.page===1,children:"Trước"}),[...Array(r.data.pagination.totalPages)].map((s,d)=>e.jsx(x,{variant:a.page===d+1?"default":"outline",onClick:()=>V(d+1),children:d+1},d)),e.jsx(x,{variant:"outline",onClick:()=>V(Math.min(r.data.pagination.totalPages,(a.page||1)+1)),disabled:a.page===r.data.pagination.totalPages,children:"Sau"})]})})]})})}),e.jsx(P,{open:l,onOpenChange:L,children:e.jsxs(U,{className:"sm:max-w-4xl",children:[e.jsx(B,{children:e.jsx(E,{children:"Xác nhận xóa yêu cầu trả hàng"})}),e.jsx("div",{className:"py-4",children:e.jsx("p",{children:"Bạn có chắc chắn muốn xóa yêu cầu trả hàng này? Hành động này không thể hoàn tác."})}),e.jsxs(je,{children:[e.jsx(hs,{asChild:!0,children:e.jsx(x,{variant:"outline",children:"Hủy"})}),e.jsx(x,{variant:"destructive",onClick:()=>ee&&Te(ee),disabled:n.isPending,children:n.isPending?"Đang xóa...":"Xóa"})]})]})}),e.jsx(P,{open:ve,onOpenChange:ae,children:e.jsxs(U,{className:"sm:max-w-[90%] max-h-[90vh] overflow-y-auto",children:[e.jsx(B,{children:e.jsx(E,{children:"Chi tiết yêu cầu trả hàng"})}),e.jsx(gs,{returnId:be||"",formatCurrency:X,formatDate:q,onUpdateStatus:le})]})}),e.jsx(ms,{isOpen:F.isOpen,onClose:()=>Y({isOpen:!1,returnId:"",currentStatus:""}),onConfirm:le,returnId:F.returnId,currentStatus:F.currentStatus,isLoading:v.isPending}),e.jsx(us,{isOpen:we,onClose:()=>te(!1)})]})}function gs({returnId:j,formatCurrency:N,formatDate:a,onUpdateStatus:m}){const{data:C,isLoading:f,isError:t}=Ie(j);if(f)return e.jsxs("div",{className:"space-y-4 p-4",children:[e.jsx(_,{className:"h-8 w-[200px]"}),e.jsx(_,{className:"h-20 w-full"}),e.jsx(_,{className:"h-40 w-full"})]});if(t||!C)return e.jsx("p",{className:"text-red-500 p-4",children:"Đã xảy ra lỗi khi tải thông tin chi tiết."});const c=C.data,r=typeof c.customer=="string"?{fullName:"Không có thông tin",email:"",phoneNumber:""}:c.customer,w=typeof c.originalOrder=="string"?{code:c.originalOrder}:c.originalOrder,S=n=>({wrong_size:"Sai kích cỡ",wrong_item:"Sản phẩm không đúng",damaged:"Sản phẩm bị hỏng",defective:"Sản phẩm bị lỗi",changed_mind:"Đổi ý",other:"Lý do khác"})[n]||n;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Thông tin yêu cầu"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-maintext",children:"Mã yêu cầu"}),e.jsx("p",{className:"font-medium",children:c.code})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-maintext",children:"Ngày tạo"}),e.jsx("p",{className:"font-medium",children:a(c.createdAt)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-maintext",children:"Đơn hàng gốc"}),e.jsx("p",{className:"font-medium",children:w.code})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-maintext",children:"Trạng thái"}),e.jsx("div",{className:"mt-1",children:c.status==="CHO_XU_LY"?e.jsx(p,{variant:"outline",className:"bg-yellow-50 text-yellow-600 border-yellow-200",children:"Chờ xử lý"}):c.status==="DA_HOAN_TIEN"?e.jsx(p,{variant:"outline",className:"bg-green-50 text-primary border-green-200",children:"Đã hoàn tiền"}):e.jsx(p,{variant:"outline",className:"bg-red-50 text-red-600 border-red-200",children:"Đã hủy"})})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"text-sm text-maintext",children:"Tổng tiền hoàn trả"}),e.jsx("p",{className:"font-medium text-lg text-primary",children:N(c.totalRefund)})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Thông tin khách hàng"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"text-sm text-maintext",children:"Tên khách hàng"}),e.jsx("p",{className:"font-medium",children:r.fullName})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-maintext",children:"Email"}),e.jsx("p",{className:"font-medium",children:r.email||"Không có"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-maintext",children:"Số điện thoại"}),e.jsx("p",{className:"font-medium",children:r.phoneNumber||"Không có"})]})]})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Sản phẩm trả lại"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(W,{children:[e.jsx(Z,{children:e.jsxs(M,{children:[e.jsx(o,{className:"w-[80px]",children:"Ảnh"}),e.jsx(o,{children:"Sản phẩm"}),e.jsx(o,{children:"Biến thể"}),e.jsx(o,{children:"Số lượng"}),e.jsx(o,{children:"Giá"}),e.jsx(o,{children:"Lý do trả hàng"}),e.jsx(o,{children:"Thành tiền"})]})}),e.jsx(I,{children:c.items.map((n,v)=>{const g=typeof n.product=="string"?{name:"Không có thông tin",code:n.product,images:[]}:n.product;return e.jsxs(M,{children:[e.jsx(h,{children:g.images&&g.images.length>0?e.jsx("div",{className:"w-16 h-16 relative",children:e.jsx("img",{src:g.images[0],alt:g.name,className:"object-cover rounded-[6px]"})}):e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-[6px] flex items-center justify-center",children:e.jsx(i.Icon,{path:z,size:1,className:"text-maintext"})})}),e.jsxs(h,{className:"font-medium",children:[g.name,e.jsxs("div",{className:"text-xs text-maintext",children:["SKU: ",g.code]})]}),e.jsx(h,{children:n.variant?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["Màu: ",n.variant.colorId]}),e.jsxs("div",{children:["Size: ",n.variant.sizeId]})]}):"Mặc định"}),e.jsx(h,{children:n.quantity}),e.jsx(h,{children:N(n.price)}),e.jsx(h,{children:n.reason?e.jsx(p,{variant:"outline",children:S(n.reason)}):"Không có"}),e.jsx(h,{children:N(n.price*n.quantity)})]},v)})})]})})]}),c.status==="CHO_XU_LY"&&e.jsxs("div",{className:"border-t pt-4 flex justify-end space-x-2",children:[e.jsxs(x,{variant:"outline",className:"gap-2",onClick:()=>m(j,"DA_HUY"),children:[e.jsx(i.Icon,{path:G,size:.7}),"Từ chối trả hàng"]}),e.jsxs(x,{className:"gap-2",onClick:()=>m(j,"DA_HOAN_TIEN"),children:[e.jsx(i.Icon,{path:Qe,size:.7}),"Hoàn tiền"]})]})]})}const Hs=()=>e.jsx(js,{});export{Hs as default};
