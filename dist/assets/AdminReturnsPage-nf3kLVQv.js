import{j as e}from"./ui-vendor-CFM_MCUz.js";import{r as s}from"./react-vendor-B55MjJUH.js";import{C as t,c as a}from"./card-ClEzRAeX.js";import{S as n}from"./skeleton-4G_X8bY4.js";import{t as i}from"./icons-vendor-BrsZP2ku.js";import{k as r,m as l,B as c,I as d,D as h,a as o,d as x,g as m,f as u,y as j}from"./index-BHeY-5EX.js";import{e as g,f as p,g as N,h as f,i as y,j as v}from"./return-4pcPvvv5.js";import{d as b}from"./query-vendor-CBwfxcof.js";import{B as C,a as w,b as D,c as k,d as _,e as I}from"./breadcrumb-CP4jYkI2.js";import{T,a as S,b as O,c as A,d as H,e as z}from"./table-DL-K3PV4.js";import{B as M}from"./badge-BeHegjHt.js";import{T as K,b as E,c as U}from"./tabs-z4DSy6tE.js";import{P as L,a as Y,b as R,C as X}from"./calendar-DBvhqSTH.js";import{S as P,a as q,b as F,c as V,d as B}from"./select-C6W71KWg.js";import{f as Q}from"./utils-vendor-C6znz4jh.js";import{l as $}from"./index-DwIVA3Vd.js";import{A as G,m as J}from"./heavy-vendor-BfN2pHnQ.js";const W=l("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),Z=s.forwardRef((({className:s,variant:t,...a},n)=>e.jsx("div",{ref:n,role:"alert",className:r(W({variant:t}),s),...a})));Z.displayName="Alert";const ee=s.forwardRef((({className:s,...t},a)=>e.jsx("div",{ref:a,className:r("text-sm [&_p]:leading-relaxed",s),...t})));function se({isOpen:t,onClose:a,onConfirm:n,returnId:r,currentStatus:l,isLoading:d=!1}){const[h,o]=s.useState(""),x=()=>{o(""),a()},m=h?(e=>{switch(e){case"DA_HOAN_TIEN":return{label:"Phê duyệt hoàn tiền",color:"text-green-600",bgColor:"bg-green-50",borderColor:"border-green-200",icon:mdiCheckCircle,description:"Yêu cầu trả hàng sẽ được phê duyệt và tiền sẽ được hoàn trả cho khách hàng."};case"DA_HUY":return{label:"Từ chối yêu cầu",color:"text-red-600",bgColor:"bg-red-50",borderColor:"border-red-200",icon:mdiCancel,description:"Yêu cầu trả hàng sẽ bị từ chối và không có tiền hoàn trả."};default:return null}})(h):null;return e.jsx(Dialog,{open:t,onOpenChange:x,children:e.jsxs(DialogContent,{className:"max-w-4xl",children:[e.jsx(DialogHeader,{children:e.jsxs(DialogTitle,{className:"flex items-center gap-2",children:[e.jsx(i.Icon,{path:mdiAlertCircle,size:1,className:"text-orange-500"}),"Cập nhật trạng thái yêu cầu trả hàng"]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-maintext mb-2",children:"Trạng thái hiện tại:"}),e.jsx(M,{variant:"outline",className:"bg-yellow-50 text-yellow-600 border-yellow-200",children:"Chờ xử lý"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Chọn trạng thái mới:"}),e.jsxs(P,{value:h,onValueChange:o,children:[e.jsx(q,{children:e.jsx(F,{placeholder:"Chọn trạng thái..."})}),e.jsxs(V,{children:[e.jsx(B,{value:"DA_HOAN_TIEN",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(i.Icon,{path:mdiCheckCircle,size:.7,className:"text-green-600"}),"Phê duyệt hoàn tiền"]})}),e.jsx(B,{value:"DA_HUY",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(i.Icon,{path:mdiCancel,size:.7,className:"text-red-600"}),"Từ chối yêu cầu"]})})]})]})]}),m&&e.jsxs(Z,{className:`${m.bgColor} ${m.borderColor}`,children:[e.jsx(i.Icon,{path:m.icon,size:.7,className:m.color}),e.jsxs(ee,{className:m.color,children:[e.jsx("strong",{children:m.label}),e.jsx("br",{}),m.description,"DA_HOAN_TIEN"===h&&e.jsxs("div",{className:"mt-2 p-2 bg-blue-50 border border-blue-200 rounded text-blue-700",children:[e.jsx(i.Icon,{path:mdiCurrencyUsd,size:.7,className:"inline mr-1"}),e.jsx("strong",{children:"Lưu ý:"})," Khi phê duyệt hoàn tiền, hệ thống sẽ tự động cộng lại số lượng sản phẩm vào kho."]})]})]})]}),e.jsxs(DialogFooter,{children:[e.jsx(c,{variant:"outline",onClick:x,disabled:d,children:"Hủy"}),e.jsx(c,{onClick:async()=>{!h||"DA_HOAN_TIEN"!==h&&"DA_HUY"!==h||(await n(r,h),o(""))},disabled:!h||d,variant:"DA_HOAN_TIEN"===h?"default":"destructive",children:d?"Đang cập nhật...":"Xác nhận cập nhật"})]})]})})}function te({isOpen:n,onClose:r}){const[l,h]=s.useState(""),[o,x]=s.useState(!1),{data:m,isLoading:u,refetch:j}=g({query:l}),p=()=>{l.trim()&&(x(!0),j())},N=s=>{switch(s){case"CHO_XU_LY":return e.jsx(M,{variant:"outline",className:"bg-yellow-50 text-yellow-600 border-yellow-200",children:"Chờ xử lý"});case"DA_HOAN_TIEN":return e.jsx(M,{variant:"outline",className:"bg-green-50 text-green-600 border-green-200",children:"Đã hoàn tiền"});case"DA_HUY":return e.jsx(M,{variant:"outline",className:"bg-red-50 text-red-600 border-red-200",children:"Đã hủy"});default:return e.jsx(M,{variant:"outline",children:"Không xác định"})}},f=()=>{h(""),x(!1),r()};return e.jsx(Dialog,{open:n,onOpenChange:f,children:e.jsxs(DialogContent,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(DialogHeader,{children:e.jsxs(DialogTitle,{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Tìm kiếm nâng cao"}),e.jsx(c,{variant:"ghost",size:"icon",onClick:f,children:e.jsx(i.Icon,{path:mdiClose,size:.7})})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(t,{children:e.jsxs(a,{className:"p-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"flex-1",children:e.jsx(d,{placeholder:"Tìm theo mã yêu cầu trả hàng hoặc mã đơn hàng gốc...",value:l,onChange:e=>h(e.target.value),onKeyPress:e=>{"Enter"===e.key&&p()},className:"w-full"})}),e.jsxs(c,{onClick:p,disabled:!l.trim()||u,children:[e.jsx(i.Icon,{path:mdiMagnify,size:.7,className:"mr-2"}),u?"Đang tìm...":"Tìm kiếm"]})]}),e.jsxs("div",{className:"mt-3 text-sm text-maintext",children:[e.jsx("p",{children:e.jsx("strong",{children:"Gợi ý tìm kiếm:"})}),e.jsxs("ul",{className:"list-disc list-inside mt-1 space-y-1",children:[e.jsx("li",{children:"Nhập mã yêu cầu trả hàng (ví dụ: RT001)"}),e.jsx("li",{children:"Nhập mã đơn hàng gốc (ví dụ: ORD001)"}),e.jsx("li",{children:"Nhập một phần của mã để tìm kiếm gần đúng"})]})]})]})}),o&&e.jsx(t,{children:e.jsxs(a,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"Kết quả tìm kiếm"}),u?e.jsx("div",{className:"space-y-4",children:[1,2,3].map((s=>e.jsx("div",{className:"h-16 bg-gray-100 rounded-lg animate-pulse"},s)))}):0===(null==m?void 0:m.data.length)?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(i.Icon,{path:mdiMagnify,size:2,className:"mx-auto text-gray-400 mb-4"}),e.jsx("p",{className:"text-maintext",children:"Không tìm thấy yêu cầu trả hàng nào phù hợp"}),e.jsx("p",{className:"text-sm text-maintext mt-1",children:"Thử tìm kiếm với từ khóa khác hoặc kiểm tra lại mã yêu cầu"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-sm text-maintext",children:["Tìm thấy ",e.jsx("strong",{children:null==m?void 0:m.data.length}),' kết quả cho "',l,'"']}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(T,{children:[e.jsx(S,{children:e.jsxs(O,{children:[e.jsx(A,{children:"Mã yêu cầu"}),e.jsx(A,{children:"Khách hàng"}),e.jsx(A,{children:"Đơn hàng gốc"}),e.jsx(A,{children:"Ngày tạo"}),e.jsx(A,{children:"Số tiền hoàn trả"}),e.jsx(A,{children:"Trạng thái"}),e.jsx(A,{className:"text-right",children:"Thao tác"})]})}),e.jsx(H,{children:null==m?void 0:m.data.map((s=>{return e.jsxs(O,{children:[e.jsx(z,{className:"font-medium",children:s.code}),e.jsx(z,{children:"string"==typeof s.customer?s.customer:s.customer.fullName}),e.jsx(z,{children:"string"==typeof s.originalOrder?s.originalOrder:s.originalOrder.code}),e.jsx(z,{children:(a=s.createdAt,Q(new Date(a),"dd/MM/yyyy HH:mm",{locale:$}))}),e.jsx(z,{children:(t=s.totalRefund,new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND",maximumFractionDigits:0}).format(t))}),e.jsx(z,{children:N(s.status)}),e.jsx(z,{className:"text-right",children:e.jsx("a",{href:`/admin/returns/edit/${s._id}`,children:e.jsx(c,{size:"icon",variant:"ghost",onClick:f,children:e.jsx(i.Icon,{path:mdiEye,size:.7})})})})]},s._id);var t,a}))})]})})]})]})})]})]})})}function ae(){const[r,l]=s.useState(""),[g,v]=s.useState({page:1,limit:10}),[P,q]=s.useState(!1),[F,V]=s.useState({}),{data:B,isLoading:W,isError:Z}=p(g),ee=N(),ae=f(),{data:ie}=y(),re=b(),[le,ce]=s.useState(!1),[de,he]=s.useState(null),[oe,xe]=s.useState("all"),[me,ue]=s.useState(!1),[je,ge]=s.useState(null),[pe,Ne]=s.useState({isOpen:!1,returnId:"",currentStatus:""}),[fe,ye]=s.useState(!1);s.useEffect((()=>{const e=setTimeout((()=>{r.trim()?v((e=>({...e,page:1}))):v({...g,page:1})}),500);return()=>clearTimeout(e)}),[r]),s.useEffect((()=>{const e=ve(oe);if(e)v({...g,status:e,page:1});else{const{status:e,...s}=g;v({...s,page:1})}}),[oe]);const ve=e=>{switch(e){case"pending":return"CHO_XU_LY";case"refunded":return"DA_HOAN_TIEN";case"cancelled":return"DA_HUY";default:return}},be=e=>{V(e);const s={...g};e.from?s.startDate=Q(e.from,"yyyy-MM-dd"):delete s.startDate,e.to?s.endDate=Q(e.to,"yyyy-MM-dd"):delete s.endDate,v({...s,page:1})},Ce=async(e,s)=>{try{await ae.mutateAsync({returnId:e,payload:{status:s}},{onSuccess:()=>{j.success("Đã cập nhật trạng thái thành công"),re.invalidateQueries({queryKey:["returns"]}),re.invalidateQueries({queryKey:["returnStats"]}),re.invalidateQueries({queryKey:["return",e]}),Ne({isOpen:!1,returnId:"",currentStatus:""})}})}catch(t){j.error("Cập nhật trạng thái thất bại")}},we=e=>{v({...g,page:e})},De=e=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND",maximumFractionDigits:0}).format(e),ke=e=>Q(new Date(e),"dd/MM/yyyy HH:mm",{locale:$}),_e=s=>{switch(s){case"CHO_XU_LY":return e.jsx(M,{variant:"outline",className:"bg-yellow-50 text-yellow-600 border-yellow-200",children:"Chờ xử lý"});case"DA_HOAN_TIEN":return e.jsx(M,{variant:"outline",className:"bg-green-50 text-primary border-green-200",children:"Đã hoàn tiền"});case"DA_HUY":return e.jsx(M,{variant:"outline",className:"bg-red-50 text-red-600 border-red-200",children:"Đã hủy"});default:return e.jsx(M,{variant:"outline",children:"Không xác định"})}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(C,{children:e.jsxs(w,{children:[e.jsx(D,{children:e.jsx(k,{href:"/admin/statistics",children:"Dashboard"})}),e.jsx(_,{}),e.jsx(D,{children:e.jsx(I,{children:"Quản lý trả hàng"})})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(c,{variant:"outline",onClick:()=>ye(!0),children:[e.jsx(i.Icon,{path:mdiMagnify,size:.7,className:"mr-2"}),"Tìm kiếm nâng cao"]}),e.jsxs(c,{variant:"outline",onClick:()=>{if(!(null==B?void 0:B.data.returns.length))return void j.error("Không có dữ liệu để xuất");const e=[["Mã yêu cầu","Khách hàng","Đơn hàng gốc","Ngày tạo","Số tiền hoàn trả","Trạng thái"].join(","),...B.data.returns.map((e=>[e.code,"string"==typeof e.customer?e.customer:e.customer.fullName,"string"==typeof e.originalOrder?e.originalOrder:e.originalOrder.code,ke(e.createdAt),e.totalRefund,e.status].join(",")))].join("\n"),s=new Blob([e],{type:"text/csv;charset=utf-8;"}),t=document.createElement("a"),a=URL.createObjectURL(s);t.setAttribute("href",a),t.setAttribute("download",`returns_${Q(new Date,"yyyy-MM-dd")}.csv`),t.style.visibility="hidden",document.body.appendChild(t),t.click(),document.body.removeChild(t)},children:[e.jsx(i.Icon,{path:mdiDownload,size:.7,className:"mr-2"}),"Xuất CSV"]}),e.jsx("a",{href:"/admin/returns/create",className:"flex items-center gap-2",children:e.jsxs(c,{className:"flex items-center gap-2",children:[e.jsx(i.Icon,{path:mdiPlus,size:.7}),"Tạo yêu cầu trả hàng mới"]})})]})]}),ie&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(t,{children:e.jsx(a,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("p",{className:"text-sm text-maintext",children:"Tổng số đơn trả"}),e.jsx("h3",{className:"text-2xl font-bold",children:ie.data.totalReturns})]})})}),e.jsx(t,{children:e.jsx(a,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("p",{className:"text-sm text-maintext",children:"Đang chờ xử lý"}),e.jsx("h3",{className:"text-2xl font-bold",children:ie.data.pendingReturns})]})})}),e.jsx(t,{children:e.jsx(a,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("p",{className:"text-sm text-maintext",children:"Đã hoàn tiền"}),e.jsx("h3",{className:"text-2xl font-bold",children:ie.data.refundedReturns})]})})}),e.jsx(t,{children:e.jsx(a,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("p",{className:"text-sm text-maintext",children:"Tổng tiền hoàn trả"}),e.jsx("h3",{className:"text-2xl font-bold",children:De(ie.data.totalRefundAmount)})]})})})]}),e.jsx(t,{className:"mb-4",children:e.jsx(a,{className:"py-4",children:e.jsxs(K,{defaultValue:"all",onValueChange:xe,children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between mb-4",children:[e.jsxs(E,{className:"h-9",children:[e.jsx(U,{value:"all",className:"px-4 text-maintext",children:"Tất cả"}),e.jsx(U,{value:"pending",className:"px-4 text-maintext",children:"Chờ xử lý"}),e.jsx(U,{value:"refunded",className:"px-4 text-maintext",children:"Đã hoàn tiền"}),e.jsx(U,{value:"cancelled",className:"px-4 text-maintext",children:"Đã hủy"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row w-full sm:w-auto gap-2",children:[e.jsxs("div",{className:"relative w-full sm:w-80",children:[e.jsx(d,{placeholder:"Tìm theo mã, tên KH, SĐT...",value:r,onChange:e=>l(e.target.value),className:"pl-10 w-full"}),e.jsx("div",{className:"absolute left-3 top-2.5 text-maintext",children:e.jsx(i.Icon,{path:mdiMagnify,size:.7})})]}),e.jsxs(c,{variant:"outline",onClick:()=>q(!P),className:"flex items-center",children:[e.jsx(i.Icon,{path:mdiFilterOutline,size:.7,className:"mr-2"}),"Bộ lọc",(g.customer||g.startDate||g.endDate)&&e.jsx(M,{className:"ml-2 bg-primary h-5 w-5 p-0 flex items-center justify-center",children:[g.customer,g.startDate,g.endDate].filter(Boolean).length})]})]})]}),e.jsx(G,{children:P&&e.jsxs(J.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3},className:"bg-slate-50 p-4 rounded-[6px] mb-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Khách hàng"}),e.jsx(d,{placeholder:"Tìm theo tên khách hàng",value:g.customer||"",onChange:e=>((e,s)=>{if(""===s){const s={...g};delete s[e],v({...s,page:1})}else v({...g,[e]:s,page:1})})("customer",e.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Từ ngày"}),e.jsxs(L,{children:[e.jsx(Y,{asChild:!0,children:e.jsxs(c,{variant:"outline",className:"w-full justify-start text-left font-normal",children:[e.jsx(i.Icon,{path:mdiCalendar,size:.7,className:"mr-2"}),F.from?Q(F.from,"dd/MM/yyyy"):"Chọn ngày"]})}),e.jsx(R,{className:"w-auto p-0",align:"start",children:e.jsx(X,{mode:"single",selected:F.from,onSelect:e=>be({...F,from:e}),initialFocus:!0})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Đến ngày"}),e.jsxs(L,{children:[e.jsx(Y,{asChild:!0,children:e.jsxs(c,{variant:"outline",className:"w-full justify-start text-left font-normal",children:[e.jsx(i.Icon,{path:mdiCalendar,size:.7,className:"mr-2"}),F.to?Q(F.to,"dd/MM/yyyy"):"Chọn ngày"]})}),e.jsx(R,{className:"w-auto p-0",align:"start",children:e.jsx(X,{mode:"single",selected:F.to,onSelect:e=>be({...F,to:e}),initialFocus:!0})})]})]})]}),e.jsx("div",{className:"flex gap-2 mt-4",children:e.jsx(c,{variant:"outline",size:"sm",onClick:()=>{V({}),v({page:1,limit:10})},children:"Xóa bộ lọc"})})]})}),W?e.jsx("div",{className:"space-y-4",children:[...Array(5)].map(((s,t)=>e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(n,{className:"h-12 w-12 rounded-[6px]"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{className:"h-4 w-[250px]"}),e.jsx(n,{className:"h-4 w-[200px]"})]})]},t)))}):Z?e.jsx("div",{className:"text-center py-10",children:e.jsx("p",{className:"text-red-500",children:"Đã xảy ra lỗi khi tải dữ liệu. Vui lòng thử lại sau."})}):0===(null==B?void 0:B.data.returns.length)?e.jsx("div",{className:"text-center py-10",children:e.jsx("p",{className:"text-maintext",children:"Không có yêu cầu trả hàng nào"})}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(T,{children:[e.jsx(S,{children:e.jsxs(O,{children:[e.jsx(A,{className:"w-[120px]",children:"Mã yêu cầu"}),e.jsx(A,{children:"Khách hàng"}),e.jsx(A,{children:"Đơn hàng gốc"}),e.jsx(A,{children:"Ngày tạo"}),e.jsx(A,{children:"Số tiền hoàn trả"}),e.jsx(A,{children:"Trạng thái"}),e.jsx(A,{className:"text-right",children:"Thao tác"})]})}),e.jsx(H,{children:null==B?void 0:B.data.returns.map((s=>e.jsxs(O,{children:[e.jsx(z,{className:"font-medium",children:s.code}),e.jsx(z,{children:"string"==typeof s.customer?s.customer:s.customer.fullName}),e.jsx(z,{children:"string"==typeof s.originalOrder?s.originalOrder:s.originalOrder.code}),e.jsx(z,{children:ke(s.createdAt)}),e.jsx(z,{children:De(s.totalRefund)}),e.jsx(z,{children:_e(s.status)}),e.jsx(z,{className:"text-right",children:e.jsxs(h,{children:[e.jsx(o,{asChild:!0,children:e.jsx(c,{size:"icon",variant:"outline",children:e.jsx(i.Icon,{path:mdiDotsVertical,size:.7})})}),e.jsxs(x,{align:"end",children:[e.jsxs(m,{className:"cursor-pointer text-maintext",onClick:()=>{ge(s._id),ue(!0)},children:[e.jsx(i.Icon,{path:mdiEye,size:.7,className:"mr-2"}),e.jsx("span",{className:"text-maintext text-sm",children:"Xem chi tiết"})]}),"CHO_XU_LY"===s.status&&e.jsxs(e.Fragment,{children:[e.jsx(u,{}),e.jsx("a",{href:`/admin/returns/edit/${s._id}`,passHref:!0,children:e.jsxs(m,{className:"cursor-pointer text-maintext",children:[e.jsx(i.Icon,{path:mdiPencilCircle,size:.7,className:"mr-2 text-blue-400"}),e.jsx("span",{className:"text-maintext text-sm",children:"Chỉnh sửa"})]})}),e.jsx(u,{}),e.jsxs(m,{className:"cursor-pointer text-green-600",onClick:()=>Ne({isOpen:!0,returnId:s._id,currentStatus:s.status}),children:[e.jsx(i.Icon,{path:mdiCheckCircle,size:.7,className:"mr-2 text-green-400 "}),e.jsx("span",{className:"text-sm text-maintext",children:"Cập nhật trạng thái"})]}),e.jsx(u,{}),e.jsxs(m,{className:"cursor-pointer text-red-600",onClick:()=>{he(s._id),ce(!0)},children:[e.jsx(i.Icon,{path:mdiDeleteCircle,size:.7,className:"mr-2 text-red-400 "}),e.jsx("span",{className:"text-sm text-maintext",children:"Xóa yêu cầu"})]})]})]})]})})]},s._id)))})]})}),B&&B.data.pagination.totalPages>1&&e.jsx("div",{className:"flex justify-center mt-6",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(c,{variant:"outline",onClick:()=>we(Math.max(1,g.page||0)),disabled:1===g.page,children:"Trước"}),[...Array(B.data.pagination.totalPages)].map(((s,t)=>e.jsx(c,{variant:g.page===t+1?"default":"outline",onClick:()=>we(t+1),children:t+1},t))),e.jsx(c,{variant:"outline",onClick:()=>we(Math.min(B.data.pagination.totalPages,(g.page||1)+1)),disabled:g.page===B.data.pagination.totalPages,children:"Sau"})]})})]})})}),e.jsx(Dialog,{open:le,onOpenChange:ce,children:e.jsxs(DialogContent,{className:"sm:max-w-4xl",children:[e.jsx(DialogHeader,{children:e.jsx(DialogTitle,{children:"Xác nhận xóa yêu cầu trả hàng"})}),e.jsx("div",{className:"py-4",children:e.jsx("p",{children:"Bạn có chắc chắn muốn xóa yêu cầu trả hàng này? Hành động này không thể hoàn tác."})}),e.jsxs(DialogFooter,{children:[e.jsx(DialogClose,{asChild:!0,children:e.jsx(c,{variant:"outline",children:"Hủy"})}),e.jsx(c,{variant:"destructive",onClick:()=>de&&(async e=>{try{await ee.mutateAsync(e,{onSuccess:()=>{j.success("Đã xóa yêu cầu trả hàng thành công"),re.invalidateQueries({queryKey:["returns"]}),re.invalidateQueries({queryKey:["returnStats"]}),ce(!1)}})}catch(s){j.error("Xóa yêu cầu trả hàng thất bại")}})(de),disabled:ee.isPending,children:ee.isPending?"Đang xóa...":"Xóa"})]})]})}),e.jsx(Dialog,{open:me,onOpenChange:ue,children:e.jsxs(DialogContent,{className:"sm:max-w-[90%] max-h-[90vh] overflow-y-auto",children:[e.jsx(DialogHeader,{children:e.jsx(DialogTitle,{children:"Chi tiết yêu cầu trả hàng"})}),e.jsx(ne,{returnId:je||"",formatCurrency:De,formatDate:ke,onUpdateStatus:Ce})]})}),e.jsx(se,{isOpen:pe.isOpen,onClose:()=>Ne({isOpen:!1,returnId:"",currentStatus:""}),onConfirm:Ce,returnId:pe.returnId,currentStatus:pe.currentStatus,isLoading:ae.isPending}),e.jsx(te,{isOpen:fe,onClose:()=>ye(!1)})]})}function ne({returnId:s,formatCurrency:t,formatDate:a,onUpdateStatus:r}){const{data:l,isLoading:d,isError:h}=v(s);if(d)return e.jsxs("div",{className:"space-y-4 p-4",children:[e.jsx(n,{className:"h-8 w-[200px]"}),e.jsx(n,{className:"h-20 w-full"}),e.jsx(n,{className:"h-40 w-full"})]});if(h||!l)return e.jsx("p",{className:"text-red-500 p-4",children:"Đã xảy ra lỗi khi tải thông tin chi tiết."});const o=l.data,x="string"==typeof o.customer?{fullName:"Không có thông tin",email:"",phoneNumber:""}:o.customer,m="string"==typeof o.originalOrder?{code:o.originalOrder}:o.originalOrder;return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Thông tin yêu cầu"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-maintext",children:"Mã yêu cầu"}),e.jsx("p",{className:"font-medium",children:o.code})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-maintext",children:"Ngày tạo"}),e.jsx("p",{className:"font-medium",children:a(o.createdAt)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-maintext",children:"Đơn hàng gốc"}),e.jsx("p",{className:"font-medium",children:m.code})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-maintext",children:"Trạng thái"}),e.jsx("div",{className:"mt-1",children:"CHO_XU_LY"===o.status?e.jsx(M,{variant:"outline",className:"bg-yellow-50 text-yellow-600 border-yellow-200",children:"Chờ xử lý"}):"DA_HOAN_TIEN"===o.status?e.jsx(M,{variant:"outline",className:"bg-green-50 text-primary border-green-200",children:"Đã hoàn tiền"}):e.jsx(M,{variant:"outline",className:"bg-red-50 text-red-600 border-red-200",children:"Đã hủy"})})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"text-sm text-maintext",children:"Tổng tiền hoàn trả"}),e.jsx("p",{className:"font-medium text-lg text-primary",children:t(o.totalRefund)})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Thông tin khách hàng"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("p",{className:"text-sm text-maintext",children:"Tên khách hàng"}),e.jsx("p",{className:"font-medium",children:x.fullName})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-maintext",children:"Email"}),e.jsx("p",{className:"font-medium",children:x.email||"Không có"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-maintext",children:"Số điện thoại"}),e.jsx("p",{className:"font-medium",children:x.phoneNumber||"Không có"})]})]})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Sản phẩm trả lại"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(T,{children:[e.jsx(S,{children:e.jsxs(O,{children:[e.jsx(A,{className:"w-[80px]",children:"Ảnh"}),e.jsx(A,{children:"Sản phẩm"}),e.jsx(A,{children:"Biến thể"}),e.jsx(A,{children:"Số lượng"}),e.jsx(A,{children:"Giá"}),e.jsx(A,{children:"Lý do trả hàng"}),e.jsx(A,{children:"Thành tiền"})]})}),e.jsx(H,{children:o.items.map(((s,a)=>{const n="string"==typeof s.product?{name:"Không có thông tin",code:s.product,images:[]}:s.product;return e.jsxs(O,{children:[e.jsx(z,{children:n.images&&n.images.length>0?e.jsx("div",{className:"w-16 h-16 relative",children:e.jsx("img",{src:n.images[0],alt:n.name,className:"object-cover rounded-[6px]"})}):e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-[6px] flex items-center justify-center",children:e.jsx(i.Icon,{path:mdiMagnify,size:1,className:"text-maintext"})})}),e.jsxs(z,{className:"font-medium",children:[n.name,e.jsxs("div",{className:"text-xs text-maintext",children:["SKU: ",n.code]})]}),e.jsx(z,{children:s.variant?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["Màu: ",s.variant.colorId]}),e.jsxs("div",{children:["Size: ",s.variant.sizeId]})]}):"Mặc định"}),e.jsx(z,{children:s.quantity}),e.jsx(z,{children:t(s.price)}),e.jsx(z,{children:s.reason?e.jsx(M,{variant:"outline",children:(r=s.reason,{wrong_size:"Sai kích cỡ",wrong_item:"Sản phẩm không đúng",damaged:"Sản phẩm bị hỏng",defective:"Sản phẩm bị lỗi",changed_mind:"Đổi ý",other:"Lý do khác"}[r]||r)}):"Không có"}),e.jsx(z,{children:t(s.price*s.quantity)})]},a);var r}))})]})})]}),"CHO_XU_LY"===o.status&&e.jsxs("div",{className:"border-t pt-4 flex justify-end space-x-2",children:[e.jsxs(c,{variant:"outline",className:"gap-2",onClick:()=>r(s,"DA_HUY"),children:[e.jsx(i.Icon,{path:mdiCancel,size:.7}),"Từ chối trả hàng"]}),e.jsxs(c,{className:"gap-2",onClick:()=>r(s,"DA_HOAN_TIEN"),children:[e.jsx(i.Icon,{path:mdiCheck,size:.7}),"Hoàn tiền"]})]})]})}ee.displayName="AlertDescription";const ie=()=>e.jsx(ae,{});export{ie as default};
