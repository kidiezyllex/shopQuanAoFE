import{U as F,a as T,j as e,B as p,k as C,w,q as l,aQ as I,a6 as o}from"./index-Dpx_4rWJ.js";import{e as q}from"./voucher-C7mr4xZE.js";import{B as R,a as B,b as j,c as v,d as D,e as $}from"./breadcrumb-CJedQ5QG.js";import{C as H,a as L,b as _,c as U,e as Q}from"./card-fT6uSY2F.js";import{L as r}from"./label-B0XdI4bT.js";import{S as V,a as S,b as E,c as O,d as N}from"./select-CS4vNzI5.js";import"./createLucideIcon-BdgKQErZ.js";import"./index-BdQq_4o_.js";import"./index-qvEK80KO.js";import"./check-CyKb8IHM.js";const k={code:"",name:"",discountType:"PERCENTAGE",discountValue:0,quantity:1,startDate:new Date().toISOString().split("T")[0],endDate:new Date(new Date().setMonth(new Date().getMonth()+1)).toISOString().split("T")[0],minOrderValue:0,maxDiscount:void 0,status:"HOAT_DONG"};function z(){const y=F(),[s,u]=T.useState(k),[t,x]=T.useState({}),g=q(),h=a=>{const{name:i,value:d,type:n}=a.target;let c=d;n==="number"&&(c=d===""?0:parseFloat(d)),u({...s,[i]:c}),t[i]&&x({...t,[i]:""})},b=(a,i)=>{u({...s,[a]:i}),t[a]&&x({...t,[a]:""})},f=(a,i)=>{u({...s,[a]:i}),t[a]&&x({...t,[a]:""})},G=()=>{const a={};return s.code.trim()?/^[A-Z0-9_-]{3,20}$/.test(s.code)||(a.code="Mã voucher chỉ bao gồm chữ hoa, số, gạch dưới và gạch ngang (3-20 ký tự)"):a.code="Mã voucher không được để trống",s.name.trim()||(a.name="Tên voucher không được để trống"),s.discountValue<=0&&(a.discountValue="Giá trị voucher phải lớn hơn 0"),s.discountType==="PERCENTAGE"&&s.discountValue>100&&(a.discountValue="Phần trăm giảm giá không được vượt quá 100%"),s.quantity<=0&&(a.quantity="Số lượng voucher phải lớn hơn 0"),s.startDate||(a.startDate="Ngày bắt đầu không được để trống"),s.endDate||(a.endDate="Ngày kết thúc không được để trống"),s.startDate&&s.endDate&&new Date(s.startDate)>new Date(s.endDate)&&(a.endDate="Ngày kết thúc phải sau ngày bắt đầu"),(s.minOrderValue??0)<0&&(a.minOrderValue="Giá trị đơn hàng tối thiểu không được âm"),s.discountType==="PERCENTAGE"&&s.maxDiscount!==void 0&&s.maxDiscount<=0&&(a.maxDiscount="Giảm giá tối đa phải lớn hơn 0"),x(a),Object.keys(a).length===0},M=async a=>{var i,d;if(a.preventDefault(),!G()){o.error("Vui lòng điền đầy đủ thông tin");return}try{await g.mutateAsync(s,{onSuccess:n=>{o.success(n.message||"Tạo mã giảm giá thành công"),y("/admin/discounts/vouchers")},onError:n=>{var c,m;(m=(c=n==null?void 0:n.response)==null?void 0:c.data)!=null&&m.message?o.error(n.response.data.message):n!=null&&n.message?o.error(n.message):o.error("Tạo mã giảm giá thất bại")}})}catch(n){(d=(i=n==null?void 0:n.response)==null?void 0:i.data)!=null&&d.message?o.error(n.response.data.message):n!=null&&n.message?o.error(n.message):o.error("Tạo mã giảm giá thất bại")}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(R,{children:e.jsxs(B,{children:[e.jsx(j,{children:e.jsx(v,{href:"/admin/statistics",children:"Dashboard"})}),e.jsx(D,{}),e.jsx(j,{children:e.jsx(v,{href:"/admin/discounts",children:"Quản lý khuyến mãi"})}),e.jsx(D,{}),e.jsx(j,{children:e.jsx(v,{href:"/admin/discounts/vouchers",children:"Mã giảm giá"})}),e.jsx(D,{}),e.jsx(j,{children:e.jsx($,{children:"Thêm mã giảm giá mới"})})]})}),e.jsxs(p,{variant:"outline",onClick:()=>y(-1),className:"flex items-center gap-2",children:[e.jsx(C.Icon,{path:w,size:.7}),"Quay lại"]})]}),e.jsx("form",{onSubmit:M,children:e.jsxs(H,{children:[e.jsx(L,{children:e.jsx(_,{children:"Thông tin mã giảm giá"})}),e.jsx(U,{className:"space-y-4 text-maintext",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(r,{htmlFor:"code",children:["Mã voucher ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(l,{id:"code",name:"code",value:s.code,onChange:h,placeholder:"VD: SUMMER2024",className:t.code?"border-red-500":""}),e.jsx(p,{type:"button",variant:"default",onClick:()=>{function a(){const d=Array.from({length:4},()=>String.fromCharCode(65+Math.floor(Math.random()*26))).join(""),n=new Date;let c,m;do c=Math.floor(Math.random()*31)+1,m=Math.floor(Math.random()*12)+1;while(m<n.getMonth()+1||m===n.getMonth()+1&&c<=n.getDate());const A=c.toString().padStart(2,"0"),P=m.toString().padStart(2,"0");return`${d}${A}${P}`}const i=a();u({...s,code:i,name:`Voucher ${i}`}),t.code&&x({...t,code:""})},children:"Random voucher"})]}),t.code&&e.jsx("p",{className:"text-red-500 text-sm",children:t.code}),e.jsx("p",{className:"text-xs text-maintext",children:"Mã voucher chỉ bao gồm chữ hoa, số, gạch dưới và gạch ngang"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(r,{htmlFor:"name",children:["Tên voucher ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(l,{id:"name",name:"name",value:s.name,onChange:h,placeholder:"VD: Đợt khuyến mãi mùa hè 2024",className:t.name?"border-red-500":""}),t.name&&e.jsx("p",{className:"text-red-500 text-sm",children:t.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(r,{htmlFor:"discountType",children:["Loại voucher ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(V,{value:s.discountType,onValueChange:a=>b("discountType",a),children:[e.jsx(S,{id:"discountType",className:t.discountType?"border-red-500":"",children:e.jsx(E,{placeholder:"Chọn loại voucher"})}),e.jsxs(O,{children:[e.jsx(N,{value:"PERCENTAGE",children:"Phần trăm (%)"}),e.jsx(N,{value:"FIXED_AMOUNT",children:"Số tiền cố định (VNĐ)"})]})]}),t.discountType&&e.jsx("p",{className:"text-red-500 text-sm",children:t.discountType})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(r,{htmlFor:"discountValue",children:["Giá trị ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(l,{id:"discountValue",name:"discountValue",type:"number",min:0,value:s.discountValue,onChange:h,className:`${t.discountValue?"border-red-500":""} ${s.discountType==="PERCENTAGE"?"rounded-r-none":""}`}),s.discountType==="PERCENTAGE"&&e.jsx("div",{className:"bg-gray-100 border border-l-0 px-3 py-2 rounded-r-md",children:"%"}),s.discountType==="FIXED_AMOUNT"&&e.jsx("div",{className:"bg-gray-100 border border-l-0 px-3 py-2 rounded-r-md",children:"VNĐ"})]}),t.discountValue&&e.jsx("p",{className:"text-red-500 text-sm",children:t.discountValue}),e.jsx("p",{className:"text-xs text-maintext",children:s.discountType==="PERCENTAGE"?"Phần trăm giảm giá (0-100%)":"Số tiền giảm giá cố định"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(r,{htmlFor:"quantity",children:["Số lượng ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(l,{id:"quantity",name:"quantity",type:"number",min:1,value:s.quantity,onChange:h,className:t.quantity?"border-red-500":""}),t.quantity&&e.jsx("p",{className:"text-red-500 text-sm",children:t.quantity}),e.jsx("p",{className:"text-xs text-maintext",children:"Tổng số voucher có thể sử dụng"})]}),s.discountType==="PERCENTAGE"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"maxDiscount",children:"Giảm giá tối đa"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(l,{id:"maxDiscount",name:"maxDiscount",type:"number",min:0,value:s.maxDiscount===void 0?"":s.maxDiscount,onChange:h,className:`${t.maxDiscount?"border-red-500":""} rounded-r-none`}),e.jsx("div",{className:"bg-gray-100 border border-l-0 px-3 py-2 rounded-r-md",children:"VNĐ"})]}),t.maxDiscount&&e.jsx("p",{className:"text-red-500 text-sm",children:t.maxDiscount}),e.jsx("p",{className:"text-xs text-maintext",children:"Giới hạn số tiền giảm tối đa (để trống nếu không giới hạn)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"minOrderValue",children:"Giá trị đơn hàng tối thiểu"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(l,{id:"minOrderValue",name:"minOrderValue",type:"number",min:0,value:s.minOrderValue,onChange:h,className:`${t.minOrderValue?"border-red-500":""} rounded-r-none`}),e.jsx("div",{className:"bg-gray-100 border border-l-0 px-3 py-2 rounded-r-md",children:"VNĐ"})]}),t.minOrderValue&&e.jsx("p",{className:"text-red-500 text-sm",children:t.minOrderValue}),e.jsx("p",{className:"text-xs text-maintext",children:"Giá trị đơn hàng tối thiểu để áp dụng voucher (0 = không giới hạn)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(r,{htmlFor:"startDate",children:["Ngày bắt đầu ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(l,{id:"startDate",name:"startDate",type:"date",value:typeof s.startDate=="string"?s.startDate:s.startDate.toISOString().split("T")[0],onChange:a=>f("startDate",a.target.value),className:t.startDate?"border-red-500":""}),t.startDate&&e.jsx("p",{className:"text-red-500 text-sm",children:t.startDate})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(r,{htmlFor:"endDate",children:["Ngày kết thúc ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(l,{id:"endDate",name:"endDate",type:"date",value:typeof s.endDate=="string"?s.endDate:s.endDate.toISOString().split("T")[0],onChange:a=>f("endDate",a.target.value),className:t.endDate?"border-red-500":""}),t.endDate&&e.jsx("p",{className:"text-red-500 text-sm",children:t.endDate})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{htmlFor:"status",children:"Trạng thái"}),e.jsxs(V,{value:s.status,onValueChange:a=>b("status",a),children:[e.jsx(S,{id:"status",className:t.status?"border-red-500":"",children:e.jsx(E,{placeholder:"Chọn trạng thái"})}),e.jsxs(O,{children:[e.jsx(N,{value:"HOAT_DONG",children:"Hoạt động"}),e.jsx(N,{value:"KHONG_HOAT_DONG",children:"Không hoạt động"})]})]}),t.status&&e.jsx("p",{className:"text-red-500 text-sm",children:t.status}),e.jsx("p",{className:"text-xs text-maintext",children:"Trạng thái của voucher (người dùng chỉ có thể sử dụng voucher đang hoạt động)"})]})]})}),e.jsxs(Q,{className:"border-t px-4 py-4 flex justify-between",children:[e.jsx(p,{variant:"outline",onClick:()=>y(-1),disabled:g.isPending,children:"Hủy"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{type:"button",variant:"outline",onClick:()=>u(k),disabled:g.isPending,children:"Đặt lại"}),e.jsx(p,{type:"submit",disabled:g.isPending,children:g.isPending?e.jsxs(e.Fragment,{children:[e.jsx(C.Icon,{path:I,size:.7,className:"mr-2 animate-spin"}),"Đang xử lý..."]}):"Tạo mã giảm giá"})]})]})]})})]})}const ne=()=>e.jsx(z,{});export{ne as default};
