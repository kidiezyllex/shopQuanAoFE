import{j as e}from"./ui-vendor-CFM_MCUz.js";import{u as s,r as t}from"./react-vendor-B55MjJUH.js";import{e as a}from"./voucher-C38MW_cY.js";import{B as n,a as r,b as i,c as d,d as c,e as l}from"./breadcrumb-CP4jYkI2.js";import{B as m,I as h,y as o}from"./index-BHeY-5EX.js";import{C as x,a as u,b as g,c as j,e as p}from"./card-ClEzRAeX.js";import{L as v}from"./label-Bm9nFuXD.js";import{t as N,M as y,aC as D}from"./icons-vendor-BrsZP2ku.js";import{S as b,a as f,b as C,c as E,d as T}from"./select-C6W71KWg.js";import"./query-vendor-CBwfxcof.js";import"./heavy-vendor-BfN2pHnQ.js";const O={code:"",name:"",type:"PERCENTAGE",value:0,quantity:1,startDate:(new Date).toISOString().split("T")[0],endDate:new Date((new Date).setMonth((new Date).getMonth()+1)).toISOString().split("T")[0],minOrderValue:0,maxDiscount:void 0,status:"HOAT_DONG"};function S(){const S=s(),[G,M]=t.useState(O),[V,k]=t.useState({}),A=a(),P=e=>{const{name:s,value:t,type:a}=e.target;let n=t;"number"===a&&(n=""===t?0:parseFloat(t)),M({...G,[s]:n}),V[s]&&k({...V,[s]:""})},F=(e,s)=>{M({...G,[e]:s}),V[e]&&k({...V,[e]:""})},q=(e,s)=>{M({...G,[e]:s}),V[e]&&k({...V,[e]:""})};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(n,{children:e.jsxs(r,{children:[e.jsx(i,{children:e.jsx(d,{href:"/admin/statistics",children:"Dashboard"})}),e.jsx(c,{}),e.jsx(i,{children:e.jsx(d,{href:"/admin/discounts",children:"Quản lý Đợt khuyến mãi"})}),e.jsx(c,{}),e.jsx(i,{children:e.jsx(d,{href:"/admin/discounts/vouchers",children:"Mã giảm giá"})}),e.jsx(c,{}),e.jsx(i,{children:e.jsx(l,{children:"Thêm mã giảm giá mới"})})]})}),e.jsxs(m,{variant:"outline",onClick:()=>S(-1),className:"flex items-center gap-2",children:[e.jsx(N.Icon,{path:y,size:.7}),"Quay lại"]})]}),e.jsx("form",{onSubmit:async e=>{if(e.preventDefault(),(()=>{const e={};return G.code.trim()?/^[A-Z0-9_-]{3,20}$/.test(G.code)||(e.code="Mã voucher chỉ bao gồm chữ hoa, số, gạch dưới và gạch ngang (3-20 ký tự)"):e.code="Mã voucher không được để trống",G.name.trim()||(e.name="Tên voucher không được để trống"),G.value<=0&&(e.value="Giá trị voucher phải lớn hơn 0"),"PERCENTAGE"===G.type&&G.value>100&&(e.value="Phần trăm giảm giá không được vượt quá 100%"),G.quantity<=0&&(e.quantity="Số lượng voucher phải lớn hơn 0"),G.startDate||(e.startDate="Ngày bắt đầu không được để trống"),G.endDate||(e.endDate="Ngày kết thúc không được để trống"),G.startDate&&G.endDate&&new Date(G.startDate)>new Date(G.endDate)&&(e.endDate="Ngày kết thúc phải sau ngày bắt đầu"),(G.minOrderValue??0)<0&&(e.minOrderValue="Giá trị đơn hàng tối thiểu không được âm"),"PERCENTAGE"===G.type&&void 0!==G.maxDiscount&&G.maxDiscount<=0&&(e.maxDiscount="Giảm giá tối đa phải lớn hơn 0"),k(e),0===Object.keys(e).length})())try{await A.mutateAsync(G,{onSuccess:()=>{o.success("Tạo mã giảm giá thành công"),S("/admin/discounts/vouchers")},onError:e=>{o.error("Tạo mã giảm giá thất bại: "+(e.message||"Không xác định"))}})}catch(s){o.error("Tạo mã giảm giá thất bại")}else o.error("Vui lòng điền đầy đủ thông tin")},children:e.jsxs(x,{children:[e.jsx(u,{children:e.jsx(g,{children:"Thông tin mã giảm giá"})}),e.jsx(j,{className:"space-y-4 text-maintext",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(v,{htmlFor:"code",children:["Mã voucher ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx(h,{id:"code",name:"code",value:G.code,onChange:P,placeholder:"VD: SUMMER2024",className:V.code?"border-red-500":""}),e.jsx(m,{type:"button",variant:"default",onClick:()=>{const e=function(){const e=Array.from({length:4},(()=>String.fromCharCode(65+Math.floor(26*Math.random())))).join(""),s=new Date;let t,a;do{t=Math.floor(31*Math.random())+1,a=Math.floor(12*Math.random())+1}while(a<s.getMonth()+1||a===s.getMonth()+1&&t<=s.getDate());return`${e}${t.toString().padStart(2,"0")}${a.toString().padStart(2,"0")}`}();M({...G,code:e,name:`Voucher ${e}`}),V.code&&k({...V,code:""})},children:"Random voucher"})]}),V.code&&e.jsx("p",{className:"text-red-500 text-sm",children:V.code}),e.jsx("p",{className:"text-xs text-maintext",children:"Mã voucher chỉ bao gồm chữ hoa, số, gạch dưới và gạch ngang"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(v,{htmlFor:"name",children:["Tên voucher ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(h,{id:"name",name:"name",value:G.name,onChange:P,placeholder:"VD: Đợt khuyến mãi mùa hè 2024",className:V.name?"border-red-500":""}),V.name&&e.jsx("p",{className:"text-red-500 text-sm",children:V.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(v,{htmlFor:"type",children:["Loại voucher ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs(b,{value:G.type,onValueChange:e=>F("type",e),children:[e.jsx(f,{id:"type",className:V.type?"border-red-500":"",children:e.jsx(C,{placeholder:"Chọn loại voucher"})}),e.jsxs(E,{children:[e.jsx(T,{value:"PERCENTAGE",children:"Phần trăm (%)"}),e.jsx(T,{value:"FIXED_AMOUNT",children:"Số tiền cố định (VNĐ)"})]})]}),V.type&&e.jsx("p",{className:"text-red-500 text-sm",children:V.type})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(v,{htmlFor:"value",children:["Giá trị ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(h,{id:"value",name:"value",type:"number",min:0,value:G.value,onChange:P,className:`${V.value?"border-red-500":""} ${"PERCENTAGE"===G.type?"rounded-r-none":""}`}),"PERCENTAGE"===G.type&&e.jsx("div",{className:"bg-gray-100 border border-l-0 px-3 py-2 rounded-r-md",children:"%"}),"FIXED_AMOUNT"===G.type&&e.jsx("div",{className:"bg-gray-100 border border-l-0 px-3 py-2 rounded-r-md",children:"VNĐ"})]}),V.value&&e.jsx("p",{className:"text-red-500 text-sm",children:V.value}),e.jsx("p",{className:"text-xs text-maintext",children:"PERCENTAGE"===G.type?"Phần trăm giảm giá (0-100%)":"Số tiền giảm giá cố định"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(v,{htmlFor:"quantity",children:["Số lượng ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(h,{id:"quantity",name:"quantity",type:"number",min:1,value:G.quantity,onChange:P,className:V.quantity?"border-red-500":""}),V.quantity&&e.jsx("p",{className:"text-red-500 text-sm",children:V.quantity}),e.jsx("p",{className:"text-xs text-maintext",children:"Tổng số voucher có thể sử dụng"})]}),"PERCENTAGE"===G.type&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"maxDiscount",children:"Giảm giá tối đa"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(h,{id:"maxDiscount",name:"maxDiscount",type:"number",min:0,value:void 0===G.maxDiscount?"":G.maxDiscount,onChange:P,className:(V.maxDiscount?"border-red-500":"")+" rounded-r-none"}),e.jsx("div",{className:"bg-gray-100 border border-l-0 px-3 py-2 rounded-r-md",children:"VNĐ"})]}),V.maxDiscount&&e.jsx("p",{className:"text-red-500 text-sm",children:V.maxDiscount}),e.jsx("p",{className:"text-xs text-maintext",children:"Giới hạn số tiền giảm tối đa (để trống nếu không giới hạn)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"minOrderValue",children:"Giá trị đơn hàng tối thiểu"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(h,{id:"minOrderValue",name:"minOrderValue",type:"number",min:0,value:G.minOrderValue,onChange:P,className:(V.minOrderValue?"border-red-500":"")+" rounded-r-none"}),e.jsx("div",{className:"bg-gray-100 border border-l-0 px-3 py-2 rounded-r-md",children:"VNĐ"})]}),V.minOrderValue&&e.jsx("p",{className:"text-red-500 text-sm",children:V.minOrderValue}),e.jsx("p",{className:"text-xs text-maintext",children:"Giá trị đơn hàng tối thiểu để áp dụng voucher (0 = không giới hạn)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(v,{htmlFor:"startDate",children:["Ngày bắt đầu ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(h,{id:"startDate",name:"startDate",type:"date",value:"string"==typeof G.startDate?G.startDate:G.startDate.toISOString().split("T")[0],onChange:e=>q("startDate",e.target.value),className:V.startDate?"border-red-500":""}),V.startDate&&e.jsx("p",{className:"text-red-500 text-sm",children:V.startDate})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(v,{htmlFor:"endDate",children:["Ngày kết thúc ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(h,{id:"endDate",name:"endDate",type:"date",value:"string"==typeof G.endDate?G.endDate:G.endDate.toISOString().split("T")[0],onChange:e=>q("endDate",e.target.value),className:V.endDate?"border-red-500":""}),V.endDate&&e.jsx("p",{className:"text-red-500 text-sm",children:V.endDate})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"status",children:"Trạng thái"}),e.jsxs(b,{value:G.status,onValueChange:e=>F("status",e),children:[e.jsx(f,{id:"status",className:V.status?"border-red-500":"",children:e.jsx(C,{placeholder:"Chọn trạng thái"})}),e.jsxs(E,{children:[e.jsx(T,{value:"HOAT_DONG",children:"Hoạt động"}),e.jsx(T,{value:"KHONG_HOAT_DONG",children:"Không hoạt động"})]})]}),V.status&&e.jsx("p",{className:"text-red-500 text-sm",children:V.status}),e.jsx("p",{className:"text-xs text-maintext",children:"Trạng thái của voucher (người dùng chỉ có thể sử dụng voucher đang hoạt động)"})]})]})}),e.jsxs(p,{className:"border-t px-4 py-4 flex justify-between",children:[e.jsx(m,{variant:"outline",onClick:()=>S(-1),disabled:A.isPending,children:"Hủy"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(m,{type:"button",variant:"outline",onClick:()=>M(O),disabled:A.isPending,children:"Đặt lại"}),e.jsx(m,{type:"submit",disabled:A.isPending,children:A.isPending?e.jsxs(e.Fragment,{children:[e.jsx(N.Icon,{path:D,size:.7,className:"mr-2 animate-spin"}),"Đang xử lý..."]}):"Tạo mã giảm giá"})]})]})]})})]})}const G=()=>e.jsx(S,{});export{G as default};
