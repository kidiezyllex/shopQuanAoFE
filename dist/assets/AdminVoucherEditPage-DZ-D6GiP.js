import{U as _,b9 as I,a as y,j as e,a2 as o,B as u,k as D,w as S,q as h,aQ as M,a6 as v}from"./index-Dpx_4rWJ.js";import{f as z,g as K}from"./voucher-C7mr4xZE.js";import{B as E,a as w,b as l,c as m,d as x,e as G}from"./breadcrumb-CJedQ5QG.js";import{C as b,a as q,c as C,b as $,e as U}from"./card-fT6uSY2F.js";import{L as d}from"./label-B0XdI4bT.js";import{S as J,a as W,b as X,c as Y,d as F}from"./select-CS4vNzI5.js";import"./createLucideIcon-BdgKQErZ.js";import"./index-BdQq_4o_.js";import"./index-qvEK80KO.js";import"./check-CyKb8IHM.js";function Z(){const c=_(),V=I(),k=typeof V.id=="string"?V.id:"",{data:n,isLoading:P,isError:A}=z(k),j=K(),[s,g]=y.useState({name:"",quantity:0,startDate:"",endDate:"",minOrderValue:0,maxDiscount:void 0,status:"HOAT_DONG"}),[r,B]=y.useState({code:"",discountType:"",discountValue:0,usedCount:0}),[a,p]=y.useState({});y.useEffect(()=>{n!=null&&n.data&&(g({name:n.data.name,quantity:n.data.quantity,startDate:n.data.startDate.split("T")[0],endDate:n.data.endDate.split("T")[0],minOrderValue:n.data.minOrderValue,maxDiscount:n.data.maxDiscount,status:n.data.status}),B({code:n.data.code,discountType:n.data.discountType,discountValue:n.data.discountValue,usedCount:n.data.usedCount}))},[n]);const N=t=>{const{name:i,value:f,type:R}=t.target;let T=f;R==="number"&&(T=f===""?0:parseFloat(f)),g({...s,[i]:T}),a[i]&&p({...a,[i]:""})},L=(t,i)=>{g({...s,[t]:i}),a[t]&&p({...a,[t]:""})},O=(t,i)=>{g({...s,[t]:i}),a[t]&&p({...a,[t]:""})},H=()=>{var i;const t={};return(i=s.name)!=null&&i.trim()||(t.name="Tên voucher không được để trống"),s.quantity!==void 0&&s.quantity<r.usedCount&&(t.quantity=`Số lượng không được nhỏ hơn số lượng đã sử dụng (${r.usedCount})`),s.startDate||(t.startDate="Ngày bắt đầu không được để trống"),s.endDate||(t.endDate="Ngày kết thúc không được để trống"),s.startDate&&s.endDate&&new Date(s.startDate)>new Date(s.endDate)&&(t.endDate="Ngày kết thúc phải sau ngày bắt đầu"),s.minOrderValue!==void 0&&s.minOrderValue<0&&(t.minOrderValue="Giá trị đơn hàng tối thiểu không được âm"),r.discountType==="PERCENTAGE"&&s.maxDiscount!==void 0&&s.maxDiscount<=0&&(t.maxDiscount="Giảm giá tối đa phải lớn hơn 0"),p(t),Object.keys(t).length===0},Q=async t=>{if(t.preventDefault(),!H()){v.error("Vui lòng điền đầy đủ thông tin");return}try{await j.mutateAsync({voucherId:k,payload:s},{onSuccess:()=>{v.success("Cập nhật mã giảm giá thành công"),c("/admin/discounts/vouchers")},onError:i=>{v.error("Cập nhật mã giảm giá thất bại: "+(i.message||"Không xác định"))}})}catch{v.error("Cập nhật mã giảm giá thất bại")}};return P?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(o,{className:"h-6 w-64"}),e.jsx(o,{className:"h-10 w-24"})]}),e.jsxs(b,{children:[e.jsx(q,{children:e.jsx(o,{className:"h-7 w-48"})}),e.jsx(C,{children:e.jsx("div",{className:"space-y-4",children:[...Array(6)].map((t,i)=>e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{className:"h-4 w-32"}),e.jsx(o,{className:"h-10 w-full"})]},i))})})]})]}):A||!n?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(E,{children:e.jsxs(w,{children:[e.jsx(l,{children:e.jsx(m,{href:"/admin/statistics",children:"Dashboard"})}),e.jsx(x,{}),e.jsx(l,{children:e.jsx(m,{href:"/admin/discounts",children:"Quản lý khuyến mãi"})}),e.jsx(x,{}),e.jsx(l,{children:e.jsx(m,{href:"/admin/discounts/vouchers",children:"Mã giảm giá"})}),e.jsx(x,{}),e.jsx(l,{children:e.jsx(G,{children:"Chỉnh sửa mã giảm giá"})})]})}),e.jsxs(u,{variant:"outline",onClick:()=>c(-1),className:"flex items-center gap-2",children:[e.jsx(D.Icon,{path:S,size:.7}),"Quay lại"]})]}),e.jsx(b,{children:e.jsxs(C,{className:"p-4 text-center",children:[e.jsx("p",{className:"text-red-500 mb-4",children:"Đã xảy ra lỗi khi tải thông tin mã giảm giá. Vui lòng thử lại sau."}),e.jsx(u,{variant:"outline",onClick:()=>c(-1),children:"Quay lại"})]})})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(E,{children:e.jsxs(w,{children:[e.jsx(l,{children:e.jsx(m,{href:"/admin/statistics",children:"Dashboard"})}),e.jsx(x,{}),e.jsx(l,{children:e.jsx(m,{href:"/admin/discounts",children:"Quản lý khuyến mãi"})}),e.jsx(x,{}),e.jsx(l,{children:e.jsx(m,{href:"/admin/discounts/vouchers",children:"Mã giảm giá"})}),e.jsx(x,{}),e.jsx(l,{children:e.jsx(G,{children:"Chỉnh sửa mã giảm giá"})})]})}),e.jsxs(u,{variant:"outline",onClick:()=>c(-1),className:"flex items-center gap-2",children:[e.jsx(D.Icon,{path:S,size:.7}),"Quay lại"]})]}),e.jsx("form",{onSubmit:Q,children:e.jsxs(b,{children:[e.jsx(q,{children:e.jsxs($,{children:["Chỉnh sửa mã giảm giá - ",r.code]})}),e.jsx(C,{className:"space-y-4 text-maintext",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"code",className:"text-maintext",children:"Mã voucher"}),e.jsx("div",{className:"px-2.5 border rounded-[6px] bg-gray-50 mt-1 h-9 flex items-center justify-between",children:r.code}),e.jsx("p",{className:"text-xs text-maintext mt-1 italic",children:"Mã voucher không thể thay đổi sau khi tạo"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"discountType",className:"text-maintext",children:"Loại voucher"}),e.jsx("div",{className:"px-2.5 border rounded-[6px] bg-gray-50 mt-1 h-9 flex items-center justify-between",children:r.discountType==="PERCENTAGE"?"Phần trăm (%)":"Số tiền cố định (VNĐ)"}),e.jsx("p",{className:"text-xs text-maintext mt-1 italic",children:"Loại voucher không thể thay đổi sau khi tạo"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"discountValue",className:"text-maintext",children:"Giá trị"}),e.jsxs("div",{className:"px-2.5 border rounded-[6px] bg-gray-50 mt-1 h-9 flex items-center justify-between flex",children:[e.jsx("span",{children:r.discountValue}),e.jsx("span",{className:"ml-2",children:r.discountType==="PERCENTAGE"?"%":"VNĐ"})]}),e.jsx("p",{className:"text-xs text-maintext mt-1 italic",children:"Giá trị không thể thay đổi sau khi tạo"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{htmlFor:"name",children:["Tên voucher ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(h,{id:"name",name:"name",value:s.name||"",onChange:N,className:a.name?"border-red-500":""}),a.name&&e.jsx("p",{className:"text-red-500 text-sm",children:a.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{htmlFor:"quantity",children:["Số lượng ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"flex items-center",children:e.jsx(h,{id:"quantity",name:"quantity",type:"number",min:r.usedCount,value:s.quantity||0,onChange:N,className:a.quantity?"border-red-500":""})}),a.quantity&&e.jsx("p",{className:"text-red-500 text-sm",children:a.quantity}),e.jsxs("p",{className:"text-xs text-maintext italic",children:["Đã sử dụng: ",r.usedCount,"/",s.quantity," voucher"]})]}),r.discountType==="PERCENTAGE"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"maxDiscount",children:"Giảm giá tối đa"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(h,{id:"maxDiscount",name:"maxDiscount",type:"number",min:0,value:s.maxDiscount===void 0?"":s.maxDiscount,onChange:N,className:`${a.maxDiscount?"border-red-500":""} rounded-r-none`}),e.jsx("div",{className:"bg-gray-100 border border-l-0 px-3 py-2 rounded-r-md",children:"VNĐ"})]}),a.maxDiscount&&e.jsx("p",{className:"text-red-500 text-sm",children:a.maxDiscount}),e.jsx("p",{className:"text-xs text-maintext",children:"Giới hạn số tiền giảm tối đa (để trống nếu không giới hạn)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"minOrderValue",children:"Giá trị đơn hàng tối thiểu"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(h,{id:"minOrderValue",name:"minOrderValue",type:"number",min:0,value:s.minOrderValue===void 0?0:s.minOrderValue,onChange:N,className:`${a.minOrderValue?"border-red-500":""} rounded-r-none`}),e.jsx("div",{className:"bg-gray-100 border border-l-0 px-3 py-2 rounded-r-md",children:"VNĐ"})]}),a.minOrderValue&&e.jsx("p",{className:"text-red-500 text-sm",children:a.minOrderValue}),e.jsx("p",{className:"text-xs text-maintext italic",children:"Giá trị đơn hàng tối thiểu để áp dụng voucher (0 = không giới hạn)"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{htmlFor:"startDate",children:["Ngày bắt đầu ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(h,{id:"startDate",name:"startDate",type:"date",value:s.startDate?new Date(s.startDate).toISOString().split("T")[0]:"",onChange:t=>O("startDate",t.target.value),className:a.startDate?"border-red-500":""}),a.startDate&&e.jsx("p",{className:"text-red-500 text-sm",children:a.startDate})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(d,{htmlFor:"endDate",children:["Ngày kết thúc ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(h,{id:"endDate",name:"endDate",type:"date",value:s.endDate?new Date(s.endDate).toISOString().split("T")[0]:"",onChange:t=>O("endDate",t.target.value),className:a.endDate?"border-red-500":""}),a.endDate&&e.jsx("p",{className:"text-red-500 text-sm",children:a.endDate})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"status",children:"Trạng thái"}),e.jsxs(J,{value:s.status||"",onValueChange:t=>L("status",t),children:[e.jsx(W,{id:"status",className:a.status?"border-red-500":"",children:e.jsx(X,{placeholder:"Chọn trạng thái"})}),e.jsxs(Y,{children:[e.jsx(F,{value:"HOAT_DONG",children:"Hoạt động"}),e.jsx(F,{value:"KHONG_HOAT_DONG",children:"Không hoạt động"})]})]}),a.status&&e.jsx("p",{className:"text-red-500 text-sm",children:a.status}),e.jsx("p",{className:"text-xs text-maintext",children:"Trạng thái của voucher (người dùng chỉ có thể sử dụng voucher đang hoạt động)"})]})]})}),e.jsxs(U,{className:"border-t px-4 py-4 flex justify-between",children:[e.jsx(u,{variant:"outline",onClick:()=>c(-1),disabled:j.isPending,children:"Hủy"}),e.jsx(u,{type:"submit",disabled:j.isPending,children:j.isPending?e.jsxs(e.Fragment,{children:[e.jsx(D.Icon,{path:M,size:.7,className:"mr-2 animate-spin"}),"Đang cập nhật..."]}):"Cập nhật"})]})]})})]})}const he=()=>{const{id:c}=I();return c?e.jsx(Z,{params:{id:c}}):e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Sửa voucher"}),e.jsx("p",{className:"text-gray-600",children:"ID voucher không hợp lệ"})]})};export{he as default};
