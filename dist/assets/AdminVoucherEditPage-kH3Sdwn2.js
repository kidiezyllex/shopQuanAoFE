import{j as e}from"./ui-vendor-CFM_MCUz.js";import{u as s,r as a,i as t}from"./react-vendor-B55MjJUH.js";import{f as n,g as i}from"./voucher-C38MW_cY.js";import{B as r,a as d,b as c,c as l,d as m,e as h}from"./breadcrumb-CP4jYkI2.js";import{B as x,I as o,y as u}from"./index-BHeY-5EX.js";import{C as j,a as g,c as p,b as N,e as v}from"./card-ClEzRAeX.js";import{L as y}from"./label-Bm9nFuXD.js";import{t as D,M as b,aC as f}from"./icons-vendor-BrsZP2ku.js";import{S as C,a as k,b as O,c as V,d as G}from"./select-C6W71KWg.js";import{S as q}from"./skeleton-4G_X8bY4.js";import"./query-vendor-CBwfxcof.js";import"./heavy-vendor-BfN2pHnQ.js";function E(){const t=s(),E=useParams(),S="string"==typeof E.id?E.id:"",{data:T,isLoading:w,isError:F}=n(S),A=i(),[P,I]=a.useState({name:"",quantity:0,startDate:"",endDate:"",minOrderValue:0,maxDiscount:void 0,status:"HOAT_DONG"}),[H,M]=a.useState({code:"",type:"",value:0,usedCount:0}),[Q,L]=a.useState({});a.useEffect((()=>{(null==T?void 0:T.data)&&(I({name:T.data.name,quantity:T.data.quantity,startDate:T.data.startDate.split("T")[0],endDate:T.data.endDate.split("T")[0],minOrderValue:T.data.minOrderValue,maxDiscount:T.data.maxDiscount,status:T.data.status}),M({code:T.data.code,type:T.data.type,value:T.data.value,usedCount:T.data.usedCount}))}),[T]);const R=e=>{const{name:s,value:a,type:t}=e.target;let n=a;"number"===t&&(n=""===a?0:parseFloat(a)),I({...P,[s]:n}),Q[s]&&L({...Q,[s]:""})},_=(e,s)=>{I({...P,[e]:s}),Q[e]&&L({...Q,[e]:""})};return w?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(q,{className:"h-6 w-64"}),e.jsx(q,{className:"h-10 w-24"})]}),e.jsxs(j,{children:[e.jsx(g,{children:e.jsx(q,{className:"h-7 w-48"})}),e.jsx(p,{children:e.jsx("div",{className:"space-y-4",children:[...Array(6)].map(((s,a)=>e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{className:"h-4 w-32"}),e.jsx(q,{className:"h-10 w-full"})]},a)))})})]})]}):F||!T?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(r,{children:e.jsxs(d,{children:[e.jsx(c,{children:e.jsx(l,{href:"/admin/statistics",children:"Dashboard"})}),e.jsx(m,{}),e.jsx(c,{children:e.jsx(l,{href:"/admin/discounts",children:"Quản lý Đợt khuyến mãi"})}),e.jsx(m,{}),e.jsx(c,{children:e.jsx(l,{href:"/admin/discounts/vouchers",children:"Mã giảm giá"})}),e.jsx(m,{}),e.jsx(c,{children:e.jsx(h,{children:"Chỉnh sửa mã giảm giá"})})]})}),e.jsxs(x,{variant:"outline",onClick:()=>t(-1),className:"flex items-center gap-2",children:[e.jsx(D.Icon,{path:b,size:.7}),"Quay lại"]})]}),e.jsx(j,{children:e.jsxs(p,{className:"p-4 text-center",children:[e.jsx("p",{className:"text-red-500 mb-4",children:"Đã xảy ra lỗi khi tải thông tin mã giảm giá. Vui lòng thử lại sau."}),e.jsx(x,{variant:"outline",onClick:()=>t(-1),children:"Quay lại"})]})})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(r,{children:e.jsxs(d,{children:[e.jsx(c,{children:e.jsx(l,{href:"/admin/statistics",children:"Dashboard"})}),e.jsx(m,{}),e.jsx(c,{children:e.jsx(l,{href:"/admin/discounts",children:"Quản lý Đợt khuyến mãi"})}),e.jsx(m,{}),e.jsx(c,{children:e.jsx(l,{href:"/admin/discounts/vouchers",children:"Mã giảm giá"})}),e.jsx(m,{}),e.jsx(c,{children:e.jsx(h,{children:"Chỉnh sửa mã giảm giá"})})]})}),e.jsxs(x,{variant:"outline",onClick:()=>t(-1),className:"flex items-center gap-2",children:[e.jsx(D.Icon,{path:b,size:.7}),"Quay lại"]})]}),e.jsx("form",{onSubmit:async e=>{if(e.preventDefault(),(()=>{var e;const s={};return(null==(e=P.name)?void 0:e.trim())||(s.name="Tên voucher không được để trống"),void 0!==P.quantity&&P.quantity<H.usedCount&&(s.quantity=`Số lượng không được nhỏ hơn số lượng đã sử dụng (${H.usedCount})`),P.startDate||(s.startDate="Ngày bắt đầu không được để trống"),P.endDate||(s.endDate="Ngày kết thúc không được để trống"),P.startDate&&P.endDate&&new Date(P.startDate)>new Date(P.endDate)&&(s.endDate="Ngày kết thúc phải sau ngày bắt đầu"),void 0!==P.minOrderValue&&P.minOrderValue<0&&(s.minOrderValue="Giá trị đơn hàng tối thiểu không được âm"),"PERCENTAGE"===H.type&&void 0!==P.maxDiscount&&P.maxDiscount<=0&&(s.maxDiscount="Giảm giá tối đa phải lớn hơn 0"),L(s),0===Object.keys(s).length})())try{await A.mutateAsync({voucherId:S,payload:P},{onSuccess:()=>{u.success("Cập nhật mã giảm giá thành công"),t("/admin/discounts/vouchers")},onError:e=>{u.error("Cập nhật mã giảm giá thất bại: "+(e.message||"Không xác định"))}})}catch(s){u.error("Cập nhật mã giảm giá thất bại")}else u.error("Vui lòng điền đầy đủ thông tin")},children:e.jsxs(j,{children:[e.jsx(g,{children:e.jsxs(N,{children:["Chỉnh sửa mã giảm giá - ",H.code]})}),e.jsx(p,{className:"space-y-4 text-maintext",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(y,{htmlFor:"code",className:"text-maintext",children:"Mã voucher"}),e.jsx("div",{className:"p-2.5 border rounded-[6px] bg-gray-50 mt-1",children:H.code}),e.jsx("p",{className:"text-xs text-maintext mt-1",children:"Mã voucher không thể thay đổi sau khi tạo"})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"type",className:"text-maintext",children:"Loại voucher"}),e.jsx("div",{className:"p-2.5 border rounded-[6px] bg-gray-50 mt-1",children:"PERCENTAGE"===H.type?"Phần trăm (%)":"Số tiền cố định (VNĐ)"}),e.jsx("p",{className:"text-xs text-maintext mt-1",children:"Loại voucher không thể thay đổi sau khi tạo"})]}),e.jsxs("div",{children:[e.jsx(y,{htmlFor:"value",className:"text-maintext",children:"Giá trị"}),e.jsxs("div",{className:"p-2.5 border rounded-[6px] bg-gray-50 mt-1 flex",children:[e.jsx("span",{children:H.value}),e.jsx("span",{className:"ml-2",children:"PERCENTAGE"===H.type?"%":"VNĐ"})]}),e.jsx("p",{className:"text-xs text-maintext mt-1",children:"Giá trị không thể thay đổi sau khi tạo"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(y,{htmlFor:"name",children:["Tên voucher ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(o,{id:"name",name:"name",value:P.name||"",onChange:R,className:Q.name?"border-red-500":""}),Q.name&&e.jsx("p",{className:"text-red-500 text-sm",children:Q.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(y,{htmlFor:"quantity",children:["Số lượng ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"flex items-center",children:e.jsx(o,{id:"quantity",name:"quantity",type:"number",min:H.usedCount,value:P.quantity||0,onChange:R,className:Q.quantity?"border-red-500":""})}),Q.quantity&&e.jsx("p",{className:"text-red-500 text-sm",children:Q.quantity}),e.jsxs("p",{className:"text-xs text-maintext",children:["Đã sử dụng: ",H.usedCount,"/",P.quantity," voucher"]})]}),"PERCENTAGE"===H.type&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"maxDiscount",children:"Giảm giá tối đa"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(o,{id:"maxDiscount",name:"maxDiscount",type:"number",min:0,value:void 0===P.maxDiscount?"":P.maxDiscount,onChange:R,className:(Q.maxDiscount?"border-red-500":"")+" rounded-r-none"}),e.jsx("div",{className:"bg-gray-100 border border-l-0 px-3 py-2 rounded-r-md",children:"VNĐ"})]}),Q.maxDiscount&&e.jsx("p",{className:"text-red-500 text-sm",children:Q.maxDiscount}),e.jsx("p",{className:"text-xs text-maintext",children:"Giới hạn số tiền giảm tối đa (để trống nếu không giới hạn)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"minOrderValue",children:"Giá trị đơn hàng tối thiểu"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(o,{id:"minOrderValue",name:"minOrderValue",type:"number",min:0,value:void 0===P.minOrderValue?0:P.minOrderValue,onChange:R,className:(Q.minOrderValue?"border-red-500":"")+" rounded-r-none"}),e.jsx("div",{className:"bg-gray-100 border border-l-0 px-3 py-2 rounded-r-md",children:"VNĐ"})]}),Q.minOrderValue&&e.jsx("p",{className:"text-red-500 text-sm",children:Q.minOrderValue}),e.jsx("p",{className:"text-xs text-maintext",children:"Giá trị đơn hàng tối thiểu để áp dụng voucher (0 = không giới hạn)"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(y,{htmlFor:"startDate",children:["Ngày bắt đầu ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(o,{id:"startDate",name:"startDate",type:"date",value:P.startDate?new Date(P.startDate).toISOString().split("T")[0]:"",onChange:e=>_("startDate",e.target.value),className:Q.startDate?"border-red-500":""}),Q.startDate&&e.jsx("p",{className:"text-red-500 text-sm",children:Q.startDate})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(y,{htmlFor:"endDate",children:["Ngày kết thúc ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(o,{id:"endDate",name:"endDate",type:"date",value:P.endDate?new Date(P.endDate).toISOString().split("T")[0]:"",onChange:e=>_("endDate",e.target.value),className:Q.endDate?"border-red-500":""}),Q.endDate&&e.jsx("p",{className:"text-red-500 text-sm",children:Q.endDate})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"status",children:"Trạng thái"}),e.jsxs(C,{value:P.status||"",onValueChange:e=>((e,s)=>{I({...P,[e]:s}),Q[e]&&L({...Q,[e]:""})})("status",e),children:[e.jsx(k,{id:"status",className:Q.status?"border-red-500":"",children:e.jsx(O,{placeholder:"Chọn trạng thái"})}),e.jsxs(V,{children:[e.jsx(G,{value:"HOAT_DONG",children:"Hoạt động"}),e.jsx(G,{value:"KHONG_HOAT_DONG",children:"Không hoạt động"})]})]}),Q.status&&e.jsx("p",{className:"text-red-500 text-sm",children:Q.status}),e.jsx("p",{className:"text-xs text-maintext",children:"Trạng thái của voucher (người dùng chỉ có thể sử dụng voucher đang hoạt động)"})]})]})}),e.jsxs(v,{className:"border-t px-4 py-4 flex justify-between",children:[e.jsx(x,{variant:"outline",onClick:()=>t(-1),disabled:A.isPending,children:"Hủy"}),e.jsx(x,{type:"submit",disabled:A.isPending,children:A.isPending?e.jsxs(e.Fragment,{children:[e.jsx(D.Icon,{path:f,size:.7,className:"mr-2 animate-spin"}),"Đang cập nhật..."]}):"Cập nhật"})]})]})})]})}const S=()=>{const{id:s}=t();return s?e.jsx(E,{params:{id:s}}):e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Sửa voucher"}),e.jsx("p",{className:"text-gray-600",children:"ID voucher không hợp lệ"})]})};export{S as default};
