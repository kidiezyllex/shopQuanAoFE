import{j as e}from"./ui-vendor-CFM_MCUz.js";import{r as a}from"./react-vendor-B55MjJUH.js";import{C as s,c as t}from"./card-ClEzRAeX.js";import{S as i}from"./skeleton-4G_X8bY4.js";import{t as n,aN as l,a5 as c,ad as r,aK as d,ae as m,H as o,aL as x,aM as h,aC as j}from"./icons-vendor-BrsZP2ku.js";import{B as p,I as u,y as g}from"./index-BHeY-5EX.js";import{b as v,c as N,d as f,a as y}from"./voucher-C38MW_cY.js";import{d as b}from"./query-vendor-CBwfxcof.js";import{B as C,a as D,b as w,c as T,d as k,e as P}from"./breadcrumb-CP4jYkI2.js";import{T as S,a as z,b as H,c as G,d as I,e as A}from"./table-DL-K3PV4.js";import{S as O,a as E,b as F,c as K,d as _}from"./select-C6W71KWg.js";import{B as M}from"./badge-BeHegjHt.js";import{L as V}from"./label-Bm9nFuXD.js";import{A as q,m as B}from"./heavy-vendor-BfN2pHnQ.js";function L(){var L,X;const[Q,R]=a.useState(""),[$,J]=a.useState({page:1,limit:10}),[U,W]=a.useState(!1),{data:Y,isLoading:Z,isError:ee}=v($),ae=N(),se=f(),te=b(),[ie,ne]=a.useState(!1),[le,ce]=a.useState(!1),[re,de]=a.useState(!1),[me,oe]=a.useState(null),[xe,he]=a.useState(null),[je,pe]=a.useState(""),[ue,ge]=a.useState(""),ve=y(),[Ne,fe]=a.useState(null);a.useEffect((()=>{const e=setTimeout((()=>{if(Q.trim())J((e=>({...e,name:Q,page:1})));else{const{name:e,...a}=$;J({...a,page:1})}}),500);return()=>clearTimeout(e)}),[Q]);const ye=(e,a)=>{if(""===a){const a={...$};delete a[e],J({...a,page:1})}else J({...$,[e]:a,page:1})},be=e=>{J({...$,page:e})},Ce=e=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND",maximumFractionDigits:0}).format(e),De=e=>new Intl.DateTimeFormat("vi-VN",{day:"2-digit",month:"2-digit",year:"numeric"}).format(new Date(e)),we=()=>{pe(""),ge(""),fe(null),de(!1)};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(C,{children:e.jsxs(D,{children:[e.jsx(w,{children:e.jsx(T,{href:"/admin/statistics",children:"Dashboard"})}),e.jsx(k,{}),e.jsx(w,{children:e.jsx(T,{href:"/admin/discounts",children:"Quản lý Đợt khuyến mãi"})}),e.jsx(k,{}),e.jsx(w,{children:e.jsx(P,{children:"Mã giảm giá"})})]})}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(p,{variant:"outline",onClick:()=>de(!0),className:"flex items-center gap-2",children:[e.jsx(n.Icon,{path:l,size:.7}),"Kiểm tra mã"]}),e.jsx("a",{href:"/admin/discounts/vouchers/create",className:"flex items-center gap-2",children:e.jsxs(p,{className:"flex items-center gap-2",children:[e.jsx(n.Icon,{path:c,size:.7}),"Thêm mã giảm giá mới"]})})]})]}),e.jsx(s,{className:"mb-4",children:e.jsxs(t,{className:"py-4",children:[e.jsxs("div",{className:"flex flex-col space-y-4 md:space-y-0 md:flex-row md:justify-between md:items-center gap-2",children:[e.jsxs("div",{className:"relative flex-1 max-w-4xl",children:[e.jsx(n.Icon,{path:r,size:.7,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-maintext"}),e.jsx(u,{type:"text",placeholder:"Tìm kiếm theo tên hoặc mã voucher...",className:"pl-10 pr-4 py-2 w-full border rounded-[6px]",value:Q,onChange:e=>R(e.target.value)})]}),e.jsxs("div",{className:"flex space-x-2",children:[(U||Q||Object.keys($).filter((e=>"page"!==e&&"limit"!==e)).length>0)&&e.jsxs(p,{variant:"outline",className:"flex items-center",onClick:()=>{R(""),J({page:1,limit:10})},children:[e.jsx(n.Icon,{path:d,size:.7,className:"mr-2"}),"Clear bộ lọc"]}),e.jsxs(p,{variant:"outline",className:"flex items-center",onClick:()=>W(!U),children:[e.jsx(n.Icon,{path:m,size:.7,className:"mr-2"}),U?"Ẩn bộ lọc":"Hiện bộ lọc"]})]})]}),e.jsx(q,{children:U&&e.jsx(B.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3},className:"mt-4 pt-4 border-t",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-maintext mb-2 font-semibold",children:"Mã voucher"}),e.jsx(u,{type:"text",value:$.code||"",onChange:e=>ye("code",e.target.value),placeholder:"Nhập mã voucher",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-maintext mb-2 font-semibold",children:"Trạng thái"}),e.jsxs(O,{value:$.status||"",onValueChange:e=>ye("status","all"===e?void 0:e),children:[e.jsx(E,{children:e.jsx(F,{placeholder:"Tất cả trạng thái"})}),e.jsxs(K,{children:[e.jsx(_,{value:"all",children:"Tất cả trạng thái"}),e.jsx(_,{value:"HOAT_DONG",children:"Hoạt động"}),e.jsx(_,{value:"KHONG_HOAT_DONG",children:"Không hoạt động"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-maintext mb-2 font-semibold",children:"Thời gian"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{children:e.jsx(u,{type:"date",value:$.startDate||"",onChange:e=>ye("startDate",e.target.value),className:"w-full",placeholder:"Từ ngày"})}),e.jsx("div",{children:e.jsx(u,{type:"date",value:$.endDate||"",onChange:e=>ye("endDate",e.target.value),className:"w-full",placeholder:"Đến ngày"})})]})]})]})})})]})}),Z?e.jsx("div",{className:"bg-white rounded-[6px] shadow-sm p-4 space-y-4",children:[...Array(5)].map(((a,s)=>e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(i,{className:"h-12 w-12 rounded-[6px]"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{className:"h-4 w-[250px]"}),e.jsx(i,{className:"h-4 w-[200px]"})]})]},s)))}):ee?e.jsxs("div",{className:"bg-white rounded-[6px] shadow-sm p-4 text-center",children:[e.jsx("p",{className:"text-red-500",children:"Đã xảy ra lỗi khi tải dữ liệu. Vui lòng thử lại sau."}),e.jsx(p,{variant:"outline",className:"mt-4",onClick:()=>te.invalidateQueries({queryKey:["vouchers"]}),children:"Thử lại"})]}):e.jsxs("div",{className:"bg-white rounded-[6px] shadow-sm overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(S,{children:[e.jsx(z,{children:e.jsxs(H,{children:[e.jsx(G,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"Mã"}),e.jsx(G,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"Tên"}),e.jsx(G,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"Loại"}),e.jsx(G,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"Giá trị"}),e.jsx(G,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"Sử dụng"}),e.jsx(G,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"Thời gian"}),e.jsx(G,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"Trạng thái"}),e.jsx(G,{className:"px-4 py-4 text-center text-sm font-medium text-maintext",children:"Thao tác"})]})}),e.jsx(I,{children:null==(X=null==(L=null==Y?void 0:Y.data)?void 0:L.vouchers)?void 0:X.map((a=>e.jsxs(H,{children:[e.jsx(A,{className:"px-4 py-4 text-sm",children:e.jsx("span",{className:"font-mono font-medium",children:a.code})}),e.jsx(A,{className:"px-4 py-4 text-sm font-medium",children:a.name}),e.jsx(A,{className:"px-4 py-4 text-sm",children:"PERCENTAGE"===a.type?"Phần trăm":"Số tiền cố định"}),e.jsx(A,{className:"px-4 py-4 text-sm",children:"PERCENTAGE"===a.type?`${a.value}%`:Ce(a.value)}),e.jsxs(A,{className:"px-4 py-4 text-sm",children:[a.usedCount,"/",a.quantity]}),e.jsxs(A,{className:"px-4 py-4 text-sm",children:[De(a.startDate)," - ",De(a.endDate)]}),e.jsx(A,{className:"px-4 py-4 text-sm",children:e.jsx(M,{variant:"HOAT_DONG"===a.status?"default":"destructive",children:"HOAT_DONG"===a.status?"Hoạt động":"Không hoạt động"})}),e.jsx(A,{className:"px-4 py-4 text-sm text-right",children:e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsx(p,{variant:"outline",size:"icon",onClick:()=>{he(a.id),ce(!0)},title:"Gửi thông báo",children:e.jsx(n.Icon,{path:o,size:.7})}),e.jsx("a",{href:`/admin/discounts/vouchers/edit/${a.id}`,children:e.jsx(p,{variant:"outline",size:"icon",title:"Sửa",children:e.jsx(n.Icon,{path:x,size:.7})})}),e.jsx(p,{variant:"outline",size:"icon",onClick:()=>{oe(a.id),ne(!0)},title:"Xóa",children:e.jsx(n.Icon,{path:h,size:.7})})]})})]},a.id)))})]})}),Y&&Y.data&&Y.data.pagination&&e.jsxs("div",{className:"flex justify-center items-center space-x-2 p-4 border-t",children:[e.jsxs(p,{variant:"outline",size:"icon",onClick:()=>be(1),disabled:1===Y.data.pagination.currentPage,children:[e.jsx("span",{className:"sr-only",children:"Trang đầu"}),e.jsx("span",{children:"«"})]}),e.jsxs(p,{variant:"outline",size:"icon",onClick:()=>be(Y.data.pagination.currentPage-1),disabled:1===Y.data.pagination.currentPage,children:[e.jsx("span",{className:"sr-only",children:"Trang trước"}),e.jsx("span",{children:"‹"})]}),[...Array(Y.data.pagination.totalPages)].map(((a,s)=>{const t=s+1;return 1===t||t===Y.data.pagination.totalPages||t>=Y.data.pagination.currentPage-2&&t<=Y.data.pagination.currentPage+2?e.jsx(p,{variant:t===Y.data.pagination.currentPage?"default":"outline",size:"icon",onClick:()=>be(t),children:t},t):t===Y.data.pagination.currentPage-3||t===Y.data.pagination.currentPage+3?e.jsx("span",{children:"..."},t):null})),e.jsxs(p,{variant:"outline",size:"icon",onClick:()=>be(Y.data.pagination.currentPage+1),disabled:Y.data.pagination.currentPage===Y.data.pagination.totalPages,children:[e.jsx("span",{className:"sr-only",children:"Trang sau"}),e.jsx("span",{children:"›"})]}),e.jsxs(p,{variant:"outline",size:"icon",onClick:()=>be(Y.data.pagination.totalPages),disabled:Y.data.pagination.currentPage===Y.data.pagination.totalPages,children:[e.jsx("span",{className:"sr-only",children:"Trang cuối"}),e.jsx("span",{children:"»"})]})]})]}),e.jsx(Dialog,{open:ie,onOpenChange:ne,children:e.jsxs(DialogContent,{children:[e.jsx(DialogHeader,{children:e.jsx(DialogTitle,{children:"Xác nhận xóa mã giảm giá"})}),e.jsx("p",{className:"py-4",children:"Bạn có chắc chắn muốn xóa mã giảm giá này không? Hành động này không thể hoàn tác."}),e.jsxs(DialogFooter,{children:[e.jsx(DialogClose,{asChild:!0,children:e.jsx(p,{variant:"outline",children:"Hủy"})}),e.jsx(p,{variant:"destructive",onClick:()=>me&&(async e=>{try{await ae.mutateAsync(e,{onSuccess:()=>{g.success("Đã xóa mã giảm giá thành công"),te.invalidateQueries({queryKey:["vouchers"]}),ne(!1)}})}catch(a){g.error("Xóa mã giảm giá thất bại")}})(me),disabled:ae.isPending,children:ae.isPending?e.jsxs(e.Fragment,{children:[e.jsx(n.Icon,{path:j,size:.7,className:"mr-2 animate-spin"}),"Đang xóa..."]}):"Xóa"})]})]})}),e.jsx(Dialog,{open:le,onOpenChange:ce,children:e.jsxs(DialogContent,{children:[e.jsx(DialogHeader,{children:e.jsx(DialogTitle,{children:"Xác nhận gửi thông báo"})}),e.jsx("p",{className:"py-4",children:"Bạn có chắc chắn muốn gửi thông báo về mã giảm giá này tới tất cả khách hàng không?"}),e.jsxs(DialogFooter,{children:[e.jsx(DialogClose,{asChild:!0,children:e.jsx(p,{variant:"outline",children:"Hủy"})}),e.jsx(p,{onClick:()=>xe&&(async e=>{try{await se.mutateAsync(e,{onSuccess:()=>{g.success("Đã gửi thông báo mã giảm giá thành công"),ce(!1)}})}catch(a){g.error("Gửi thông báo thất bại")}})(xe),disabled:se.isPending,children:se.isPending?e.jsxs(e.Fragment,{children:[e.jsx(n.Icon,{path:j,size:.7,className:"mr-2 animate-spin"}),"Đang gửi..."]}):"Gửi thông báo"})]})]})}),e.jsx(Dialog,{open:re,onOpenChange:we,children:e.jsxs(DialogContent,{className:"sm:max-w-4xl",children:[e.jsx(DialogHeader,{children:e.jsx(DialogTitle,{children:"Kiểm tra mã giảm giá"})}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(V,{htmlFor:"voucher-code",className:"text-right",children:"Mã voucher"}),e.jsx(u,{id:"voucher-code",value:je,onChange:e=>pe(e.target.value),className:"col-span-3",placeholder:"Nhập mã voucher cần kiểm tra"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(V,{htmlFor:"order-value",className:"text-right",children:"Giá trị đơn hàng"}),e.jsx(u,{id:"order-value",type:"number",value:ue,onChange:e=>ge(e.target.value),className:"col-span-3",placeholder:"Nhập giá trị đơn hàng"})]}),Ne&&e.jsxs("div",{className:"border rounded-[6px] p-4 mt-2",children:[e.jsx("h4",{className:"text-md font-semibold mb-2",children:"Kết quả kiểm tra:"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-maintext",children:"Mã giảm giá:"}),e.jsx("span",{className:"font-medium",children:Ne.data.voucher.code})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-maintext",children:"Tên:"}),e.jsx("span",{className:"font-medium",children:Ne.data.voucher.name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-maintext",children:"Loại:"}),e.jsx("span",{className:"font-medium",children:"PERCENTAGE"===Ne.data.voucher.type?"Phần trăm":"Số tiền cố định"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-maintext",children:"Giá trị giảm:"}),e.jsx("span",{className:"font-medium text-primary",children:Ce(Ne.data.discountValue)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-maintext",children:"Thời hạn:"}),e.jsxs("span",{className:"font-medium",children:[De(Ne.data.voucher.startDate)," - ",De(Ne.data.voucher.endDate)]})]})]})]})]}),e.jsxs(DialogFooter,{className:"justify-between",children:[e.jsx(p,{type:"button",variant:"outline",onClick:we,children:"Hủy"}),e.jsx(p,{type:"button",onClick:async()=>{try{const e=await ve.mutateAsync({code:je,orderValue:ue?parseInt(ue):void 0});fe(e)}catch(e){g.error("Mã giảm giá không hợp lệ hoặc đã hết hạn"),fe(null)}},disabled:!je,children:"Kiểm tra"})]})]})})]})}const X=()=>e.jsx(L,{});export{X as default};
