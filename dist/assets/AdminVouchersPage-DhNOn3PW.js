import{a as n,aJ as me,j as e,B as t,k as r,aa as xe,ao as he,q as h,bf as ue,ap as pe,A as ge,m as je,a2 as V,s as Ne,bg as fe,bh as ye,aQ as _,a6 as g}from"./index-Dpx_4rWJ.js";import{C as be,c as ve}from"./card-fT6uSY2F.js";import{b as Ce,c as Te,d as De,a as we}from"./voucher-C7mr4xZE.js";import{B as Ve,a as Pe,b as P,c as q,d as X,e as ke}from"./breadcrumb-CJedQ5QG.js";import{T as Se,a as Oe,b as $,c as d,d as Ie,e as o}from"./table-BeX0puEz.js";import{S as ze,a as Fe,b as Ae,c as He,d as k}from"./select-CS4vNzI5.js";import{B as Be}from"./badge-CA2Kv9aL.js";import{L as J}from"./label-B0XdI4bT.js";import{D as S,a as O,b as I,c as z,e as F,i as U}from"./dialog-BuHyDe_9.js";import"./createLucideIcon-BdgKQErZ.js";import"./index-BdQq_4o_.js";import"./index-qvEK80KO.js";import"./check-CyKb8IHM.js";function Ee(){var M,Q;const[u,A]=n.useState(""),[c,x]=n.useState({page:1,limit:10}),[j,W]=n.useState(!1),{data:s,isLoading:Y,isError:Z}=Ce(c),y=Te(),b=De(),H=me(),[ee,v]=n.useState(!1),[ae,C]=n.useState(!1),[se,te]=n.useState(!1),[B,ie]=n.useState(null),[E,ne]=n.useState(null),[T,G]=n.useState(""),[D,K]=n.useState(""),le=we(),[m,w]=n.useState(null);n.useEffect(()=>{const a=setTimeout(()=>{if(u.trim())x(l=>({...l,name:u,page:1}));else{const{name:l,...i}=c;x({...i,page:1})}},500);return()=>clearTimeout(a)},[u]);const N=(a,l)=>{if(l===""){const i={...c};delete i[a],x({...i,page:1})}else x({...c,[a]:l,page:1})},ce=()=>{A(""),x({page:1,limit:10})},re=async a=>{try{await y.mutateAsync(a,{onSuccess:()=>{g.success("Đã xóa mã giảm giá thành công"),H.invalidateQueries({queryKey:["vouchers"]}),v(!1)}})}catch{g.error("Xóa mã giảm giá thất bại")}},de=async a=>{try{await b.mutateAsync(a,{onSuccess:()=>{g.success("Đã gửi thông báo mã giảm giá thành công"),C(!1)}})}catch{g.error("Gửi thông báo thất bại")}},p=a=>{x({...c,page:a})},L=a=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND",maximumFractionDigits:0}).format(a),f=a=>new Intl.DateTimeFormat("vi-VN",{day:"2-digit",month:"2-digit",year:"numeric"}).format(new Date(a)),oe=async()=>{try{const a=await le.mutateAsync({code:T,orderValue:D?parseInt(D):void 0});w(a)}catch{g.error("Mã giảm giá không hợp lệ hoặc đã hết hạn"),w(null)}},R=()=>{G(""),K(""),w(null),te(!1)};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(Ve,{children:e.jsxs(Pe,{children:[e.jsx(P,{children:e.jsx(q,{href:"/admin/statistics",children:"Dashboard"})}),e.jsx(X,{}),e.jsx(P,{children:e.jsx(q,{href:"/admin/discounts",children:"Quản lý khuyến mãi"})}),e.jsx(X,{}),e.jsx(P,{children:e.jsx(ke,{children:"Mã giảm giá"})})]})}),e.jsx("div",{className:"flex space-x-2",children:e.jsx("a",{href:"/admin/discounts/vouchers/create",className:"flex items-center gap-2",children:e.jsxs(t,{className:"flex items-center gap-2",children:[e.jsx(r.Icon,{path:xe,size:.7}),"Thêm mã giảm giá mới"]})})})]}),e.jsx(be,{className:"mb-4",children:e.jsxs(ve,{className:"py-4",children:[e.jsxs("div",{className:"flex flex-col space-y-4 md:space-y-0 md:flex-row md:justify-between md:items-center gap-2",children:[e.jsxs("div",{className:"relative flex-1 max-w-4xl",children:[e.jsx(r.Icon,{path:he,size:.7,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-maintext"}),e.jsx(h,{type:"text",placeholder:"Tìm kiếm theo tên hoặc mã voucher...",className:"pl-10 pr-4 py-2 w-full border rounded-[6px]",value:u,onChange:a=>A(a.target.value)})]}),e.jsxs("div",{className:"flex space-x-2",children:[(j||u||Object.keys(c).filter(a=>a!=="page"&&a!=="limit").length>0)&&e.jsxs(t,{variant:"outline",className:"flex items-center",onClick:ce,children:[e.jsx(r.Icon,{path:ue,size:.7,className:"mr-2"}),"Clear bộ lọc"]}),e.jsxs(t,{variant:"outline",className:"flex items-center",onClick:()=>W(!j),children:[e.jsx(r.Icon,{path:pe,size:.7,className:"mr-2"}),j?"Ẩn bộ lọc":"Hiện bộ lọc"]})]})]}),e.jsx(ge,{children:j&&e.jsx(je.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3},className:"mt-4 pt-4 border-t",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-maintext mb-2 font-semibold",children:"Mã voucher"}),e.jsx(h,{type:"text",value:c.code||"",onChange:a=>N("code",a.target.value),placeholder:"Nhập mã voucher",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-maintext mb-2 font-semibold",children:"Trạng thái"}),e.jsxs(ze,{value:c.status||"",onValueChange:a=>N("status",a==="all"?void 0:a),children:[e.jsx(Fe,{children:e.jsx(Ae,{placeholder:"Tất cả trạng thái"})}),e.jsxs(He,{children:[e.jsx(k,{value:"all",children:"Tất cả trạng thái"}),e.jsx(k,{value:"HOAT_DONG",children:"Hoạt động"}),e.jsx(k,{value:"KHONG_HOAT_DONG",children:"Không hoạt động"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-maintext mb-2 font-semibold",children:"Thời gian"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("div",{children:e.jsx(h,{type:"date",value:c.startDate||"",onChange:a=>N("startDate",a.target.value),className:"w-full",placeholder:"Từ ngày"})}),e.jsx("div",{children:e.jsx(h,{type:"date",value:c.endDate||"",onChange:a=>N("endDate",a.target.value),className:"w-full",placeholder:"Đến ngày"})})]})]})]})})})]})}),Y?e.jsx("div",{className:"bg-white rounded-[6px] shadow-sm p-4 space-y-4",children:[...Array(5)].map((a,l)=>e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(V,{className:"h-12 w-12 rounded-[6px]"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{className:"h-4 w-[250px]"}),e.jsx(V,{className:"h-4 w-[200px]"})]})]},l))}):Z?e.jsxs("div",{className:"bg-white rounded-[6px] shadow-sm p-4 text-center",children:[e.jsx("p",{className:"text-red-500",children:"Đã xảy ra lỗi khi tải dữ liệu. Vui lòng thử lại sau."}),e.jsx(t,{variant:"outline",className:"mt-4",onClick:()=>H.invalidateQueries({queryKey:["vouchers"]}),children:"Thử lại"})]}):e.jsxs("div",{className:"bg-white rounded-[6px] shadow-sm overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Se,{children:[e.jsx(Oe,{children:e.jsxs($,{children:[e.jsx(d,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"Mã"}),e.jsx(d,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"Tên"}),e.jsx(d,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"Loại"}),e.jsx(d,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"Giá trị"}),e.jsx(d,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"Sử dụng"}),e.jsx(d,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"Thời gian"}),e.jsx(d,{className:"px-4 py-4 text-left text-sm font-medium text-maintext",children:"Trạng thái"}),e.jsx(d,{className:"px-4 py-4 text-center text-sm font-medium text-maintext",children:"Thao tác"})]})}),e.jsx(Ie,{children:(Q=(M=s==null?void 0:s.data)==null?void 0:M.vouchers)==null?void 0:Q.map(a=>e.jsxs($,{children:[e.jsx(o,{className:"px-4 py-4 text-sm",children:e.jsx("span",{className:"font-mono font-medium",children:a.code})}),e.jsx(o,{className:"px-4 py-4 text-sm font-medium",children:a.name}),e.jsx(o,{className:"px-4 py-4 text-sm",children:(a==null?void 0:a.type)==="PERCENTAGE"?"Phần trăm":"Số tiền cố định"}),e.jsx(o,{className:"px-4 py-4 text-sm",children:(a==null?void 0:a.type)==="PERCENTAGE"?`${a==null?void 0:a.value}%`:L(a==null?void 0:a.value)}),e.jsxs(o,{className:"px-4 py-4 text-sm",children:[a.usedCount,"/",a.quantity]}),e.jsxs(o,{className:"px-4 py-4 text-sm",children:[f(a.startDate)," - ",f(a.endDate)]}),e.jsx(o,{className:"px-4 py-4 text-sm",children:e.jsx(Be,{variant:a.status==="HOAT_DONG"?"default":"destructive",children:a.status==="HOAT_DONG"?"Hoạt động":"Không hoạt động"})}),e.jsx(o,{className:"px-4 py-4 text-sm text-right",children:e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsx(t,{variant:"outline",size:"icon",onClick:()=>{ne(a.id),C(!0)},title:"Gửi thông báo",children:e.jsx(r.Icon,{path:Ne,size:.7})}),e.jsx("a",{href:`/admin/discounts/vouchers/edit/${a.id}`,children:e.jsx(t,{variant:"outline",size:"icon",title:"Sửa",children:e.jsx(r.Icon,{path:fe,size:.7})})}),e.jsx(t,{variant:"outline",size:"icon",onClick:()=>{ie(a.id),v(!0)},title:"Xóa",children:e.jsx(r.Icon,{path:ye,size:.7})})]})})]},a.id))})]})}),s&&s.data&&s.data.pagination&&e.jsxs("div",{className:"flex justify-center items-center space-x-2 p-4 border-t",children:[e.jsxs(t,{variant:"outline",size:"icon",onClick:()=>p(1),disabled:s.data.pagination.currentPage===1,children:[e.jsx("span",{className:"sr-only",children:"Trang đầu"}),e.jsx("span",{children:"«"})]}),e.jsxs(t,{variant:"outline",size:"icon",onClick:()=>p(s.data.pagination.currentPage-1),disabled:s.data.pagination.currentPage===1,children:[e.jsx("span",{className:"sr-only",children:"Trang trước"}),e.jsx("span",{children:"‹"})]}),[...Array(s.data.pagination.totalPages)].map((a,l)=>{const i=l+1;return i===1||i===s.data.pagination.totalPages||i>=s.data.pagination.currentPage-2&&i<=s.data.pagination.currentPage+2?e.jsx(t,{variant:i===s.data.pagination.currentPage?"default":"outline",size:"icon",onClick:()=>p(i),children:i},i):i===s.data.pagination.currentPage-3||i===s.data.pagination.currentPage+3?e.jsx("span",{children:"..."},i):null}),e.jsxs(t,{variant:"outline",size:"icon",onClick:()=>p(s.data.pagination.currentPage+1),disabled:s.data.pagination.currentPage===s.data.pagination.totalPages,children:[e.jsx("span",{className:"sr-only",children:"Trang sau"}),e.jsx("span",{children:"›"})]}),e.jsxs(t,{variant:"outline",size:"icon",onClick:()=>p(s.data.pagination.totalPages),disabled:s.data.pagination.currentPage===s.data.pagination.totalPages,children:[e.jsx("span",{className:"sr-only",children:"Trang cuối"}),e.jsx("span",{children:"»"})]})]})]}),e.jsx(S,{open:ee,onOpenChange:v,children:e.jsxs(O,{children:[e.jsx(I,{children:e.jsx(z,{children:"Xác nhận xóa mã giảm giá"})}),e.jsx("p",{className:"py-4",children:"Bạn có chắc chắn muốn xóa mã giảm giá này không? Hành động này không thể hoàn tác."}),e.jsxs(F,{children:[e.jsx(U,{asChild:!0,children:e.jsx(t,{variant:"outline",children:"Hủy"})}),e.jsx(t,{variant:"destructive",onClick:()=>B&&re(B),disabled:y.isPending,children:y.isPending?e.jsxs(e.Fragment,{children:[e.jsx(r.Icon,{path:_,size:.7,className:"mr-2 animate-spin"}),"Đang xóa..."]}):"Xóa"})]})]})}),e.jsx(S,{open:ae,onOpenChange:C,children:e.jsxs(O,{children:[e.jsx(I,{children:e.jsx(z,{children:"Xác nhận gửi thông báo"})}),e.jsx("p",{className:"py-4",children:"Bạn có chắc chắn muốn gửi thông báo về mã giảm giá này tới tất cả khách hàng không?"}),e.jsxs(F,{children:[e.jsx(U,{asChild:!0,children:e.jsx(t,{variant:"outline",children:"Hủy"})}),e.jsx(t,{onClick:()=>E&&de(E),disabled:b.isPending,children:b.isPending?e.jsxs(e.Fragment,{children:[e.jsx(r.Icon,{path:_,size:.7,className:"mr-2 animate-spin"}),"Đang gửi..."]}):"Gửi thông báo"})]})]})}),e.jsx(S,{open:se,onOpenChange:R,children:e.jsxs(O,{className:"sm:max-w-4xl",children:[e.jsx(I,{children:e.jsx(z,{children:"Kiểm tra mã giảm giá"})}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(J,{htmlFor:"voucher-code",className:"text-right",children:"Mã voucher"}),e.jsx(h,{id:"voucher-code",value:T,onChange:a=>G(a.target.value),className:"col-span-3",placeholder:"Nhập mã voucher cần kiểm tra"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(J,{htmlFor:"order-value",className:"text-right",children:"Giá trị đơn hàng"}),e.jsx(h,{id:"order-value",type:"number",value:D,onChange:a=>K(a.target.value),className:"col-span-3",placeholder:"Nhập giá trị đơn hàng"})]}),m&&e.jsxs("div",{className:"border rounded-[6px] p-4 mt-2",children:[e.jsx("h4",{className:"text-md font-semibold mb-2",children:"Kết quả kiểm tra:"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-maintext",children:"Mã giảm giá:"}),e.jsx("span",{className:"font-medium",children:m.data.voucher.code})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-maintext",children:"Tên:"}),e.jsx("span",{className:"font-medium",children:m.data.voucher.name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-maintext",children:"Loại:"}),e.jsx("span",{className:"font-medium",children:m.data.discountType==="PERCENTAGE"?"Phần trăm":"Số tiền cố định"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-maintext",children:"Giá trị giảm:"}),e.jsx("span",{className:"font-medium text-primary",children:L(m.data.discountValue)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-maintext",children:"Thời hạn:"}),e.jsxs("span",{className:"font-medium",children:[f(m.data.voucher.startDate)," - ",f(m.data.voucher.endDate)]})]})]})]})]}),e.jsxs(F,{className:"justify-between",children:[e.jsx(t,{type:"button",variant:"outline",onClick:R,children:"Hủy"}),e.jsx(t,{type:"button",onClick:oe,disabled:!T,children:"Kiểm tra"})]})]})})]})}const Ye=()=>e.jsx(Ee,{});export{Ye as default};
