import{j as s}from"./ui-vendor-CFM_MCUz.js";import{u as t,r as e}from"./react-vendor-B55MjJUH.js";import{u as a,a as r,F as i,b as n,c as o,d as l,e as d,f as m}from"./form-DeJYl1uA.js";import{u as c,B as h,i as x,I as u,y as p}from"./index-BHeY-5EX.js";import{C as j,a as f,b,d as y,c as k}from"./card-ClEzRAeX.js";import{aw as v,t as w,ax as g,aa as N,ab as P,ac as M}from"./icons-vendor-BrsZP2ku.js";import{m as z}from"./heavy-vendor-BfN2pHnQ.js";import{o as S,s as C}from"./utils-vendor-C6znz4jh.js";import"./label-Bm9nFuXD.js";import"./query-vendor-CBwfxcof.js";const A=S({oldPassword:C().min(6,"Mật khẩu cũ phải có ít nhất 6 ký tự"),newPassword:C().min(6,"Mật khẩu mới phải có ít nhất 6 ký tự"),confirmPassword:C().min(6,"Xác nhận mật khẩu phải có ít nhất 6 ký tự")}).refine((s=>s.newPassword===s.confirmPassword),{message:"Mật khẩu xác nhận không khớp với mật khẩu mới",path:["confirmPassword"]});function q({password:t}){const[a,r]=e.useState(0),[i,n]=e.useState("Nhập mật khẩu mới");return e.useEffect((()=>{if(!t)return r(0),void n("Nhập mật khẩu mới");let s=0;t.length>=8&&(s+=20),t.length>=12&&(s+=10),/[a-z]/.test(t)&&(s+=10),/[A-Z]/.test(t)&&(s+=15),/[0-9]/.test(t)&&(s+=15),/[^a-zA-Z0-9]/.test(t)&&(s+=20);/123456|password|qwerty|abc123/i.test(t)&&(s=Math.max(s-30,0)),r(s),n(s<40?"Mật khẩu yếu":s<70?"Mật khẩu trung bình":"Mật khẩu mạnh")}),[t]),s.jsxs("div",{className:"mt-2",children:[s.jsx("div",{className:"h-1.5 w-full bg-gray-200 rounded-full overflow-hidden",children:s.jsx("div",{className:`h-full ${a<40?"bg-red-500":a<70?"bg-yellow-500":"bg-green-500"} transition-all duration-300`,style:{width:`${Math.min(a,100)}%`}})}),s.jsx("p",{className:"text-xs mt-1 text-maintext dark:text-maintext",children:i})]})}function B(){const c=t(),j=x(),[f,b]=e.useState(!1),[y,k]=e.useState(!1),[v,w]=e.useState(!1),g=a({resolver:r(A),defaultValues:{oldPassword:"",newPassword:"",confirmPassword:""}});return s.jsx(i,{...g,children:s.jsxs("form",{onSubmit:g.handleSubmit((async s=>{try{await j.mutateAsync({oldPassword:s.oldPassword,newPassword:s.newPassword}),p.success("Đổi mật khẩu thành công"),setTimeout((()=>{c("/profile")}),2e3)}catch(t){p.error("Đổi mật khẩu thất bại")}})),className:"space-y-5",children:[s.jsx(n,{control:g.control,name:"oldPassword",render:({field:t})=>s.jsxs(o,{children:[s.jsx(l,{className:"text-maintext dark:text-gray-300 font-medium",children:"Mật khẩu hiện tại"}),s.jsx(d,{children:s.jsxs("div",{className:"relative",children:[s.jsx(u,{type:f?"text":"password",placeholder:"Nhập mật khẩu hiện tại",...t,className:"border-gray-300 dark:border-gray-700 focus-visible:ring-primary focus-visible:border-primary transition-all duration-300 pr-10"}),s.jsx("button",{type:"button",onClick:()=>b(!f),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-maintext hover:text-maintext focus:outline-none",children:f?s.jsx(N,{size:16}):s.jsx(P,{size:16})})]})}),s.jsx(m,{})]})}),s.jsx(n,{control:g.control,name:"newPassword",render:({field:t})=>s.jsxs(o,{children:[s.jsx(l,{className:"text-maintext dark:text-gray-300 font-medium",children:"Mật khẩu mới"}),s.jsx(d,{children:s.jsxs("div",{className:"relative",children:[s.jsx(u,{type:y?"text":"password",placeholder:"Nhập mật khẩu mới",...t,className:"border-gray-300 dark:border-gray-700 focus-visible:ring-primary focus-visible:border-primary transition-all duration-300 pr-10"}),s.jsx("button",{type:"button",onClick:()=>k(!y),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-maintext hover:text-maintext focus:outline-none",children:y?s.jsx(N,{size:16}):s.jsx(P,{size:16})})]})}),s.jsx(m,{}),s.jsx(q,{password:t.value})]})}),s.jsx(n,{control:g.control,name:"confirmPassword",render:({field:t})=>s.jsxs(o,{children:[s.jsx(l,{className:"text-maintext dark:text-gray-300 font-medium",children:"Xác nhận mật khẩu mới"}),s.jsx(d,{children:s.jsxs("div",{className:"relative",children:[s.jsx(u,{type:v?"text":"password",placeholder:"Nhập lại mật khẩu mới",...t,className:"border-gray-300 dark:border-gray-700 focus-visible:ring-primary focus-visible:border-primary transition-all duration-300 pr-10"}),s.jsx("button",{type:"button",onClick:()=>w(!v),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-maintext hover:text-maintext focus:outline-none",children:v?s.jsx(N,{size:16}):s.jsx(P,{size:16})})]})}),s.jsx(m,{})]})}),s.jsx("div",{className:"pt-4",children:s.jsx(h,{type:"submit",className:"bg-primary hover:bg-secondary transition-all duration-300 text-base font-semibold w-full py-4",disabled:j.isPending,children:j.isPending?s.jsxs(s.Fragment,{children:[s.jsx(M,{className:"w-5 h-5 mr-2 animate-spin"}),"Đang đổi mật khẩu..."]}):"Đổi mật khẩu"})})]})})}const E=()=>{const a=t(),{isAuthenticated:r}=c();return e.useEffect((()=>{r||a("/auth/login")}),[r,a]),r?s.jsx("div",{className:"container max-w-2xl mx-auto px-4 py-12",children:s.jsxs(z.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:[s.jsxs("div",{className:"mb-8",children:[s.jsxs(h,{variant:"outline",onClick:()=>a("/profile"),className:"mb-4",children:[s.jsx(v,{className:"w-4 h-4 mr-2"}),"Quay lại hồ sơ"]}),s.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[s.jsx("div",{className:"p-2 rounded-full bg-primary/10",children:s.jsx(w.Icon,{path:g,size:1.2,className:"text-primary"})}),s.jsx("h1",{className:"text-3xl font-bold text-maintext dark:text-white",children:"Đổi mật khẩu"})]}),s.jsx("p",{className:"text-maintext dark:text-maintext",children:"Bảo vệ tài khoản của bạn với mật khẩu mạnh và bảo mật"})]}),s.jsxs(j,{className:"border border-gray-200 dark:border-gray-700 shadow-sm",children:[s.jsxs(f,{children:[s.jsx(b,{children:"Thay đổi mật khẩu"}),s.jsx(y,{children:"Nhập mật khẩu hiện tại và mật khẩu mới để cập nhật"})]}),s.jsx(k,{children:s.jsx(B,{})})]})]})}):null};export{E as default};
