import{j as e}from"./ui-vendor-CFM_MCUz.js";import{r as s,u as t}from"./react-vendor-B55MjJUH.js";import{s as n,y as a,B as i,I as l,u as r,n as c,l as d}from"./index-BHeY-5EX.js";import{u as o}from"./useCartStore-nn8gyhXY.js";import{B as h,a as m,b as x,c as u,d as p,e as g}from"./breadcrumb-CP4jYkI2.js";import{C as j,c as f,a as N,b as v,e as b}from"./card-ClEzRAeX.js";import{u as y,a as w,F as C,b as S,c as T,d as k,e as V,f as I}from"./form-DeJYl1uA.js";import{S as D,a as $,b as P,c as E,d as M}from"./select-C6W71KWg.js";import{f as A}from"./formatters-BtOGY0AI.js";import{b as O}from"./order-BDDy-DF1.js";import{c as q}from"./query-vendor-CBwfxcof.js";import{L as B}from"./label-Bm9nFuXD.js";import{t as z,aB as _,M as F,ad as R,aC as K,ak as L,ap as G,G as X,aD as H,W as U,aE as Y}from"./icons-vendor-BrsZP2ku.js";import{o as Q,e as W,s as J}from"./utils-vendor-C6znz4jh.js";import"./heavy-vendor-BfN2pHnQ.js";import"./middleware-DTCYSWSl.js";const Z=()=>q({mutationFn:e=>(async e=>await n("/notifications",e))(e)});function ee({isOpen:t,onClose:n,orderData:r,onPaymentSuccess:c,onPaymentError:d}){const[o,h]=s.useState([]),[m,x]=s.useState(null),[u,p]=s.useState(""),[g,b]=s.useState(!1),[y,w]=s.useState(!1),[C,S]=s.useState("bank-selection"),[T,k]=s.useState(null),[V,I]=s.useState(""),[D,$]=s.useState(""),[P,E]=s.useState(""),[M,O]=s.useState(60),[q,Y]=s.useState(!1),Q=s.useMemo((()=>{if(!u)return o;const e=u.toLowerCase();return o.filter((s=>s.name.toLowerCase().includes(e)||s.shortName.toLowerCase().includes(e)||s.code.toLowerCase().includes(e)))}),[o,u]);s.useEffect((()=>{t&&W()}),[t]),s.useEffect((()=>{let e;return"otp-verification"===C&&M>0&&(e=setInterval((()=>{O((e=>e<=1?(Y(!0),0):e-1))}),1e3)),()=>clearInterval(e)}),[C,M]);const W=async()=>{try{b(!0);const e=await fetch("https://api.vietqr.io/v2/banks"),s=await e.json();if("00"!==s.code||!s.data)throw new Error("Không thể tải danh sách ngân hàng");{const e=s.data.filter((e=>1===e.transferSupported));h(e)}}catch(e){a.error("Không thể tải danh sách ngân hàng"),h([{id:1,name:"Ngân hàng TMCP Công thương Việt Nam",code:"ICB",bin:"970415",shortName:"VietinBank",logo:"https://api.vietqr.io/img/ICB.png",transferSupported:1,lookupSupported:1,short_name:"VietinBank",support:3,isTransfer:1,swift_code:"ICBVVNVX"},{id:2,name:"Ngân hàng TMCP Ngoại Thương Việt Nam",code:"VCB",bin:"970436",shortName:"Vietcombank",logo:"https://api.vietqr.io/img/VCB.png",transferSupported:1,lookupSupported:1,short_name:"Vietcombank",support:3,isTransfer:1,swift_code:"BFTVVNVX"},{id:3,name:"Ngân hàng TMCP Đầu tư và Phát triển Việt Nam",code:"BIDV",bin:"970418",shortName:"BIDV",logo:"https://api.vietqr.io/img/BIDV.png",transferSupported:1,lookupSupported:1,short_name:"BIDV",support:3,isTransfer:1,swift_code:"BIDVVNVX"}])}finally{b(!1)}},J=()=>{!V||V.length<8?a.error("Vui lòng nhập số tài khoản hợp lệ (ít nhất 8 số)"):(w(!0),setTimeout((()=>{$("NGUYEN VAN A"),S("otp-verification"),O(60),Y(!1),w(!1),a.success("Mã OTP đã được gửi đến số điện thoại của bạn")}),2e3))},Z=()=>{P&&4===P.length?"1234"===P?ee():a.error("Mã OTP không chính xác"):a.error("Vui lòng nhập mã OTP 4 số")},ee=async()=>{try{w(!0),S("processing"),await new Promise((e=>setTimeout(e,3e3)));if(Math.random()>.05){const e={orderId:r.orderId,amount:r.amount,bankCode:null==m?void 0:m.code,bankName:null==m?void 0:m.shortName,accountNumber:V,transactionId:`VNP${Date.now()}`,paymentTime:(new Date).toISOString(),status:"SUCCESS"};k(e),S("success"),setTimeout((()=>{c(e)}),2e3)}else S("error"),setTimeout((()=>{d("Giao dịch không thành công. Vui lòng thử lại.")}),2e3)}catch(e){S("error"),d("Đã xảy ra lỗi trong quá trình thanh toán")}finally{w(!1)}},se=()=>{O(60),Y(!1),E(""),a.success("Mã OTP mới đã được gửi")},te=()=>{"processing"!==C&&(ne(),n())},ne=()=>{S("bank-selection"),x(null),p(""),I(""),$(""),E(""),O(60),Y(!1),k(null)},ae=()=>{switch(C){case"account-input":S("bank-selection"),x(null);break;case"otp-verification":S("account-input"),E("");break;case"error":S("bank-selection"),ne()}},ie=()=>e.jsxs(j,{className:"mb-4",children:[e.jsx(N,{children:e.jsx(v,{className:"text-sm",children:"Thông tin đơn hàng"})}),e.jsxs(f,{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-maintext",children:"Mã đơn hàng:"}),e.jsx("span",{className:"font-medium text-maintext",children:r.orderCode||r.orderId})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-maintext",children:"Số tiền:"}),e.jsx("span",{className:"font-bold text-lg text-red-600",children:A(r.amount)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-maintext",children:"Nội dung:"}),e.jsx("span",{className:"font-medium text-right max-w-[200px] truncate text-maintext",children:r.orderInfo})]})]})]}),le=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"flex items-center justify-center mb-4",children:e.jsx("img",{draggable:"false",src:"/images/vnpay-logo.png",alt:"bank",width:500,height:500,className:"h-16 object-contain w-auto"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Thanh toán qua VNPay"}),e.jsx("p",{className:"text-maintext",children:"Chọn ngân hàng để thực hiện thanh toán"})]}),ie(),e.jsxs("div",{children:[e.jsx(B,{htmlFor:"bank-search",className:"text-sm font-medium mb-3 block",children:"Tìm kiếm ngân hàng"}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx(z.Icon,{path:R,size:.7,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-maintext"}),e.jsx(l,{id:"bank-search",placeholder:"Tìm theo tên ngân hàng, mã ngân hàng...",value:u,onChange:e=>p(e.target.value),className:"pl-10"})]})]}),e.jsxs("div",{children:[e.jsxs(B,{className:"text-sm font-medium mb-3 block",children:["Chọn ngân hàng (",Q.length," ngân hàng)"]}),g?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(z.Icon,{path:K,size:1,className:"animate-spin text-blue-600"}),e.jsx("span",{className:"ml-2",children:"Đang tải danh sách ngân hàng..."})]}):e.jsx("div",{className:"grid grid-cols-1 gap-4 max-h-80 overflow-y-auto border rounded-lg p-2",children:0===Q.length?e.jsx("div",{className:"text-center py-8 text-maintext",children:"Không tìm thấy ngân hàng nào"}):Q.map((s=>e.jsx("div",{className:"border rounded-lg p-3 cursor-pointer transition-all hover:border-blue-300 hover:bg-blue-50",onClick:()=>(e=>{x(e),S("account-input")})(s),children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-12 h-12 relative flex-shrink-0",children:e.jsx("img",{src:s.logo,alt:s.shortName,className:"w-full h-full object-contain rounded"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-sm",children:s.shortName}),e.jsx("div",{className:"text-xs text-maintext truncate",children:s.name}),e.jsxs("div",{className:"text-xs text-blue-600",children:["Mã: ",s.code]})]})]})},s.code)))})]}),e.jsxs("div",{className:"flex items-center justify-center space-x-2 text-sm text-maintext",children:[e.jsx(z.Icon,{path:L,size:.7}),e.jsx("span",{children:"Giao dịch được bảo mật bởi VNPay"})]})]});return e.jsx(Dialog,{open:t,onOpenChange:te,children:e.jsxs(DialogContent,{className:"sm:max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(DialogHeader,{children:e.jsxs(DialogTitle,{className:"flex items-center space-x-2",children:[e.jsx(z.Icon,{path:_,size:1,className:"text-blue-600"}),e.jsx("span",{children:"VNPay - Cổng thanh toán"})]})}),(()=>{switch(C){case"bank-selection":default:return le();case"account-input":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"flex items-center justify-center mb-4",children:e.jsx("img",{src:"/images/vnpay-logo.png",alt:"bank",width:500,height:500,className:"h-10 object-contain w-auto"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Thông tin tài khoản"}),e.jsx("p",{className:"text-maintext",children:"Nhập thông tin tài khoản ngân hàng"})]}),ie(),m&&e.jsx(j,{children:e.jsx(f,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-12 h-12 relative",children:e.jsx("img",{src:m.logo,alt:m.shortName,className:"w-full h-full object-contain"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:m.shortName}),e.jsx("div",{className:"text-sm text-maintext",children:m.name})]})]})})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs(B,{htmlFor:"account-number",className:"text-sm font-medium mb-2 block",children:["Số tài khoản ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(l,{id:"account-number",placeholder:"Nhập số tài khoản (ví dụ: 1234567890)",value:V,onChange:e=>I(e.target.value.replace(/\D/g,"")),maxLength:20})]}),D&&e.jsxs("div",{children:[e.jsx(B,{className:"text-sm font-medium mb-2 block",children:"Chủ tài khoản"}),e.jsx(l,{value:D,disabled:!0})]})]}),e.jsxs("div",{className:"flex items-center justify-center space-x-2 text-xs text-maintext",children:[e.jsx(z.Icon,{path:U,size:.7}),e.jsx("span",{children:"Thông tin được mã hóa và bảo mật"})]})]});case"otp-verification":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"flex items-center justify-center mb-4",children:e.jsx("div",{className:"bg-green-100 p-3 rounded-full",children:e.jsx(z.Icon,{path:H,size:1.5,className:"text-primary"})})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Xác thực OTP"}),e.jsx("p",{className:"text-maintext",children:"Nhập mã OTP được gửi đến số điện thoại của bạn"})]}),ie(),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(z.Icon,{path:H,size:1,className:"text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Mã OTP đã được gửi đến"}),e.jsx("p",{className:"text-sm text-maintext",children:"*******890"})]})]})}),e.jsxs("div",{children:[e.jsxs(B,{htmlFor:"otp-code",className:"text-sm font-medium mb-2 block",children:["Mã OTP ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(l,{id:"otp-code",placeholder:"Nhập mã OTP 4 số",value:P,onChange:e=>E(e.target.value.replace(/\D/g,"").slice(0,4)),maxLength:4,className:"text-center text-lg tracking-widest"})]}),e.jsx("div",{className:"text-center",children:M>0?e.jsxs("p",{className:"text-sm text-maintext",children:["Gửi lại mã sau ",M,"s"]}):e.jsx(i,{variant:"link",onClick:se,disabled:!q,className:"text-blue-600 p-0 h-auto",children:"Gửi lại mã OTP"})}),e.jsxs("div",{className:"flex items-center justify-center space-x-2 text-xs text-maintext",children:[e.jsx(z.Icon,{path:L,size:.7}),e.jsx("span",{children:"Mã OTP có hiệu lực trong 5 phút"})]})]});case"processing":return e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"flex items-center justify-center mb-4",children:e.jsx("div",{className:"bg-blue-100 p-4 rounded-full",children:e.jsx(z.Icon,{path:K,size:2,className:"text-blue-600 animate-spin"})})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Đang xử lý thanh toán"}),e.jsx("p",{className:"text-maintext mb-4",children:"Vui lòng không đóng cửa sổ này"}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-yellow-800",children:["Đang kết nối với ngân hàng ",null==m?void 0:m.shortName,"..."]})})]});case"success":return e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"flex items-center justify-center mb-4",children:e.jsx("div",{className:"bg-green-100 p-4 rounded-full",children:e.jsx(z.Icon,{path:X,size:2,className:"text-primary"})})}),e.jsx("h3",{className:"text-lg font-semibold mb-2 text-primary",children:"Thanh toán thành công!"}),e.jsx("p",{className:"text-maintext mb-4",children:"Đơn hàng của bạn đã được thanh toán thành công"}),T&&e.jsx(j,{children:e.jsx(f,{className:"pt-4",children:e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Mã giao dịch:"}),e.jsx("span",{className:"font-medium",children:T.transactionId})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Ngân hàng:"}),e.jsx("span",{className:"font-medium",children:T.bankName})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Số tài khoản:"}),e.jsxs("span",{className:"font-medium",children:["***",T.accountNumber.slice(-4)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Số tiền:"}),e.jsx("span",{className:"font-medium",children:A(T.amount)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Thời gian:"}),e.jsx("span",{className:"font-medium",children:new Date(T.paymentTime).toLocaleString("vi-VN")})]})]})})})]});case"error":return e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"flex items-center justify-center mb-4",children:e.jsx("div",{className:"bg-red-100 p-4 rounded-full",children:e.jsx(z.Icon,{path:G,size:2,className:"text-red-600"})})}),e.jsx("h3",{className:"text-lg font-semibold mb-2 text-red-600",children:"Thanh toán thất bại"}),e.jsx("p",{className:"text-maintext mb-4",children:"Giao dịch không thể hoàn tất. Vui lòng thử lại."}),e.jsx(i,{onClick:ae,variant:"outline",children:"Thử lại"})]})}})(),"processing"===C||"success"===C?null:"error"===C?e.jsx("div",{className:"flex space-x-4 pt-4",children:e.jsx(i,{variant:"outline",onClick:te,className:"flex-1",children:"Đóng"})}):e.jsxs("div",{className:"flex space-x-4 pt-4",children:[("account-input"===C||"otp-verification"===C)&&e.jsxs(i,{variant:"outline",onClick:ae,className:"w-32",children:[e.jsx(z.Icon,{path:F,size:.7,className:"mr-2"}),"Quay lại"]}),e.jsx("div",{className:"w-full flex justify-end",children:"bank-selection"===C&&e.jsx(i,{variant:"default",onClick:te,className:"w-32",children:"Hủy"})}),"account-input"===C&&e.jsx(i,{onClick:J,disabled:!V||V.length<8||y,className:"w-32",children:y?"Đang xử lý...":"Tiếp tục"}),"otp-verification"===C&&e.jsx(i,{onClick:Z,disabled:!P||4!==P.length||y,className:"flex-1",children:y?"Đang xử lý...":"Xác nhận thanh toán"})]})]})})}function se({isOpen:s,onClose:t,orderId:n,orderCode:a}){const l=useNavigate();return e.jsx(Dialog,{open:s,onOpenChange:t,children:e.jsxs(DialogContent,{className:"sm:max-w-4xl",children:[e.jsx(DialogHeader,{children:e.jsx(DialogTitle,{className:"sr-only",children:"Đặt hàng thành công"})}),e.jsxs(j,{className:"border-0 shadow-none",children:[e.jsxs(N,{className:"text-center pb-4",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx(Y,{className:"w-16 h-16 text-green-500"})}),e.jsx("h2",{className:"text-2xl font-bold text-primary",children:"Đặt hàng thành công!"})]}),e.jsxs(f,{className:"space-y-4 text-center",children:[e.jsx("p",{className:"text-maintext",children:"Cảm ơn bạn đã đặt hàng tại Clothes Shop"}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-maintext mb-1",children:"Mã đơn hàng của bạn là:"}),e.jsx("p",{className:"font-bold text-lg text-maintext",children:a||n})]}),e.jsx("p",{className:"text-sm text-maintext",children:"Chúng tôi sẽ sớm liên hệ với bạn để xác nhận đơn hàng"})]}),e.jsxs(b,{className:"flex flex-col space-y-4 pt-6",children:[e.jsx(i,{onClick:()=>{t(),l("/account#account-tabs?tab=orders")},className:"w-full",variant:"default",children:"Xem đơn hàng"}),e.jsx(i,{onClick:()=>{t(),l("/products")},className:"w-full",variant:"outline",children:"Tiếp tục mua sắm"})]})]})]})})}const te=Q({fullName:J().min(1,"Vui lòng nhập họ tên"),phoneNumber:J().min(10,"Số điện thoại không hợp lệ"),email:J().email("Email không hợp lệ"),address:J().min(1,"Vui lòng nhập địa chỉ"),province:J().min(1,"Vui lòng chọn tỉnh/thành"),district:J().min(1,"Vui lòng chọn quận/huyện"),ward:J().min(1,"Vui lòng chọn phường/xã"),paymentMethod:W(["COD","BANK_TRANSFER"])});function ne(){const n=t(),{user:q}=r(),{items:B,clearCart:z,appliedVoucher:_,voucherDiscount:F,removeVoucher:R,subtotal:K,tax:L,shipping:G,total:X}=o(),[H,U]=s.useState(!1),[Y,Q]=s.useState(!0),[W,J]=s.useState(!1),[ne,ae]=s.useState(!1),[ie,le]=s.useState(null),[re,ce]=s.useState(null),[de,oe]=s.useState([]),[he,me]=s.useState([]),[xe,ue]=s.useState([]),[pe,ge]=s.useState(!1),[je,fe]=s.useState(!1),[Ne,ve]=s.useState(!1),[be,ye]=s.useState(""),[we,Ce]=s.useState(""),[Se,Te]=s.useState(""),ke=O(),Ve=Z(),{data:Ie,isLoading:De}=c(),$e=y({resolver:w(te),defaultValues:{fullName:"",email:"",phoneNumber:"",address:"",province:"",district:"",ward:"",paymentMethod:"COD"}}),Pe=K,Ee=L,Me=G,Ae=X,Oe=$e.watch("province"),qe=$e.watch("district"),Be=$e.watch("paymentMethod"),ze=$e.watch("ward");s.useEffect((()=>{(async()=>{try{ge(!0);const e=await fetch("https://provinces.open-api.vn/api/"),s=await e.json();oe(s)}catch(e){a.error("Không thể tải danh sách tỉnh/thành")}finally{ge(!1)}})()}),[]),s.useEffect((()=>{if(Oe){(async()=>{try{fe(!0);const e=await fetch(`https://provinces.open-api.vn/api/p/${Oe}?depth=2`),s=await e.json();me(s.districts||[]),$e.setValue("district",""),$e.setValue("ward",""),ue([])}catch(e){a.error("Không thể tải danh sách quận/huyện")}finally{fe(!1)}})()}else me([]),ue([]),$e.setValue("district",""),$e.setValue("ward","")}),[Oe,$e]),s.useEffect((()=>{if(qe){(async()=>{try{ve(!0);const e=await fetch(`https://provinces.open-api.vn/api/d/${qe}?depth=2`),s=await e.json();ue(s.wards||[]),$e.setValue("ward","")}catch(e){a.error("Không thể tải danh sách phường/xã")}finally{ve(!1)}})()}else ue([]),$e.setValue("ward","")}),[qe,$e]),s.useEffect((()=>{var e,s,t,n,a,i,l,r;if(null==Ie?void 0:Ie.data){const c=Ie.data;$e.reset({fullName:c.fullName||"",email:c.email||"",phoneNumber:c.phoneNumber||"",address:(null==(s=null==(e=c.addresses)?void 0:e[0])?void 0:s.specificAddress)||"",province:(null==(n=null==(t=c.addresses)?void 0:t[0])?void 0:n.provinceName)||"",district:(null==(i=null==(a=c.addresses)?void 0:a[0])?void 0:i.districtName)||"",ward:(null==(r=null==(l=c.addresses)?void 0:l[0])?void 0:r.wardName)||"",paymentMethod:"COD"})}}),[Ie,$e]),s.useEffect((()=>{(async()=>{try{if(Q(!0),0===B.length)return void n("/");Q(!1)}catch(e){}})()}),[B,router]),s.useEffect((()=>{if("BANK_TRANSFER"===Be&&!W){const e={orderId:`DEMO_${Date.now()}`,amount:Ae,orderInfo:"Thanh toán đơn hàng",orderCode:`ORD${Date.now()}`};ce(e),J(!0)}}),[Be]),s.useEffect((()=>{if(Oe){const e=de.find((e=>e.code.toString()===Oe));ye(e?e.name:"")}else ye("")}),[Oe,de]),s.useEffect((()=>{if(qe){const e=he.find((e=>e.code.toString()===qe));Ce(e?e.name:"")}else Ce("")}),[qe,he]),s.useEffect((()=>{if(ze){const e=xe.find((e=>e.code.toString()===ze));Te(e?e.name:"")}else Te("")}),[ze,xe]);const _e=async(e,s,t)=>{try{const n=B.map((e=>`<tr>\n          <td style="padding: 10px; border-bottom: 1px solid #eee;">${e.name} (${e.size||"N/A"})</td>\n          <td style="padding: 10px; border-bottom: 1px solid #eee;">${e.quantity}</td>\n          <td style="padding: 10px; border-bottom: 1px solid #eee; text-align: right;">${A(e.price)}</td>\n        </tr>`)).join(""),a=`\n        <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; border: 1px solid #eee; padding: 20px;">\n          <h2 style="color: #333; text-align: center;">Xác nhận đơn hàng</h2>\n          <p>Xin chào <strong>${s.shippingAddress.name}</strong>,</p>\n          <p>Cảm ơn bạn đã đặt hàng tại Clothes Shop. Dưới đây là chi tiết đơn hàng của bạn:</p>\n          \n          <div style="background-color: #f9f9f9; padding: 15px; margin: 20px 0;">\n            <p><strong>Mã đơn hàng:</strong> ${s.code||e}</p>\n            <p><strong>Ngày đặt hàng:</strong> ${(new Date).toLocaleDateString("vi-VN")}</p>\n            <p><strong>Phương thức thanh toán:</strong> ${"COD"===s.paymentMethod?"Thanh toán khi nhận hàng":"Thanh toán qua VNPay"}</p>\n          </div>\n          \n          <h3 style="color: #333;">Chi tiết sản phẩm</h3>\n          <table style="width: 100%; border-collapse: collapse;">\n            <thead>\n              <tr style="background-color: #f2f2f2;">\n                <th style="padding: 10px; text-align: left;">Sản phẩm</th>\n                <th style="padding: 10px;">Số lượng</th>\n                <th style="padding: 10px; text-align: right;">Giá</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${n}\n            </tbody>\n            <tfoot>\n              <tr>\n                <td colspan="2" style="padding: 10px; text-align: right; font-weight: bold;">Tạm tính:</td>\n                <td style="padding: 10px; text-align: right;">${A(Pe+F)}</td>\n              </tr>\n              ${_&&F>0?`\n              <tr>\n                <td colspan="2" style="padding: 10px; text-align: right; font-weight: bold; color: #16a34a;">Giảm giá voucher (${_.code}):</td>\n                <td style="padding: 10px; text-align: right; color: #16a34a;">-${A(F)}</td>\n              </tr>\n              `:""}\n              <tr>\n                <td colspan="2" style="padding: 10px; text-align: right; font-weight: bold;">Thuế:</td>\n                <td style="padding: 10px; text-align: right;">${A(Ee)}</td>\n              </tr>\n              <tr>\n                <td colspan="2" style="padding: 10px; text-align: right; font-weight: bold;">Phí vận chuyển:</td>\n                <td style="padding: 10px; text-align: right;">${A(Me)}</td>\n              </tr>\n              <tr style="background-color: #f9f9f9;">\n                <td colspan="2" style="padding: 10px; text-align: right; font-weight: bold;">Tổng cộng:</td>\n                <td style="padding: 10px; text-align: right; font-weight: bold;">${A(Ae)}</td>\n              </tr>\n            </tfoot>\n          </table>\n          \n          <div style="margin-top: 20px;">\n            <h3 style="color: #333;">Thông tin giao hàng</h3>\n            <p><strong>Người nhận:</strong> ${s.shippingAddress.name}</p>\n            <p><strong>Số điện thoại:</strong> ${s.shippingAddress.phoneNumber}</p>\n            <p><strong>Địa chỉ:</strong> ${s.shippingAddress.specificAddress}</p>\n          </div>\n          \n          <div style="margin-top: 30px; text-align: center; color: #777;">\n            <p>Nếu bạn có bất kỳ câu hỏi nào, vui lòng liên hệ với chúng tôi qua email hoặc hotline.</p>\n            <p>© 2023 Clothes Shop. Tất cả các quyền được bảo lưu.</p>\n          </div>\n        </div>\n      `;await Ve.mutateAsync({type:"EMAIL",title:`Xác nhận đơn hàng ${s.code||e}`,content:a,recipients:[t,"buitranthienan1111@gmail.com"],relatedTo:"ORDER",relatedId:e})}catch(n){}},Fe=e=>{var s,t,n,a,i,l,r,c;if(!(null==Ie?void 0:Ie.data))return!1;const d=Ie.data;switch(e){case"fullName":return!!d.fullName;case"email":return!!d.email;case"phoneNumber":return!!d.phoneNumber;case"address":return!!(null==(t=null==(s=d.addresses)?void 0:s[0])?void 0:t.specificAddress);case"province":return!!(null==(a=null==(n=d.addresses)?void 0:n[0])?void 0:a.provinceName);case"district":return!!(null==(l=null==(i=d.addresses)?void 0:i[0])?void 0:l.districtName);case"ward":return!!(null==(c=null==(r=d.addresses)?void 0:r[0])?void 0:c.wardName);default:return!1}};return Y?e.jsx("div",{className:"container max-w-6xl py-8 flex items-center justify-center",children:e.jsx("div",{children:"Đang tải..."})}):e.jsxs("div",{className:"container mx-auto py-8 relative",children:[e.jsx(h,{className:"mb-4",children:e.jsxs(m,{children:[e.jsx(x,{children:e.jsx(u,{href:"/",className:"!text-maintext hover:!text-maintext",children:"Trang chủ"})}),e.jsx(p,{className:"!text-maintext hover:!text-maintext"}),e.jsx(x,{children:e.jsx(u,{href:"/products",className:"!text-maintext hover:!text-maintext",children:"Sản phẩm"})}),e.jsx(p,{className:"!text-maintext hover:!text-maintext"}),e.jsx(x,{children:e.jsx(g,{className:"!text-maintext hover:!text-maintext",children:"Thanh toán đơn hàng"})})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-maintext",children:[e.jsx("div",{children:e.jsxs(j,{children:[e.jsx(N,{children:e.jsx(v,{children:"Thông tin giao hàng"})}),e.jsx(f,{children:e.jsx(C,{...$e,children:e.jsxs("form",{onSubmit:$e.handleSubmit((async e=>{try{if(U(!0),"BANK_TRANSFER"===e.paymentMethod){const e={orderId:`DEMO_${Date.now()}`,amount:Ae,orderInfo:"Thanh toán đơn hàng",orderCode:`ORD${Date.now()}`};return ce(e),J(!0),void U(!1)}const s={orderId:`DH${(new Date).getFullYear()}${Date.now().toString().slice(-6)}`,customer:(null==q?void 0:q._id)||"000000000000000000000000",items:B.map((e=>({product:e.productId||e.id,variant:{colorId:e.colorId,sizeId:e.sizeId},quantity:e.quantity,price:e.price}))),voucher:null==_?void 0:_.voucherId,subTotal:Number(Pe.toFixed(2)),discount:Number(F.toFixed(2)),total:Number(Ae.toFixed(2)),shippingAddress:{name:e.fullName,phoneNumber:e.phoneNumber,provinceId:Oe,districtId:qe,wardId:ze,specificAddress:`${e.address}, ${Se}, ${we}, ${be}, Việt Nam`},paymentMethod:e.paymentMethod},t=await ke.mutateAsync(s);if(!(t&&t.success&&t.data))throw new Error((null==t?void 0:t.message)||"Đã xảy ra lỗi khi tạo đơn hàng");z(),_&&R(),a.success("Đặt hàng thành công!"),await _e(t.data._id,t.data,e.email),le(t.data),ae(!0)}catch(s){a.error(s.message||"Đã có lỗi xảy ra khi tạo đơn hàng")}finally{U(!1)}})),className:"space-y-4",children:[e.jsx(S,{control:$e.control,name:"fullName",render:({field:s})=>e.jsxs(T,{children:[e.jsx(k,{className:"text-maintext font-semibold",children:"Họ tên"}),e.jsx(V,{children:e.jsx(l,{placeholder:"Nguyễn Văn A",...s,disabled:Fe("fullName")})}),e.jsx(I,{})]})}),e.jsx(S,{control:$e.control,name:"phoneNumber",render:({field:s})=>e.jsxs(T,{children:[e.jsx(k,{className:"text-maintext font-semibold",children:"Số điện thoại"}),e.jsx(V,{children:e.jsx(l,{...s,disabled:Fe("phoneNumber")})}),e.jsx(I,{})]})}),e.jsx(S,{control:$e.control,name:"email",render:({field:s})=>e.jsxs(T,{children:[e.jsx(k,{className:"text-maintext font-semibold",children:"Email"}),e.jsx(V,{children:e.jsx(l,{placeholder:"Ví dụ: example@gmail.com",...s,disabled:Fe("email")})}),e.jsx(I,{})]})}),e.jsx(S,{control:$e.control,name:"province",render:({field:s})=>e.jsxs(T,{children:[e.jsx(k,{className:"text-maintext font-semibold",children:"Tỉnh/Thành phố"}),e.jsx(V,{children:e.jsxs(D,{value:s.value,onValueChange:s.onChange,disabled:Fe("province")||pe,children:[e.jsx($,{className:"w-full",children:e.jsx(P,{placeholder:pe?"Đang tải...":"Chọn tỉnh/thành phố"})}),e.jsx(E,{children:de.map((s=>e.jsx(M,{value:s.code.toString(),children:s.name},s.code)))})]})}),e.jsx(I,{})]})}),e.jsx(S,{control:$e.control,name:"district",render:({field:s})=>e.jsxs(T,{children:[e.jsx(k,{className:"text-maintext font-semibold",children:"Quận/Huyện"}),e.jsx(V,{children:e.jsxs(D,{value:s.value,onValueChange:s.onChange,disabled:Fe("district")||!Oe||je,children:[e.jsx($,{className:"w-full",children:e.jsx(P,{placeholder:Oe?je?"Đang tải...":"Chọn quận/huyện":"Vui lòng chọn tỉnh/thành phố trước"})}),e.jsx(E,{children:he.map((s=>e.jsx(M,{value:s.code.toString(),children:s.name},s.code)))})]})}),e.jsx(I,{})]})}),e.jsx(S,{control:$e.control,name:"ward",render:({field:s})=>e.jsxs(T,{children:[e.jsx(k,{className:"text-maintext font-semibold",children:"Phường/Xã"}),e.jsx(V,{children:e.jsxs(D,{value:s.value,onValueChange:s.onChange,disabled:Fe("ward")||!qe||Ne,children:[e.jsx($,{className:"w-full",children:e.jsx(P,{placeholder:qe?Ne?"Đang tải...":"Chọn phường/xã":"Vui lòng chọn quận/huyện trước"})}),e.jsx(E,{children:xe.map((s=>e.jsx(M,{value:s.code.toString(),children:s.name},s.code)))})]})}),e.jsx(I,{})]})}),e.jsx(S,{control:$e.control,name:"address",render:({field:s})=>e.jsxs(T,{children:[e.jsx(k,{className:"text-maintext font-semibold",children:"Địa chỉ cụ thể"}),e.jsx(V,{children:e.jsx(l,{placeholder:"Số nhà, tên đường...",...s,disabled:Fe("address")})}),e.jsx(I,{})]})}),e.jsx(S,{control:$e.control,name:"paymentMethod",render:({field:s})=>e.jsxs(T,{children:[e.jsx(k,{className:"text-maintext font-semibold",children:"Phương thức thanh toán"}),e.jsx(V,{children:e.jsxs(D,{value:s.value,onValueChange:s.onChange,disabled:s.disabled,children:[e.jsx($,{className:"w-full",children:e.jsx(P,{placeholder:"Chọn phương thức thanh toán"})}),e.jsxs(E,{children:[e.jsx(M,{value:"COD",children:"Thanh toán khi nhận hàng (COD)"}),e.jsx(M,{value:"BANK_TRANSFER",children:"Thanh toán qua VNPay"})]})]})}),e.jsx(I,{})]})}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(i,{type:"button",variant:"outline",className:"flex-1",onClick:()=>{n("/products")},disabled:H,children:"Tiếp tục mua hàng"}),e.jsx(i,{type:"submit",className:"flex-1",disabled:H,children:H?"Đang xử lý...":"Hoàn tất đặt hàng"})]})]})})})]})}),e.jsx("div",{children:e.jsxs(j,{children:[e.jsx(N,{children:e.jsx(v,{children:"Đơn hàng của bạn"})}),e.jsx(f,{children:e.jsx("div",{className:"space-y-4",children:B.map((s=>e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-20 h-20 bg-muted rounded relative overflow-hidden",children:e.jsx("img",{src:d(s.image),alt:s.name,className:"object-contain w-full h-full"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-maintext",children:s.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.brand,s.size&&` • Size ${s.size}`]}),e.jsxs("div",{className:"flex justify-between mt-2 text-maintext",children:[e.jsxs("span",{children:["x",s.quantity]}),e.jsx("span",{className:"text-maintext",children:A(s.price)})]})]})]},s.id)))})}),e.jsxs(b,{className:"flex flex-col space-y-2",children:[e.jsxs("div",{className:"flex justify-between w-full",children:[e.jsx("span",{className:"text-muted-foreground font-semibold text-sm",children:"Tạm tính"}),e.jsx("span",{className:"text-maintext",children:A(Pe+F)})]}),_&&F>0&&e.jsxs("div",{className:"flex justify-between w-full text-green-600",children:[e.jsxs("span",{className:"text-sm font-semibold",children:["Giảm giá voucher (",_.code,")"]}),e.jsxs("span",{children:["-",A(F)]})]}),e.jsxs("div",{className:"flex justify-between w-full",children:[e.jsx("span",{className:"text-muted-foreground font-semibold text-sm",children:"Thuế"}),e.jsx("span",{className:"text-maintext",children:A(Ee)})]}),e.jsxs("div",{className:"flex justify-between w-full",children:[e.jsx("span",{className:"text-muted-foreground font-semibold text-sm",children:"Phí vận chuyển"}),e.jsx("span",{className:"text-maintext",children:A(Me)})]}),e.jsxs("div",{className:"flex justify-between w-full text-base font-semibold text-maintext pt-2 border-t",children:[e.jsx("span",{children:"Tổng cộng"}),e.jsx("span",{className:"text-lg text-primary font-semibold",children:A(Ae)})]})]})]})})]}),e.jsx(ee,{isOpen:W,onClose:()=>J(!1),orderData:re||{orderId:`TEMP_${Date.now()}`,amount:Ae,orderInfo:"Thanh toán đơn hàng",orderCode:`ORD${Date.now()}`},onPaymentSuccess:async e=>{try{J(!1),U(!0);const s=$e.getValues(),t={orderId:`DH${(new Date).getFullYear()}-${Date.now().toString().slice(-6)}`,customer:(null==q?void 0:q._id)||"000000000000000000000000",items:B.map((e=>({product:e.productId||e.id,variant:{colorId:e.colorId,sizeId:e.sizeId},quantity:e.quantity,price:e.price}))),voucher:null==_?void 0:_.voucherId,subTotal:Number(Pe.toFixed(2)),discount:Number(F.toFixed(2)),total:Number(Ae.toFixed(2)),shippingAddress:{name:s.fullName,phoneNumber:s.phoneNumber,provinceId:Oe,districtId:qe,wardId:ze,specificAddress:`${s.address}, ${Se}, ${we}, ${be}, Việt Nam`},paymentMethod:"BANK_TRANSFER",paymentInfo:e},n=await ke.mutateAsync(t);if(!(n&&n.success&&n.data))throw new Error((null==n?void 0:n.message)||"Đã xảy ra lỗi khi tạo đơn hàng");z(),_&&R(),a.success("Thanh toán và đặt hàng thành công!"),await _e(n.data._id,n.data,s.email),le(n.data),ae(!0)}catch(s){a.error(s.message||"Đã có lỗi xảy ra sau khi thanh toán")}finally{U(!1)}},onPaymentError:e=>{J(!1),a.error(e)}}),ie&&e.jsx(se,{isOpen:ne,onClose:()=>ae(!1),orderId:ie._id,orderCode:ie.code})]})}const ae=()=>e.jsx(ne,{});export{ae as default};
