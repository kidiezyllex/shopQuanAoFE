import{aN as Qe,aO as Ye,a as n,a6 as f,j as e,k as y,aP as Je,B as S,w as Ze,ao as et,q as F,aQ as Ae,aw as Be,aB as tt,p as st,aR as Fe,X as nt,U as at,E as it,aC as rt,ar as ct}from"./index-Dpx_4rWJ.js";import{u as lt}from"./useCartStore-XJ4QOmkb.js";import{B as ot,a as dt,b as Pe,c as Le,d as Re,e as ht}from"./breadcrumb-CJedQ5QG.js";import{C as Z,c as ee,a as Ie,b as De,e as qe}from"./card-fT6uSY2F.js";import{u as mt,a as xt,F as ut,b as M,c as $,d as E,e as A,f as B,o as pt,i as gt,s as _}from"./form-BFysSGgk.js";import{S as Se,a as Ce,b as Te,c as ke,d as me}from"./select-CS4vNzI5.js";import{f as g}from"./formatters-BzOSFyyi.js";import{b as ft}from"./order-Cuy2edjT.js";import{L as xe}from"./label-B0XdI4bT.js";import{D as ze,a as _e,b as Ke,c as Xe}from"./dialog-BuHyDe_9.js";import{C as jt}from"./circle-check-big-ScwhtRSE.js";import"./middleware-C0Ya4A5M.js";import"./createLucideIcon-BdgKQErZ.js";import"./index-BdQq_4o_.js";import"./index-qvEK80KO.js";import"./check-CyKb8IHM.js";const Nt=async N=>await Qe("/notifications",N),bt=()=>Ye({mutationFn:N=>Nt(N)});function vt({isOpen:N,onClose:j,orderData:x,onPaymentSuccess:K,onPaymentError:o}){const[u,L]=n.useState([]),[d,te]=n.useState(null),[X,ue]=n.useState(""),[se,P]=n.useState(!1),[H,R]=n.useState(!1),[h,m]=n.useState("bank-selection"),[D,G]=n.useState(null),[C,ne]=n.useState(""),[pe,ae]=n.useState(""),[T,W]=n.useState(""),[O,q]=n.useState(60),[ie,V]=n.useState(!1),U=n.useMemo(()=>{if(!X)return u;const a=X.toLowerCase();return u.filter(l=>l.name.toLowerCase().includes(a)||l.shortName.toLowerCase().includes(a)||l.code.toLowerCase().includes(a))},[u,X]);n.useEffect(()=>{N&&ge()},[N]),n.useEffect(()=>{let a;return h==="otp-verification"&&O>0&&(a=setInterval(()=>{q(l=>l<=1?(V(!0),0):l-1)},1e3)),()=>clearInterval(a)},[h,O]);const ge=async()=>{try{P(!0);const l=await(await fetch("https://api.vietqr.io/v2/banks")).json();if(l.code==="00"&&l.data){const b=l.data.filter(v=>v.transferSupported===1);L(b)}else throw new Error("Không thể tải danh sách ngân hàng")}catch(a){console.error("Error fetching banks:",a),f.error("Không thể tải danh sách ngân hàng"),L([{id:1,name:"Ngân hàng TMCP Công thương Việt Nam",code:"ICB",bin:"970415",shortName:"VietinBank",logo:"https://api.vietqr.io/img/ICB.png",transferSupported:1,lookupSupported:1,short_name:"VietinBank",support:3,isTransfer:1,swift_code:"ICBVVNVX"},{id:2,name:"Ngân hàng TMCP Ngoại Thương Việt Nam",code:"VCB",bin:"970436",shortName:"Vietcombank",logo:"https://api.vietqr.io/img/VCB.png",transferSupported:1,lookupSupported:1,short_name:"Vietcombank",support:3,isTransfer:1,swift_code:"BFTVVNVX"},{id:3,name:"Ngân hàng TMCP Đầu tư và Phát triển Việt Nam",code:"BIDV",bin:"970418",shortName:"BIDV",logo:"https://api.vietqr.io/img/BIDV.png",transferSupported:1,lookupSupported:1,short_name:"BIDV",support:3,isTransfer:1,swift_code:"BIDVVNVX"}])}finally{P(!1)}},fe=a=>{te(a),m("account-input")},je=()=>{if(!C||C.length<8){f.error("Vui lòng nhập số tài khoản hợp lệ (ít nhất 8 số)");return}R(!0),setTimeout(()=>{ae("NGUYEN VAN A"),m("otp-verification"),q(60),V(!1),R(!1),f.success("Mã OTP đã được gửi đến số điện thoại của bạn")},2e3)},Ne=()=>{if(!T||T.length!==4){f.error("Vui lòng nhập mã OTP 4 số");return}if(T!=="1234"){f.error("Mã OTP không chính xác");return}be()},be=async()=>{try{if(R(!0),m("processing"),await new Promise(l=>setTimeout(l,3e3)),Math.random()>.05){const l={orderId:x.orderId,amount:x.amount,bankCode:d==null?void 0:d.code,bankName:d==null?void 0:d.shortName,accountNumber:C,transactionId:`VNP${Date.now()}`,paymentTime:new Date().toISOString(),status:"SUCCESS"};G(l),m("success"),setTimeout(()=>{K(l)},2e3)}else m("error"),setTimeout(()=>{o("Giao dịch không thành công. Vui lòng thử lại.")},2e3)}catch{m("error"),o("Đã xảy ra lỗi trong quá trình thanh toán")}finally{R(!1)}},ve=()=>{q(60),V(!1),W(""),f.success("Mã OTP mới đã được gửi")},Q=()=>{h!=="processing"&&(re(),j())},re=()=>{m("bank-selection"),te(null),ue(""),ne(""),ae(""),W(""),q(60),V(!1),G(null)},ce=()=>{switch(h){case"account-input":m("bank-selection"),te(null);break;case"otp-verification":m("account-input"),W("");break;case"error":m("bank-selection"),re();break}},Y=()=>e.jsxs(Z,{className:"mb-4",children:[e.jsx(Ie,{children:e.jsx(De,{className:"text-sm",children:"Thông tin đơn hàng"})}),e.jsxs(ee,{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-maintext",children:"Mã đơn hàng:"}),e.jsx("span",{className:"font-medium text-maintext",children:x.orderCode||x.orderId})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-maintext",children:"Số tiền:"}),e.jsx("span",{className:"font-bold text-lg text-red-600",children:g(x.amount)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-maintext",children:"Nội dung:"}),e.jsx("span",{className:"font-medium text-right max-w-[200px] truncate text-maintext",children:x.orderInfo})]})]})]}),le=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"flex items-center justify-center mb-4",children:e.jsx("img",{draggable:"false",src:"/images/vnpay-logo.png",alt:"bank",width:500,height:500,className:"h-16 object-contain w-auto"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Thanh toán qua VNPay"}),e.jsx("p",{className:"text-maintext",children:"Chọn ngân hàng để thực hiện thanh toán"})]}),Y(),e.jsxs("div",{children:[e.jsx(xe,{htmlFor:"bank-search",className:"text-sm font-medium mb-3 block",children:"Tìm kiếm ngân hàng"}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx(y.Icon,{path:et,size:.7,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-maintext"}),e.jsx(F,{id:"bank-search",placeholder:"Tìm theo tên ngân hàng, mã ngân hàng...",value:X,onChange:a=>ue(a.target.value),className:"pl-10"})]})]}),e.jsxs("div",{children:[e.jsxs(xe,{className:"text-sm font-medium mb-3 block",children:["Chọn ngân hàng (",U.length," ngân hàng)"]}),se?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(y.Icon,{path:Ae,size:1,className:"animate-spin text-blue-600"}),e.jsx("span",{className:"ml-2",children:"Đang tải danh sách ngân hàng..."})]}):e.jsx("div",{className:"grid grid-cols-1 gap-4 max-h-80 overflow-y-auto border rounded-lg p-2",children:U.length===0?e.jsx("div",{className:"text-center py-8 text-maintext",children:"Không tìm thấy ngân hàng nào"}):U.map(a=>e.jsx("div",{className:"border rounded-lg p-3 cursor-pointer transition-all hover:border-blue-300 hover:bg-blue-50",onClick:()=>fe(a),children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-12 h-12 relative flex-shrink-0",children:e.jsx("img",{src:a.logo,alt:a.shortName,className:"w-full h-full object-contain rounded"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-sm",children:a.shortName}),e.jsx("div",{className:"text-xs text-maintext truncate",children:a.name}),e.jsxs("div",{className:"text-xs text-blue-600",children:["Mã: ",a.code]})]})]})},a.code))})]}),e.jsxs("div",{className:"flex items-center justify-center space-x-2 text-sm text-maintext",children:[e.jsx(y.Icon,{path:Be,size:.7}),e.jsx("span",{children:"Giao dịch được bảo mật bởi VNPay"})]})]}),ye=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"flex items-center justify-center mb-4",children:e.jsx("img",{src:"/images/vnpay-logo.png",alt:"bank",width:500,height:500,className:"h-10 object-contain w-auto"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Thông tin tài khoản"}),e.jsx("p",{className:"text-maintext",children:"Nhập thông tin tài khoản ngân hàng"})]}),Y(),d&&e.jsx(Z,{children:e.jsx(ee,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-12 h-12 relative",children:e.jsx("img",{src:d.logo,alt:d.shortName,className:"w-full h-full object-contain"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:d.shortName}),e.jsx("div",{className:"text-sm text-maintext",children:d.name})]})]})})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs(xe,{htmlFor:"account-number",className:"text-sm font-medium mb-2 block",children:["Số tài khoản ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(F,{id:"account-number",placeholder:"Nhập số tài khoản (ví dụ: 1234567890)",value:C,onChange:a=>ne(a.target.value.replace(/\D/g,"")),maxLength:20})]}),pe&&e.jsxs("div",{children:[e.jsx(xe,{className:"text-sm font-medium mb-2 block",children:"Chủ tài khoản"}),e.jsx(F,{value:pe,disabled:!0})]})]}),e.jsxs("div",{className:"flex items-center justify-center space-x-2 text-xs text-maintext",children:[e.jsx(y.Icon,{path:nt,size:.7}),e.jsx("span",{children:"Thông tin được mã hóa và bảo mật"})]})]}),Ve=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"flex items-center justify-center mb-4",children:e.jsx("div",{className:"bg-green-100 p-3 rounded-full",children:e.jsx(y.Icon,{path:Fe,size:1.5,className:"text-primary"})})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Xác thực OTP"}),e.jsx("p",{className:"text-maintext",children:"Nhập mã OTP được gửi đến số điện thoại của bạn"})]}),Y(),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(y.Icon,{path:Fe,size:1,className:"text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Mã OTP đã được gửi đến"}),e.jsx("p",{className:"text-sm text-maintext",children:"*******890"})]})]})}),e.jsxs("div",{children:[e.jsxs(xe,{htmlFor:"otp-code",className:"text-sm font-medium mb-2 block",children:["Mã OTP ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(F,{id:"otp-code",placeholder:"Nhập mã OTP 4 số",value:T,onChange:a=>W(a.target.value.replace(/\D/g,"").slice(0,4)),maxLength:4,className:"text-center text-lg tracking-widest"})]}),e.jsx("div",{className:"text-center",children:O>0?e.jsxs("p",{className:"text-sm text-maintext",children:["Gửi lại mã sau ",O,"s"]}):e.jsx(S,{variant:"link",onClick:ve,disabled:!ie,className:"text-blue-600 p-0 h-auto",children:"Gửi lại mã OTP"})}),e.jsxs("div",{className:"flex items-center justify-center space-x-2 text-xs text-maintext",children:[e.jsx(y.Icon,{path:Be,size:.7}),e.jsx("span",{children:"Mã OTP có hiệu lực trong 5 phút"})]})]}),w=()=>e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"flex items-center justify-center mb-4",children:e.jsx("div",{className:"bg-blue-100 p-4 rounded-full",children:e.jsx(y.Icon,{path:Ae,size:2,className:"text-blue-600 animate-spin"})})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Đang xử lý thanh toán"}),e.jsx("p",{className:"text-maintext mb-4",children:"Vui lòng không đóng cửa sổ này"}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:e.jsxs("p",{className:"text-sm text-yellow-800",children:["Đang kết nối với ngân hàng ",d==null?void 0:d.shortName,"..."]})})]}),Oe=()=>e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"flex items-center justify-center mb-4",children:e.jsx("div",{className:"bg-green-100 p-4 rounded-full",children:e.jsx(y.Icon,{path:st,size:2,className:"text-primary"})})}),e.jsx("h3",{className:"text-lg font-semibold mb-2 text-primary",children:"Thanh toán thành công!"}),e.jsx("p",{className:"text-maintext mb-4",children:"Đơn hàng của bạn đã được thanh toán thành công"}),D&&e.jsx(Z,{children:e.jsx(ee,{className:"pt-4",children:e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Mã giao dịch:"}),e.jsx("span",{className:"font-medium",children:D.transactionId})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Ngân hàng:"}),e.jsx("span",{className:"font-medium",children:D.bankName})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Số tài khoản:"}),e.jsxs("span",{className:"font-medium",children:["***",D.accountNumber.slice(-4)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Số tiền:"}),e.jsx("span",{className:"font-medium",children:g(D.amount)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Thời gian:"}),e.jsx("span",{className:"font-medium",children:new Date(D.paymentTime).toLocaleString("vi-VN")})]})]})})})]}),r=()=>e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"flex items-center justify-center mb-4",children:e.jsx("div",{className:"bg-red-100 p-4 rounded-full",children:e.jsx(y.Icon,{path:tt,size:2,className:"text-red-600"})})}),e.jsx("h3",{className:"text-lg font-semibold mb-2 text-red-600",children:"Thanh toán thất bại"}),e.jsx("p",{className:"text-maintext mb-4",children:"Giao dịch không thể hoàn tất. Vui lòng thử lại."}),e.jsx(S,{onClick:ce,variant:"outline",children:"Thử lại"})]}),J=()=>{switch(h){case"bank-selection":return le();case"account-input":return ye();case"otp-verification":return Ve();case"processing":return w();case"success":return Oe();case"error":return r();default:return le()}},we=()=>h==="processing"||h==="success"?null:h==="error"?e.jsx("div",{className:"flex space-x-4 pt-4",children:e.jsx(S,{variant:"outline",onClick:Q,className:"flex-1",children:"Đóng"})}):e.jsxs("div",{className:"flex space-x-4 pt-4",children:[(h==="account-input"||h==="otp-verification")&&e.jsxs(S,{variant:"outline",onClick:ce,className:"w-32",children:[e.jsx(y.Icon,{path:Ze,size:.7,className:"mr-2"}),"Quay lại"]}),e.jsx("div",{className:"w-full flex justify-end",children:h==="bank-selection"&&e.jsx(S,{variant:"default",onClick:Q,className:"w-32",children:"Hủy"})}),h==="account-input"&&e.jsx(S,{onClick:je,disabled:!C||C.length<8||H,className:"w-32",children:H?"Đang xử lý...":"Tiếp tục"}),h==="otp-verification"&&e.jsx(S,{onClick:Ne,disabled:!T||T.length!==4||H,className:"flex-1",children:H?"Đang xử lý...":"Xác nhận thanh toán"})]});return e.jsx(ze,{open:N,onOpenChange:Q,children:e.jsxs(_e,{className:"sm:max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Ke,{children:e.jsxs(Xe,{className:"flex items-center space-x-2",children:[e.jsx(y.Icon,{path:Je,size:1,className:"text-blue-600"}),e.jsx("span",{children:"VNPay - Cổng thanh toán"})]})}),J(),we()]})})}function yt({isOpen:N,onClose:j,orderId:x,orderCode:K}){const o=useNavigate(),u=()=>{j(),o("/account#account-tabs?tab=orders")},L=()=>{j(),o("/products")};return e.jsx(ze,{open:N,onOpenChange:j,children:e.jsxs(_e,{className:"sm:max-w-4xl",children:[e.jsx(Ke,{children:e.jsx(Xe,{className:"sr-only",children:"Đặt hàng thành công"})}),e.jsxs(Z,{className:"border-0 shadow-none",children:[e.jsxs(Ie,{className:"text-center pb-4",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx(jt,{className:"w-16 h-16 text-green-500"})}),e.jsx("h2",{className:"text-2xl font-bold text-primary",children:"Đặt hàng thành công!"})]}),e.jsxs(ee,{className:"space-y-4 text-center",children:[e.jsx("p",{className:"text-maintext",children:"Cảm ơn bạn đã đặt hàng tại Clothes Shop"}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-maintext mb-1",children:"Mã đơn hàng của bạn là:"}),e.jsx("p",{className:"font-bold text-lg text-maintext",children:K||x})]}),e.jsx("p",{className:"text-sm text-maintext",children:"Chúng tôi sẽ sớm liên hệ với bạn để xác nhận đơn hàng"})]}),e.jsxs(qe,{className:"flex flex-col space-y-4 pt-6",children:[e.jsx(S,{onClick:u,className:"w-full",variant:"default",children:"Xem đơn hàng"}),e.jsx(S,{onClick:L,className:"w-full",variant:"outline",children:"Tiếp tục mua sắm"})]})]})]})})}const wt=pt({fullName:_().min(1,"Vui lòng nhập họ tên"),phoneNumber:_().min(10,"Số điện thoại không hợp lệ"),email:_().email("Email không hợp lệ"),address:_().min(1,"Vui lòng nhập địa chỉ"),province:_().min(1,"Vui lòng chọn tỉnh/thành"),district:_().min(1,"Vui lòng chọn quận/huyện"),ward:_().min(1,"Vui lòng chọn phường/xã"),paymentMethod:gt(["COD","BANK_TRANSFER"])});function St(){const N=at(),{user:j}=it(),{items:x,clearCart:K,appliedVoucher:o,voucherDiscount:u,removeVoucher:L,subtotal:d,tax:te,shipping:X,total:ue}=lt(),[se,P]=n.useState(!1),[H,R]=n.useState(!0),[h,m]=n.useState(!1),[D,G]=n.useState(!1),[C,ne]=n.useState(null),[pe,ae]=n.useState(null),[T,W]=n.useState([]),[O,q]=n.useState([]),[ie,V]=n.useState([]),[U,ge]=n.useState(!1),[fe,je]=n.useState(!1),[Ne,be]=n.useState(!1),[ve,Q]=n.useState(""),[re,ce]=n.useState(""),[Y,le]=n.useState(""),ye=ft(),Ve=bt(),{data:w,isLoading:Oe}=rt(),r=mt({resolver:xt(wt),defaultValues:{fullName:"",email:"",phoneNumber:"",address:"",province:"",district:"",ward:"",paymentMethod:"COD"}}),J=d,we=te,a=X,l=ue,b=r.watch("province"),v=r.watch("district"),Me=r.watch("paymentMethod"),oe=r.watch("ward");n.useEffect(()=>{(async()=>{try{ge(!0);const c=await(await fetch("https://provinces.open-api.vn/api/")).json();W(c)}catch{f.error("Không thể tải danh sách tỉnh/thành")}finally{ge(!1)}})()},[]),n.useEffect(()=>{b?(async()=>{try{je(!0);const c=await(await fetch(`https://provinces.open-api.vn/api/p/${b}?depth=2`)).json();q(c.districts||[]),r.setValue("district",""),r.setValue("ward",""),V([])}catch{f.error("Không thể tải danh sách quận/huyện")}finally{je(!1)}})():(q([]),V([]),r.setValue("district",""),r.setValue("ward",""))},[b,r]),n.useEffect(()=>{v?(async()=>{try{be(!0);const c=await(await fetch(`https://provinces.open-api.vn/api/d/${v}?depth=2`)).json();V(c.wards||[]),r.setValue("ward","")}catch{f.error("Không thể tải danh sách phường/xã")}finally{be(!1)}})():(V([]),r.setValue("ward",""))},[v,r]),n.useEffect(()=>{var t,s,c,i,p,k,de,he;if(w!=null&&w.data){const I=w.data;r.reset({fullName:I.fullName||"",email:I.email||"",phoneNumber:I.phoneNumber||"",address:((s=(t=I.addresses)==null?void 0:t[0])==null?void 0:s.specificAddress)||"",province:((i=(c=I.addresses)==null?void 0:c[0])==null?void 0:i.provinceName)||"",district:((k=(p=I.addresses)==null?void 0:p[0])==null?void 0:k.districtName)||"",ward:((he=(de=I.addresses)==null?void 0:de[0])==null?void 0:he.wardName)||"",paymentMethod:"COD"})}},[w,r]),n.useEffect(()=>{(async()=>{try{if(R(!0),x.length===0){N("/");return}R(!1)}catch(s){console.error("Error checking cart:",s)}})()},[x,router]),n.useEffect(()=>{if(Me==="BANK_TRANSFER"&&!h){const t={orderId:`DEMO_${Date.now()}`,amount:l,orderInfo:"Thanh toán đơn hàng",orderCode:`ORD${Date.now()}`};ae(t),m(!0)}},[Me]),n.useEffect(()=>{if(b){const t=T.find(s=>s.code.toString()===b);Q(t?t.name:"")}else Q("")},[b,T]),n.useEffect(()=>{if(v){const t=O.find(s=>s.code.toString()===v);ce(t?t.name:"")}else ce("")},[v,O]),n.useEffect(()=>{if(oe){const t=ie.find(s=>s.code.toString()===oe);le(t?t.name:"")}else le("")},[oe,ie]);const $e=async(t,s,c)=>{try{const i=x.map(k=>`<tr>
          <td style="padding: 10px; border-bottom: 1px solid #eee;">${k.name} (${k.size||"N/A"})</td>
          <td style="padding: 10px; border-bottom: 1px solid #eee;">${k.quantity}</td>
          <td style="padding: 10px; border-bottom: 1px solid #eee; text-align: right;">${g(k.price)}</td>
        </tr>`).join(""),p=`
        <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; border: 1px solid #eee; padding: 20px;">
          <h2 style="color: #333; text-align: center;">Xác nhận đơn hàng</h2>
          <p>Xin chào <strong>${s.shippingAddress.name}</strong>,</p>
          <p>Cảm ơn bạn đã đặt hàng tại Clothes Shop. Dưới đây là chi tiết đơn hàng của bạn:</p>
          
          <div style="background-color: #f9f9f9; padding: 15px; margin: 20px 0;">
            <p><strong>Mã đơn hàng:</strong> ${s.code||t}</p>
            <p><strong>Ngày đặt hàng:</strong> ${new Date().toLocaleDateString("vi-VN")}</p>
            <p><strong>Phương thức thanh toán:</strong> ${s.paymentMethod==="COD"?"Thanh toán khi nhận hàng":"Thanh toán qua VNPay"}</p>
          </div>
          
          <h3 style="color: #333;">Chi tiết sản phẩm</h3>
          <table style="width: 100%; border-collapse: collapse;">
            <thead>
              <tr style="background-color: #f2f2f2;">
                <th style="padding: 10px; text-align: left;">Sản phẩm</th>
                <th style="padding: 10px;">Số lượng</th>
                <th style="padding: 10px; text-align: right;">Giá</th>
              </tr>
            </thead>
            <tbody>
              ${i}
            </tbody>
            <tfoot>
              <tr>
                <td colspan="2" style="padding: 10px; text-align: right; font-weight: bold;">Tạm tính:</td>
                <td style="padding: 10px; text-align: right;">${g(J+u)}</td>
              </tr>
              ${o&&u>0?`
              <tr>
                <td colspan="2" style="padding: 10px; text-align: right; font-weight: bold; color: #16a34a;">Giảm giá voucher (${o.code}):</td>
                <td style="padding: 10px; text-align: right; color: #16a34a;">-${g(u)}</td>
              </tr>
              `:""}
              <tr>
                <td colspan="2" style="padding: 10px; text-align: right; font-weight: bold;">Thuế:</td>
                <td style="padding: 10px; text-align: right;">${g(we)}</td>
              </tr>
              <tr>
                <td colspan="2" style="padding: 10px; text-align: right; font-weight: bold;">Phí vận chuyển:</td>
                <td style="padding: 10px; text-align: right;">${g(a)}</td>
              </tr>
              <tr style="background-color: #f9f9f9;">
                <td colspan="2" style="padding: 10px; text-align: right; font-weight: bold;">Tổng cộng:</td>
                <td style="padding: 10px; text-align: right; font-weight: bold;">${g(l)}</td>
              </tr>
            </tfoot>
          </table>
          
          <div style="margin-top: 20px;">
            <h3 style="color: #333;">Thông tin giao hàng</h3>
            <p><strong>Người nhận:</strong> ${s.shippingAddress.name}</p>
            <p><strong>Số điện thoại:</strong> ${s.shippingAddress.phoneNumber}</p>
            <p><strong>Địa chỉ:</strong> ${s.shippingAddress.specificAddress}</p>
          </div>
          
          <div style="margin-top: 30px; text-align: center; color: #777;">
            <p>Nếu bạn có bất kỳ câu hỏi nào, vui lòng liên hệ với chúng tôi qua email hoặc hotline.</p>
            <p>© 2023 Clothes Shop. Tất cả các quyền được bảo lưu.</p>
          </div>
        </div>
      `;await Ve.mutateAsync({type:"EMAIL",title:`Xác nhận đơn hàng ${s.code||t}`,content:p,recipients:[c,"buitranthienan1111@gmail.com"],relatedTo:"ORDER",relatedId:t})}catch(i){console.error("Error sending confirmation email:",i)}},He=async t=>{try{if(P(!0),t.paymentMethod==="BANK_TRANSFER"){const i={orderId:`DEMO_${Date.now()}`,amount:l,orderInfo:"Thanh toán đơn hàng",orderCode:`ORD${Date.now()}`};ae(i),m(!0),P(!1);return}const s={orderId:`DH${new Date().getFullYear()}${Date.now().toString().slice(-6)}`,customer:(j==null?void 0:j.id)||"000000000000000000000000",items:x.map(i=>({product:i.productId||i.id,variant:{colorId:i.colorId,sizeId:i.sizeId},quantity:i.quantity,price:i.price})),voucher:o==null?void 0:o.voucherId,subTotal:Number(J.toFixed(2)),discount:Number(u.toFixed(2)),total:Number(l.toFixed(2)),shippingAddress:{name:t.fullName,phoneNumber:t.phoneNumber,provinceId:b,districtId:v,wardId:oe,specificAddress:`${t.address}, ${Y}, ${re}, ${ve}, Việt Nam`},paymentMethod:t.paymentMethod},c=await ye.mutateAsync(s);if(c&&c.success&&c.data)K(),o&&L(),f.success("Đặt hàng thành công!"),await $e(c.data.id,c.data,t.email),ne(c.data),G(!0);else throw new Error((c==null?void 0:c.message)||"Đã xảy ra lỗi khi tạo đơn hàng")}catch(s){f.error(s.message||"Đã có lỗi xảy ra khi tạo đơn hàng")}finally{P(!1)}},Ge=async t=>{try{m(!1),P(!0);const s=r.getValues(),c={orderId:`DH${new Date().getFullYear()}-${Date.now().toString().slice(-6)}`,customer:(j==null?void 0:j.id)||"000000000000000000000000",items:x.map(p=>({product:p.productId||p.id,variant:{colorId:p.colorId,sizeId:p.sizeId},quantity:p.quantity,price:p.price})),voucher:o==null?void 0:o.voucherId,subTotal:Number(J.toFixed(2)),discount:Number(u.toFixed(2)),total:Number(l.toFixed(2)),shippingAddress:{name:s.fullName,phoneNumber:s.phoneNumber,provinceId:b,districtId:v,wardId:oe,specificAddress:`${s.address}, ${Y}, ${re}, ${ve}, Việt Nam`},paymentMethod:"BANK_TRANSFER",paymentInfo:t},i=await ye.mutateAsync(c);if(i&&i.success&&i.data)K(),o&&L(),f.success("Thanh toán và đặt hàng thành công!"),await $e(i.data.id,i.data,s.email),ne(i.data),G(!0);else throw new Error((i==null?void 0:i.message)||"Đã xảy ra lỗi khi tạo đơn hàng")}catch(s){f.error(s.message||"Đã có lỗi xảy ra sau khi thanh toán")}finally{P(!1)}},We=t=>{m(!1),f.error(t)},Ue=()=>{N("/products")},z=t=>{var c,i,p,k,de,he,I,Ee;if(!(w!=null&&w.data))return!1;const s=w.data;switch(t){case"fullName":return!!s.fullName;case"email":return!!s.email;case"phoneNumber":return!!s.phoneNumber;case"address":return!!((i=(c=s.addresses)==null?void 0:c[0])!=null&&i.specificAddress);case"province":return!!((k=(p=s.addresses)==null?void 0:p[0])!=null&&k.provinceName);case"district":return!!((he=(de=s.addresses)==null?void 0:de[0])!=null&&he.districtName);case"ward":return!!((Ee=(I=s.addresses)==null?void 0:I[0])!=null&&Ee.wardName);default:return!1}};return H?e.jsx("div",{className:"container max-w-6xl py-8 flex items-center justify-center",children:e.jsx("div",{children:"Đang tải..."})}):e.jsxs("div",{className:"container mx-auto py-8 relative",children:[e.jsx(ot,{className:"mb-4",children:e.jsxs(dt,{children:[e.jsx(Pe,{children:e.jsx(Le,{href:"/",className:"!text-maintext hover:!text-maintext",children:"Trang chủ"})}),e.jsx(Re,{className:"!text-maintext hover:!text-maintext"}),e.jsx(Pe,{children:e.jsx(Le,{href:"/products",className:"!text-maintext hover:!text-maintext",children:"Sản phẩm"})}),e.jsx(Re,{className:"!text-maintext hover:!text-maintext"}),e.jsx(Pe,{children:e.jsx(ht,{className:"!text-maintext hover:!text-maintext",children:"Thanh toán đơn hàng"})})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-maintext",children:[e.jsx("div",{children:e.jsxs(Z,{children:[e.jsx(Ie,{children:e.jsx(De,{children:"Thông tin giao hàng"})}),e.jsx(ee,{children:e.jsx(ut,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(He),className:"space-y-4",children:[e.jsx(M,{control:r.control,name:"fullName",render:({field:t})=>e.jsxs($,{children:[e.jsx(E,{className:"text-maintext font-semibold",children:"Họ tên"}),e.jsx(A,{children:e.jsx(F,{placeholder:"Nguyễn Văn A",...t,disabled:z("fullName")})}),e.jsx(B,{})]})}),e.jsx(M,{control:r.control,name:"phoneNumber",render:({field:t})=>e.jsxs($,{children:[e.jsx(E,{className:"text-maintext font-semibold",children:"Số điện thoại"}),e.jsx(A,{children:e.jsx(F,{...t,disabled:z("phoneNumber")})}),e.jsx(B,{})]})}),e.jsx(M,{control:r.control,name:"email",render:({field:t})=>e.jsxs($,{children:[e.jsx(E,{className:"text-maintext font-semibold",children:"Email"}),e.jsx(A,{children:e.jsx(F,{placeholder:"Ví dụ: example@gmail.com",...t,disabled:z("email")})}),e.jsx(B,{})]})}),e.jsx(M,{control:r.control,name:"province",render:({field:t})=>e.jsxs($,{children:[e.jsx(E,{className:"text-maintext font-semibold",children:"Tỉnh/Thành phố"}),e.jsx(A,{children:e.jsxs(Se,{value:t.value,onValueChange:t.onChange,disabled:z("province")||U,children:[e.jsx(Ce,{className:"w-full",children:e.jsx(Te,{placeholder:U?"Đang tải...":"Chọn tỉnh/thành phố"})}),e.jsx(ke,{children:T.map(s=>e.jsx(me,{value:s.code.toString(),children:s.name},s.code))})]})}),e.jsx(B,{})]})}),e.jsx(M,{control:r.control,name:"district",render:({field:t})=>e.jsxs($,{children:[e.jsx(E,{className:"text-maintext font-semibold",children:"Quận/Huyện"}),e.jsx(A,{children:e.jsxs(Se,{value:t.value,onValueChange:t.onChange,disabled:z("district")||!b||fe,children:[e.jsx(Ce,{className:"w-full",children:e.jsx(Te,{placeholder:b?fe?"Đang tải...":"Chọn quận/huyện":"Vui lòng chọn tỉnh/thành phố trước"})}),e.jsx(ke,{children:O.map(s=>e.jsx(me,{value:s.code.toString(),children:s.name},s.code))})]})}),e.jsx(B,{})]})}),e.jsx(M,{control:r.control,name:"ward",render:({field:t})=>e.jsxs($,{children:[e.jsx(E,{className:"text-maintext font-semibold",children:"Phường/Xã"}),e.jsx(A,{children:e.jsxs(Se,{value:t.value,onValueChange:t.onChange,disabled:z("ward")||!v||Ne,children:[e.jsx(Ce,{className:"w-full",children:e.jsx(Te,{placeholder:v?Ne?"Đang tải...":"Chọn phường/xã":"Vui lòng chọn quận/huyện trước"})}),e.jsx(ke,{children:ie.map(s=>e.jsx(me,{value:s.code.toString(),children:s.name},s.code))})]})}),e.jsx(B,{})]})}),e.jsx(M,{control:r.control,name:"address",render:({field:t})=>e.jsxs($,{children:[e.jsx(E,{className:"text-maintext font-semibold",children:"Địa chỉ cụ thể"}),e.jsx(A,{children:e.jsx(F,{placeholder:"Số nhà, tên đường...",...t,disabled:z("address")})}),e.jsx(B,{})]})}),e.jsx(M,{control:r.control,name:"paymentMethod",render:({field:t})=>e.jsxs($,{children:[e.jsx(E,{className:"text-maintext font-semibold",children:"Phương thức thanh toán"}),e.jsx(A,{children:e.jsxs(Se,{value:t.value,onValueChange:t.onChange,disabled:t.disabled,children:[e.jsx(Ce,{className:"w-full",children:e.jsx(Te,{placeholder:"Chọn phương thức thanh toán"})}),e.jsxs(ke,{children:[e.jsx(me,{value:"COD",children:"Thanh toán khi nhận hàng (COD)"}),e.jsx(me,{value:"BANK_TRANSFER",children:"Thanh toán qua VNPay"})]})]})}),e.jsx(B,{})]})}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(S,{type:"button",variant:"outline",className:"flex-1",onClick:Ue,disabled:se,children:"Tiếp tục mua hàng"}),e.jsx(S,{type:"submit",className:"flex-1",disabled:se,children:se?"Đang xử lý...":"Hoàn tất đặt hàng"})]})]})})})]})}),e.jsx("div",{children:e.jsxs(Z,{children:[e.jsx(Ie,{children:e.jsx(De,{children:"Đơn hàng của bạn"})}),e.jsx(ee,{children:e.jsx("div",{className:"space-y-4",children:x.map(t=>e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-20 h-20 bg-muted rounded relative overflow-hidden",children:e.jsx("img",{src:ct(t.image),alt:t.name,className:"object-contain w-full h-full"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-maintext",children:t.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[t.brand,t.size&&` • Size ${t.size}`]}),e.jsxs("div",{className:"flex justify-between mt-2 text-maintext",children:[e.jsxs("span",{children:["x",t.quantity]}),e.jsx("span",{className:"text-maintext",children:g(t.price)})]})]})]},t.id))})}),e.jsxs(qe,{className:"flex flex-col space-y-2",children:[e.jsxs("div",{className:"flex justify-between w-full",children:[e.jsx("span",{className:"text-muted-foreground font-semibold text-sm",children:"Tạm tính"}),e.jsx("span",{className:"text-maintext",children:g(J+u)})]}),o&&u>0&&e.jsxs("div",{className:"flex justify-between w-full text-green-600",children:[e.jsxs("span",{className:"text-sm font-semibold",children:["Giảm giá voucher (",o.code,")"]}),e.jsxs("span",{children:["-",g(u)]})]}),e.jsxs("div",{className:"flex justify-between w-full",children:[e.jsx("span",{className:"text-muted-foreground font-semibold text-sm",children:"Thuế"}),e.jsx("span",{className:"text-maintext",children:g(we)})]}),e.jsxs("div",{className:"flex justify-between w-full",children:[e.jsx("span",{className:"text-muted-foreground font-semibold text-sm",children:"Phí vận chuyển"}),e.jsx("span",{className:"text-maintext",children:g(a)})]}),e.jsxs("div",{className:"flex justify-between w-full text-base font-semibold text-maintext pt-2 border-t",children:[e.jsx("span",{children:"Tổng cộng"}),e.jsx("span",{className:"text-lg text-primary font-semibold",children:g(l)})]})]})]})})]}),e.jsx(vt,{isOpen:h,onClose:()=>m(!1),orderData:pe||{orderId:`TEMP_${Date.now()}`,amount:l,orderInfo:"Thanh toán đơn hàng",orderCode:`ORD${Date.now()}`},onPaymentSuccess:Ge,onPaymentError:We}),C&&e.jsx(yt,{isOpen:D,onClose:()=>G(!1),orderId:C.id,orderCode:C.code})]})}const qt=()=>e.jsx(St,{});export{qt as default};
