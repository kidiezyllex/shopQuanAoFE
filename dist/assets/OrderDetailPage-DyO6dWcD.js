import{U as N,a as h,j as e,B as v}from"./index-Dpx_4rWJ.js";import{u as b}from"./useAuth-Doo4_xAC.js";import{u as w}from"./useToast-DwXsNIYN.js";import{C as c,c as d,a as o,b as m}from"./card-fT6uSY2F.js";import{B as C}from"./badge-CA2Kv9aL.js";import{f as T,l as A}from"./index-VIuxkY8Z.js";import"./typeof-QjJsDpFa.js";function O({params:l}){const x=N(),{user:a}=b(),{showToast:i}=w(),[s,g]=h.useState(null),[u,j]=h.useState(!0);h.useEffect(()=>{(async()=>{try{if(!(a!=null&&a.id)){x("/login");return}const r=await(await fetch(`/api/orders/${l.id}`)).json();if(r.success)g(r.data);else throw new Error(r.message||"Không thể tải thông tin đơn hàng")}catch(t){i({title:"Lỗi",message:t.message||"Đã có lỗi xảy ra khi tải đơn hàng",type:"error"}),x("/orders")}finally{j(!1)}})()},[l.id,a,router,i]);const p=n=>{switch(n){case"pending":return"bg-yellow-500";case"processing":return"bg-blue-500";case"completed":return"bg-green-500";case"cancelled":return"bg-red-500";default:return"bg-gray-500"}},f=n=>{switch(n){case"pending":return"Chờ xác nhận";case"processing":return"Đang xử lý";case"completed":return"Hoàn thành";case"cancelled":return"Đã hủy";default:return n}},y=async()=>{try{const t=await(await fetch(`/api/orders/${l.id}/cancel`,{method:"PUT"})).json();if(t.success)i({title:"Thành công",message:"Đã hủy đơn hàng thành công",type:"success"}),g(r=>r?{...r,status:"cancelled"}:null);else throw new Error(t.message||"Không thể hủy đơn hàng")}catch(n){i({title:"Lỗi",message:n.message||"Đã có lỗi xảy ra khi hủy đơn hàng",type:"error"})}};return u?e.jsx("div",{className:"container max-w-6xl py-8 flex items-center justify-center",children:e.jsx("div",{children:"Đang tải..."})}):s?e.jsxs("div",{className:"container max-w-6xl py-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h1",{className:"text-2xl font-bold",children:["Chi tiết đơn hàng #",s.id.slice(-6)]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(C,{className:`${p(s.status)} text-white`,children:f(s.status)}),s.status==="pending"&&e.jsx(v,{variant:"destructive",onClick:y,children:"Hủy đơn hàng"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs(c,{children:[e.jsx(o,{children:e.jsx(m,{children:"Thông tin giao hàng"})}),e.jsx(d,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:"Người nhận"}),e.jsxs("p",{className:"text-muted-foreground mt-1",children:[s.shippingAddress.name,e.jsx("br",{}),s.shippingAddress.phoneNumber]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:"Địa chỉ"}),e.jsxs("p",{className:"text-muted-foreground mt-1",children:[s.shippingAddress.specificAddress,e.jsx("br",{}),s.shippingAddress.wardId,", ",s.shippingAddress.districtId,e.jsx("br",{}),s.shippingAddress.provinceId]})]})]})})]}),e.jsxs(c,{children:[e.jsx(o,{children:e.jsx(m,{children:"Chi tiết thanh toán"})}),e.jsx(d,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:"Phương thức thanh toán"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:s.paymentMethod==="COD"?"Thanh toán khi nhận hàng":"VNPay"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:"Thời gian đặt hàng"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:T(new Date(s.createdAt),"HH:mm - dd/MM/yyyy",{locale:A})})]}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Tạm tính"}),e.jsxs("span",{children:["$",s.subTotal.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between font-medium text-lg",children:[e.jsx("span",{children:"Tổng cộng"}),e.jsxs("span",{children:["$",s.total.toFixed(2)]})]})]})]})})]})]}),e.jsxs(c,{className:"mt-6",children:[e.jsx(o,{children:e.jsx(m,{children:"Sản phẩm"})}),e.jsx(d,{children:e.jsx("div",{className:"space-y-4",children:s.items.map((n,t)=>e.jsxs("div",{className:"flex items-center gap-4 py-4 border-b last:border-0",children:[e.jsx("div",{className:"w-20 h-20 bg-muted rounded relative overflow-hidden",children:e.jsx("img",{src:n.product.image,alt:n.product.name,className:"object-cover w-full h-full"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium",children:n.product.name}),e.jsxs("div",{className:"flex justify-between mt-2 text-muted-foreground",children:[e.jsxs("span",{children:["Số lượng: ",n.quantity]}),e.jsxs("span",{children:["$",n.price.toFixed(2)]})]})]})]},t))})})]})]}):e.jsx("div",{className:"container max-w-6xl py-8",children:e.jsx(c,{children:e.jsx(d,{className:"py-8",children:e.jsx("div",{className:"text-center text-muted-foreground",children:"Không tìm thấy đơn hàng"})})})})}const D=()=>e.jsx(O,{});export{D as default};
