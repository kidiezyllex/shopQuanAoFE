import{j as e,i as s,k as a,l as i,m as t}from"./ui-vendor-CFM_MCUz.js";import{r}from"./react-vendor-B55MjJUH.js";import{k as l,I as n,B as c,l as o,y as d}from"./index-BHeY-5EX.js";import{C as m}from"./card-ClEzRAeX.js";import{S as h,a as u,b as x,c as p,d as j}from"./select-C6W71KWg.js";import{t as v,ad as f,ae as g,af as N,J as y,K as b,L as w}from"./icons-vendor-BrsZP2ku.js";import{u as k,a as I}from"./product-BXJPBtky.js";import{u as P}from"./promotion-DDJnNtmQ.js";import{a as z,c as A}from"./promotions-CtwgNWvY.js";import{B as C,a as T,b as _,c as S,d as D,e as V}from"./breadcrumb-CP4jYkI2.js";import{S as O}from"./skeleton-4G_X8bY4.js";import{u as G}from"./useCartStore-nn8gyhXY.js";import{P as M,a as $,b as B,c as E,d as F,e as H}from"./pagination-C8X0lLjr.js";import{m as K,A as L}from"./heavy-vendor-BfN2pHnQ.js";import"./query-vendor-CBwfxcof.js";import"./middleware-DTCYSWSl.js";const q=r.forwardRef((({className:r,...n},c)=>e.jsxs(s,{ref:c,className:l("relative flex w-full touch-none select-none items-center",r),...n,children:[e.jsx(a,{className:"relative h-1.5 w-full grow overflow-hidden rounded-full bg-primary/20",children:e.jsx(i,{className:"absolute h-full bg-primary"})}),e.jsx(t,{className:"block h-4 w-4 rounded-full border border-primary/50 bg-background shadow transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50"})]})));q.displayName=s.displayName;const Q=e=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(e),W=()=>{var s,a,i;const[t,l]=r.useState(!1),[o,N]=r.useState({page:1,limit:8}),[y,b]=r.useState({}),[w,K]=r.useState(""),[L,q]=r.useState("default"),[Q,W]=r.useState(null),[U,X]=r.useState(!1),{addToCart:Y}=G();r.useEffect((()=>{const e=setTimeout((()=>{X(!!w)}),500);return()=>clearTimeout(e)}),[w]);const Z={page:o.page,limit:o.limit,status:"HOAT_DONG"},ee=k(Z),se=I(U?{keyword:w,status:"HOAT_DONG"}:{keyword:""}),{data:ae,isLoading:ie,isError:te}=U?se:ee,{data:re}=P({status:"HOAT_DONG"}),le=r.useMemo((()=>{var e;if(!ae||!ae.data||!ae.data.products)return ae;let s=[...ae.data.products];if((null==(e=null==re?void 0:re.data)?void 0:e.promotions)&&(s=z(s,re.data.promotions)),y.brands&&y.brands.length>0){const e=Array.isArray(y.brands)?y.brands:[y.brands];s=s.filter((s=>{const a="object"==typeof s.brand?s.(brand as any)?.id:s.brand;return e.includes(a)}))}if(y.categories&&y.categories.length>0){const e=Array.isArray(y.categories)?y.categories:[y.categories];s=s.filter((s=>{const a="object"==typeof s.category?s.(category as any)?.id:s.category;return e.includes(a)}))}if(y.color&&(s=s.filter((e=>e.variants.some((e=>("object"==typeof e.colorId?e.colorId.id:e.colorId)===y.color))))),y.size&&(s=s.filter((e=>e.variants.some((e=>("object"==typeof e.sizeId?e.sizeId.id:e.sizeId)===y.size))))),void 0!==y.minPrice||void 0!==y.maxPrice){const e=void 0!==y.minPrice?y.minPrice:0,a=void 0!==y.maxPrice?y.maxPrice:Number.POSITIVE_INFINITY;s=s.filter((s=>{var i,t;let r=(null==(i=s.variants[0])?void 0:i.price)||0;if(null==(t=null==re?void 0:re.data)?void 0:t.promotions){const e=A(s.id,r,re.data.promotions);e.discountPercent>0&&(r=e.discountedPrice)}return r>=e&&r<=a}))}return"default"!==L&&s.sort(((e,s)=>{var a,i,t;let r=(null==(a=e.variants[0])?void 0:a.price)||0,l=(null==(i=s.variants[0])?void 0:i.price)||0;if(null==(t=null==re?void 0:re.data)?void 0:t.promotions){const a=A(e.id,r,re.data.promotions),i=A(s.id,l,re.data.promotions);a.discountPercent>0&&(r=a.discountedPrice),i.discountPercent>0&&(l=i.discountedPrice)}const n=new Date(e.createdAt).getTime(),c=new Date(s.createdAt).getTime();switch(L){case"price-asc":return r-l;case"price-desc":return l-r;case"newest":return c-n;case"popularity":const a=e.variants.reduce(((e,s)=>e+s.stock),0);return s.variants.reduce(((e,s)=>e+s.stock),0)-a;default:return 0}})),{...ae,data:{...ae.data,products:s}}}),[ae,y,L,re]),ne=e=>{N((s=>({...s,page:e})))};if(ie)return e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:Array.from({length:8}).map(((s,a)=>e.jsxs(m,{className:"overflow-hidden",children:[e.jsx(O,{className:"h-64 w-full"}),e.jsxs("div",{className:"p-4 space-y-2",children:[e.jsx(O,{className:"h-4 w-3/4"}),e.jsx(O,{className:"h-4 w-1/2"}),e.jsx(O,{className:"h-8 w-full"})]})]},a)))})});if(te)return e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-red-600 mb-4",children:"Có lỗi xảy ra"}),e.jsx("p",{className:"text-gray-600",children:"Không thể tải danh sách sản phẩm. Vui lòng thử lại sau."})]})});const ce=(null==(s=null==le?void 0:le.data)?void 0:s.products)||[],oe=Math.ceil(((null==(i=null==(a=null==le?void 0:le.data)?void 0:a.pagination)?void 0:i.totalItems)||0)/o.limit);return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white shadow-sm",children:e.jsx("div",{className:"container mx-auto px-4 py-4",children:e.jsx(C,{children:e.jsxs(T,{children:[e.jsx(_,{children:e.jsx(S,{href:"/",children:"Trang chủ"})}),e.jsx(D,{}),e.jsx(_,{children:e.jsx(V,{children:"Sản phẩm"})})]})})})}),e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 mb-8",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(v.Icon,{path:f,size:1,className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx(n,{type:"text",placeholder:"Tìm kiếm sản phẩm...",value:w,onChange:e=>K(e.target.value),className:"pl-10"})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(c,{variant:"outline",onClick:()=>{l(!t)},className:"lg:hidden",children:[e.jsx(v.Icon,{path:g,size:1,className:"mr-2"}),"Bộ lọc"]}),e.jsxs(h,{value:L,onValueChange:q,children:[e.jsx(u,{className:"w-48",children:e.jsx(x,{placeholder:"Sắp xếp theo"})}),e.jsxs(p,{children:[e.jsx(j,{value:"default",children:"Mặc định"}),e.jsx(j,{value:"price-asc",children:"Giá tăng dần"}),e.jsx(j,{value:"price-desc",children:"Giá giảm dần"}),e.jsx(j,{value:"newest",children:"Mới nhất"}),e.jsx(j,{value:"popularity",children:"Phổ biến"})]})]})]})]}),e.jsxs("div",{className:"flex gap-8",children:[e.jsx("div",{className:`lg:block ${t?"block":"hidden"} lg:w-64 w-full`,children:e.jsx(R,{filters:y,onChange:e=>{b((s=>({...s,...e})))}})}),e.jsx("div",{className:"flex-1",children:0===ce.length?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-600 mb-2",children:"Không tìm thấy sản phẩm"}),e.jsx("p",{className:"text-gray-500",children:"Thử thay đổi bộ lọc hoặc từ khóa tìm kiếm"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mb-8",children:ce.map((s=>e.jsx(J,{product:s,promotionsData:re,onAddToCart:()=>(e=>{var s,a;const i=e.variants.find((e=>e.stock>0));if(!i)return void d.error("Sản phẩm đã hết hàng");let t=i.price,r=0;if(null==(s=null==re?void 0:re.data)?void 0:s.promotions){const s=A(e.id,t,re.data.promotions);s.discountPercent>0&&(t=s.discountedPrice,r=s.discountPercent)}const l={id:`${e.id}-${i.id}`,productId:e.id,variantId:i.id,name:e.name,price:t,originalPrice:i.price,discountPercent:r,quantity:1,image:(null==(a=e.images)?void 0:a[0])||"/placeholder-image.jpg",color:"object"==typeof i.colorId?i.colorId.name:"N/A",size:"object"==typeof i.sizeId?i.sizeId.name:"N/A",stock:i.stock};Y(l,1),d.success(`Đã thêm ${e.name} vào giỏ hàng`)})(s),onQuickView:()=>{},onAddToWishlist:()=>(e=>{d.success(`Đã thêm ${e.name} vào danh sách yêu thích`)})(s)},s.id)))}),oe>1&&e.jsx(M,{children:e.jsxs($,{children:[e.jsx(B,{children:e.jsx(E,{href:"#",onClick:e=>{e.preventDefault(),o.page>1&&ne(o.page-1)}})}),Array.from({length:oe},((e,s)=>s+1)).map((s=>e.jsx(B,{children:e.jsx(F,{href:"#",isActive:s===o.page,onClick:e=>{e.preventDefault(),ne(s)},children:s})},s))),e.jsx(B,{children:e.jsx(H,{href:"#",onClick:e=>{e.preventDefault(),o.page<oe&&ne(o.page+1)}})})]})})]})})]})]})]})},J=({product:s,promotionsData:a,onAddToCart:i,onQuickView:t,onAddToWishlist:l})=>{var n,d,h;const[u,x]=r.useState(!1),p=(null==(n=s.variants[0])?void 0:n.price)||0;let j=p,f=0;if(null==(d=null==a?void 0:a.data)?void 0:d.promotions){const e=A(s.id,p,a.data.promotions);e.discountPercent>0&&(j=e.discountedPrice,f=e.discountPercent)}const g=s.variants.every((e=>0===e.stock));return e.jsx(K.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},onMouseEnter:()=>x(!0),onMouseLeave:()=>x(!1),children:e.jsxs(m,{className:"overflow-hidden group hover:shadow-lg transition-shadow duration-300 relative",children:[f>0&&e.jsx("div",{className:"absolute top-2 left-2 z-10",children:e.jsxs("div",{className:"bg-red-500 text-white px-2 py-1 rounded-full text-xs font-bold flex items-center",children:[e.jsx(v.Icon,{path:N,size:.5,className:"mr-1"}),"-",f,"%"]})}),g&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center z-10",children:e.jsx("span",{className:"text-white font-bold text-lg",children:"Hết hàng"})}),e.jsxs("div",{className:"relative overflow-hidden",children:[e.jsx("img",{src:o(null==(h=s.images)?void 0:h[0])||"/placeholder-image.jpg",alt:s.name,className:"w-full h-64 object-cover transition-transform duration-300 group-hover:scale-105"}),e.jsx(L,{children:u&&e.jsx(K.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},className:"absolute inset-0 bg-black bg-opacity-40 flex items-center justify-center",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{size:"sm",variant:"secondary",onClick:t,className:"rounded-full p-2",children:e.jsx(v.Icon,{path:y,size:.8})}),e.jsx(c,{size:"sm",variant:"secondary",onClick:l,className:"rounded-full p-2",children:e.jsx(v.Icon,{path:b,size:.8})})]})})})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"font-semibold text-lg mb-2 line-clamp-2",children:s.name}),e.jsx("div",{className:"flex items-center gap-2 mb-3",children:f>0?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-lg font-bold text-red-600",children:Q(j)}),e.jsx("span",{className:"text-sm text-gray-500 line-through",children:Q(p)})]}):e.jsx("span",{className:"text-lg font-bold text-gray-900",children:Q(j)})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:[s.variants.reduce(((e,s)=>e+s.stock),0)," có sẵn"]}),e.jsxs(c,{size:"sm",onClick:i,disabled:g,className:"flex items-center gap-1",children:[e.jsx(v.Icon,{path:w,size:.7}),"Thêm"]})]})]})]})})},R=({filters:s,onChange:a})=>e.jsxs(m,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"Bộ lọc"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Giá"}),e.jsx(q,{defaultValue:[0,1e6],max:1e6,step:1e4,className:"w-full",onValueChange:e=>{a({minPrice:e[0],maxPrice:e[1]})}})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Thương hiệu"}),e.jsx("div",{className:"space-y-2",children:e.jsx("p",{className:"text-sm text-gray-500",children:"Đang tải..."})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Danh mục"}),e.jsx("div",{className:"space-y-2",children:e.jsx("p",{className:"text-sm text-gray-500",children:"Đang tải..."})})]}),e.jsx(c,{variant:"outline",className:"w-full",onClick:()=>a({}),children:"Xóa bộ lọc"})]})]});export{W as default};
