import{j as e}from"./ui-vendor-CFM_MCUz.js";import{r as s}from"./react-vendor-B55MjJUH.js";import{C as a,c as t,a as n,b as i}from"./card-ClEzRAeX.js";import{B as r,I as l,y as c}from"./index-BHeY-5EX.js";import{B as d}from"./badge-BeHegjHt.js";import{T as m,b as h,c as o,a as x}from"./tabs-z4DSy6tE.js";import{b as u,c as j,d as p,u as g,a as v}from"./return-4pcPvvv5.js";import{t as N,ay as y,az as f,aA as b,a9 as I,J as w}from"./icons-vendor-BrsZP2ku.js";import{C}from"./checkbox-4N58UvKV.js";import{T as z}from"./textarea-DHkaMSo6.js";import{d as _}from"./query-vendor-CBwfxcof.js";import{T as D,a as k,b as A,c as H,d as q,e as T}from"./table-DL-K3PV4.js";import{D as O,f as S}from"./dialog-Va24CY58.js";import{f as Y}from"./utils-vendor-C6znz4jh.js";import{l as L}from"./index-DwIVA3Vd.js";import"./heavy-vendor-BfN2pHnQ.js";function M({order:n}){const[i,d]=s.useState([]),[m,h]=s.useState(""),[o,x]=s.useState(!1),j=u(),p=_();s.useEffect((()=>{n&&(d([]),h(""))}),[n]);const g=e=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND",maximumFractionDigits:0}).format(e),v=(e,s)=>{d((a=>a.map(((a,t)=>t===e?{...a,quantity:Math.max(1,Math.min(s,a.maxQuantity))}:a))))},y=e=>i.some((s=>s.product===e.product._id&&s.variant.colorId===e.variant.colorId&&s.variant.sizeId===e.variant.sizeId));return n?e.jsxs(DialogContent,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(DialogHeader,{children:e.jsx(DialogTitle,{children:"Tạo yêu cầu trả hàng"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(a,{children:e.jsxs(t,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Thông tin đơn hàng"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-maintext",children:"Mã đơn hàng:"}),e.jsxs("span",{className:"ml-2 font-medium",children:["#",n.code]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-maintext",children:"Tổng tiền:"}),e.jsx("span",{className:"ml-2 font-medium",children:g(n.total)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-maintext",children:"Ngày đặt:"}),e.jsx("span",{className:"ml-2 font-medium",children:new Date(n.createdAt).toLocaleDateString("vi-VN")})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-maintext",children:"Trạng thái:"}),e.jsx("span",{className:"ml-2 font-medium text-green-600",children:"Đã hoàn thành"})]})]})]})}),e.jsx(a,{children:e.jsxs(t,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"Chọn sản phẩm cần trả"}),e.jsx("div",{className:"space-y-4",children:n.items.map(((s,a)=>{var t,n,c;return e.jsx("div",{className:"border rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(C,{checked:y(s),onCheckedChange:e=>((e,s)=>{var a,t;if(s){const s={product:e.product._id,variant:e.variant,quantity:1,maxQuantity:e.quantity,price:e.price,productName:e.product.name,productImage:e.product.images[0]||"/placeholder.jpg",variantInfo:`${(null==(a=e.variant.color)?void 0:a.name)||""} - ${(null==(t=e.variant.size)?void 0:t.name)||""}`};d((e=>[...e,s]))}else d((s=>s.filter((s=>!(s.product===e.product._id&&s.variant.colorId===e.variant.colorId&&s.variant.sizeId===e.variant.sizeId)))))})(s,e)}),e.jsx("img",{src:s.product.images[0]||"/placeholder.jpg",alt:s.product.name,width:80,height:80,className:"rounded-md object-cover"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium",children:s.product.name}),e.jsxs("p",{className:"text-sm text-maintext",children:[null==(t=s.variant.color)?void 0:t.name," - ",null==(n=s.variant.size)?void 0:n.name]}),e.jsxs("p",{className:"text-sm text-maintext",children:["Đã mua: ",s.quantity," | Giá: ",g(s.price)]})]}),y(s)&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm",children:"Số lượng trả:"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(r,{variant:"outline",size:"sm",onClick:()=>{const e=i.findIndex((e=>e.product===s.product._id&&e.variant.colorId===s.variant.colorId&&e.variant.sizeId===s.variant.sizeId));-1!==e&&v(e,i[e].quantity-1)},children:e.jsx(N.Icon,{path:mdiMinus,size:.7})}),e.jsx(l,{type:"number",min:"1",max:s.quantity,value:(null==(c=i.find((e=>e.product===s.product._id&&e.variant.colorId===s.variant.colorId&&e.variant.sizeId===s.variant.sizeId)))?void 0:c.quantity)||1,onChange:e=>{const a=i.findIndex((e=>e.product===s.product._id&&e.variant.colorId===s.variant.colorId&&e.variant.sizeId===s.variant.sizeId));-1!==a&&v(a,parseInt(e.target.value)||1)},className:"w-16 text-center"}),e.jsx(r,{variant:"outline",size:"sm",onClick:()=>{const e=i.findIndex((e=>e.product===s.product._id&&e.variant.colorId===s.variant.colorId&&e.variant.sizeId===s.variant.sizeId));-1!==e&&v(e,i[e].quantity+1)},children:e.jsx(N.Icon,{path:mdiPlus,size:.7})})]})]})]})},a)}))})]})}),e.jsx(a,{children:e.jsxs(t,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Lý do trả hàng *"}),e.jsx(z,{placeholder:"Vui lòng mô tả lý do bạn muốn trả hàng...",value:m,onChange:e=>h(e.target.value),rows:4,className:"w-full"})]})}),i.length>0&&e.jsx(a,{children:e.jsxs(t,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Tóm tắt yêu cầu trả hàng"}),e.jsxs("div",{className:"space-y-2",children:[i.map(((s,a)=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{children:[s.productName," (",s.variantInfo,") x",s.quantity]}),e.jsx("span",{children:g(s.price*s.quantity)})]},a))),e.jsxs("div",{className:"border-t pt-2 flex justify-between font-semibold",children:[e.jsx("span",{children:"Tổng tiền hoàn trả:"}),e.jsx("span",{className:"text-primary",children:g(i.reduce(((e,s)=>e+s.price*s.quantity),0))})]})]})]})})]}),e.jsxs(DialogFooter,{children:[e.jsx(r,{variant:"outline",disabled:o,children:"Hủy"}),e.jsx(r,{onClick:async()=>{if(n&&0!==i.length&&m.trim()){x(!0);try{const e={originalOrder:n._id,items:i.map((e=>({product:e.product,variant:e.variant,quantity:e.quantity}))),reason:m.trim()};await j.mutateAsync(e),c.success("Yêu cầu trả hàng đã được gửi thành công"),p.invalidateQueries({queryKey:["myReturns"]}),p.invalidateQueries({queryKey:["returnableOrders"]}),d([]),h("")}catch(e){c.error("Gửi yêu cầu trả hàng thất bại")}finally{x(!1)}}else c.error("Vui lòng chọn sản phẩm và nhập lý do trả hàng")},disabled:o||0===i.length||!m.trim(),children:o?"Đang gửi...":"Gửi yêu cầu"})]})]}):null}function V({onConfirm:s,onCancel:a,isLoading:t=!1}){return e.jsxs(DialogContent,{className:"max-w-4xl",children:[e.jsx(DialogHeader,{children:e.jsxs(DialogTitle,{className:"flex items-center gap-2",children:[e.jsx(N.Icon,{path:y,size:1,className:"text-red-500"}),"Xác nhận hủy yêu cầu"]})}),e.jsx("div",{className:"py-4",children:e.jsx("p",{className:"text-maintext",children:"Bạn có chắc chắn muốn hủy yêu cầu trả hàng này không? Hành động này không thể hoàn tác."})}),e.jsxs(DialogFooter,{children:[e.jsx(r,{variant:"outline",onClick:a,disabled:t,children:"Không, giữ lại"}),e.jsx(r,{variant:"destructive",onClick:s,disabled:t,children:t?"Đang hủy...":"Có, hủy yêu cầu"})]})]})}function F({returnItem:l}){const[m,h]=s.useState(!1),{data:o,isLoading:x}=j((null==l?void 0:l._id)||""),u=p(),g=_(),v=e=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND",maximumFractionDigits:0}).format(e),y=e=>Y(new Date(e),"dd/MM/yyyy HH:mm",{locale:L});if(!l)return null;const f=(null==o?void 0:o.data)||l;return e.jsxs(DialogContent,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(DialogHeader,{children:e.jsxs(DialogTitle,{className:"flex items-center justify-between",children:[e.jsxs("span",{children:["Chi tiết yêu cầu trả hàng #",f.code]}),(s=>{switch(s){case"CHO_XU_LY":return e.jsxs(d,{variant:"outline",className:"bg-yellow-50 text-yellow-600 border-yellow-200",children:[e.jsx(N.Icon,{path:mdiClockOutline,size:.7,className:"mr-1"}),"Chờ xử lý"]});case"DA_HOAN_TIEN":return e.jsxs(d,{variant:"outline",className:"bg-green-50 text-green-600 border-green-200",children:[e.jsx(N.Icon,{path:mdiCheckCircle,size:.7,className:"mr-1"}),"Đã hoàn tiền"]});case"DA_HUY":return e.jsxs(d,{variant:"outline",className:"bg-red-50 text-red-600 border-red-200",children:[e.jsx(N.Icon,{path:mdiCancel,size:.7,className:"mr-1"}),"Đã hủy"]});default:return e.jsx(d,{variant:"outline",children:"Không xác định"})}})(f.status)]})}),x?e.jsx("div",{className:"space-y-4",children:[1,2,3].map((s=>e.jsx("div",{className:"h-32 bg-gray-100 rounded-lg animate-pulse"},s)))}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs(a,{children:[e.jsx(n,{children:e.jsx(i,{children:"Thông tin yêu cầu trả hàng"})}),e.jsx(t,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-maintext",children:"Mã yêu cầu:"}),e.jsxs("span",{className:"ml-2 font-medium",children:["#",f.code]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-maintext",children:"Đơn hàng gốc:"}),e.jsxs("span",{className:"ml-2 font-medium",children:["#","string"==typeof f.originalOrder?f.originalOrder:f.originalOrder.code]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-maintext",children:"Ngày tạo:"}),e.jsx("span",{className:"ml-2 font-medium",children:y(f.createdAt)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-maintext",children:"Tổng tiền hoàn trả:"}),e.jsx("span",{className:"ml-2 font-medium text-primary",children:v(f.totalRefund)})]})]})})]}),e.jsxs(a,{children:[e.jsx(n,{children:e.jsx(i,{children:"Trạng thái xử lý"})}),e.jsx(t,{children:((s,a,t)=>{const n=[{key:"CHO_XU_LY",label:"Chờ xử lý",date:a},{key:"DA_HOAN_TIEN",label:"Đã hoàn tiền",date:"DA_HOAN_TIEN"===s?t:null},{key:"DA_HUY",label:"Đã hủy",date:"DA_HUY"===s?t:null}];return e.jsx("div",{className:"space-y-4",children:n.map(((s,a)=>{s.key;const t=null!==s.date;return e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center "+(t?"bg-primary text-white":"bg-gray-200 text-maintext"),children:t?e.jsx(N.Icon,{path:mdiCheckCircle,size:.7}):e.jsx("span",{className:"text-sm",children:a+1})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium "+(t?"text-gray-900":"text-maintext"),children:s.label}),s.date&&e.jsx("p",{className:"text-sm text-maintext",children:y(s.date)})]})]},s.key)}))})})(f.status,f.createdAt,f.updatedAt)})]}),e.jsxs(a,{children:[e.jsx(n,{children:e.jsx(i,{children:"Sản phẩm trả hàng"})}),e.jsx(t,{children:e.jsxs(D,{children:[e.jsx(k,{children:e.jsxs(A,{children:[e.jsx(H,{children:"Sản phẩm"}),e.jsx(H,{children:"Phân loại"}),e.jsx(H,{children:"Số lượng"}),e.jsx(H,{children:"Đơn giá"}),e.jsx(H,{children:"Thành tiền"})]})}),e.jsx(q,{children:f.items.map(((s,a)=>{var t,n;return e.jsxs(A,{children:[e.jsx(T,{children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:"/placeholder.jpg",alt:"Product",width:50,height:50,className:"rounded-md object-cover"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"object"==typeof s&&"product"in s&&"object"==typeof s.product?s.product.name:"Sản phẩm"}),e.jsx("p",{className:"text-sm text-maintext",children:"object"==typeof s&&"product"in s&&"object"==typeof s.product?s.product.code:""})]})]})}),e.jsx(T,{children:e.jsxs("div",{className:"text-sm",children:[e.jsxs("p",{children:["Màu: ",(null==(t=s.variant)?void 0:t.colorId)||"N/A"]}),e.jsxs("p",{children:["Size: ",(null==(n=s.variant)?void 0:n.sizeId)||"N/A"]})]})}),e.jsx(T,{children:s.quantity}),e.jsx(T,{children:v(s.price)}),e.jsx(T,{children:v(s.price*s.quantity)})]},a)}))})]})})]})]}),e.jsx(DialogFooter,{children:e.jsxs("div",{className:"flex gap-2",children:["CHO_XU_LY"===f.status&&e.jsxs(O,{open:m,onOpenChange:h,children:[e.jsx(S,{asChild:!0,children:e.jsxs(r,{variant:"destructive",children:[e.jsx(N.Icon,{path:mdiCancel,size:.7,className:"mr-1"}),"Hủy yêu cầu"]})}),e.jsx(V,{onConfirm:async()=>{if(l)try{await u.mutateAsync(l._id),c.success("Đã hủy yêu cầu trả hàng thành công"),g.invalidateQueries({queryKey:["myReturns"]}),g.invalidateQueries({queryKey:["myReturn",l._id]}),h(!1)}catch(e){c.error("Hủy yêu cầu trả hàng thất bại")}},onCancel:()=>h(!1),isLoading:u.isPending})]}),e.jsx(r,{variant:"outline",children:"Đóng"})]})})]})}const U=()=>{const[l,c]=s.useState("returnable"),[u,j]=s.useState(null),[p,y]=s.useState(null),[C,z]=s.useState({page:1,limit:10}),[_,D]=s.useState({page:1,limit:10}),{data:k,isLoading:A}=g(C),{data:H,isLoading:q}=v(_),T=e=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND",maximumFractionDigits:0}).format(e),V=e=>Y(new Date(e),"dd/MM/yyyy",{locale:L}),U=s=>{switch(s){case"CHO_XU_LY":return e.jsx(d,{variant:"outline",className:"bg-yellow-50 text-yellow-600 border-yellow-200",children:"Chờ xử lý"});case"DA_HOAN_TIEN":return e.jsx(d,{variant:"outline",className:"bg-green-50 text-green-600 border-green-200",children:"Đã hoàn tiền"});case"DA_HUY":return e.jsx(d,{variant:"outline",className:"bg-red-50 text-red-600 border-red-200",children:"Đã hủy"});default:return e.jsx(d,{variant:"outline",children:"Không xác định"})}},K=({order:s})=>e.jsx(a,{className:"hover:shadow-md transition-shadow",children:e.jsxs(t,{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-lg",children:["#",s.code]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-maintext mt-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(N.Icon,{path:f,size:.7}),V(s.createdAt)]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(N.Icon,{path:b,size:.7}),T(s.total)]})]})]}),e.jsxs(O,{children:[e.jsx(S,{asChild:!0,children:e.jsxs(r,{variant:"outline",size:"sm",onClick:()=>j(s),children:[e.jsx(N.Icon,{path:I,size:.7,className:"mr-1"}),"Yêu cầu trả hàng"]})}),e.jsx(M,{order:u})]})]}),e.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-2",children:[s.items.slice(0,3).map(((s,a)=>e.jsx("div",{className:"flex-shrink-0",children:e.jsx("img",{src:s.product.images[0]||"/placeholder.jpg",alt:s.product.name,width:60,height:60,className:"rounded-md object-cover"})},a))),s.items.length>3&&e.jsxs("div",{className:"flex-shrink-0 w-15 h-15 bg-gray-100 rounded-md flex items-center justify-center text-sm text-maintext",children:["+",s.items.length-3]})]})]})}),X=({returnItem:s})=>e.jsx(a,{className:"hover:shadow-md transition-shadow",children:e.jsxs(t,{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-lg",children:["#",s.code]}),e.jsxs("p",{className:"text-sm text-maintext",children:["Đơn gốc: #","string"==typeof s.originalOrder?s.originalOrder:s.originalOrder.code]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-maintext mt-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(N.Icon,{path:f,size:.7}),V(s.createdAt)]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(N.Icon,{path:b,size:.7}),T(s.totalRefund)]})]})]}),e.jsxs("div",{className:"flex flex-col gap-2 items-end",children:[U(s.status),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(O,{children:[e.jsx(S,{asChild:!0,children:e.jsxs(r,{variant:"outline",size:"sm",onClick:()=>y(s),children:[e.jsx(N.Icon,{path:w,size:.7,className:"mr-1"}),"Chi tiết"]})}),e.jsx(F,{returnItem:p})]}),"CHO_XU_LY"===s.status&&e.jsx(r,{variant:"destructive",size:"sm",children:"Hủy yêu cầu"})]})]})]}),e.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-2",children:[s.items.slice(0,3).map(((s,a)=>e.jsx("div",{className:"flex-shrink-0",children:e.jsx("img",{src:"/placeholder.jpg",alt:"Product",width:60,height:60,className:"rounded-md object-cover"})},a))),s.items.length>3&&e.jsxs("div",{className:"flex-shrink-0 w-15 h-15 bg-gray-100 rounded-md flex items-center justify-center text-sm text-maintext",children:["+",s.items.length-3]})]})]})});return e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Quản lý trả hàng"}),e.jsx("p",{className:"text-maintext",children:"Xem đơn hàng có thể trả và quản lý yêu cầu trả hàng của bạn"})]}),e.jsxs(m,{value:l,onValueChange:c,className:"w-full",children:[e.jsxs(h,{className:"grid w-full grid-cols-2",children:[e.jsx(o,{value:"returnable",children:"Đơn hàng có thể trả"}),e.jsx(o,{value:"my-returns",children:"Yêu cầu trả hàng của tôi"})]}),e.jsx(x,{value:"returnable",className:"space-y-4",children:e.jsxs(a,{children:[e.jsxs(n,{children:[e.jsx(i,{children:"Đơn hàng có thể trả hàng"}),e.jsx("p",{className:"text-sm text-maintext",children:"Chỉ hiển thị đơn hàng đã hoàn thành trong vòng 7 ngày qua"})]}),e.jsx(t,{children:A?e.jsx("div",{className:"space-y-4",children:[1,2,3].map((s=>e.jsx("div",{className:"h-32 bg-gray-100 rounded-lg animate-pulse"},s)))}):0===(null==k?void 0:k.data.orders.length)?e.jsx("div",{className:"text-center py-8 text-maintext",children:"Không có đơn hàng nào có thể trả hàng"}):e.jsx("div",{className:"space-y-4",children:null==k?void 0:k.data.orders.map((s=>e.jsx(K,{order:s},s._id)))})})]})}),e.jsx(x,{value:"my-returns",className:"space-y-4",children:e.jsxs(a,{children:[e.jsxs(n,{children:[e.jsx(i,{children:"Yêu cầu trả hàng của tôi"}),e.jsx("p",{className:"text-sm text-maintext",children:"Xem trạng thái và chi tiết các yêu cầu trả hàng đã gửi"})]}),e.jsx(t,{children:q?e.jsx("div",{className:"space-y-4",children:[1,2,3].map((s=>e.jsx("div",{className:"h-32 bg-gray-100 rounded-lg animate-pulse"},s)))}):0===(null==H?void 0:H.data.returns.length)?e.jsx("div",{className:"text-center py-8 text-maintext",children:"Bạn chưa có yêu cầu trả hàng nào"}):e.jsx("div",{className:"space-y-4",children:null==H?void 0:H.data.returns.map((s=>e.jsx(X,{returnItem:s},s._id)))})})]})})]})]})};export{U as default};
