import{a as v,aJ as $,j as e,B as u,k as o,ab as W,q as Z,aa as ee,a6 as k,aK as se,ad as U,p as B,C as ae,aL as K,aM as Q,ae as ne,t as te}from"./index-Dpx_4rWJ.js";import{C as j,c as p,a as H,b as A}from"./card-fT6uSY2F.js";import{B as C}from"./badge-CA2Kv9aL.js";import{T as ie,b as ce,c as E,a as X}from"./tabs-BXj1bKUw.js";import{b as re,c as le,d as de,u as he,a as xe}from"./return-D2yKC1D3.js";import{C as oe}from"./checkbox-BwYGdXvN.js";import{T as me}from"./textarea-D-7Bay0_.js";import{a as O,b as Y,c as L,e as P,D as _,h as M}from"./dialog-BuHyDe_9.js";import{T as ue,a as je,b as F,c as S,d as pe,e as q}from"./table-BeX0puEz.js";import{f as G,l as J}from"./index-VIuxkY8Z.js";import"./index-qvEK80KO.js";import"./check-CyKb8IHM.js";import"./createLucideIcon-BdgKQErZ.js";import"./typeof-QjJsDpFa.js";function ge({order:t}){const[l,x]=v.useState([]),[g,w]=v.useState(""),[f,T]=v.useState(!1),R=re(),z=$();v.useEffect(()=>{t&&(x([]),w(""))},[t]);const I=s=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND",maximumFractionDigits:0}).format(s),y=(s,i)=>{var d,m;if(i){const a={product:s.product.id,variant:s.variant,quantity:1,maxQuantity:s.quantity,price:s.price,productName:s.product.name,productImage:s.product.images[0]||"/placeholder.jpg",variantInfo:`${((d=s.variant.color)==null?void 0:d.name)||""} - ${((m=s.variant.size)==null?void 0:m.name)||""}`};x(c=>[...c,a])}else x(a=>a.filter(c=>!(c.product===s.product.id&&c.variant.colorId===s.variant.colorId&&c.variant.sizeId===s.variant.sizeId)))},D=(s,i)=>{x(d=>d.map((m,a)=>a===s?{...m,quantity:Math.max(1,Math.min(i,m.maxQuantity))}:m))},r=s=>l.some(i=>{var d;return i.product===((d=s.product)==null?void 0:d.id)&&i.variant.colorId===s.variant.colorId&&i.variant.sizeId===s.variant.sizeId}),n=()=>l.reduce((s,i)=>s+i.price*i.quantity,0),b=async()=>{if(!t||l.length===0||!g.trim()){k.error("Vui lòng chọn sản phẩm và nhập lý do trả hàng");return}T(!0);try{const s={originalOrder:t.id,items:l.map(i=>({product:i.product,variant:i.variant,quantity:i.quantity})),reason:g.trim()};await R.mutateAsync(s),k.success("Yêu cầu trả hàng đã được gửi thành công"),z.invalidateQueries({queryKey:["myReturns"]}),z.invalidateQueries({queryKey:["returnableOrders"]}),x([]),w("")}catch{k.error("Gửi yêu cầu trả hàng thất bại")}finally{T(!1)}};return t?e.jsxs(O,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Y,{children:e.jsx(L,{children:"Tạo yêu cầu trả hàng"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(j,{children:e.jsxs(p,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Thông tin đơn hàng"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-maintext",children:"Mã đơn hàng:"}),e.jsxs("span",{className:"ml-2 font-medium",children:["#",t.code]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-maintext",children:"Tổng tiền:"}),e.jsx("span",{className:"ml-2 font-medium",children:I(t.total)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-maintext",children:"Ngày đặt:"}),e.jsx("span",{className:"ml-2 font-medium",children:new Date(t.createdAt).toLocaleDateString("vi-VN")})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-maintext",children:"Trạng thái:"}),e.jsx("span",{className:"ml-2 font-medium text-green-600",children:"Đã hoàn thành"})]})]})]})}),e.jsx(j,{children:e.jsxs(p,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"Chọn sản phẩm cần trả"}),e.jsx("div",{className:"space-y-4",children:t.items.map((s,i)=>{var d,m,a;return e.jsx("div",{className:"border rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(oe,{checked:r(s),onCheckedChange:c=>y(s,c)}),e.jsx("img",{src:s.product.images[0]||"/placeholder.jpg",alt:s.product.name,width:80,height:80,className:"rounded-md object-cover"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium",children:s.product.name}),e.jsxs("p",{className:"text-sm text-maintext",children:[(d=s.variant.color)==null?void 0:d.name," - ",(m=s.variant.size)==null?void 0:m.name]}),e.jsxs("p",{className:"text-sm text-maintext",children:["Đã mua: ",s.quantity," | Giá: ",I(s.price)]})]}),r(s)&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm",children:"Số lượng trả:"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(u,{variant:"outline",size:"sm",onClick:()=>{const c=l.findIndex(h=>{var N;return h.product===((N=s.product)==null?void 0:N.id)&&h.variant.colorId===s.variant.colorId&&h.variant.sizeId===s.variant.sizeId});c!==-1&&D(c,l[c].quantity-1)},children:e.jsx(o.Icon,{path:W,size:.7})}),e.jsx(Z,{type:"number",min:"1",max:s.quantity,value:((a=l.find(c=>{var h;return c.product===((h=s.product)==null?void 0:h.id)&&c.variant.colorId===s.variant.colorId&&c.variant.sizeId===s.variant.sizeId}))==null?void 0:a.quantity)||1,onChange:c=>{const h=l.findIndex(N=>{var V;return N.product===((V=s.product)==null?void 0:V.id)&&N.variant.colorId===s.variant.colorId&&N.variant.sizeId===s.variant.sizeId});h!==-1&&D(h,parseInt(c.target.value)||1)},className:"w-16 text-center"}),e.jsx(u,{variant:"outline",size:"sm",onClick:()=>{const c=l.findIndex(h=>{var N;return h.product===((N=s.product)==null?void 0:N.id)&&h.variant.colorId===s.variant.colorId&&h.variant.sizeId===s.variant.sizeId});c!==-1&&D(c,l[c].quantity+1)},children:e.jsx(o.Icon,{path:ee,size:.7})})]})]})]})},i)})})]})}),e.jsx(j,{children:e.jsxs(p,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Lý do trả hàng *"}),e.jsx(me,{placeholder:"Vui lòng mô tả lý do bạn muốn trả hàng...",value:g,onChange:s=>w(s.target.value),rows:4,className:"w-full"})]})}),l.length>0&&e.jsx(j,{children:e.jsxs(p,{className:"p-4",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Tóm tắt yêu cầu trả hàng"}),e.jsxs("div",{className:"space-y-2",children:[l.map((s,i)=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{children:[s.productName," (",s.variantInfo,") x",s.quantity]}),e.jsx("span",{children:I(s.price*s.quantity)})]},i)),e.jsxs("div",{className:"border-t pt-2 flex justify-between font-semibold",children:[e.jsx("span",{children:"Tổng tiền hoàn trả:"}),e.jsx("span",{className:"text-primary",children:I(n())})]})]})]})})]}),e.jsxs(P,{children:[e.jsx(u,{variant:"outline",disabled:f,children:"Hủy"}),e.jsx(u,{onClick:b,disabled:f||l.length===0||!g.trim(),children:f?"Đang gửi...":"Gửi yêu cầu"})]})]}):null}function ye({onConfirm:t,onCancel:l,isLoading:x=!1}){return e.jsxs(O,{className:"max-w-4xl",children:[e.jsx(Y,{children:e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(o.Icon,{path:se,size:1,className:"text-red-500"}),"Xác nhận hủy yêu cầu"]})}),e.jsx("div",{className:"py-4",children:e.jsx("p",{className:"text-maintext",children:"Bạn có chắc chắn muốn hủy yêu cầu trả hàng này không? Hành động này không thể hoàn tác."})}),e.jsxs(P,{children:[e.jsx(u,{variant:"outline",onClick:l,disabled:x,children:"Không, giữ lại"}),e.jsx(u,{variant:"destructive",onClick:t,disabled:x,children:x?"Đang hủy...":"Có, hủy yêu cầu"})]})]})}function ve({returnItem:t}){const[l,x]=v.useState(!1),{data:g,isLoading:w}=le((t==null?void 0:t.id)||""),f=de(),T=$(),R=n=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND",maximumFractionDigits:0}).format(n),z=n=>G(new Date(n),"dd/MM/yyyy HH:mm",{locale:J}),I=n=>{switch(n){case"CHO_XU_LY":return e.jsxs(C,{variant:"outline",className:"bg-yellow-50 text-yellow-600 border-yellow-200",children:[e.jsx(o.Icon,{path:ae,size:.7,className:"mr-1"}),"Chờ xử lý"]});case"DA_HOAN_TIEN":return e.jsxs(C,{variant:"outline",className:"bg-green-50 text-green-600 border-green-200",children:[e.jsx(o.Icon,{path:B,size:.7,className:"mr-1"}),"Đã hoàn tiền"]});case"DA_HUY":return e.jsxs(C,{variant:"outline",className:"bg-red-50 text-red-600 border-red-200",children:[e.jsx(o.Icon,{path:U,size:.7,className:"mr-1"}),"Đã hủy"]});default:return e.jsx(C,{variant:"outline",children:"Không xác định"})}},y=(n,b,s)=>{const i=[{key:"CHO_XU_LY",label:"Chờ xử lý",date:b},{key:"DA_HOAN_TIEN",label:"Đã hoàn tiền",date:n==="DA_HOAN_TIEN"?s:null},{key:"DA_HUY",label:"Đã hủy",date:n==="DA_HUY"?s:null}];return e.jsx("div",{className:"space-y-4",children:i.map((d,m)=>{d.key;const a=d.date!==null;return e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center ${a?"bg-primary text-white":"bg-gray-200 text-maintext"}`,children:a?e.jsx(o.Icon,{path:B,size:.7}):e.jsx("span",{className:"text-sm",children:m+1})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:`font-medium ${a?"text-gray-900":"text-maintext"}`,children:d.label}),d.date&&e.jsx("p",{className:"text-sm text-maintext",children:z(d.date)})]})]},d.key)})})},D=async()=>{if(t)try{await f.mutateAsync(t==null?void 0:t.id),k.success("Đã hủy yêu cầu trả hàng thành công"),T.invalidateQueries({queryKey:["myReturns"]}),T.invalidateQueries({queryKey:["myReturn",t==null?void 0:t.id]}),x(!1)}catch{k.error("Hủy yêu cầu trả hàng thất bại")}};if(!t)return null;const r=(g==null?void 0:g.data)||t;return e.jsxs(O,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Y,{children:e.jsxs(L,{className:"flex items-center justify-between",children:[e.jsxs("span",{children:["Chi tiết yêu cầu trả hàng #",r.code]}),I(r.status)]})}),w?e.jsx("div",{className:"space-y-4",children:[1,2,3].map(n=>e.jsx("div",{className:"h-32 bg-gray-100 rounded-lg animate-pulse"},n))}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs(j,{children:[e.jsx(H,{children:e.jsx(A,{children:"Thông tin yêu cầu trả hàng"})}),e.jsx(p,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-maintext",children:"Mã yêu cầu:"}),e.jsxs("span",{className:"ml-2 font-medium",children:["#",r.code]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-maintext",children:"Đơn hàng gốc:"}),e.jsxs("span",{className:"ml-2 font-medium",children:["#",typeof r.originalOrder=="string"?r.originalOrder:r.originalOrder.code]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-maintext",children:"Ngày tạo:"}),e.jsx("span",{className:"ml-2 font-medium",children:z(r.createdAt)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-maintext",children:"Tổng tiền hoàn trả:"}),e.jsx("span",{className:"ml-2 font-medium text-primary",children:R(r.totalRefund)})]})]})})]}),e.jsxs(j,{children:[e.jsx(H,{children:e.jsx(A,{children:"Trạng thái xử lý"})}),e.jsx(p,{children:y(r.status,r.createdAt,r.updatedAt)})]}),e.jsxs(j,{children:[e.jsx(H,{children:e.jsx(A,{children:"Sản phẩm trả hàng"})}),e.jsx(p,{children:e.jsxs(ue,{children:[e.jsx(je,{children:e.jsxs(F,{children:[e.jsx(S,{children:"Sản phẩm"}),e.jsx(S,{children:"Phân loại"}),e.jsx(S,{children:"Số lượng"}),e.jsx(S,{children:"Đơn giá"}),e.jsx(S,{children:"Thành tiền"})]})}),e.jsx(pe,{children:r.items.map((n,b)=>{var s,i;return e.jsxs(F,{children:[e.jsx(q,{children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:"/placeholder.jpg",alt:"Product",width:50,height:50,className:"rounded-md object-cover"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:typeof n=="object"&&"product"in n&&typeof n.product=="object"?n.product.name:"Sản phẩm"}),e.jsx("p",{className:"text-sm text-maintext",children:typeof n=="object"&&"product"in n&&typeof n.product=="object"?n.product.code:""})]})]})}),e.jsx(q,{children:e.jsxs("div",{className:"text-sm",children:[e.jsxs("p",{children:["Màu: ",((s=n.variant)==null?void 0:s.colorId)||"N/A"]}),e.jsxs("p",{children:["Size: ",((i=n.variant)==null?void 0:i.sizeId)||"N/A"]})]})}),e.jsx(q,{children:n.quantity}),e.jsx(q,{children:R(n.price)}),e.jsx(q,{children:R(n.price*n.quantity)})]},b)})})]})})]})]}),e.jsx(P,{children:e.jsxs("div",{className:"flex gap-2",children:[r.status==="CHO_XU_LY"&&e.jsxs(_,{open:l,onOpenChange:x,children:[e.jsx(M,{asChild:!0,children:e.jsxs(u,{variant:"destructive",children:[e.jsx(o.Icon,{path:U,size:.7,className:"mr-1"}),"Hủy yêu cầu"]})}),e.jsx(ye,{onConfirm:D,onCancel:()=>x(!1),isLoading:f.isPending})]}),e.jsx(u,{variant:"outline",children:"Đóng"})]})})]})}const Ae=()=>{const[t,l]=v.useState("returnable"),[x,g]=v.useState(null),[w,f]=v.useState(null),[T,R]=v.useState({page:1,limit:10}),[z,I]=v.useState({page:1,limit:10}),{data:y,isLoading:D}=he(T),{data:r,isLoading:n}=xe(z),b=a=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND",maximumFractionDigits:0}).format(a),s=a=>G(new Date(a),"dd/MM/yyyy",{locale:J}),i=a=>{switch(a){case"CHO_XU_LY":return e.jsx(C,{variant:"outline",className:"bg-yellow-50 text-yellow-600 border-yellow-200",children:"Chờ xử lý"});case"DA_HOAN_TIEN":return e.jsx(C,{variant:"outline",className:"bg-green-50 text-green-600 border-green-200",children:"Đã hoàn tiền"});case"DA_HUY":return e.jsx(C,{variant:"outline",className:"bg-red-50 text-red-600 border-red-200",children:"Đã hủy"});default:return e.jsx(C,{variant:"outline",children:"Không xác định"})}},d=({order:a})=>e.jsx(j,{className:"hover:shadow-md transition-shadow",children:e.jsxs(p,{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-lg",children:["#",a.code]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-maintext mt-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(o.Icon,{path:K,size:.7}),s(a.createdAt)]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(o.Icon,{path:Q,size:.7}),b(a.total)]})]})]}),e.jsxs(_,{children:[e.jsx(M,{asChild:!0,children:e.jsxs(u,{variant:"outline",size:"sm",onClick:()=>g(a),children:[e.jsx(o.Icon,{path:ne,size:.7,className:"mr-1"}),"Yêu cầu trả hàng"]})}),e.jsx(ge,{order:x})]})]}),e.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-2",children:[a.items.slice(0,3).map((c,h)=>e.jsx("div",{className:"flex-shrink-0",children:e.jsx("img",{src:c.product.images[0]||"/placeholder.jpg",alt:c.product.name,width:60,height:60,className:"rounded-md object-cover"})},h)),a.items.length>3&&e.jsxs("div",{className:"flex-shrink-0 w-15 h-15 bg-gray-100 rounded-md flex items-center justify-center text-sm text-maintext",children:["+",a.items.length-3]})]})]})}),m=({returnItem:a})=>e.jsx(j,{className:"hover:shadow-md transition-shadow",children:e.jsxs(p,{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-lg",children:["#",a.code]}),e.jsxs("p",{className:"text-sm text-maintext",children:["Đơn gốc: #",typeof a.originalOrder=="string"?a.originalOrder:a.originalOrder.code]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-maintext mt-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(o.Icon,{path:K,size:.7}),s(a.createdAt)]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(o.Icon,{path:Q,size:.7}),b(a.totalRefund)]})]})]}),e.jsxs("div",{className:"flex flex-col gap-2 items-end",children:[i(a.status),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(_,{children:[e.jsx(M,{asChild:!0,children:e.jsxs(u,{variant:"outline",size:"sm",onClick:()=>f(a),children:[e.jsx(o.Icon,{path:te,size:.7,className:"mr-1"}),"Chi tiết"]})}),e.jsx(ve,{returnItem:w})]}),a.status==="CHO_XU_LY"&&e.jsx(u,{variant:"destructive",size:"sm",children:"Hủy yêu cầu"})]})]})]}),e.jsxs("div",{className:"flex gap-2 overflow-x-auto pb-2",children:[a.items.slice(0,3).map((c,h)=>e.jsx("div",{className:"flex-shrink-0",children:e.jsx("img",{src:"/placeholder.jpg",alt:"Product",width:60,height:60,className:"rounded-md object-cover"})},h)),a.items.length>3&&e.jsxs("div",{className:"flex-shrink-0 w-15 h-15 bg-gray-100 rounded-md flex items-center justify-center text-sm text-maintext",children:["+",a.items.length-3]})]})]})});return e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Quản lý trả hàng"}),e.jsx("p",{className:"text-maintext",children:"Xem đơn hàng có thể trả và quản lý yêu cầu trả hàng của bạn"})]}),e.jsxs(ie,{value:t,onValueChange:l,className:"w-full",children:[e.jsxs(ce,{className:"grid w-full grid-cols-2",children:[e.jsx(E,{value:"returnable",children:"Đơn hàng có thể trả"}),e.jsx(E,{value:"my-returns",children:"Yêu cầu trả hàng của tôi"})]}),e.jsx(X,{value:"returnable",className:"space-y-4",children:e.jsxs(j,{children:[e.jsxs(H,{children:[e.jsx(A,{children:"Đơn hàng có thể trả hàng"}),e.jsx("p",{className:"text-sm text-maintext",children:"Chỉ hiển thị đơn hàng đã hoàn thành trong vòng 7 ngày qua"})]}),e.jsx(p,{children:D?e.jsx("div",{className:"space-y-4",children:[1,2,3].map(a=>e.jsx("div",{className:"h-32 bg-gray-100 rounded-lg animate-pulse"},a))}):(y==null?void 0:y.data.orders.length)===0?e.jsx("div",{className:"text-center py-8 text-maintext",children:"Không có đơn hàng nào có thể trả hàng"}):e.jsx("div",{className:"space-y-4",children:y==null?void 0:y.data.orders.map(a=>e.jsx(d,{order:a},a.id))})})]})}),e.jsx(X,{value:"my-returns",className:"space-y-4",children:e.jsxs(j,{children:[e.jsxs(H,{children:[e.jsx(A,{children:"Yêu cầu trả hàng của tôi"}),e.jsx("p",{className:"text-sm text-maintext",children:"Xem trạng thái và chi tiết các yêu cầu trả hàng đã gửi"})]}),e.jsx(p,{children:n?e.jsx("div",{className:"space-y-4",children:[1,2,3].map(a=>e.jsx("div",{className:"h-32 bg-gray-100 rounded-lg animate-pulse"},a))}):(r==null?void 0:r.data.returns.length)===0?e.jsx("div",{className:"text-center py-8 text-maintext",children:"Bạn chưa có yêu cầu trả hàng nào"}):e.jsx("div",{className:"space-y-4",children:r==null?void 0:r.data.returns.map(a=>e.jsx(m,{returnItem:a},a==null?void 0:a.id))})})]})})]})]})};export{Ae as default};
