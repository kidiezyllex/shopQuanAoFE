function e(e,t){let r;try{r=e()}catch(n){return}return{getItem:e=>{var t;const n=e=>null===e?null:JSON.parse(e,void 0),o=null!=(t=r.getItem(e))?t:null;return o instanceof Promise?o.then(n):n(o)},setItem:(e,t)=>r.setItem(e,JSON.stringify(t,void 0)),removeItem:e=>r.removeItem(e)}}const t=e=>r=>{try{const n=e(r);return n instanceof Promise?n:{then:e=>t(e)(n),catch(e){return this}}}catch(n){return{then(e){return this},catch:e=>t(e)(n)}}},r=(r,n)=>(o,a,s)=>{let i={storage:e((()=>localStorage)),partialize:e=>e,version:0,merge:(e,t)=>({...t,...e}),...n},l=!1;const c=new Set,u=new Set;let m=i.storage;if(!m)return r(((...e)=>{o(...e)}),a,s);const d=()=>{const e=i.partialize({...a()});return m.setItem(i.name,{state:e,version:i.version})},v=s.setState;s.setState=(e,t)=>{v(e,t),d()};const h=r(((...e)=>{o(...e),d()}),a,s);let g;s.getInitialState=()=>h;const f=()=>{var e,r;if(!m)return;l=!1,c.forEach((e=>{var t;return e(null!=(t=a())?t:h)}));const n=(null==(r=i.onRehydrateStorage)?void 0:r.call(i,null!=(e=a())?e:h))||void 0;return t(m.getItem.bind(m))(i.name).then((e=>{if(e){if("number"!=typeof e.version||e.version===i.version)return[!1,e.state];if(i.migrate){const t=i.migrate(e.state,e.version);return t instanceof Promise?t.then((e=>[!0,e])):[!0,t]}}return[!1,void 0]})).then((e=>{var t;const[r,n]=e;if(g=i.merge(n,null!=(t=a())?t:h),o(g,!0),r)return d()})).then((()=>{null==n||n(g,void 0),g=a(),l=!0,u.forEach((e=>e(g)))})).catch((e=>{null==n||n(void 0,e)}))};return s.persist={setOptions:e=>{i={...i,...e},e.storage&&(m=e.storage)},clearStorage:()=>{null==m||m.removeItem(i.name)},getOptions:()=>i,rehydrate:()=>f(),hasHydrated:()=>l,onHydrate:e=>(c.add(e),()=>{c.delete(e)}),onFinishHydration:e=>(u.add(e),()=>{u.delete(e)})},i.skipHydration||f(),g||h};export{e as c,r as p};
