import{p as D}from"./middleware-C0Ya4A5M.js";import{aI as f}from"./index-Dpx_4rWJ.js";const d=c=>{const n=c.reduce((s,e)=>s+e.quantity,0),t=c.reduce((s,e)=>s+e.price*e.quantity,0);return{totalItems:n,totalPrice:t}},p=(c,n=0)=>{const t=c.reduce((i,a)=>i+a.price*a.quantity,0),s=t*.05,e=t>=5e5?0:3e4,o=t+s+e-n;return{subtotal:t,tax:s,shipping:e,total:o}},b=f(D((c,n)=>({items:[],totalItems:0,totalPrice:0,subtotal:0,tax:0,shipping:0,total:0,appliedVoucher:null,voucherDiscount:0,calculateVoucherDiscount:()=>{const{appliedVoucher:t,items:s}=n();if(!t)return 0;const e=s.reduce((o,i)=>o+i.price*i.quantity,0);if(t.discountType==="PERCENTAGE"){let o=e*t.discountValue/100;return t.maxDiscount&&o>t.maxDiscount&&(o=t.maxDiscount),o}else return Math.min(t.discountValue,e)},setAppliedVoucher:t=>{c({appliedVoucher:t});const s=n(),e=t?s.calculateVoucherDiscount():0,{subtotal:o,tax:i,shipping:a,total:l}=p(s.items,e);c({voucherDiscount:e,subtotal:o,tax:i,shipping:a,total:l})},removeVoucher:()=>{c({appliedVoucher:null,voucherDiscount:0});const{subtotal:t,tax:s,shipping:e,total:o}=p(n().items,0);c({subtotal:t,tax:s,shipping:e,total:o})},addToCart:(t,s)=>{const e=[...n().items],o=e.findIndex(r=>r.id===t.id);if(o!==-1){const r=e[o],x=r.quantity+s;if(r.stock&&x>r.stock)return;e[o].quantity=x}else{if(t.stock&&s>t.stock)return;e.push({id:t.id,productId:t.productId||t.id,name:t.name,price:t.price,originalPrice:t.originalPrice,discountPercent:t.discountPercent||0,hasDiscount:!!(t.hasDiscount||t.originalPrice&&t.originalPrice>t.price),image:t.image,quantity:s,slug:t.slug,brand:t.brand,colors:t.colors,size:t.size,stock:t.stock,colorId:t.colorId||"",sizeId:t.sizeId||"",colorName:t.colorName||"",sizeName:t.sizeName||""})}const{totalItems:i,totalPrice:a}=d(e),l=n().calculateVoucherDiscount(),{subtotal:u,tax:m,shipping:h,total:I}=p(e,l);c({items:e,totalItems:i,totalPrice:a,subtotal:u,tax:m,shipping:h,total:I,voucherDiscount:l})},removeFromCart:t=>{const s=n().items.filter(h=>h.id!==t),{totalItems:e,totalPrice:o}=d(s),i=n().calculateVoucherDiscount(),{subtotal:a,tax:l,shipping:u,total:m}=p(s,i);c({items:s,totalItems:e,totalPrice:o,subtotal:a,tax:l,shipping:u,total:m,voucherDiscount:i})},updateQuantity:(t,s)=>{const e=[...n().items],o=e.findIndex(i=>i.id===t);if(o!==-1){const i=e[o];i.stock&&s>i.stock?e[o].quantity=i.stock:s<=0?e.splice(o,1):e[o].quantity=s;const{totalItems:a,totalPrice:l}=d(e),u=n().calculateVoucherDiscount(),{subtotal:m,tax:h,shipping:I,total:r}=p(e,u);c({items:e,totalItems:a,totalPrice:l,subtotal:m,tax:h,shipping:I,total:r,voucherDiscount:u})}},clearCart:()=>{c({items:[],totalItems:0,totalPrice:0,subtotal:0,tax:0,shipping:0,total:0,appliedVoucher:null,voucherDiscount:0})}}),{name:"cart-storage"}));export{b as u};
