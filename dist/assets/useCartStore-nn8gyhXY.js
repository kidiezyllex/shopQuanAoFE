import{p as t}from"./middleware-DTCYSWSl.js";import{r as o}from"./index-BHeY-5EX.js";const i=t=>({totalItems:t.reduce(((t,o)=>t+o.quantity),0),totalPrice:t.reduce(((t,o)=>t+o.price*o.quantity),0)}),e=(t,o=0)=>{const i=t.reduce(((t,o)=>t+o.price*o.quantity),0),e=.05*i,a=i>=5e5?0:3e4;return{subtotal:i,tax:e,shipping:a,total:i+e+a-o}},a=o(t(((t,o)=>({items:[],totalItems:0,totalPrice:0,subtotal:0,tax:0,shipping:0,total:0,appliedVoucher:null,voucherDiscount:0,calculateVoucherDiscount:()=>{const{appliedVoucher:t,items:i}=o();if(!t)return 0;const e=i.reduce(((t,o)=>t+o.price*o.quantity),0);if("PERCENTAGE"===t.type){let o=e*t.value/100;return t.maxDiscount&&o>t.maxDiscount&&(o=t.maxDiscount),o}return Math.min(t.value,e)},setAppliedVoucher:i=>{t({appliedVoucher:i});const a=o(),s=i?a.calculateVoucherDiscount():0,{subtotal:c,tax:u,shipping:l,total:r}=e(a.items,s);t({voucherDiscount:s,subtotal:c,tax:u,shipping:l,total:r})},removeVoucher:()=>{t({appliedVoucher:null,voucherDiscount:0});const{subtotal:i,tax:a,shipping:s,total:c}=e(o().items,0);t({subtotal:i,tax:a,shipping:s,total:c})},addToCart:(a,s)=>{const c=[...o().items],u=c.findIndex((t=>t.id===a.id));if(-1!==u){const t=c[u],o=t.quantity+s;if(t.stock&&o>t.stock)return;c[u].quantity=o}else{if(a.stock&&s>a.stock)return;c.push({id:a.id,productId:a.productId||a.id,name:a.name,price:a.price,originalPrice:a.originalPrice,discountPercent:a.discountPercent||0,hasDiscount:Boolean(a.hasDiscount||a.originalPrice&&a.originalPrice>a.price),image:a.image,quantity:s,slug:a.slug,brand:a.brand,colors:a.colors,size:a.size,stock:a.stock,colorId:a.colorId||"",sizeId:a.sizeId||"",colorName:a.colorName||"",sizeName:a.sizeName||""})}const{totalItems:l,totalPrice:r}=i(c),n=o().calculateVoucherDiscount(),{subtotal:p,tax:m,shipping:d,total:h}=e(c,n);t({items:c,totalItems:l,totalPrice:r,subtotal:p,tax:m,shipping:d,total:h,voucherDiscount:n})},removeFromCart:a=>{const s=o().items.filter((t=>t.id!==a)),{totalItems:c,totalPrice:u}=i(s),l=o().calculateVoucherDiscount(),{subtotal:r,tax:n,shipping:p,total:m}=e(s,l);t({items:s,totalItems:c,totalPrice:u,subtotal:r,tax:n,shipping:p,total:m,voucherDiscount:l})},updateQuantity:(a,s)=>{const c=[...o().items],u=c.findIndex((t=>t.id===a));if(-1!==u){const a=c[u];a.stock&&s>a.stock?c[u].quantity=a.stock:s<=0?c.splice(u,1):c[u].quantity=s;const{totalItems:l,totalPrice:r}=i(c),n=o().calculateVoucherDiscount(),{subtotal:p,tax:m,shipping:d,total:h}=e(c,n);t({items:c,totalItems:l,totalPrice:r,subtotal:p,tax:m,shipping:d,total:h,voucherDiscount:n})}},clearCart:()=>{t({items:[],totalItems:0,totalPrice:0,subtotal:0,tax:0,shipping:0,total:0,appliedVoucher:null,voucherDiscount:0})}})),{name:"cart-storage"}));export{a as u};
